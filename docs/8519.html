<html>
<head>
<title>Crowdfunding dApp with Solidity and NextJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Solidity和NextJS众筹dApp</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/crowdfunding-dapp-with-solidity-and-nextjs-53e3737cc025?source=collection_archive---------11-----------------------#2022-06-12">https://medium.com/coinmonks/crowdfunding-dapp-with-solidity-and-nextjs-53e3737cc025?source=collection_archive---------11-----------------------#2022-06-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="c9ba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我是一个相当新的开发人员，我发现当我构建一个项目时学习编码是最容易的，所以我决定构建一个。</p><p id="c125" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我建立了一个不需要中介的众筹网站。终端用户进来，开始与平台互动。你可以<a class="ae jo" href="https://crowd-fund-darkmatterchimpanzee.vercel.app/" rel="noopener ugc nofollow" target="_blank">在这里</a>查看。</p><p id="5f56" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好了，说够了，让我们开始吧。</p><p id="3a7a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们从用我的主目录初始化truffle开始:</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="2d34" class="jy jz ht ju b fv ka kb l kc kd">truffle init</span></pre><p id="f1e8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我喜欢使用ganache appimage，所以启动它，它会在端口8545上为我们生成一个本地测试网。</p><p id="99b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">进入我的truffle.config.js进行必要的修改</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="2fea" class="jy jz ht ju b fv ka kb l kc kd">const HDWalletProvider = require('<a class="ae jo" href="http://twitter.com/truffle/hdwallet-provider" rel="noopener ugc nofollow" target="_blank">@truffle/hdwallet-provider</a>');</span><span id="8a9c" class="jy jz ht ju b fv ke kb l kc kd">const fs = require('fs');</span><span id="c1e1" class="jy jz ht ju b fv ke kb l kc kd">const mnemonic = fs.readFileSync(".secret").toString().trim();</span><span id="046b" class="jy jz ht ju b fv ke kb l kc kd">require('dotenv').config();</span><span id="0a10" class="jy jz ht ju b fv ke kb l kc kd">const projectID = process.env.PROJECT_ID;</span><span id="6fa3" class="jy jz ht ju b fv ke kb l kc kd">module.exports = {</span><span id="1012" class="jy jz ht ju b fv ke kb l kc kd">networks: {<br/>   development: {<br/>      host: "127.0.0.1",     // Localhost (default: none)<br/>      port: 8545,            // Standard Ethereum port (default: none)<br/>      network_id: "*",       // Any network (default: none)<br/>   },<br/>   rinkeby: {</span><span id="fe8c" class="jy jz ht ju b fv ke kb l kc kd">// 1.<br/>      provider: () =&gt; new HDWalletProvider(mnemonic, `<a class="ae jo" href="https://rinkeby.infura.io/v3/${projectID}`" rel="noopener ugc nofollow" target="_blank">https://rinkeby.infura.io/v3/${projectID}`</a>),<br/>      network_id: "4", // Rinkeby ID 4<br/>      gas: 4465030,<br/>      gasPrice: 10000000000,<br/>   }<br/>},</span><span id="ca9d" class="jy jz ht ju b fv ke kb l kc kd">// Set default mocha options here, use special reporters etc.</span><span id="a3eb" class="jy jz ht ju b fv ke kb l kc kd">mocha: {<br/>// timeout: 100000<br/>},</span><span id="6840" class="jy jz ht ju b fv ke kb l kc kd">// Configure your compilers</span><span id="5de4" class="jy jz ht ju b fv ke kb l kc kd">compilers: {<br/>      solc: {<br/>         version: "0.8.4",      // Fetch exact version from solc-bin (default: truffle's version)<br/>      settings: {          <br/>         optimizer: {<br/>            enabled: true,<br/>            runs: 200<br/>         },<br/>      }<br/>   }<br/>  },<br/>};</span></pre><p id="5d0d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我最终在rinkeby testnet上托管了这个项目，所以我在这里添加了infura端点。</p><p id="60fc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">转到infura dashboard，注册并为您的项目设置一个端点。<a class="ae jo" href="https://blog.infura.io/post/introducing-the-infura-dashboard-8969b7ab94e7" rel="noopener ugc nofollow" target="_blank">说明在这里</a>。一旦你建立了一个项目，进入设置，复制项目的ID并粘贴到根目录下的. env文件中</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="6d37" class="jy jz ht ju b fv ka kb l kc kd">PROJECT_ID=db0b4735bad24926a761d909e1f82576</span></pre><p id="09b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因为这个项目是公开的，所以我把它放在这里。你不会想在制作过程中这样做的。与危及安全有关。我不知道具体的原因，但钻研安全是我的下一步行动，所以有一天我会写一个帖子，我会知道为什么这是不安全的。</p><p id="c066" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">助记符是最终将它部署到testnet的帐户的私钥，所以确保在部署之前从rinkeby水龙头那里得到一些假的ETH。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><p id="1c02" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我将代码放在这里，因为它有很好的文档记录并且不言自明:</p><p id="d98c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://github.com/darkMatterChimpanzee/crowdFund" rel="noopener ugc nofollow" target="_blank"> github回购在这里</a>。相信我，你想看那里的代码，而不是这个巨大的没有颜色的怪物。</p><p id="16b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我通常喜欢在一开始就定义合同中的所有事件，因为这让我对合同中将要发生的所有事情有所了解</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="73ad" class="jy jz ht ju b fv ka kb l kc kd">// SPDX-License-Identifier: MIT<br/>pragma solidity ^0.8.4;</span><span id="d42b" class="jy jz ht ju b fv ke kb l kc kd">import "<a class="ae jo" href="http://twitter.com/openzeppelin/contracts" rel="noopener ugc nofollow" target="_blank">@openzeppelin/contracts</a>/utils/math/SafeMath.sol";<br/>import "<a class="ae jo" href="http://twitter.com/openzeppelin/contracts" rel="noopener ugc nofollow" target="_blank">@openzeppelin/contracts</a>/security/ReentrancyGuard.sol";</span><span id="a4fa" class="jy jz ht ju b fv ke kb l kc kd">contract CrowdFund is ReentrancyGuard {<br/>    using SafeMath for uint256;</span><span id="5a76" class="jy jz ht ju b fv ke kb l kc kd">/*===== Events =====*/<br/>    event NewProjectCreated(<br/>        uint256 indexed id,<br/>        address projectCreator,<br/>        string projectTitle,<br/>        string projectDesc,<br/>        uint256 projectDeadline,<br/>        uint256 goalAmount<br/>    );</span><span id="0f62" class="jy jz ht ju b fv ke kb l kc kd">event ExpireFundraise(<br/>        uint256 indexed id,<br/>        string name,<br/>        uint256 projectDeadline,<br/>        uint256 goal<br/>    );<br/>    <br/>    event SuccessFundRaise(<br/>        uint256 indexed id,<br/>        string name,<br/>        uint256 projectDeadline,<br/>        uint256 goal<br/>    );<br/>    <br/>    event SuccessButContinueFundRaise(<br/>        uint256 indexed id,<br/>        string name,<br/>        uint256 projectDeadline,<br/>        uint256 goal<br/>    );</span><span id="4401" class="jy jz ht ju b fv ke kb l kc kd">event FundsReceive(<br/>        uint256 indexed id,<br/>        address contributor,<br/>        uint256 amount,<br/>        uint256 totalPledged<br/>    );</span><span id="ad9b" class="jy jz ht ju b fv ke kb l kc kd">event NewWithdrawalRequest(<br/>        uint256 indexed id,<br/>        string description,<br/>        uint256 amount<br/>    );</span><span id="008d" class="jy jz ht ju b fv ke kb l kc kd">event GenerateRefund(<br/>        uint256 indexed id,<br/>        address refundRequestUser,<br/>        uint256 refundAmt<br/>    );</span><span id="b696" class="jy jz ht ju b fv ke kb l kc kd">event ApproveRequest(uint256 indexed _id, uint32 _withdrawalRequestIndex);</span><span id="fadb" class="jy jz ht ju b fv ke kb l kc kd">event RejectRequest(uint256 indexed _id, uint32 _withdrawalRequestIndex);</span><span id="8a09" class="jy jz ht ju b fv ke kb l kc kd">event TransferRequestFunds(<br/>        uint256 indexed _id,<br/>        uint32 _withdrawalRequestIndex<br/>    );</span><span id="2876" class="jy jz ht ju b fv ke kb l kc kd">event PayCreator( uint256 indexed _id, uint32 _withdrawalRequestIndex, uint256 _amountTransfered);</span><span id="c39b" class="jy jz ht ju b fv ke kb l kc kd">event PayPlatform(uint256 indexed _id, uint32 _withdrawalRequestIndex, uint256 _amountTransfered);</span></pre><p id="8a72" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们定义所有的状态变量。这些都是有状态的东西，在与用户互动的过程中会有某种转变。</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="3ef5" class="jy jz ht ju b fv ka kb l kc kd">/*===== State variables =====*/<br/>    address payable platformAdmin;</span><span id="0a94" class="jy jz ht ju b fv ke kb l kc kd">enum State {<br/>        Fundraise,<br/>        Expire,<br/>        Success<br/>    }</span><span id="04bd" class="jy jz ht ju b fv ke kb l kc kd">enum Withdrawal {<br/>        Allow,<br/>        Reject<br/>    }</span><span id="8751" class="jy jz ht ju b fv ke kb l kc kd">struct Project {<br/>        // project ID<br/>        uint256 id;<br/>        // address of the creator of project<br/>        address payable creator;<br/>        // name of the project<br/>        string name;<br/>        // description of the project<br/>        string description;<br/>        // end of fundraising date<br/>        uint256 projectDeadline;<br/>        // total amount that has been pledged until this point<br/>        uint256 totalPledged;<br/>        // total amount needed for a successful campaign<br/>        uint256 goal;<br/>        // number of depositors<br/>        uint256 totalDepositors;<br/>        // total funds withdrawn from project<br/>        uint256 totalWithdrawn;<br/>        // current state of the fundraise<br/>        State currentState;<br/>        // holds URL of IPFS upload<br/>        // string ipfsURL;<br/>    }</span><span id="5707" class="jy jz ht ju b fv ke kb l kc kd">struct WithdrawalRequest {<br/>        uint32 index;<br/>        // purpose of withdrawal<br/>        string description;<br/>        // amount of withdrawal requested<br/>        uint256 withdrawalAmount;<br/>        // project owner address<br/>        address payable recipient;<br/>        // total votes received for request<br/>        uint256 approvedVotes;<br/>        // current state of the withdrawal request<br/>        Withdrawal currentWithdrawalState;<br/>        // hash of the ipfs storage<br/>        // string ipfsHash;<br/>        // boolean to represent if amount has been withdrawn<br/>        bool withdrawn;<br/>    }</span><span id="341a" class="jy jz ht ju b fv ke kb l kc kd">mapping(address =&gt; uint) balances;</span><span id="d0a9" class="jy jz ht ju b fv ke kb l kc kd">// project states<br/>    uint256 public projectCount;<br/>    mapping(uint256 =&gt; Project) public idToProject;<br/>    // project id =&gt; contributor =&gt; contribution<br/>    mapping(uint256 =&gt; mapping(address =&gt; uint256)) public contributions;</span><span id="dcf8" class="jy jz ht ju b fv ke kb l kc kd">// withdrawal requests<br/>    mapping(uint256 =&gt; WithdrawalRequest[]) public idToWithdrawalRequests;<br/>    // project ID =&gt; withdrawal request Index<br/>    mapping(uint256 =&gt; uint32) latestWithdrawalIndex;</span><span id="fd38" class="jy jz ht ju b fv ke kb l kc kd">// project id =&gt; request number =&gt; address of contributors<br/>    mapping(uint256 =&gt; mapping(uint32 =&gt; address[])) approvals;<br/>    mapping(uint256 =&gt; mapping(uint32 =&gt; address[])) rejections;</span></pre><p id="91d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们放入一些修饰符来严格限制谁可以与契约函数交互。</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="d2b7" class="jy jz ht ju b fv ka kb l kc kd">/*===== Modifiers =====*/<br/>    modifier checkState(uint256 _id, State _state) {<br/>        require(<br/>            idToProject[_id].currentState == _state,<br/>            "Unmatching states. Invalid operation"<br/>        );<br/>        _;<br/>    }</span><span id="0802" class="jy jz ht ju b fv ke kb l kc kd">modifier onlyAdmin() {<br/>        require(<br/>            msg.sender == platformAdmin,<br/>            "Unauthorized access. Only admin can use this function"<br/>        );<br/>        _;<br/>    }</span><span id="89ce" class="jy jz ht ju b fv ke kb l kc kd">modifier onlyProjectOwner(uint256 _id) {<br/>        require(<br/>            msg.sender == idToProject[_id].creator,<br/>            "Unauthorized access. Only project owner can use this function"<br/>        );<br/>        _;<br/>    }</span><span id="582f" class="jy jz ht ju b fv ke kb l kc kd">modifier onlyProjectDonor(uint256 _id) {<br/>        require(<br/>            contributions[_id][msg.sender] &gt; 0,<br/>            "Unauthorized access. Only project funders can use this function."<br/>        );<br/>        _;<br/>    }</span><span id="6110" class="jy jz ht ju b fv ke kb l kc kd">modifier checkLatestWithdrawalIndex(<br/>        uint256 _id,<br/>        uint32 _withdrawalRequestIndex<br/>    ) {<br/>        require(<br/>            latestWithdrawalIndex[_id] == _withdrawalRequestIndex,<br/>            "This is not the latest withdrawal request. Please check again and try later"<br/>        );<br/>        _;<br/>    }</span></pre><p id="4dc8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我加了一个重入守卫，因为我只是不想让人们在这种公共利益上做贪婪的事情。</p><p id="19b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个契约的后备是平台管理员。如果有一些乙醚漂浮在周围，还不如把它发送给管理员，而不是浪费在合同上。</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="25a9" class="jy jz ht ju b fv ka kb l kc kd">constructor() ReentrancyGuard() {<br/>        platformAdmin = payable(msg.sender);<br/>        projectCount = 0;<br/>    }</span><span id="8efc" class="jy jz ht ju b fv ke kb l kc kd">// make contract payable<br/>    fallback() external payable {}<br/>    receive() external payable {<br/>        platformAdmin.transfer(msg.value);<br/>    }</span><span id="758c" class="jy jz ht ju b fv ke kb l kc kd">/*===== Functions  =====*/</span><span id="b033" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to start a new project.<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _name Name of the project<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _description Project Description<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _projectDeadline Total days to end of fundraise<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _goalEth Project goal in ETH<br/>     */<br/>    function createNewProject(<br/>        string memory _name,<br/>        string memory _description,<br/>        uint256 _projectDeadline,<br/>        uint256 _goalEth<br/>    ) public {<br/>        // update ID<br/>        projectCount += 1;</span><span id="5e6f" class="jy jz ht ju b fv ke kb l kc kd">        // log goal as wei<br/>        uint256 _goal = _goalEth * 1e18;</span><span id="674d" class="jy jz ht ju b fv ke kb l kc kd">        // create new fundraise object<br/>        Project memory newFR = Project({<br/>            id: projectCount,<br/>            creator: payable(msg.sender),<br/>            name: _name,<br/>            description: _description,<br/>            projectDeadline: _projectDeadline,<br/>            totalPledged: 0,<br/>            goal: _goal,<br/>            currentState: State.Fundraise,<br/>            totalDepositors: 0,<br/>            totalWithdrawn: 0<br/>        });</span><span id="b13a" class="jy jz ht ju b fv ke kb l kc kd">        // update mapping of id to new project<br/>        idToProject[projectCount] = newFR;</span><span id="3b5c" class="jy jz ht ju b fv ke kb l kc kd">        // initiate total withdrawal requests <br/>        latestWithdrawalIndex[projectCount] = 0;</span><span id="8b39" class="jy jz ht ju b fv ke kb l kc kd">        // emit event<br/>        emit NewProjectCreated(<br/>            projectCount,<br/>            msg.sender,<br/>            _name,<br/>            _description,<br/>            _projectDeadline,<br/>            _goal<br/>        );<br/>    }</span><span id="4240" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to make a contribution to the project<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID where contributions are to be made<br/>     */<br/>    function contributeFunds(uint256 _id)<br/>        public<br/>        payable<br/>        checkState(_id, State.Fundraise)<br/>        nonReentrant()<br/>    {<br/>        require(_id &lt;= projectCount, "Project ID out of range");</span><span id="dff7" class="jy jz ht ju b fv ke kb l kc kd">        require(<br/>            msg.value &gt; 0,<br/>            "Invalid transaction. Please send valid amounts to the project"<br/>        );</span><span id="7182" class="jy jz ht ju b fv ke kb l kc kd">        require(<br/>            block.timestamp &lt;= idToProject[_id].projectDeadline,<br/>            "Contributions cannot be made to this project anymore."<br/>        );</span><span id="d8a9" class="jy jz ht ju b fv ke kb l kc kd">        // transfer contributions to contract address<br/>        balances[address(this)] += msg.value;</span><span id="f3bd" class="jy jz ht ju b fv ke kb l kc kd">       // add to contribution<br/>        contributions[_id][msg.sender] += msg.value;</span><span id="1110" class="jy jz ht ju b fv ke kb l kc kd">        // increase total contributions pledged to the project<br/>        idToProject[_id].totalPledged += msg.value;</span><span id="1b76" class="jy jz ht ju b fv ke kb l kc kd">        // add one to total number of depositors for this project<br/>        idToProject[_id].totalDepositors += 1;</span><span id="fc79" class="jy jz ht ju b fv ke kb l kc kd">        emit FundsReceive(<br/>            _id,<br/>            msg.sender,<br/>            msg.value,<br/>            idToProject[_id].totalPledged<br/>        );<br/>    }</span><span id="ddeb" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to end fundraising drive<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>    */<br/>    function endContributionsExpire(uint256 _id) <br/>        public <br/>        onlyProjectDonor(_id)<br/>        checkState(_id, State.Fundraise) <br/>        {<br/>            require(<br/>                block.timestamp &gt; idToProject[_id].projectDeadline,<br/>                "Invalid request. Can only be called after project deadline is reached"<br/>            );</span><span id="99c5" class="jy jz ht ju b fv ke kb l kc kd">            idToProject[_id].currentState = State.Expire;<br/>            emit ExpireFundraise(_id,<br/>                idToProject[_id].name,<br/>                idToProject[_id].projectDeadline,<br/>                idToProject[_id].goal<br/>            );<br/>        }<br/>    <br/>    /** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to end fundraising drive with success is total pledged higher than goal. Irrespective of deadline<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>    */<br/>    function endContributionsSuccess(uint256 _id) <br/>        public <br/>        onlyProjectOwner(_id)<br/>        checkState(_id, State.Fundraise) <br/>        {<br/>            require(idToProject[_id].totalPledged &gt;= idToProject[_id].goal, "Did not receive enough funds");</span><span id="487a" class="jy jz ht ju b fv ke kb l kc kd">            idToProject[_id].currentState = State.Success;<br/>            emit SuccessFundRaise(<br/>                _id,<br/>                idToProject[_id].name,<br/>                idToProject[_id].projectDeadline,<br/>                idToProject[_id].goal<br/>            );                <br/>        }</span><span id="a2db" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to get refund on expired projects<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>     */<br/>    function getRefund(uint256 _id)<br/>        public<br/>        payable<br/>        onlyProjectDonor(_id)<br/>        checkState(_id, State.Expire)<br/>        nonReentrant()<br/>    {<br/>        require(<br/>            block.timestamp &gt; idToProject[_id].projectDeadline,<br/>            "Project deadline hasn't been reached yet"<br/>        );</span><span id="934b" class="jy jz ht ju b fv ke kb l kc kd">        address payable _contributor = payable(msg.sender);<br/>        uint256 _amount = contributions[_id][msg.sender];<br/>        (bool success, ) = _contributor.call{value: _amount}("");<br/>        require(success, "Transaction failed. Please try again later.");<br/>        emit GenerateRefund(_id, _contributor, _amount);</span><span id="4615" class="jy jz ht ju b fv ke kb l kc kd">        // update project state<br/>        idToProject[_id].totalPledged -= _amount;<br/>        idToProject[_id].totalDepositors -= 1;<br/>    }</span><span id="59fb" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to create a request for withdrawal of funds<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _requestNumber Index of the request<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _description  Purpose of withdrawal<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _amount Amount of withdrawal requested in ETH<br/>    */<br/>    function createWithdrawalRequest(<br/>        uint256 _id,<br/>        uint32 _requestNumber,<br/>        string memory _description,<br/>        uint256 _amount<br/>    ) public onlyProjectOwner(_id) checkState(_id, State.Success){<br/>        require(idToProject[_id].totalWithdrawn &lt; idToProject[_id].totalPledged, "Insufficient funds");</span><span id="8974" class="jy jz ht ju b fv ke kb l kc kd">        require(_requestNumber == latestWithdrawalIndex[_id] + 1, "Incorrect request number");</span><span id="b394" class="jy jz ht ju b fv ke kb l kc kd">        // convert ETH to Wei units<br/>        uint256 _withdraw = _amount * 1e18;</span><span id="a481" class="jy jz ht ju b fv ke kb l kc kd">        // create new withdrawal request<br/>        WithdrawalRequest memory newWR = WithdrawalRequest({<br/>            index: _requestNumber,<br/>            description: _description,<br/>            withdrawalAmount: _withdraw,<br/>            // funds withdrawn to project owner<br/>            recipient: idToProject[_id].creator,<br/>            // initialized with no votes for request<br/>            approvedVotes: 0,<br/>            // state changes on quorum<br/>            currentWithdrawalState: Withdrawal.Reject,<br/>            withdrawn: false<br/>        });</span><span id="4761" class="jy jz ht ju b fv ke kb l kc kd">        // update project to request mapping<br/>        idToWithdrawalRequests[_id].push(newWR);<br/>        <br/>        latestWithdrawalIndex[_id] += 1;</span><span id="b5df" class="jy jz ht ju b fv ke kb l kc kd">        // emit event<br/>        emit NewWithdrawalRequest(_id, _description, _amount);<br/>    }</span><span id="9286" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to check whether a given address has approved a specific request<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _withdrawalRequestIndex Index of the withdrawal request<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _checkAddress Address of the request initiator<br/>    */<br/>    function _checkAddressInApprovalsIterator(<br/>        uint256 _id,<br/>        uint32 _withdrawalRequestIndex, <br/>        address _checkAddress<br/>    )<br/>        internal<br/>        view <br/>        returns(bool approved) <br/>    {<br/>        // iterate over the array specific to this id and withdrawal request<br/>        for (uint256 i = 0; i &lt; approvals[_id][_withdrawalRequestIndex - 1].length; i++) {<br/>            // if address is in the array, return true<br/>            if(approvals[_id][_withdrawalRequestIndex - 1][i] == _checkAddress) {<br/>                approved = true;<br/>            }<br/>        }<br/>    }</span><span id="4228" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to check whether a given address has rejected a specific request<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _withdrawalRequestIndex Index of the withdrawal request<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _checkAddress Address of the request initiator<br/>    */<br/>    function _checkAddressInRejectionIterator(<br/>        uint256 _id,<br/>        uint32 _withdrawalRequestIndex, <br/>        address _checkAddress<br/>    ) <br/>        internal<br/>        view<br/>        returns(bool rejected) <br/>    {<br/>        // iterate over the array specific to this id and withdrawal request<br/>        for (uint256 i = 0; i &lt; rejections[_id][_withdrawalRequestIndex - 1].length; i++) {<br/>            // if address is in the array, return true<br/>            if(rejections[_id][_withdrawalRequestIndex - 1][i] == _checkAddress) {<br/>                rejected = true;<br/>            }<br/>        }<br/>    }</span><span id="2232" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to approve withdrawal of funds<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>    * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _withdrawalRequestIndex Index of withdrawal request<br/>    */<br/>    function approveWithdrawalRequest(<br/>        uint256 _id,<br/>        uint32 _withdrawalRequestIndex<br/>    )<br/>        public<br/>        onlyProjectDonor(_id)<br/>        checkState(_id, State.Success)<br/>        checkLatestWithdrawalIndex(_id, _withdrawalRequestIndex)<br/>    {<br/>        // confirm msg.sender hasn't approved request yet<br/>        require(!_checkAddressInApprovalsIterator(_id, _withdrawalRequestIndex, msg.sender), <br/>                "Invalid operation. You have already approved this request");</span><span id="d8d9" class="jy jz ht ju b fv ke kb l kc kd">         require(!_checkAddressInRejectionIterator(_id, _withdrawalRequestIndex, msg.sender), <br/>                "Invalid operation. You have rejected this request");</span><span id="3692" class="jy jz ht ju b fv ke kb l kc kd">        // get total withdrawal requests made<br/>        uint256 _lastWithdrawal = latestWithdrawalIndex[_id];</span><span id="676b" class="jy jz ht ju b fv ke kb l kc kd">       // iterate over all requests for this project<br/>        for (uint256 i = 0; i &lt; _lastWithdrawal; i++) {<br/>            // if request number is equal to index<br/>            if(i + 1 == _withdrawalRequestIndex) {<br/>                // increment approval count<br/>                idToWithdrawalRequests[_id][i].approvedVotes += 1;<br/>            }<br/>        }</span><span id="7123" class="jy jz ht ju b fv ke kb l kc kd">        // push msg.sender to approvals list for this request<br/>        approvals[_id][_withdrawalRequestIndex - 1].push(msg.sender);<br/>        <br/>        emit ApproveRequest(_id, _withdrawalRequestIndex);<br/>    }</span><span id="2399" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to reject withdrawal of funds<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _withdrawalRequestIndex Index of withdrawal request<br/>     */<br/>    function rejectWithdrawalRequest(<br/>        uint256 _id,<br/>        uint32 _withdrawalRequestIndex<br/>    )<br/>        public<br/>        onlyProjectDonor(_id)<br/>        checkState(_id, State.Success)<br/>        checkLatestWithdrawalIndex(_id, _withdrawalRequestIndex)<br/>    {<br/>        // confirm user hasn't approved request<br/>        require(!_checkAddressInApprovalsIterator(_id, _withdrawalRequestIndex, msg.sender), <br/>                "Invalid operation. You have approved this request");<br/>        require(!_checkAddressInRejectionIterator(_id, _withdrawalRequestIndex, msg.sender), <br/>                "Invalid operation. You have already rejected this request");</span><span id="c68d" class="jy jz ht ju b fv ke kb l kc kd">        // get total withdrawal requests made<br/>        uint256 _lastWithdrawal = latestWithdrawalIndex[_id];</span><span id="450b" class="jy jz ht ju b fv ke kb l kc kd">        // iterate over all requests for this project<br/>        for (uint256 i = 0; i &lt; _lastWithdrawal; i++) {<br/>            // if request number is equal to index<br/>            if(i + 1 == _withdrawalRequestIndex) {<br/>                // if there hve been approvals, decrement<br/>                if(idToWithdrawalRequests[_id][i].approvedVotes != 0) {<br/>                    // decrement approval count<br/>                    idToWithdrawalRequests[_id][i].approvedVotes -= 1;<br/>                } <br/>                    // else if no one has approved request yet, keep approvals to 0<br/>                else {<br/>                    idToWithdrawalRequests[_id][i].approvedVotes == 0;<br/>                }<br/>            }<br/>        }</span><span id="7058" class="jy jz ht ju b fv ke kb l kc kd">        // add msg.sender to rejections list for this request<br/>        rejections[_id][_withdrawalRequestIndex - 1].push(msg.sender);</span><span id="59d7" class="jy jz ht ju b fv ke kb l kc kd">emit RejectRequest(_id, _withdrawalRequestIndex);<br/>    }</span><span id="38dd" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to transfer funds to project creator<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _withdrawalRequestIndex Index of withdrawal request<br/>     */<br/>    function transferWithdrawalRequestFunds(<br/>        uint256 _id,<br/>        uint32 _withdrawalRequestIndex<br/>    )<br/>        public<br/>        payable<br/>        onlyProjectOwner(_id)<br/>        checkLatestWithdrawalIndex(_id, _withdrawalRequestIndex)<br/>        nonReentrant()<br/>    {<br/>        require(<br/>     // _withdrawalRequestIndex - 1 to accomodate 0 start of arrays<br/>            idToWithdrawalRequests[_id][_withdrawalRequestIndex - 1].approvedVotes &gt; (idToProject[_id].totalDepositors).div(2),<br/>            "More than half the total depositors need to approve withdrawal request"<br/>        );</span><span id="a60a" class="jy jz ht ju b fv ke kb l kc kd">        require(idToWithdrawalRequests[_id][_withdrawalRequestIndex - 1].withdrawn == false, "Withdrawal has laready been made for this request");</span><span id="d4e9" class="jy jz ht ju b fv ke kb l kc kd">         require(idToWithdrawalRequests[_id][_withdrawalRequestIndex - 1].withdrawalAmount &lt; idToProject[_id].totalPledged, "Insufficient funds");</span><span id="7e78" class="jy jz ht ju b fv ke kb l kc kd">          WithdrawalRequest storage cRequest = idToWithdrawalRequests[_id][_withdrawalRequestIndex - 1];</span><span id="df22" class="jy jz ht ju b fv ke kb l kc kd">        // flat 0.3% platform fee<br/>        uint256 platformFee = (cRequest.withdrawalAmount.mul(3)).div(1000);<br/>        (bool pfSuccess, ) = payable(platformAdmin).call{value: platformFee}("");<br/>        require(pfSuccess, "Transaction failed. Please try again later.");<br/>        emit PayPlatform(_id, _withdrawalRequestIndex, platformFee);<br/>        <br/>        // transfer funds to creator<br/>        address payable _creator = idToProject[_id].creator;<br/>        uint256 _amount = cRequest.withdrawalAmount - platformFee;<br/>        (bool success, ) = _creator.call{value: _amount}("");<br/>        require(success, "Transaction failed. Please try again later.");<br/>        emit PayCreator(_id, _withdrawalRequestIndex, _amount);</span><span id="8bab" class="jy jz ht ju b fv ke kb l kc kd">        // update states<br/>        cRequest.withdrawn = true;<br/>        idToProject[_id].totalWithdrawn += cRequest.withdrawalAmount;</span><span id="7499" class="jy jz ht ju b fv ke kb l kc kd">        emit TransferRequestFunds(_id, _withdrawalRequestIndex);<br/>    }</span></pre><p id="394a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将是基本功能。接下来是视图函数，允许前端查询区块链和显示状态。</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="d332" class="jy jz ht ju b fv ka kb l kc kd">/*===== Blockchain get functions =====*/</span><span id="7f96" class="jy jz ht ju b fv ke kb l kc kd">/** <a class="ae jo" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Function to get project details<br/>     * <a class="ae jo" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _id Project ID<br/>     */<br/>    function getProjectDetails(uint256 _id)<br/>        public<br/>        view<br/>        returns (<br/>            address creator,<br/>            string memory name,<br/>            string memory description,<br/>            uint256 projectDeadline,<br/>            uint256 totalPledged,<br/>            uint256 goal,<br/>            uint256 totalDepositors,<br/>            uint256 totalWithdrawn,<br/>            State currentState</span><span id="3c0a" class="jy jz ht ju b fv ke kb l kc kd">)<br/>    {<br/>        creator = idToProject[_id].creator;<br/>        name = idToProject[_id].name;<br/>        description = idToProject[_id].description;<br/>        projectDeadline = idToProject[_id].projectDeadline;<br/>        totalPledged = idToProject[_id].totalPledged;<br/>        goal = idToProject[_id].goal;<br/>        totalDepositors = idToProject[_id].totalDepositors;<br/>        totalWithdrawn = idToProject[_id].totalWithdrawn;<br/>        currentState = idToProject[_id].currentState;<br/>    }</span><span id="bbfd" class="jy jz ht ju b fv ke kb l kc kd">function getAllProjects() public view returns (Project[] memory) {<br/>        uint256 _projectCount = projectCount;</span><span id="1434" class="jy jz ht ju b fv ke kb l kc kd">        Project[] memory projects = new Project[](_projectCount);<br/>        for (uint256 i = 0; i &lt; _projectCount; i++) {<br/>            uint256 currentId = i + 1;<br/>            Project storage currentItem = idToProject[currentId];<br/>            projects[i] = currentItem;<br/>        }<br/>        return projects;<br/>    }</span><span id="a28a" class="jy jz ht ju b fv ke kb l kc kd">function getProjectCount() public view returns (uint256 count) {<br/>        count = projectCount;<br/>    }</span><span id="9ef2" class="jy jz ht ju b fv ke kb l kc kd">function getAllWithdrawalRequests(uint256 _id)<br/>        public<br/>        view<br/>        returns (WithdrawalRequest[] memory)<br/>    {<br/>        uint256 _lastWithdrawal = latestWithdrawalIndex[_id];</span><span id="f1cb" class="jy jz ht ju b fv ke kb l kc kd">        WithdrawalRequest[] memory withdrawals = new WithdrawalRequest[](<br/>            _lastWithdrawal<br/>        );<br/>        for (uint256 i = 0; i &lt; _lastWithdrawal; i++) {<br/>            WithdrawalRequest storage currentRequest = idToWithdrawalRequests[_id][i];<br/>            withdrawals[i] = currentRequest;<br/>        }</span><span id="8b80" class="jy jz ht ju b fv ke kb l kc kd">        return withdrawals;<br/>    }</span><span id="b2c0" class="jy jz ht ju b fv ke kb l kc kd">function getContributions(uint256 _id, address _contributor) public view returns(uint256) {<br/>        return contributions[_id][_contributor];<br/>    }<br/>}</span></pre><p id="6c48" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦写好了契约，就用</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="eda4" class="jy jz ht ju b fv ka kb l kc kd">truffle migrate</span></pre><p id="21f5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在交易收据中，复制合同地址并创建一个名为config.js的文件</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="9c4d" class="jy jz ht ju b fv ka kb l kc kd">export const contractAddress = "0x53692f4BB9E072d481D42Ce2c9d919E2945aDac6";</span></pre><p id="7daa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个地址是我最终将它部署到rinkeby testenet的地方。</p><p id="462b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">是的，那有很多代码。</p><p id="32d0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">去散散步。亲吻你的伴侣。如果你没有伴侣，去和你感兴趣的人谈谈，当这种交流带来的失望开始出现时…从前端开始。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><p id="ce8c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">按照这里给出的指令通过<a class="ae jo" href="https://tailwindcss.com/docs/guides/nextjs" rel="noopener ugc nofollow" target="_blank">用NextJS初始化Tailwind。</a></p><p id="c420" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">不要草率，不要错过任何一步。正确的配置对于整个构建最终的工作非常重要。</p><p id="13f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以我使用localhost设置，然后注释掉它们以激活testnet的半真实世界设置。但是当你在你的开发环境中工作的时候，把过程反过来，做更多的探索。</p><p id="e05b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我开始喜欢NextJS了，因为它让我远离了所有不必要的工作，我可以专注于产品的开发。</p><p id="58c5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在开始之前，让我们的package.json文件看起来一样</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="b1e0" class="jy jz ht ju b fv ka kb l kc kd">{<br/>  "name": "crowdfund",<br/>  "version": "0.1.0",<br/>  "private": true,<br/>  "scripts": {<br/>    "dev": "next dev",<br/>    "build": "next build",<br/>    "start": "next start",<br/>    "lint": "next lint"<br/>  },<br/>  "resolutions": {<br/>    "async": "^2.6.4",<br/>    "node-fetch": "^2.6.7",<br/>    "lodash": "^4.17.21",<br/>    "underscore": "^1.12.1",<br/>    "yargs-parser": "^5.0.1"<br/>  },<br/>  "dependencies": {<br/>    "<a class="ae jo" href="http://twitter.com/openzeppelin/contracts" rel="noopener ugc nofollow" target="_blank">@openzeppelin/contracts</a>": "^4.6.0",<br/>    "<a class="ae jo" href="http://twitter.com/openzeppelin/test-helpers" rel="noopener ugc nofollow" target="_blank">@openzeppelin/test-helpers</a>": "^0.5.15",<br/>    "<a class="ae jo" href="http://twitter.com/truffle/hdwallet-provider" rel="noopener ugc nofollow" target="_blank">@truffle/hdwallet-provider</a>": "^2.0.8",<br/>    "<a class="ae jo" href="http://twitter.com/walletconnect/web3-provider" rel="noopener ugc nofollow" target="_blank">@walletconnect/web3-provider</a>": "^1.7.8",<br/>    "bignumber.js": "^9.0.2",<br/>    "dotenv": "^16.0.1",<br/>    "ipfs-http-client": "^56.0.3",<br/>    "next": "12.1.6",<br/>    "nextjs-progressbar": "^0.0.14",<br/>    "react": "18.1.0",<br/>    "react-dom": "18.1.0",<br/>    "true-json-bigint": "^1.0.1",<br/>    "web3": "^1.7.3",<br/>    "web3modal": "^1.9.7"<br/>  },<br/>  "devDependencies": {<br/>    "<a class="ae jo" href="http://twitter.com/babel/plugin-syntax-top-level-a" rel="noopener ugc nofollow" target="_blank">@babel/plugin-syntax-top-level-a</a>wait": "^7.14.5",<br/>    "<a class="ae jo" href="http://twitter.com/openzeppelin/truffle-upgrades" rel="noopener ugc nofollow" target="_blank">@openzeppelin/truffle-upgrades</a>": "^1.15.0",<br/>    "autoprefixer": "^10.4.7",<br/>    "chai": "^4.3.6",<br/>    "eslint": "8.16.0",<br/>    "eslint-config-next": "12.1.6",<br/>    "ethereum-waffle": "^3.0.0",<br/>    "ethers": "^5.6.8",<br/>    "postcss": "^8.4.14",<br/>    "tailwindcss": "^3.0.24"<br/>  }<br/>}</span></pre><p id="00fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在快跑</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="0352" class="jy jz ht ju b fv ka kb l kc kd">yarn</span></pre><p id="4a39" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将安装该项目所需的所有依赖项。</p><p id="6589" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，进入pages目录和_app.js文件:</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="0115" class="jy jz ht ju b fv ka kb l kc kd">import { AccountContext } from '../context.js'<br/>import { useState } from 'react'<br/>import Link from 'next/link'<br/>import Head from 'next/head'<br/>import NextNProgress from "nextjs-progressbar";<br/>import { ethers } from 'ethers'<br/>import Web3Modal from 'web3modal'<br/>import WalletConnectProvider from '<a class="ae jo" href="http://twitter.com/walletconnect/web3-provider" rel="noopener ugc nofollow" target="_blank">@walletconnect/web3-provider</a>'</span><span id="e420" class="jy jz ht ju b fv ke kb l kc kd">import '../styles/globals.css'</span><span id="386d" class="jy jz ht ju b fv ke kb l kc kd">function MyApp({ Component, pageProps }) {<br/>  const [account, setAccount] = useState(null)</span><span id="77d3" class="jy jz ht ju b fv ke kb l kc kd">// 1.</span><span id="a104" class="jy jz ht ju b fv ke kb l kc kd">   async function getWeb3Modal() {<br/>    const web3Modal = new Web3Modal({<br/>      network: 'rinkeby',<br/>      cacheProvider: false,<br/>      providerOptions: {<br/>        walletconnect: {<br/>          package: WalletConnectProvider,</span><span id="17cc" class="jy jz ht ju b fv ke kb l kc kd">          // testnet deployement<br/>          options: {<br/>            infuraId: process.env.PROJECT_ID<br/>          },</span><span id="90b6" class="jy jz ht ju b fv ke kb l kc kd">          // localhost for dev<br/>          // options: {<br/>          //   rpc: { 1337: '<a class="ae jo" href="http://localhost:8545'" rel="noopener ugc nofollow" target="_blank">http://localhost:8545'</a>, },<br/>          //   chainId: 1337,<br/>          // }<br/>        },<br/>      },<br/>    })<br/>    return web3Modal<br/>  }</span><span id="0619" class="jy jz ht ju b fv ke kb l kc kd">//2.</span><span id="d733" class="jy jz ht ju b fv ke kb l kc kd">   async function web3connect() {<br/>    try {<br/>      const web3Modal = await getWeb3Modal()<br/>      const connection = await web3Modal.connect()<br/>      const provider = new ethers.providers.Web3Provider(connection)<br/>      const accounts = await provider.listAccounts()<br/>      return accounts;<br/>    } catch (err) {<br/>      console.log('error:', err)<br/>    }<br/>  }</span><span id="f4c6" class="jy jz ht ju b fv ke kb l kc kd">// 3.</span><span id="24ec" class="jy jz ht ju b fv ke kb l kc kd">   // connect to wallet<br/>  async function connect() {<br/>    const accounts = await web3connect()<br/>    setAccount(accounts)<br/>  }</span><span id="48b7" class="jy jz ht ju b fv ke kb l kc kd">   return (<br/>    &lt;div className='min-h-screen w-screen font-mono'&gt;<br/>      &lt;Head&gt;<br/>        &lt;title&gt;iFund&lt;/title&gt;<br/>        &lt;meta name="description" content="Create New Fundraising Campaign" /&gt;<br/>        &lt;link rel="icon" href="/logo.png" /&gt;<br/>      &lt;/Head&gt;<br/>      &lt;div className='sm:h-10'&gt;<br/>        &lt;nav className='flex mx-auto text-black-20/100'&gt;<br/>          &lt;Link href="/"&gt;<br/>            &lt;a&gt;<br/>              &lt;img src="/logo.png" alt="crowdFund logo" className='h-20 object-contain my-5 ml-5' /&gt;<br/>            &lt;/a&gt;<br/>          &lt;/Link&gt;</span><span id="f966" class="jy jz ht ju b fv ke kb l kc kd">          &lt;div className='flex'&gt;</span><span id="90fb" class="jy jz ht ju b fv ke kb l kc kd">// 4.<br/>            {<br/>              !account ?<br/>                &lt;div className='my-10 mx-10' &gt;<br/>                  &lt;p&gt;Pls connect to interact with this app&lt;/p&gt;<br/>                  &lt;button className='rounded-md bg-pink-500 text-white p-3 ml-20' onClick={connect}&gt;Connect&lt;/button&gt;<br/>                &lt;/div&gt; :<br/>                &lt;p className='rounded-md my-10 bg-pink-500 text-white p-3 ml-20' &gt;<br/>                  {account[0].substr(0, 10) + "..."}<br/>                &lt;/p&gt;<br/>            }</span><span id="476b" class="jy jz ht ju b fv ke kb l kc kd">            {/* if you compile right now it will give an error as we haven't created this page yet. this is coming up next. */}</span><span id="9677" class="jy jz ht ju b fv ke kb l kc kd">            &lt;Link href="/create"&gt;<br/>              &lt;button className='rounded-md my-10 bg-pink-500 text-white p-3 ml-20' &gt;Create New Fundraising Project&lt;/button&gt;<br/>            &lt;/Link&gt;<br/>          &lt;/div&gt;<br/>        &lt;/nav&gt;<br/>      &lt;/div&gt;</span><span id="81ce" class="jy jz ht ju b fv ke kb l kc kd">// 5. </span><span id="eb59" class="jy jz ht ju b fv ke kb l kc kd">    {/* drip account into the app */}<br/>      &lt;AccountContext.Provider value={account}&gt;<br/>        &lt;NextNProgress /&gt;<br/>        {account &amp;&amp; &lt;Component {...pageProps} connect={connect} /&gt;}<br/>      &lt;/AccountContext.Provider&gt;<br/>    &lt;/div&gt;)<br/>}</span><span id="4a24" class="jy jz ht ju b fv ke kb l kc kd">export default MyApp</span></pre><ol class=""><li id="c08d" class="km kn ht is b it iu ix iy jb ko jf kp jj kq jn kr ks kt ku dt translated">联系区块链</li><li id="b1e2" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">从我们的元掩码infura端点调用区块链</li><li id="28a9" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">更新当前与区块链对话的帐户的状态</li></ol><p id="1fa0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4.很简单。如果尚未连接任何帐户，请说“连接”。如果有东西连接上了，打印出账户的前几个字符</p><p id="005c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5.AccountContext是我们添加的一个上下文，这样应用程序就可以随时了解连接到它的用户的任何变化</p><p id="be3d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">(你可以<a class="ae jo" href="https://reactjs.org/docs/context.html#reactcreatecontext" rel="noopener ugc nofollow" target="_blank">在这里阅读更多关于上下文的信息</a>)</p><p id="f8a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在pages目录之外，创建一个名为context.js的文件，并将它添加到</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="6086" class="jy jz ht ju b fv ka kb l kc kd">import { createContext } from 'react'</span><span id="431f" class="jy jz ht ju b fv ke kb l kc kd">export const AccountContext = createContext(null)</span></pre><p id="9675" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们在名为create.js的页面目录中创建用于筹款的页面</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="3e86" class="jy jz ht ju b fv ka kb l kc kd">import Link from "next/link"<br/>import { useEffect, useState } from 'react' // new<br/>import { useRouter } from 'next/router'<br/>import Web3Modal from 'web3modal'<br/>import { ethers } from 'ethers'</span><span id="6261" class="jy jz ht ju b fv ke kb l kc kd">// 1.</span><span id="7b86" class="jy jz ht ju b fv ke kb l kc kd">import CrowdFund from "../build/contracts/CrowdFund.json"<br/>import { contractAddress } from '../config'</span><span id="e03e" class="jy jz ht ju b fv ke kb l kc kd">// 2.</span><span id="69b4" class="jy jz ht ju b fv ke kb l kc kd">const initialState = { name: '', description: '', projectDeadline: '', goal: 0 };</span><span id="7227" class="jy jz ht ju b fv ke kb l kc kd">const Create = () =&gt; {<br/>    // router to route back to home page<br/>    const router = useRouter()</span><span id="f3b4" class="jy jz ht ju b fv ke kb l kc kd">    const [project, setProject] = useState(initialState)<br/>    const [contract, setContract] = useState();</span><span id="12c3" class="jy jz ht ju b fv ke kb l kc kd"><br/>// 3.</span><span id="c84f" class="jy jz ht ju b fv ke kb l kc kd">    useEffect(() =&gt; {<br/>        // function to get contract address and update state<br/>        async function getContract() {<br/>            const web3Modal = new Web3Modal()<br/>            const connection = await web3Modal.connect()<br/>            const provider = new ethers.providers.Web3Provider(connection)<br/>            const signer = provider.getSigner()<br/>            let _contract = new ethers.Contract(contractAddress, CrowdFund.abi, signer)<br/>            setContract(_contract);<br/>        }<br/>        getContract();<br/>    })</span><span id="e7fb" class="jy jz ht ju b fv ke kb l kc kd"><br/>// 4.</span><span id="99de" class="jy jz ht ju b fv ke kb l kc kd">     async function saveProject() {<br/>        // destructure project <br/>        const { name, description, projectDeadline, goal } = project<br/>        try {<br/>            // create project<br/>            let transaction = await contract.createNewProject(name, description, projectDeadline, goal)</span><span id="6538" class="jy jz ht ju b fv ke kb l kc kd">// await successful transaction and reroute to home<br/>            const x = await transaction.wait()<br/>            if (x.status == 1) {<br/>                router.push('/')<br/>            }<br/>        } catch (err) {<br/>            window.alert(err)<br/>        }<br/>    }</span><span id="9be3" class="jy jz ht ju b fv ke kb l kc kd">return (<br/>        &lt;div className="min-h-screen my-20 w-screen p-5"&gt;<br/>            &lt;main&gt;<br/>                &lt;div className="rounded-md my-10 bg-pink-500 text-white p-3 w-20"&gt;&lt;Link href="/"&gt; Home &lt;/Link&gt;&lt;/div&gt;<br/>                &lt;p className="text-center text-lg my-5"&gt;Create a new campaign!&lt;/p&gt;</span><span id="ef8e" class="jy jz ht ju b fv ke kb l kc kd"><br/>// 5.</span><span id="cb91" class="jy jz ht ju b fv ke kb l kc kd">               &lt;div className="bg-pink-500 text-black h-50 p-10 flex flex-col"&gt;<br/>                    &lt;input<br/>                        onChange={e =&gt; setProject({ ...project, name: e.target.value })}<br/>                        name='title'<br/>                        placeholder='Give it a name ...'<br/>                        className='p-2 my-2 rounded-md'<br/>                        value={project.name}<br/>                    /&gt;<br/>                    &lt;textarea<br/>                        onChange={e =&gt; setProject({ ...project, description: e.target.value })}<br/>                        name='description'<br/>                        placeholder='Give it a description ...'<br/>                        className='p-2 my-2 rounded-md'<br/>                    /&gt;<br/>                    &lt;input<br/>                        onChange={e =&gt; setProject({ ...project, projectDeadline: Math.floor(new Date() / 1000) + (e.target.value * 86400) })}<br/>                        name='projectDeadline'<br/>                        placeholder='Give it a deadline ... (in days)'<br/>                        className='p-2 my-2 rounded-md'<br/>                    /&gt;<br/>                    &lt;input<br/>                        onChange={e =&gt; setProject({ ...project, goal: e.target.value })}<br/>                        name='goalEth'<br/>                        placeholder='Give it a goal ... (in ETH). Only integer values are valid'<br/>                        className='p-2 my-2 rounded-md'<br/>                    /&gt;<br/>                    &lt;button type='button' className="w-20 text-white rounded-md my-10 px-3 py-2 shadow-lg border-2" onClick={saveProject}&gt;Submit&lt;/button&gt;<br/>                &lt;/div&gt;<br/>            &lt;/main&gt;<br/>        &lt;/div&gt;<br/>    )<br/>}</span><span id="4edf" class="jy jz ht ju b fv ke kb l kc kd">export default Create</span></pre><ol class=""><li id="e472" class="km kn ht is b it iu ix iy jb ko jf kp jj kq jn kr ks kt ku dt translated">是为前端获取合同细节的地方。我们需要三样东西来讨论这个合同。它所在的区块链、合同的地址、合同的内容以及试图与之交互的用户。区块链和谁在和它说话，我们从truffle migrate给我们的构建中获取in _app.js. contract地址及其内容(ABI)。</li><li id="2591" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">我将初始状态设置为我希望募捐到的条目的对象。这使得稍后通过输入更新状态变得容易。</li><li id="27d9" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">由于NextJS在服务器端将所有内容都转换成HTML，如果我们在useEffect中不提及这段代码，我们会得到一个错误，因为当然只有在设置了提供者和签名者之后，才能联系契约。</li><li id="c240" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">这只是调用了我们在契约中定义的createNewProject函数</li><li id="30ed" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">现在，我们获取用户输入并更新状态，然后将其发送到区块链，从而创建一个新项目</li></ol><p id="50d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你跑了</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="5b97" class="jy jz ht ju b fv ka kb l kc kd">yarn run dev</span></pre><p id="5758" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，这将编译，我们将有一个主页和一个创建项目页面。</p><p id="6cfd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们可以创建项目了，我们需要查看创建者创建的所有项目。所以在主页(index.js)我们写道:</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="ac54" class="jy jz ht ju b fv ka kb l kc kd">import {<br/>    contractAddress<br/>} from '../config'<br/>import CrowdFund from "../build/contracts/CrowdFund.json"<br/>import { ethers, BigNumber } from 'ethers'<br/>import Link from 'next/link'</span><span id="9c80" class="jy jz ht ju b fv ke kb l kc kd">// 1.</span><span id="7f9d" class="jy jz ht ju b fv ke kb l kc kd">const infuraKey = process.env.PROJECT_ID;</span><span id="c025" class="jy jz ht ju b fv ke kb l kc kd">export default function Home({ projects }) {<br/>    return (<br/>        &lt;div className='min-h-screen my-20 w-screen p-5'&gt;<br/>            &lt;p className='text-center font-bold'&gt;test project --- Please connect to the Rinkeby testnet&lt;/p&gt;</span><span id="4576" class="jy jz ht ju b fv ke kb l kc kd">&lt;div className='bg-pink-500 text-white p-10 rounded-md'&gt;<br/>                &lt;div&gt;<br/>                    &lt;p className='font-bold m-5'&gt;How it Works&lt;/p&gt;<br/>                    &lt;p className='my-3'&gt;1. Creator creates a new project &lt;/p&gt;</span><span id="c83c" class="jy jz ht ju b fv ke kb l kc kd">&lt;p className='my-3'&gt;2. Contributors contribute until deadline&lt;/p&gt;<br/>                    &lt;p className='my-3'&gt;3. If total pledged doesn&amp;apos;t get met on deadline date, contributors expire the project and refund donated funds back&lt;/p&gt;<br/>                    &lt;p className='my-3'&gt;4. If total amount pledged reaches the goal, creator declares the fundraise a success&lt;/p&gt;<br/>                    &lt;div className='my-3'&gt;<br/>                        &lt;p className='my-3 ml-10'&gt;a. creator makes a withdrawal request&lt;/p&gt;<br/>                        &lt;p className='my-3 ml-10'&gt;b. contributors vote on the request&lt;/p&gt;<br/>                        &lt;p className='my-3 ml-10'&gt;c. if approved, creator withdraws the amount requested to work on the project&lt;/p&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className='text-black'&gt;</span><span id="d186" class="jy jz ht ju b fv ke kb l kc kd">// 2.<br/>                &lt;div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 pt-6"&gt;<br/>                    {<br/>                        projects.map((project, i) =&gt; (<br/>                            &lt;div key={i} className="border shadow rounded-xl overflow-hidden"&gt;<br/>                                &lt;div className="p-4"&gt;<br/>                                    &lt;p&gt;ID: {BigNumber.from(project[0]).toNumber()}&lt;/p&gt;<br/>                                    &lt;p className="my-6 text-2xl font-semibold"&gt;{project[2]}&lt;/p&gt;<br/>                                    &lt;div&gt;<br/>                                        &lt;p className="my-3 text-gray-400"&gt;{project[3]?.substr(0, 20) + "..."}&lt;/p&gt;<br/>                                        &lt;p className="my-3"&gt; Deadline:  {<br/>                                            new Date((BigNumber.from(project[4]).toNumber()) * 1000).toLocaleDateString()<br/>                                        } &lt;/p&gt;</span><span id="8738" class="jy jz ht ju b fv ke kb l kc kd">&lt;p className="my-3"&gt; Total Pledged:  {<br/>                                            Math.round(ethers.utils.formatEther(project[5]))<br/>                                        } ETH&lt;/p&gt;</span><span id="2c42" class="jy jz ht ju b fv ke kb l kc kd">&lt;p className="my-3"&gt; Goal:  {<br/>                                            ethers.utils.formatEther(project[6])<br/>                                        } ETH &lt;/p&gt;<br/>                                    &lt;/div&gt;</span><span id="b493" class="jy jz ht ju b fv ke kb l kc kd">// 3. <br/>&lt;Link href={`project/${BigNumber.from(project[0]).toNumber()}`} key={i}&gt;<br/>                                        &lt;button className='rounded-md my-5 bg-pink-500 text-white p-3 mx-1'&gt;Details&lt;/button&gt;<br/>                                    &lt;/Link&gt;<br/>                                &lt;/div&gt;<br/>                            &lt;/div&gt;<br/>                        ))<br/>                    }<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div &gt;<br/>    )<br/>}</span><span id="7a2a" class="jy jz ht ju b fv ke kb l kc kd">// 4.</span><span id="5784" class="jy jz ht ju b fv ke kb l kc kd">export async function getServerSideProps() {<br/>    let provider = new ethers.providers.JsonRpcProvider(`<a class="ae jo" href="https://rinkeby.infura.io/v3/${infuraKey}`" rel="noopener ugc nofollow" target="_blank">https://rinkeby.infura.io/v3/${infuraKey}`</a>)</span><span id="64b5" class="jy jz ht ju b fv ke kb l kc kd">    // localhost<br/>    // let provider = new ethers.providers.JsonRpcProvider()</span><span id="c95d" class="jy jz ht ju b fv ke kb l kc kd">const contract = new ethers.Contract(contractAddress, CrowdFund.abi, provider)<br/>    const data = await contract.getAllProjects()<br/>    return {<br/>        props: {<br/>            projects: JSON.parse(JSON.stringify(data))<br/>        }<br/>    }<br/>}</span></pre><ol class=""><li id="50e9" class="km kn ht is b it iu ix iy jb ko jf kp jj kq jn kr ks kt ku dt translated">从获取infura密钥。环境文件</li><li id="6a62" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">我们从服务器端渲染得到的道具会被析构并作为项目出现。我们映射到这一点，可以孤立的个人项目，已经由用户在此合同上创建。</li></ol><p id="62ac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3.这是我们接下来创建的页面。该页面将暂时出错</p><p id="08d4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4.是NextJS大放异彩的地方。它获取服务器端的所有项目，并对其进行预渲染。这使得整个渲染速度超快。</p><p id="8c54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我向上帝发誓，我希望我能把这个代码块做得更宽一点，但是，唉，这就是格式。你必须与它抗争，或者在github上查看代码。</p><p id="d86b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我非常喜欢动态路由，所以我们将使用它。在pages目录中，创建一个名为project的目录。在其中创建一个名为[id]的文件。射流研究…</p><p id="3eb7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这基本上允许我们做的是运行函数getStaticPaths和getStaticProps，这实际上填充了我们已经决定要挂钩的所有可能的路径。在这个例子中，我们将项目ID与路线挂钩。</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="088b" class="jy jz ht ju b fv ka kb l kc kd">import { BigNumber, ethers, web3 } from 'ethers'<br/>import Web3Modal from 'web3modal'<br/>import { useState, useContext, useEffect } from 'react' // new<br/>import { useRouter } from 'next/router'<br/>import Link from 'next/link'</span><span id="0ed1" class="jy jz ht ju b fv ke kb l kc kd">import {<br/>    contractAddress<br/>} from '../../config'<br/>import { AccountContext } from '../../context'<br/>import CrowdFund from "../../build/contracts/CrowdFund.json"</span><span id="1d19" class="jy jz ht ju b fv ke kb l kc kd">const infuraKey = process.env.PROJECT_ID;</span><span id="d5ed" class="jy jz ht ju b fv ke kb l kc kd">export default function Project({ project, projectID }) {<br/>    useContext(AccountContext);</span><span id="2b4c" class="jy jz ht ju b fv ke kb l kc kd">    const router = useRouter()<br/>    const [contributionValue, setContributionValue] = useState(0);</span><span id="ed03" class="jy jz ht ju b fv ke kb l kc kd">    const [contract, setContract] = useState();</span><span id="f7d0" class="jy jz ht ju b fv ke kb l kc kd">    useEffect(() =&gt; {<br/>        // function to get contract address and update state<br/>        async function getContract() {<br/>            const web3Modal = new Web3Modal()<br/>            const connection = await web3Modal.connect()<br/>            const provider = new ethers.providers.Web3Provider(connection)<br/>            const signer = provider.getSigner()<br/>            let _contract = new ethers.Contract(contractAddress, CrowdFund.abi, signer)<br/>            setContract(_contract);<br/>        }<br/>        getContract();<br/>    })</span><span id="24cd" class="jy jz ht ju b fv ke kb l kc kd">    // Function to contribute funds to the project<br/>    async function contribute() {<br/>        try {<br/>            // send contribution<br/>            let transaction = await contract.contributeFunds(projectID, {<br/>                value: ethers.utils.parseUnits(contributionValue, "ether")<br/>            })<br/>            // await transaction<br/>            let x = await transaction.wait()</span><span id="8db1" class="jy jz ht ju b fv ke kb l kc kd">            // reroute to home page<br/>            if (x.status == 1) {<br/>                router.push('/')<br/>            }<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }</span><span id="d4a1" class="jy jz ht ju b fv ke kb l kc kd">    // function to declare fundraise a success<br/>    async function changeStateToSuccess() {<br/>        try {<br/>            let tx = await contract.endContributionsSuccess(projectID);<br/>            let x = await tx.wait()</span><span id="5fb7" class="jy jz ht ju b fv ke kb l kc kd">            if (x.status == 1) {<br/>                router.push(`/project/${projectID}`);<br/>                window.alert('Project state was successfully changed to : Success')<br/>            }<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }</span><span id="a78d" class="jy jz ht ju b fv ke kb l kc kd">    // function to declare fundraise a failure<br/>    async function changeStateToExpire() {<br/>        try {<br/>            let tx = await contract.endContributionsExpire(projectID);<br/>            let x = await tx.wait()</span><span id="9981" class="jy jz ht ju b fv ke kb l kc kd">            if (x.status == 1) {<br/>                window.alert('Project state was successfully changed to : Expire')<br/>            }<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }</span><span id="8d59" class="jy jz ht ju b fv ke kb l kc kd">// function to process a refund on failed fundraise<br/>    async function processRefund() {<br/>        try {<br/>            let tx = await contract.getRefund(projectID);<br/>            let x = await tx.wait()</span><span id="b2c7" class="jy jz ht ju b fv ke kb l kc kd">            if (x.status == 1) {<br/>                window.alert('Successful Refund')<br/>                router.push('/');<br/>            }<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }</span><span id="df02" class="jy jz ht ju b fv ke kb l kc kd">// 1.</span><span id="4bf1" class="jy jz ht ju b fv ke kb l kc kd">    if (router.isFallback) {<br/>        return &lt;div&gt;Loading...&lt;/div&gt;<br/>    }</span><span id="66b1" class="jy jz ht ju b fv ke kb l kc kd">return (<br/>        &lt;div className='mt-20'&gt;<br/>            &lt;div className='bg-pink-500 text-white p-20 rounded-md mx-5 mt-40'&gt;<br/>                &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt; Project Number: &lt;/span&gt; {projectID}&lt;/p&gt;<br/>                &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt; Creator: &lt;/span&gt; {project.creator}&lt;/p&gt;<br/>                &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt; Project Name: &lt;/span&gt; {project.name}&lt;/p&gt;<br/>                &lt;div className='break-words'&gt;<br/>                    &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt;Description:&lt;/span&gt; {project.description}&lt;/p&gt;<br/>                &lt;/div&gt;<br/>                &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt;Crowdfund deadline:&lt;/span&gt; {new Date((BigNumber.from(project.projectDeadline).toNumber()) * 1000).toLocaleDateString()}&lt;/p&gt;<br/>                &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt;Total ETH pledged:&lt;/span&gt; {project.totalPledged} ETH&lt;/p&gt;<br/>                &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt;Fundraise Goal:&lt;/span&gt; {project.goal} ETH&lt;/p&gt;<br/>                &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt;Total Contributors:&lt;/span&gt; {project.totalDepositors}&lt;/p&gt;<br/>                &lt;p className='my-6'&gt;&lt;span className='font-bold'&gt;Current State:&lt;/span&gt; {project.currentState === 0 ? 'Fundraise Active' : (project.currentState === 1) ? 'Fundraise Expired' : 'Fundraise Success'}&lt;/p&gt;</span><span id="3f07" class="jy jz ht ju b fv ke kb l kc kd">&lt;p className='my-6'&gt;&lt;span className='font-bold'&gt;Total Withdrawals:&lt;/span&gt; {project.totalWithdrawn} ETH&lt;/p&gt;</span><span id="454f" class="jy jz ht ju b fv ke kb l kc kd">&lt;div className='text-center'&gt;<br/>                    &lt;input<br/>                        onChange={e =&gt; setContributionValue(e.target.value)}<br/>                        type='number'<br/>                        className='p-2 my-2 rounded-md text-black'<br/>                        value={contributionValue}<br/>                    /&gt;<br/>                    &lt;button onClick={contribute} className='rounded-md mt-20 my-10 bg-white text-pink-500 p-3 mx-4 shadow-md'&gt;Contribute&lt;/button&gt;<br/>                &lt;/div&gt;</span><span id="9d76" class="jy jz ht ju b fv ke kb l kc kd">&lt;div className='grid sm:grid-col-1 md:grid-cols-2 sm:text-sm'&gt;<br/>                    &lt;div className='grid grid-cols-1 px-10 sm:w-200 place-content-stretch'&gt;<br/>                        &lt;button onClick={changeStateToSuccess} className='rounded-md mt-20 my-10 bg-white text-pink-500 p-3 shadow-lg flex-wrap'&gt;Click here if fundraise was a success (project owner only)&lt;/button&gt;</span><span id="6803" class="jy jz ht ju b fv ke kb l kc kd">&lt;Link href={`withdrawal/${projectID}`}&gt;<br/>                            &lt;button className='rounded-md mt-20 my-10 bg-white text-pink-500 p-3 shadow-lg min-w-50'&gt;Create Withdrawal Request&lt;/button&gt;<br/>                        &lt;/Link&gt;</span><span id="57a8" class="jy jz ht ju b fv ke kb l kc kd">&lt;Link href={`requests/${projectID}`}&gt;<br/>                            &lt;button className='rounded-md mt-20 my-10 bg-white text-pink-500 p-3 shadow-lg flex-wrap'&gt;Approve / Reject / Withdraw&lt;/button&gt;<br/>                        &lt;/Link&gt;<br/>                    &lt;/div&gt;</span><span id="82da" class="jy jz ht ju b fv ke kb l kc kd">&lt;div className='grid grid-cols-1 px-10'&gt;<br/>                        &lt;button onClick={changeStateToExpire} className='rounded-md mt-20 my-10 bg-white text-pink-500 p-3 shadow-lg w-50'&gt;Click here if fundraise needs to be expired (contributors only)&lt;/button&gt;</span><span id="b53b" class="jy jz ht ju b fv ke kb l kc kd">&lt;button onClick={processRefund} className='rounded-md mt-20 my-10 bg-white text-pink-500 p-3 shadow-lg w-50'&gt;Request Refund&lt;/button&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div &gt;<br/>    )<br/>}</span><span id="1cdf" class="jy jz ht ju b fv ke kb l kc kd">// 2.</span><span id="45c1" class="jy jz ht ju b fv ke kb l kc kd">export async function getStaticPaths() {<br/>    let provider = new ethers.providers.JsonRpcProvider(`<a class="ae jo" href="https://rinkeby.infura.io/v3/${infuraKey}`" rel="noopener ugc nofollow" target="_blank">https://rinkeby.infura.io/v3/${infuraKey}`</a>)</span><span id="ef3f" class="jy jz ht ju b fv ke kb l kc kd">// let provider = new ethers.providers.JsonRpcProvider()<br/>    const contract = new ethers.Contract(contractAddress, CrowdFund.abi, provider)<br/>    const data = await contract.getAllProjects()</span><span id="30fb" class="jy jz ht ju b fv ke kb l kc kd">// populate the dynamic routes with the id<br/>    const paths = data.map(d =&gt; ({ params: { id: BigNumber.from(d[0]).toString() } }))</span><span id="ae64" class="jy jz ht ju b fv ke kb l kc kd">return {<br/>        paths,<br/>        fallback: true<br/>    }<br/>}</span><span id="0369" class="jy jz ht ju b fv ke kb l kc kd">// 3.</span><span id="3f63" class="jy jz ht ju b fv ke kb l kc kd">// local fetch - change to ropsten/mainnet on deployement time<br/>export async function getStaticProps({ params }) {<br/>    // isolate ID from params<br/>    const { id } = params</span><span id="96d7" class="jy jz ht ju b fv ke kb l kc kd">    // contact the blockchain<br/>    let provider = new ethers.providers.JsonRpcProvider(`<a class="ae jo" href="https://rinkeby.infura.io/v3/${infuraKey}`" rel="noopener ugc nofollow" target="_blank">https://rinkeby.infura.io/v3/${infuraKey}`</a>)</span><span id="fb4c" class="jy jz ht ju b fv ke kb l kc kd">     // localhost<br/>    // let provider = new ethers.providers.JsonRpcProvider()<br/>    const contract = new ethers.Contract(contractAddress, CrowdFund.abi, provider)<br/>    const data = await contract.getProjectDetails(id);</span><span id="4540" class="jy jz ht ju b fv ke kb l kc kd">    // parse received data into JSON<br/>    let projectData = {<br/>        creator: data.creator,<br/>        name: data.name,<br/>        description: data.description,<br/>        projectDeadline: BigNumber.from(data.projectDeadline).toNumber(),<br/>        totalPledged: ethers.utils.formatEther(data.totalPledged),<br/>        goal: ethers.utils.formatEther(data.goal),<br/>        totalDepositors: BigNumber.from(data.totalDepositors).toNumber(),<br/>        totalWithdrawn: ethers.utils.formatEther(data.totalWithdrawn),<br/>        currentState: data.currentState<br/>    }</span><span id="2eab" class="jy jz ht ju b fv ke kb l kc kd">// return JSON data belonging to this route<br/>    return {<br/>        props: {<br/>            project: projectData,<br/>            projectID: id<br/>        },<br/>    }<br/>}</span></pre><ol class=""><li id="2b0a" class="km kn ht is b it iu ix iy jb ko jf kp jj kq jn kr ks kt ku dt translated">当路由发生时，我们需要一个回退，否则页面就没有什么可呈现的，并且会出错</li><li id="bc0e" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">获取项目ID，并告诉nextJS路由将挂钩到什么。在我们的例子中，它是项目的ID。</li><li id="1e12" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku dt translated">接下来，我们传递在最后一次getStaticPaths调用中获得的参数来获取项目的数据。我们创建一个JSON对象，并将其作为props返回，该props被放入主函数的顶部输入。</li></ol><p id="26b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果项目成功，创建者需要提交退出请求。为此，我们在项目目录中创建了一个名为retraction的新文件夹。我们在其中创建了一个名为[id]的文件。js和</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="f48f" class="jy jz ht ju b fv ka kb l kc kd">import { BigNumber, ethers } from 'ethers'<br/>import { useEffect, useState } from 'react'<br/>import Web3Modal from 'web3modal'<br/>import { useRouter } from 'next/router'</span><span id="afed" class="jy jz ht ju b fv ke kb l kc kd">import {<br/>    contractAddress<br/>} from '../../../config'<br/>import CrowdFund from "../../../build/contracts/CrowdFund.json"</span><span id="84b3" class="jy jz ht ju b fv ke kb l kc kd">const infuraKey = process.env.PROJECT_ID;</span><span id="6de1" class="jy jz ht ju b fv ke kb l kc kd">const initialState = { requestNo: '', requestDescription: '', amount: 0 };</span><span id="0675" class="jy jz ht ju b fv ke kb l kc kd">export default function Withdrawal({ projectID }) {<br/>    const router = useRouter()</span><span id="e34d" class="jy jz ht ju b fv ke kb l kc kd">    const [withdrawalRequest, setWithdrawalRequest] =    useState(initialState)<br/>    const [contract, setContract] = useState();</span><span id="a53c" class="jy jz ht ju b fv ke kb l kc kd">    useEffect(() =&gt; {<br/>        // function to get contract address and update state<br/>        async function getContract() {<br/>            const web3Modal = new Web3Modal()<br/>            const connection = await web3Modal.connect()<br/>            const provider = new ethers.providers.Web3Provider(connection)<br/>            const signer = provider.getSigner()<br/>            let _contract = new ethers.Contract(contractAddress, CrowdFund.abi, signer)<br/>            setContract(_contract);<br/>        }<br/>        getContract();<br/>    })</span><span id="8695" class="jy jz ht ju b fv ke kb l kc kd">     async function requestWithdrawal() {<br/>        const { requestNo, requestDescription, amount } = withdrawalRequest;</span><span id="080a" class="jy jz ht ju b fv ke kb l kc kd">        try {<br/>            let transaction = await contract.createWithdrawalRequest(projectID, requestNo, requestDescription, amount)<br/>            const x = await transaction.wait()</span><span id="aa57" class="jy jz ht ju b fv ke kb l kc kd">            if (x.status == 1) {<br/>                router.push(`/project/${projectID}`)<br/>            }<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }</span><span id="f625" class="jy jz ht ju b fv ke kb l kc kd">    if (router.isFallback) {<br/>        return &lt;div&gt;Loading...&lt;/div&gt;<br/>    }</span><span id="3a2c" class="jy jz ht ju b fv ke kb l kc kd">    return (<br/>        &lt;div className='grid sm:grid-cols-1 lg:grid-cols-1 mt-20 '&gt;<br/>            &lt;p className='text-center'&gt;Only project creator can access this functionality on goal reached&lt;/p&gt;<br/>            &lt;div className='bg-pink-500 text-black p-20 text-center rounded-md mx-5 flex flex-col'&gt;<br/>                &lt;input<br/>                    type='number'<br/>                    onChange={e =&gt; setWithdrawalRequest({ ...withdrawalRequest, requestNo: e.target.value })}<br/>                    name='requestNo'<br/>                    placeholder='Request number...'<br/>                    className='p-2 mt-5 rounded-md'<br/>                    value={withdrawalRequest.requestNo} /&gt;<br/>                &lt;textarea<br/>                    onChange={e =&gt; setWithdrawalRequest({ ...withdrawalRequest, requestDescription: e.target.value })}<br/>                    name='requestDescription'<br/>                    placeholder='Give it a description ...'<br/>                    className='p-2 mt-5 rounded-md'<br/>                /&gt;<br/>                &lt;input<br/>                    onChange={e =&gt; setWithdrawalRequest({ ...withdrawalRequest, amount: e.target.value })}<br/>                    name='amount'<br/>                    placeholder='Withdrawal amount ... (in ETH). Only integer values are valid'<br/>                    className='p-2 mt-5 rounded-md'<br/>                /&gt;<br/>                &lt;button type='button' className="w-20 bg-white rounded-md my-10 px-3 py-2 shadow-lg border-2" onClick={requestWithdrawal}&gt;Submit&lt;/button&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div &gt;<br/>    )<br/>}</span><span id="ff94" class="jy jz ht ju b fv ke kb l kc kd">export async function getStaticPaths() {<br/>    let provider = new ethers.providers.JsonRpcProvider(`<a class="ae jo" href="https://rinkeby.infura.io/v3/${infuraKey}`" rel="noopener ugc nofollow" target="_blank">https://rinkeby.infura.io/v3/${infuraKey}`</a>)</span><span id="ef94" class="jy jz ht ju b fv ke kb l kc kd">// localhost <br/>    // let provider = new ethers.providers.JsonRpcProvider()<br/>    const contract = new ethers.Contract(contractAddress, CrowdFund.abi, provider)<br/>    const data = await contract.getAllProjects()</span><span id="952a" class="jy jz ht ju b fv ke kb l kc kd">// populate the dynamic routes with the id<br/>    const paths = data.map(d =&gt; ({ params: { id: BigNumber.from(d[0]).toString() } }))</span><span id="c777" class="jy jz ht ju b fv ke kb l kc kd">return {<br/>        paths,<br/>        fallback: true<br/>    }<br/>}</span><span id="4a2d" class="jy jz ht ju b fv ke kb l kc kd">// local fetch - change to ropsten/mainnet on deployement time<br/>export async function getStaticProps({ params }) {<br/>    // isolate ID from params<br/>    const { id } = params</span><span id="c9db" class="jy jz ht ju b fv ke kb l kc kd">// return JSON data belonging to this route<br/>    return {<br/>        props: {<br/>            projectID: id<br/>        },<br/>    }<br/>}</span></pre><p id="0779" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">已经创建的提款请求需要分离出来，单独批准或拒绝，如果请求获得批准，创建者需要能够提取金额。</p><p id="507a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在项目目录中，创建一个名为requests的新目录。创建一个名为[id]的新文件。js和</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="fcf3" class="jy jz ht ju b fv ka kb l kc kd">import { ethers, BigNumber } from 'ethers'<br/>import Web3Modal from 'web3modal'<br/>import { useEffect, useState } from 'react'<br/>import { useRouter } from 'next/router'</span><span id="8ffd" class="jy jz ht ju b fv ke kb l kc kd">import {<br/>    contractAddress<br/>} from '../../../config'<br/>import CrowdFund from "../../../build/contracts/CrowdFund.json"</span><span id="3acf" class="jy jz ht ju b fv ke kb l kc kd">const infuraKey = process.env.PROJECT_ID;</span><span id="ec6d" class="jy jz ht ju b fv ke kb l kc kd">export default function Requests({ project, projectID }) {<br/>    const router = useRouter()<br/>    const [withdrawalRequests, setWithdrawalRequests] = useState([])<br/>    const [contract, setContract] = useState();</span><span id="5007" class="jy jz ht ju b fv ke kb l kc kd">    useEffect(() =&gt; {<br/>        // function to get contract address and update state<br/>        async function getContract() {<br/>            const web3Modal = new Web3Modal()<br/>            const connection = await web3Modal.connect()<br/>            const provider = new ethers.providers.Web3Provider(connection)<br/>            const signer = provider.getSigner()<br/>            let _contract = new ethers.Contract(contractAddress, CrowdFund.abi, signer)<br/>            setContract(_contract);<br/>        }<br/>        getContract();<br/>    })</span><span id="87d0" class="jy jz ht ju b fv ke kb l kc kd">    <br/>    // function to get all requests made by the creator</span><span id="12d7" class="jy jz ht ju b fv ke kb l kc kd">    async function getRequests() {<br/>        try {<br/>            let x = await contract.getAllWithdrawalRequests(projectID)<br/>            setWithdrawalRequests(x);<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }</span><span id="95d7" class="jy jz ht ju b fv ke kb l kc kd"><br/>    // function to approve a specific request</span><span id="31f5" class="jy jz ht ju b fv ke kb l kc kd">    async function approveRequest(r, projectID) {<br/>        try {<br/>            let tx = await contract.approveWithdrawalRequest(projectID, r[0])<br/>            let x = await tx.wait()</span><span id="8b23" class="jy jz ht ju b fv ke kb l kc kd">if (x.status == 1) {<br/>                router.push(`/project/${projectID}`)<br/>            }<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }</span><span id="45e4" class="jy jz ht ju b fv ke kb l kc kd"><br/>    // function to reje a specific request</span><span id="4000" class="jy jz ht ju b fv ke kb l kc kd">    async function rejectRequest(r, projectID) {<br/>        try {<br/>            let tx = await contract.rejectWithdrawalRequest(projectID, r[0])<br/>            let x = await tx.wait()</span><span id="7a42" class="jy jz ht ju b fv ke kb l kc kd">if (x.status == 1) {<br/>                router.push(`/project/${projectID}`)<br/>            }<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }  </span><span id="cf9c" class="jy jz ht ju b fv ke kb l kc kd">    // function to transfer funds to the creator if requests were approved<br/>    async function transferFunds(r, projectID) {<br/>        try {<br/>            let tx = await contract.transferWithdrawalRequestFunds(projectID, r[0])<br/>            let x = await tx.wait()</span><span id="ec7c" class="jy jz ht ju b fv ke kb l kc kd">if (x.status == 1) {<br/>                router.push(`/project/${projectID}`)<br/>            }<br/>        } catch (err) {<br/>            window.alert(err.message)<br/>        }<br/>    }<br/></span><span id="744f" class="jy jz ht ju b fv ke kb l kc kd">    if (router.isFallback) {<br/>        return &lt;div&gt;Loading...&lt;/div&gt;<br/>    }</span><span id="16ee" class="jy jz ht ju b fv ke kb l kc kd">    return (<br/>        &lt;div className='grid sm:grid-cols-1 lg:grid-cols-1 mt-20 '&gt;<br/>            &lt;p className='text-center'&gt;Only project contributors can access approve/reject functionality&lt;/p&gt;<br/>            &lt;p className='text-center mt-3 mb-3'&gt;Creators need more than 50% of the contributors to approve a request before withdrawal can be made&lt;/p&gt;</span><span id="777c" class="jy jz ht ju b fv ke kb l kc kd">&lt;div className='bg-pink-500 text-white p-20 text-center rounded-md'&gt;<br/>                &lt;button onClick={getRequests} className="bg-white text-black rounded-md my-10 px-3 py-2 shadow-lg border-2 w-80"&gt;Get all withdrawal requests&lt;/button&gt;</span><span id="24ce" class="jy jz ht ju b fv ke kb l kc kd">&lt;p className='font-bold'&gt;All Withdrawal requests&lt;/p&gt;</span><span id="c41d" class="jy jz ht ju b fv ke kb l kc kd">&lt;div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pt-6'&gt;<br/>                    {<br/>                        withdrawalRequests.map(request =&gt;<br/>                            &lt;div className='border shadow rounded-xl text-left grid grid-cols-1 lg:grid-col-2' key={request[0]}&gt;<br/>                                &lt;div className='p-4'&gt;<br/>                                    &lt;p className='py-4'&gt;request number: {request[0]}&lt;/p&gt;<br/>                                    &lt;p className='py-4 break-words'&gt;description: {request[1]}&lt;/p&gt;<br/>                                    &lt;p className='py-4'&gt;amount: {ethers.utils.formatEther(request[2])} ETH&lt;/p&gt;<br/>                                    &lt;p className='py-4'&gt;total approvals: {BigNumber.from(request[4]).toNumber()}&lt;/p&gt;<br/>                                    &lt;p className='py-4'&gt;total depositor: {project.totalDepositors}&lt;/p&gt;</span><span id="165f" class="jy jz ht ju b fv ke kb l kc kd">&lt;div className='sm:grid sm:grid-cols-1 xs:grid xs:grid-cols-1'&gt;<br/>                                        &lt;button onClick={() =&gt; approveRequest(request, projectID)} className="bg-white text-black rounded-md my-10 mx-1 px-3 py-2 shadow-lg border-2"&gt;Approve&lt;/button&gt;</span><span id="b600" class="jy jz ht ju b fv ke kb l kc kd">&lt;button onClick={() =&gt; rejectRequest(request, projectID)} className="bg-white text-black rounded-md my-10 px-3 mx-1 py-2 shadow-lg border-2"&gt;Reject&lt;/button&gt;</span><span id="6cc9" class="jy jz ht ju b fv ke kb l kc kd">&lt;button onClick={() =&gt; transferFunds(request, projectID)} className="bg-white text-black rounded-md my-10 px-3 mx-1 py-2 shadow-lg border-2"&gt;Withdraw&lt;/button&gt;<br/>                                    &lt;/div&gt;<br/>                                &lt;/div&gt;<br/>                            &lt;/div&gt;<br/>                        )<br/>                    }<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div &gt;<br/>    )<br/>}</span><span id="96d0" class="jy jz ht ju b fv ke kb l kc kd">export async function getStaticPaths() {<br/>    let provider = new ethers.providers.JsonRpcProvider(`<a class="ae jo" href="https://rinkeby.infura.io/v3/${infuraKey}`" rel="noopener ugc nofollow" target="_blank">https://rinkeby.infura.io/v3/${infuraKey}`</a>)</span><span id="03fc" class="jy jz ht ju b fv ke kb l kc kd">// localhost<br/>    // let provider = new ethers.providers.JsonRpcProvider()vvvvv<br/>    const contract = new ethers.Contract(contractAddress, CrowdFund.abi, provider)<br/>    const data = await contract.getAllProjects()</span><span id="d41f" class="jy jz ht ju b fv ke kb l kc kd">// populate the dynamic routes with the id<br/>    const paths = data.map(d =&gt; ({ params: { id: BigNumber.from(d[0]).toString() } }))</span><span id="795c" class="jy jz ht ju b fv ke kb l kc kd">return {<br/>        paths,<br/>        fallback: true<br/>    }<br/>}</span><span id="c80d" class="jy jz ht ju b fv ke kb l kc kd">// local fetch - change to ropsten/mainnet on deployement time<br/>export async function getStaticProps({ params }) {<br/>    // isolate ID from params<br/>    const { id } = params</span><span id="3c3c" class="jy jz ht ju b fv ke kb l kc kd">// contact the blockchain<br/>    let provider = new ethers.providers.JsonRpcProvider(`<a class="ae jo" href="https://rinkeby.infura.io/v3/${infuraKey}`" rel="noopener ugc nofollow" target="_blank">https://rinkeby.infura.io/v3/${infuraKey}`</a>)</span><span id="6cca" class="jy jz ht ju b fv ke kb l kc kd">// localhost<br/>    // let provider = new ethers.providers.JsonRpcProvider()</span><span id="fd03" class="jy jz ht ju b fv ke kb l kc kd">const contract = new ethers.Contract(contractAddress, CrowdFund.abi, provider)<br/>    const data = await contract.getProjectDetails(id);</span><span id="4d5e" class="jy jz ht ju b fv ke kb l kc kd">// parse received data into JSON<br/>    let projectData = {<br/>        creator: data.creator,<br/>        name: data.name,<br/>        description: data.description,<br/>        projectDeadline: BigNumber.from(data.projectDeadline).toNumber(),<br/>        totalPledged: ethers.utils.formatEther(data.totalPledged),<br/>        goal: ethers.utils.formatEther(data.goal),<br/>        totalDepositors: BigNumber.from(data.totalDepositors).toNumber(),<br/>        totalWithdrawn: ethers.utils.formatEther(data.totalWithdrawn),<br/>        currentState: data.currentState<br/>    }</span><span id="21d2" class="jy jz ht ju b fv ke kb l kc kd">// return JSON data belonging to this route<br/>    return {<br/>        props: {<br/>            project: projectData,<br/>            projectID: id<br/>        },<br/>    }<br/>}</span></pre><p id="7cf7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后，我们为不存在的路由创建一个404页面。在pages目录中创建一个名为404.js的文件</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="bf2b" class="jy jz ht ju b fv ka kb l kc kd">const notFound = () =&gt; {<br/>  return (<br/>    &lt;div className='flex h-screen'&gt;<br/>        &lt;p className='m-auto'&gt;404 Not Found&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="92ec" class="jy jz ht ju b fv ke kb l kc kd">export default notFound</span></pre><p id="9bc3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这就完成了代码。奔跑</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="6ed3" class="jy jz ht ju b fv ka kb l kc kd">yarn build</span></pre><p id="ba32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建优化的版本。推送到github，部署到vercel，你就有了一个随时可以交互的dapp。</p><p id="a641" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我希望你能从中受益。如果你有，请帮助你的孩子</p><p id="2d9f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">(ETH)0xf 1128 dff 5816 f 80241 d6e 7 de 4 F3 cc 5b 5 E4 C5 a 819</p><p id="744a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">或者</p><p id="7f20" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">(BTC)1e8gcslrzqfbzuxcpsodbg 8 xuv 6 GX ark</p><p id="3171" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">直到下一次🖖</p><blockquote class="la"><p id="4b21" class="lb lc ht bd ld le lf lg lh li lj jn ek translated"><em class="lk">加入Coinmonks </em> <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> <em class="lk">电报频道</em> </a> <em class="lk">和</em> <a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> <em class="lk"> Youtube频道</em> </a> <em class="lk">了解加密交易和投资</em></p></blockquote><h1 id="8a49" class="ll jz ht bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh dt translated">另外，阅读</h1><ul class=""><li id="0f11" class="km kn ht is b it mi ix mj jb mk jf ml jj mm jn mn ks kt ku dt translated"><a class="ae jo" href="https://coincodecap.com/bookmap-review-2021-best-trading-software" rel="noopener ugc nofollow" target="_blank"> Bookmap点评</a> | <a class="ae jo" href="https://coincodecap.com/crypto-exchange-usa" rel="noopener ugc nofollow" target="_blank">美国5大最佳加密交易所</a></li><li id="4307" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn mn ks kt ku dt translated">最佳加密<a class="ae jo" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a> | <a class="ae jo" rel="noopener" href="/coinmonks/bitbns-review-38256a07e161"> Bitbns评论</a></li><li id="f057" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn mn ks kt ku dt translated"><a class="ae jo" href="https://coincodecap.com/crypto-exchange-in-singapore" rel="noopener ugc nofollow" target="_blank">新加坡十大最佳加密交易所</a> | <a class="ae jo" href="https://coincodecap.com/buy-axs-token" rel="noopener ugc nofollow" target="_blank">购买AXS </a></li><li id="bbe7" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn mn ks kt ku dt translated"><a class="ae jo" href="https://coincodecap.com/red-dog-casino-review" rel="noopener ugc nofollow" target="_blank">红狗赌场评论</a> | <a class="ae jo" href="https://coincodecap.com/swyftx-review" rel="noopener ugc nofollow" target="_blank"> Swyftx评论</a> | <a class="ae jo" href="https://coincodecap.com/coingate-review" rel="noopener ugc nofollow" target="_blank"> CoinGate评论</a></li><li id="ea91" class="km kn ht is b it kv ix kw jb kx jf ky jj kz jn mn ks kt ku dt translated"><a class="ae jo" href="https://coincodecap.com/best-crypto-to-invest-in-india-in-2021" rel="noopener ugc nofollow" target="_blank">投资印度的最佳密码</a>|<a class="ae jo" href="https://coincodecap.com/wazirx-p2p" rel="noopener ugc nofollow" target="_blank">WazirX P2P</a>|<a class="ae jo" href="https://coincodecap.com/hi-dollar-review" rel="noopener ugc nofollow" target="_blank">Hi Dollar Review</a></li></ul></div></div>    
</body>
</html>