<html>
<head>
<title>Flattening smart contracts using HardHat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用HardHat展平智能合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/flattening-smart-contracts-using-hardhat-dffe7dbc7b3f?source=collection_archive---------2-----------------------#2022-06-08">https://medium.com/coinmonks/flattening-smart-contracts-using-hardhat-dffe7dbc7b3f?source=collection_archive---------2-----------------------#2022-06-08</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/cc9b719f1457319d88ae50a92e1893db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B7Ky05wDai-DtLkEmyG_XQ.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@afgprogrammer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mohammad Rahmani</a> on <a class="ae jf" href="https://unsplash.com/s/photos/programming-code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3615" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">通常，在编写智能合同时，我们会使用第三方库。一个例子是使用OpenZeppelin库创建ERC20或ERC721令牌。部署后，建议在网络的某个块资源管理器中验证和发布合同。</p><p id="96c7" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在以太坊网络的情况下，默认的块浏览器是<a class="ae jf" href="http://etherscan.io" rel="noopener ugc nofollow" target="_blank"> etherscan.io </a>。bscscan.com的<a class="ae jf" href="http://bscscan.com" rel="noopener ugc nofollow" target="_blank">就是币安智能连锁的</a>。一般来说，块浏览器有一个API，允许用户直接从IDE(或框架)中验证和发布契约，但通常需要事先在块浏览器中注册。</p><p id="2e71" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">另一种验证方法是复制并粘贴契约代码，但是这需要复制并粘贴整个契约，包括导入的库。将契约扁平化是必不可少的，也就是将所有的依赖关系聚集在一个文件中。</p><p id="218d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在本文中，我们将看到如何使用HardHat来实现这一点。例如，让我们使用OpenZepellin库创建一个ERC20令牌契约。我们首先创建一个新项目:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="3d4a" class="kn ko ht kj b fv kp kq l kr ks">$ npx hardhat</span></pre><p id="c3de" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">之后，控制台上会出现一个警告，警告必须安装一些库。您需要执行以下命令:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="6180" class="kn ko ht kj b fv kp kq l kr ks">$ npm install --save-dev "hardhat@^2.9.0" "@nomiclabs/hardhat-waffle@^2.0.0" "ethereum-waffle@^3.0.0" "chai@^4.2.0" "@nomiclabs/hardhat-ethers@^2.0.0" "ethers@^5.0.0"</span></pre><p id="99ad" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">安装后，当您再次运行“npx hardhat”时，控制台上会显示一个命令列表，如下图所示:</p><figure class="ke kf kg kh fq iu fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/aa5f25b0e3da27e55df24eeb6a50e433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*6G_AutR3_Jek6Zwu_BruuQ.png"/></div></figure><p id="0472" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">注意，其中一个选项是“<strong class="ji hu">展平</strong>”，这将是我们将运行的展平合同的命令。现在让我们导入OpenZepellin库，如下所示:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="0b1e" class="kn ko ht kj b fv kp kq l kr ks">$ npm install @openzeppelin/contracts</span></pre><p id="99af" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在<em class="ku">合同</em>文件夹中，让我们创建一个名为<em class="ku">令牌的新合同。Sol </em>。代码如下所示。</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="0f23" class="kn ko ht kj b fv kp kq l kr ks">pragma solidity ^0.8.7;  <br/>import "@openzeppelin/contracts/token/ERC20/ERC20.sol";  </span><span id="0a19" class="kn ko ht kj b fv kv kq l kr ks">contract Token is ERC20 {      <br/>   constructor(uint256 initialSupply) ERC20("Flattened","FLAT") {<br/>      _mint(msg.sender, initialSupply);     <br/>   }      <br/>}</span></pre><p id="5910" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">令牌的“基础”在<em class="ku"> ERC20.sol </em>文件中，该文件又导入其他文件。如果想把完整的合同放在一个文件夹里，就必须把它展平。为此，我们使用以下命令。</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="396d" class="kn ko ht kj b fv kp kq l kr ks">$ npx hardhat flatten ./contracts/Token.sol &gt; flattenedToken.sol</span></pre><p id="3555" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">将生成完整的扁平契约，其输出将位于名为<em class="ku"> flattenedToken.sol </em>的文件中。如果<em class="ku">合同</em>文件夹包含单个合同，即您想要展平的合同，执行代码可以忽略您想要展平的文件。也就是说，您可以使用:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="813d" class="kn ko ht kj b fv kp kq l kr ks">$ npx hardhat flatten  &gt; flattenedAll.sol</span></pre><p id="4496" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然而，如果<em class="ku"> contracts </em>文件夹有多个合同，并且您使用了上面的命令，HardHat会将所有现有的合同合并成一个文件。这可能不是你想要的。</p><p id="2692" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如果您现在检查名为<em class="ku"> flattenedToken.sol </em>的文件，您可以看到它包含了<em class="ku"> Token使用的所有合同。索尔</em>，正如你在下图中看到的。</p><figure class="ke kf kg kh fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kw"><img src="../Images/50a4ac08976b8578478d5e7eaec61ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJEs9MReCk6_Imu8Ll1UNA.png"/></div></div></figure><p id="7c53" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">部署到网络后，现在只需复制和粘贴此合同，就可以在block explorer中对其进行验证和发布。</p><p id="9f0c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">感谢阅读！</strong></p><blockquote class="kx"><p id="8ac7" class="ky kz ht bd la lb lc ld le lf lg kd ek translated">加入Coinmonks <a class="ae jf" href="https://t.me/joinchat/Trz8jaxd6xEsBI4p" rel="noopener ugc nofollow" target="_blank"> Telegram group </a>并了解加密交易和投资</p></blockquote></div></div>    
</body>
</html>