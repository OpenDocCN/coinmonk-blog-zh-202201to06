<html>
<head>
<title>Deciphering Solidity: Does adding a PAYABLE keyword actually save GAS?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解密扎实:加一个可支付的关键词实际上省油吗？</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deciphering-solidity-does-adding-a-payable-keyword-actually-save-gas-89d1d8298d3f?source=collection_archive---------8-----------------------#2022-06-20">https://medium.com/coinmonks/deciphering-solidity-does-adding-a-payable-keyword-actually-save-gas-89d1d8298d3f?source=collection_archive---------8-----------------------#2022-06-20</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/206e95acfd1aa2fc6a9f9a9d0f26a2df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eX2PmLb3hMokSsfwK4ZSrA.png"/></div></div></figure><p id="1d4e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">嘿，范姆👋🏻</p><p id="c621" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">欢迎阅读<em class="jz">解密系列</em>中的另一篇文章，在这篇文章中，我们将选取一个特定的智能合约/Web3主题并深入了解它。</p><p id="231d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你最近一直在使用Solidity开发智能合同，你可能会遇到<strong class="jd hu">应付款</strong>关键字。</p><p id="259f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个博客也是如此，我们在这里破译了它所有有趣的<em class="jz">和怪异的</em>秘密。😃</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="acd8" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">快速介绍:支付关键字的基础知识</h1><p id="33e6" class="pw-post-body-paragraph jb jc ht jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">在智能合约能做的所有美妙事情中，储存你的钱(ETH)是其中之一。现在，为了在智能合约中获得receive ETH，Solidity language获得了一个名为<strong class="jd hu"> payable的特定关键字。</strong></p><p id="7ecf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">应付款</strong>关键字，用非常简单的话来说，就是solidity语言中的修饰语，可以附加到任何函数上。一旦附加，这个关键字允许函数接收以太。换句话说，在用payable关键字触发一个函数的同时，你可以将ether(<strong class="jd hu"><em class="jz">msg . value</em></strong>)和那个交易一起发送。</p><p id="a724" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">虽然这一切都很好，但几个月前，当我在Twitter上滚动时，我遇到了一个有趣的关于应付款关键字的警告。它吸引了我所有的注意力，我发现每当一个<strong class="jd hu">应付款</strong>修饰符被附加到任何函数上时，就会发生一个有趣的(<strong class="jd hu"> <em class="jz">但是真正关联的</em> </strong>)场景👀。</p><p id="392b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">让我们快速看一下这个有趣的场景:</em></p><figure class="lm ln lo lp fq iu fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/3711e8c50c070fbcbd0e89ef87fcf289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*SiIffdmWYbXnq3E1qcZ80g.png"/></div><figcaption class="lq lr fg fe ff ls lt bd b be z ek">A setter function with NO Payable Keyword</figcaption></figure><p id="f274" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在上面的图片中，我们有一个非常简单的setter函数，它将uint256变量的状态设置为100。如果你触发这个功能，你会发现交易气成本在<strong class="jd hu"> 43300左右。</strong></p><p id="7a1b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">好，现在让我们看看第二个条件。</p><figure class="lm ln lo lp fq iu fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/e302f3eccb5d869e2445a5afb5c96d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*TpUsoYjHoLRZAgXAGo-VOA.png"/></div><figcaption class="lq lr fg fe ff ls lt bd b be z ek">A setter function WITH Payable Keyword</figcaption></figure><p id="d2b8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在第二种情况下，我们有完全相同的函数，它执行完全相似的设置状态变量的事务。然而，这里唯一的区别是附加在函数上的一个额外的<strong class="jd hu">应付款修饰符</strong>。</p><p id="bf41" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">非常有趣的是，如果你看看调用这个函数的交易气体成本，它在<strong class="jd hu"> 43276 </strong>左右，低于上面提到的没有<em class="jz">应付款关键字</em>的函数。</p><p id="e84f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">是的，你说得对。</p><p id="4281" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> <em class="jz">增加一个简单的应付关键字只是减少了函数中的用气量。😃</em> </strong></p><figure class="lm ln lo lp fq iu fe ff paragraph-image"><div class="fe ff lu"><img src="../Images/07cba671ac2f42736d9c585703973379.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*RiJOOaf2nsUlcThYDJCTHg.png"/></div></figure></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="3903" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">啊哈时刻💡💡</h1><p id="549a" class="pw-post-body-paragraph jb jc ht jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">好了，现在是时候理解了——为什么应付款修改量会降低油耗？ </p><p id="1e92" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个问题的一个非常简单的答案是:</p><blockquote class="lv"><p id="46f1" class="lw lx ht bd ly lz ma mb mc md me jy ek translated"><strong class="ak"> <em class="mf">增加一个payable关键字，降低正在执行的操作码数量，从而降低耗气量。</em>T3】</strong></p></blockquote><p id="8fb5" class="pw-post-body-paragraph jb jc ht jd b je mg jg jh ji mh jk jl jm mi jo jp jq mj js jt ju mk jw jx jy hm dt translated">很奇怪，不是吗？如何在函数中增加额外的修饰符来减少而不是增加操作码的数量？？？</p><p id="f6e3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这里有一些技术上的(<em class="jz">和逻辑上的</em>)解释。😃</p><ol class=""><li id="535f" class="ml mm ht jd b je jf ji jj jm mn jq mo ju mp jy mq mr ms mt dt translated">正如我们已经知道的，对于一个能够接收以太的函数，一个<strong class="jd hu"> payable修饰符</strong>必须被附加到它上面。而没有任何<strong class="jd hu">应付款</strong>修饰符的函数将永远不能接收任何以太。</li><li id="2e5d" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy mq mr ms mt dt translated">必须注意的是，这在可靠性方面是一个严格的规则，因此如果你试图在调用一个<strong class="jd hu">不可支付的</strong>函数时传递以太，它将简单地恢复。</li><li id="5ae7" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy mq mr ms mt dt translated">因此，在<strong class="jd hu">不可支付</strong>函数的情况下，在调用<strong class="jd hu">不可支付</strong>函数时会执行额外的操作码，以确保只有在随事务一起发送的ether ( <strong class="jd hu"> msg.value </strong>)恰好等于<strong class="jd hu">零时才会执行该函数。</strong></li><li id="db1d" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy mq mr ms mt dt translated">然而，对于<strong class="jd hu">应付款</strong>功能来说，情况并非如此。Payable函数允许用户在调用函数时传入非零或零的值。</li><li id="5070" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy mq mr ms mt dt translated">这基本上意味着，即使在调用<strong class="jd hu">应付款函数时发送了零以太(<strong class="jd hu"> <em class="jz"> msg.value == 0 </em> </strong>)，交易也不会恢复。因此，在应付函数的情况下，不需要显式检查<strong class="jd hu">消息值</strong>。</strong></li></ol></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="a9b1" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">简单地🥜</h1><figure class="lm ln lo lp fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mz"><img src="../Images/bcb29286c05e1f5aa9f0595383eecc24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2x8G2ABbHP2PePqVBYYwdQ.png"/></div></div><figcaption class="lq lr fg fe ff ls lt bd b be z ek">GAS Difference between PAYABLE and NON-PAYABLE Functions in Solidity</figcaption></figure><p id="1d6c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">对于非付费功能:</strong></p><p id="5cab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">答:包括额外的检查，以确保在调用函数时没有以太值通过。</em></p><p id="b7ec" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这些检查增加了被执行的操作码的数量。</p><p id="207d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">操作码数量的增加最终会导致更高的气体使用量。</p><p id="638d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">对于付费功能:</strong></p><p id="35d2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">答:无需额外检查，因为该功能可接受乙醚的零值或非零值。</em></p><p id="b2b1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz"> b .没有额外的检查意味着没有额外的操作码被执行。</em></p><p id="3f13" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz"> c .执行中操作码越低，意味着气体消耗越低。</em></p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="5a56" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">我的两分钱🪙🪙</h1><p id="cd65" class="pw-post-body-paragraph jb jc ht jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated"><strong class="jd hu"> <em class="jz">上述所有细节，是否意味着我们应该使用付费功能来节省汽油？</em>T49】</strong></p><p id="4cf6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">好吧，那可以讨论一下。</p><p id="224d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">天然气优化无疑是每个智能合同向导在合同中梦寐以求的事情。</p><p id="8a9a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然而，一个迫切的问题是:</p><figure class="lm ln lo lp fq iu fe ff paragraph-image"><div class="fe ff na"><img src="../Images/2c94056b25990fc39d2980600db7df34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*sEkkr-KedSsgw6BtBlpOHA.png"/></div></figure><p id="f16f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">虽然节省汽油很重要，但在函数的预期行为上妥协，尽量减少必要的状态改变，或者仅仅为了节省一些额外的汽油而使用不适当的策略，都不是一个好主意。</p><blockquote class="lv"><p id="9f94" class="lw lx ht bd ly lz ma mb mc md me jy ek translated">换句话说，如果一个函数与接收以太无关，那么它就不应该附加任何payable关键字，即使这样可以节省一些汽油。</p></blockquote><figure class="nc nd ne nf ng iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nb"><img src="../Images/e28abc7946e881bb8c77ebf183e59a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gJMimAskvWsUxKLE1k6OEg.png"/></div></div><figcaption class="lq lr fg fe ff ls lt bd b be z ek">Dropping <a class="nh ni gr" href="https://medium.com/u/a005f91be571?source=post_page-----89d1d8298d3f--------------------------------" rel="noopener" target="_blank">John Adler</a>’s 2 Cents as well 😇</figcaption></figure><p id="bc8a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">所以我坚信，仅仅为了省油而在一个函数中增加一个不必要的payable关键字，很可能是一个糟糕的决定。上面提到的加了payable关键字的同时减气的场景，只是一个有线的solidity语言设计，一点效果都没有。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="86e4" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">关于我自己</h1><h2 id="8287" class="nj ki ht bd kj nk nl nm kn nn no np kr jm nq nr kv jq ns nt kz ju nu nv ld nw dt translated">我是谁？🙋🏻‍♂️</h2><p id="062c" class="pw-post-body-paragraph jb jc ht jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">𝙃𝙞, 𝙄 𝙖𝙢 𝙕𝙖𝙧𝙮𝙖𝙗 👋🏻我是一名精通区块链和智能合同的工程师，我的愿景是用Web3去中心化和保护传统网络。主要从事智能合约工作，在开发和智能合约安全方面都有丰富的经验。</p><h2 id="3554" class="nj ki ht bd kj nk nl nm kn nn no np kr jm nq nr kv jq ns nt kz ju nu nv ld nw dt translated">我做什么🧑🏼‍💻</h2><ul class=""><li id="08d2" class="ml mm ht jd b je lf ji lg jm nx jq ny ju nz jy oa mr ms mt dt translated">我撰写安全和优化的智能合同</li><li id="d014" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy oa mr ms mt dt translated">我对智能合同进行安全审计，并提高EVM连锁店智能合同的整体安全性</li><li id="14a8" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy oa mr ms mt dt translated">我撰写和谈论Web3和智能合约&amp;为扩展Web3的边界贡献我的一份力量。</li></ul><h2 id="8ffa" class="nj ki ht bd kj nk nl nm kn nn no np kr jm nq nr kv jq ns nt kz ju nu nv ld nw dt translated">打声招呼，保持联系🤝</h2><p id="66b6" class="pw-post-body-paragraph jb jc ht jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated"><a class="ae lk" href="https://www.linkedin.com/in/zaryab-afser-97085b157/" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hu"> <em class="jz">领英</em> </strong> </a> <strong class="jd hu"> <em class="jz">。| </em> </strong> <a class="ae lk" href="https://twitter.com/zaryab_eth" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hu"> <em class="jz">推特</em></strong></a><strong class="jd hu"><em class="jz">|</em></strong><a class="ae lk" href="https://www.linkedin.com/newsletters/decipher-with-zaryab-6944516958839021568/" rel="noopener ugc nofollow" target="_blank"><strong class="jd hu"><em class="jz">关注我的每周简讯</em></strong></a><strong class="jd hu"><em class="jz">|</em></strong><a class="ae lk" href="https://zaryab2000.notion.site/Invite-me-to-your-Next-Web3-Event-78bcd204b866426687e1afbcdc61c5c7" rel="noopener ugc nofollow" target="_blank"><strong class="jd hu"><em class="jz">邀请我参加Web3活动</em> </strong> </a></p><blockquote class="lv"><p id="ec74" class="lw lx ht bd ly lz ma mb mc md me jy ek translated"><em class="mf">加入Coinmonks </em> <a class="ae lk" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> <em class="mf">电报频道</em> </a> <em class="mf">和</em> <a class="ae lk" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> <em class="mf"> Youtube频道</em> </a> <em class="mf">了解加密交易和投资</em></p></blockquote><h1 id="1b98" class="kh ki ht bd kj kk ob km kn ko oc kq kr ks od ku kv kw oe ky kz la of lc ld le dt translated">另外，阅读</h1><ul class=""><li id="cd6b" class="ml mm ht jd b je lf ji lg jm nx jq ny ju nz jy oa mr ms mt dt translated"><a class="ae lk" href="https://coincodecap.com/bookmap-review-2021-best-trading-software" rel="noopener ugc nofollow" target="_blank"> Bookmap评论</a> | <a class="ae lk" href="https://coincodecap.com/crypto-exchange-usa" rel="noopener ugc nofollow" target="_blank">美国5大最佳加密交易所</a></li><li id="e00c" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy oa mr ms mt dt translated">最佳加密<a class="ae lk" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a> | <a class="ae lk" rel="noopener" href="/coinmonks/bitbns-review-38256a07e161"> Bitbns评论</a></li><li id="4964" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy oa mr ms mt dt translated"><a class="ae lk" href="https://coincodecap.com/crypto-exchange-in-singapore" rel="noopener ugc nofollow" target="_blank">新加坡十大最佳密码交易所</a> | <a class="ae lk" href="https://coincodecap.com/buy-axs-token" rel="noopener ugc nofollow" target="_blank">收购AXS </a></li><li id="d597" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy oa mr ms mt dt translated"><a class="ae lk" href="https://coincodecap.com/red-dog-casino-review" rel="noopener ugc nofollow" target="_blank">红狗赌场评论</a> | <a class="ae lk" href="https://coincodecap.com/swyftx-review" rel="noopener ugc nofollow" target="_blank"> Swyftx评论</a> | <a class="ae lk" href="https://coincodecap.com/coingate-review" rel="noopener ugc nofollow" target="_blank"> CoinGate评论</a></li><li id="9718" class="ml mm ht jd b je mu ji mv jm mw jq mx ju my jy oa mr ms mt dt translated"><a class="ae lk" href="https://coincodecap.com/best-crypto-to-invest-in-india-in-2021" rel="noopener ugc nofollow" target="_blank">投资印度的最佳加密软件</a>|<a class="ae lk" href="https://coincodecap.com/wazirx-p2p" rel="noopener ugc nofollow" target="_blank">WazirX P2P</a>|<a class="ae lk" href="https://coincodecap.com/hi-dollar-review" rel="noopener ugc nofollow" target="_blank">Hi Dollar Review</a></li></ul></div></div>    
</body>
</html>