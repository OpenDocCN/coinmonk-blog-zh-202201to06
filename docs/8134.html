<html>
<head>
<title>Triangular Arbitrage With Crypto DEX’s: Part Two</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带加密指数的三角套利:第二部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/triangular-arbitrage-with-crypto-dexs-part-two-f6e6ff66fb87?source=collection_archive---------1-----------------------#2022-06-06">https://medium.com/coinmonks/triangular-arbitrage-with-crypto-dexs-part-two-f6e6ff66fb87?source=collection_archive---------1-----------------------#2022-06-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="4621" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">图和密码有什么关系！？</p><p id="d142" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt jo translated">自从我上次更新以来已经有一段时间了，我经历了很多事情，我彻底改造了整个套利机器人，让它工作得更有效率。这个更新将涵盖很多，所以我可能要做3个部分。这一部分将是如何让这样的东西大规模工作的本质和细节。</p><h1 id="e672" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">概述</h1><p id="f376" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">在上一部分中，我讨论了从DEX(在本例中是Tinyman)获取资产池，并将每个资产的报价放入一个矩阵中。然后，我将计算资产的每个排列，并使用矩阵来获得报价，即</p><pre class="la lb lc ld fq le lf lg lh aw li dt"><span id="11b6" class="lj jy ht lf b fv lk ll l lm ln">Path (0, 31566704, 312769) Close to Profit!</span><span id="584a" class="lj jy ht lf b fv lo ll l lm ln">First Swap Quote: SwapQuote(swap_type='fixed-input', amount_in=ALGO('20'), amount_out=USDC('14.394919'), swap_fees=ALGO('0.06'), slippage=0.01)</span><span id="25a8" class="lj jy ht lf b fv lo ll l lm ln">Second Swap Quote: SwapQuote(swap_type='fixed-input', amount_in=USDC('14.25097'), amount_out=USDt('14.260552'), swap_fees=USDC('0.042752'), slippage=0.01)</span><span id="7239" class="lj jy ht lf b fv lo ll l lm ln">Third Swap Quote: SwapQuote(swap_type='fixed-input', amount_in=USDt('14.117947'), amount_out=ALGO('19.402954'), swap_fees=USDt('0.042353'), slippage=0.01)</span><span id="0818" class="lj jy ht lf b fv lo ll l lm ln">Final Amount Of ALGO('19.208925')</span></pre><p id="ae87" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里的问题是，收集池是通过分页API完成的，对于Tinyman，您可以为575个池的每个请求获得10个池！这是58个请求，然后我不得不再次向Algorand区块链请求池对象，即58 * 2个请求，116个。如果每个网络请求花费1秒钟，那就是2分钟，而我甚至还没有得到报价！</p><p id="ccfa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">矩阵查找是在最坏的立方时间，在大O中，这是O(n ),不会扩展。</p><h1 id="253f" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">异步获取</h1><p id="a54c" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">当我第一次开始这个项目时，它更多的是一个概念验证，我并不期望赚钱，但现在我已经部署了它，我需要更快的查找，这意味着我必须异步进行。如果您没有接触过异步python，那么您就错过了。这是一个关于https://www.youtube.com/watch?v=2IW-ZEui4h4<a class="ae lp" href="https://www.youtube.com/watch?v=2IW-ZEui4h4" rel="noopener ugc nofollow" target="_blank">的很棒的视频</a></p><p id="df54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">基本上，我可以同时发出所有58个HTTP请求。然后，我使用多处理池来调用区块链并检索池对象。</p><figure class="la lb lc ld fq lq"><div class="bz el l di"><div class="lr ls l"/></div></figure><p id="390d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我已经为AlgoFi和PactFi复制了这种行为，Algorand上的另外两个DEX。然后，我使用与获取池对象相同的多重处理技巧来获取报价。</p><h1 id="9729" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">图论和套利</h1><p id="180c" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">现在我可以把这些都放进一个矩阵里，我可以把我的2D矩阵转换成三维，第三维就是交换。我没有那样做，这看起来更像是一个图形问题，我没有进行矩阵查找，而是遍历了一条路径，节省了多次矩阵查找。</p><h2 id="ec61" class="lj jy ht bd jz lt lu lv kd lw lx ly kh jb lz ma kl jf mb mc kp jj md me kt mf dt translated">把它想象成一个图表</h2><p id="77b8" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">没有比视觉化更好的方式来解释这一点，所以这里是图表上的AlgoFi和PactFi交换(Tinyman有点太大了..)</p><figure class="la lb lc ld fq lq fe ff paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="fe ff mg"><img src="../Images/cfd8ca25081c55c47345ff7893536065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g0b_6EbiJFdizUcgK8fkhg.png"/></div></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">Swap Network</figcaption></figure><p id="ae06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">PactFi边缘为红色，AlgoFi边缘为蓝色。您可以通过池的连接来查看哪些池可用。</p><p id="ccc3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我还可以单击一条边和一项资产。我很快会谈到重量。</p><figure class="la lb lc ld fq lq fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/d21aaff1adde2513343a67043638d564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*ipvm-lioIpe3bWPIqyDy3w.png"/></div></figure><h2 id="c03d" class="lj jy ht bd jz lt lu lv kd lw lx ly kh jb lz ma kl jf mb mc kp jj md me kt mf dt translated">作为图形问题的套利</h2><p id="5335" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">现在，我已经得到了所有交易所、资产和报价的图表。我需要找到套利机会。这一节不会详细介绍，因此需要对图论有所了解。</p><p id="6e3f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">问题归结为找到图中的某个地方，在那里我遍历X边，我将结束比开始时更多的源节点。例如，如果我从1个ALGO开始，我需要找到一个路径，在遍历后，我得到大于1个ALGO。我需要找到正循环，在这些循环中，路径的成本随着你穿越的次数增加而增加。</p><figure class="la lb lc ld fq lq fe ff paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="fe ff ms"><img src="../Images/99e1fff3e7d900e5c859e63b5757903e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r_REi4qCCw_We-jlqrGXKg.png"/></div></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">Exchange Rate Positive Loop Example</figcaption></figure><p id="3846" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">正如你在上面看到的，每一次我们遵循这个循环，我们都在增加我们的起始重量，也就是我们的量。这是一个正循环。</p><h2 id="8947" class="lj jy ht bd jz lt lu lv kd lw lx ly kh jb lz ma kl jf mb mc kp jj md me kt mf dt translated">输入贝尔曼-福特</h2><p id="0879" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">不幸的是，没有检测正循环的算法，对于最短路径问题，正循环永远不会被发现，因为你试图降低成本或最小化重量。另一个问题是没有最短路径算法乘以权重，而是加法。</p><p id="7178" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">幸运的是，我们可以使用一些数学技巧来帮助我们。贝尔曼-福特是一种算法，在给定每条边X权重的情况下，找到源和目标之间的最短路径。它通过添加路径的权重来获得总路径权重。Bellman-Ford可以检测负循环，这对于我们的用例非常有用。它通过寻找趋向负无穷大的路径来检测负循环，而我们寻找的是趋向无穷大的路径。贝尔曼·福特之所以这样做，是因为如果一个循环趋向负无穷大，那么最短路径永远也找不到，它只会一直遍历这个循环。</p><p id="52bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，利用这些数学技巧，我们可以将目前寻找套利的方法(乘以每个汇率)改为使用加法，这就是贝尔曼-福特所使用的方法。以下面的套利机会为例。</p><figure class="la lb lc ld fq lq fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/b325a85d970e90b7912fe0dfb81a5e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*NzGUxXJUw50JvOx94fc9hQ.png"/></div></figure><p id="dea7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们对每个汇率取Ln(自然对数),我们可以把它变成ln(a) + ln(b) + ln(c)</p><figure class="la lb lc ld fq lq fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/a45a888ef23665ad3a1198d37b4fb7b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*XoVrIqJhuVBafZzglP0OFg.png"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">Natural Log Example</figcaption></figure><p id="c56f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，如果我们将每个对数乘以-1，我们现在使用负循环来计算是否有套利机会。</p><figure class="la lb lc ld fq lq fe ff paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="fe ff mv"><img src="../Images/9ece38bc40a73ba6027b76cd278d9dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-4j34yFQ1dDf3EIFRcuVw.png"/></div></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">Bellman Ford Example</figcaption></figure><p id="3b84" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以看到，当我们遍历这个周期时，我们越来越接近负无穷大，这正是我们试图检测到的信号套利。</p><p id="88d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">贝尔曼-福特的执行时间是O(V*E)其中V是顶点，E是边。比我们之前的矩阵查找快多了。</p><h1 id="0b5e" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated"><strong class="ak">最终产品</strong></h1><p id="4e58" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">为了将这一切结合在一起，当前的流程如下。</p><figure class="la lb lc ld fq lq fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/65fd7da792cf9cc922d5a1babb3cbb5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*WpqxEvt4ZkCItZNpKSt4fA.png"/></div></figure><p id="caee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">输出看起来有点像这样</p><pre class="la lb lc ld fq le lf lg lh aw li dt"><span id="b575" class="lj jy ht lf b fv lk ll l lm ln">Found a winning Cycle… (404044168, 0, 404044168) via [&lt;Exchange.ALGOFI: 2&gt;, &lt;Exchange.TINYMAN: 1&gt;] with profit 0.19299999999999962</span></pre><p id="3a48" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，代码将创建事务并启动。这里还有一些工作要做——一个更好的方法是在AlgoFi上获得一笔快速贷款，并用它来增加初始投资额并获得更高的回报。这将是下一部分！</p><blockquote class="mx"><p id="9cf5" class="my mz ht bd na nb nc nd ne nf ng jn ek translated">加入Coinmonks <a class="ae lp" href="https://t.me/joinchat/Trz8jaxd6xEsBI4p" rel="noopener ugc nofollow" target="_blank">电报集团</a>，了解加密交易和投资</p></blockquote></div></div>    
</body>
</html>