# ç®—æ³•äº¤æ˜“:åˆå­¦è€…æŒ‡å—ç³»åˆ—ã€‚

> åŸæ–‡ï¼š<https://medium.com/coinmonks/algorithmic-trading-a-beginners-guide-series-7ecb4cdd4281?source=collection_archive---------8----------------------->

## å¦‚ä½•ä½¿ç”¨**å¸å®‰ API** å¼€å‘ä¸€ä¸ªåŠ å¯†è´§å¸äº¤æ˜“æœºå™¨äºº(ä¸€æ­¥ä¸€æ­¥æ¥)ã€‚

## ä»€ä¹ˆæ˜¯ç®—æ³•äº¤æ˜“ï¼Ÿï¼

ç®€å•æ¥è¯´ï¼Œç®—æ³•äº¤æ˜“å°±æ˜¯åˆ©ç”¨ç¨‹åºï¼Œæ ¹æ®ç¼–ç¨‹è¯­è¨€å®ç°çš„ç­–ç•¥ï¼Œè¿›è¡Œç³»ç»Ÿçš„äº¤æ˜“ã€‚

ç®—æ³•äº¤æ˜“å¯ä»¥**å…¨** - **è‡ªåŠ¨åŒ–ï¼ŒåŠè‡ªåŠ¨ï¼Œæˆ–è€…ç»™å‡ºä¿¡å·æ‰‹åŠ¨æ‰§è¡Œã€‚**

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¸å®‰ API å¼€å‘ä¸€ä¸ªç®€å•çš„åŠè‡ªåŠ¨ç­–ç•¥æ¥è·å–æ•°æ®å’Œæ‰§è¡Œäº¤æ˜“ã€‚

æˆ‘æ­£åœ¨ä½¿ç”¨æœ¨æ˜Ÿç¬”è®°æœ¬ï¼Œä½¿ç”¨ pythonï¼Œpandas å’Œ NumPy

ä»å¯¼å…¥å®‰è£… python-å¸å®‰è¿æ¥åˆ°å¸å®‰ API æ‰€éœ€çš„åº“å¼€å§‹ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä½¿ç”¨**å¸å®‰æµ‹è¯•ç½‘ API** è®©ä»»ä½•äººéƒ½èƒ½å¤Ÿå»æ‰§è¡Œä»£ç ï¼Œå³ä½¿ä½ æ²¡æœ‰å¸å®‰å¸æˆ·ã€‚

é¦–å…ˆï¼Œæ‚¨å¿…é¡»æœ‰ä¸€ä¸ª API å¯†åŒ™å’Œç§˜å¯†å¯†åŒ™æ¥æä¾›ç»™å®¢æˆ·æœºå‡½æ•°ä»¥å»ºç«‹è¿æ¥

è¦ç”Ÿæˆ API å¯†é’¥å’Œç§˜å¯†å¯†é’¥ï¼Œè¯·åˆ°[å¸å®‰ç°åœºæµ‹è¯•ç½‘ç»œ](https://testnet.binance.vision/)ç”¨ GitHub ç­¾åå¹¶ç”Ÿæˆ HMAC SHA256 å¯†é’¥ã€‚

æœ€åï¼Œç”¨å®é™…çš„é”®æ›¿æ¢ä»£ç ä¸­çš„ APIKEY å’Œ SECRETKEY å˜é‡ã€‚

```
**import** pandas **as** pd
**import** numpy **as** np
!pip install python-binance**from** binance **import** Client

APIKEY **=** 'Your API KEY'
SECRETKEY **=** 'Your Secret KEY'client **=**Client(APIKEY,SECRETKEY)
client**.**API_URL **=** 'https://testnet.binance.vision/api'acc **=** client**.**get_account()
acc 
```

å»ºç«‹è¿æ¥åï¼Œè®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ **client.get_account()** å‡½æ•°æ¥æŸ¥çœ‹æˆ‘ä»¬çš„æµ‹è¯•å¸æˆ·ä½™é¢ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯ç»“æœã€‚

```
{'makerCommission': 0,
 'takerCommission': 0,
 'buyerCommission': 0,
 'sellerCommission': 0,
 'canTrade': True,
 'canWithdraw': False,
 'canDeposit': False,
 'updateTime': 1644598822834,
 'accountType': 'SPOT',
 'balances': [{'asset': 'BNB',
   'free': '1000.00000000',
   'locked': '0.00000000'},
  {'asset': 'BTC', 'free': '1.01300000', 'locked': '0.00000000'},
  {'asset': 'BUSD', 'free': '10000.00000000', 'locked': '0.00000000'},
  {'asset': 'ETH', 'free': '100.00000000', 'locked': '0.00000000'},
  {'asset': 'LTC', 'free': '500.00000000', 'locked': '0.00000000'},
  {'asset': 'TRX', 'free': '500000.00000000', 'locked': '0.00000000'},
  {'asset': 'USDT', 'free': '9449.55739000', 'locked': '0.00000000'},
  {'asset': 'XRP', 'free': '50000.00000000', 'locked': '0.00000000'}],
 'permissions': ['SPOT']}
```

ç°åœ¨æ˜¯è·å–åŠ å¯†æ•°æ®æµçš„æ—¶å€™äº†

å…³äºå¦‚ä½•ä»å¸å®‰è·å–æ•°æ®ï¼Œæˆ‘ä»¬æœ‰ä¸æ­¢ä¸€ç§é€‰æ‹©ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³è®©å®ƒè¶³å¤Ÿç®€å•ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨

**client . get _ historical _ klines()**å‡½æ•°

ä¸ºæ­¤å‡½æ•°æä¾›çš„å‚æ•°æœ‰:

**ç¬¦å·â€”** *åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ‚¨æƒ³è¦äº¤æ˜“çš„åŠ å¯†è´§å¸ç¬¦å·æ˜¯ BTCUSDT*

**æ—¶é—´æ¡†æ¶**:ä½ è¦äº¤æ˜“çš„æ—¶é—´æ¡†æ¶åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘é€‰æ‹©äº† 1 åˆ†é’Ÿçš„æ—¶é—´æ¡†æ¶ã€‚

T21:åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘é€‰æ‹©äº† 20 åˆ†é’Ÿã€‚

```
**def** dataorg(symbol):
    data **=** pd**.**DataFrame(client**.**get_historical_klines( symbol ,
                                                      '1m', 
                                                  '20 min ago UTC'))
    df **=** data**.**iloc[:,:6] df**.**columns **=** ['Time', 'Open', 'High' , 'Low' , 'Close','Volume'] df **=** df**.**set_index('Time') df**.**index **=** pd**.**to_datetime(df**.**index,unit**=**'ms') df **=** df**.**astype(float) **return** dfdataorg('BTCUSDT') 
```

æˆ‘å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒé‡‡ç”¨ä¸€ä¸ª**ç¬¦å·**å‚æ•°æ¥ç»„ç»‡æ•°æ®ï¼Œ

å¹¶æŠŠå®ƒåšæˆä¸€ä¸ªæ•°æ®æ¡†

ä»¥ä¸‹æ˜¯ç”Ÿæˆçš„æ•°æ®å¸§ï¼Œå…¶ä¸­åŒ…å«

æ—¶é—´ï¼Œå¼€ç›˜ä»·ï¼Œæœ€ä½ä»·ï¼Œæ”¶ç›˜ä»·å’Œæˆäº¤é‡ã€‚

![](img/7409056f443a18c441ae24e9c30edc26.png)

è¿™é‡Œæˆ‘ä»¬è¦è®¡ç®—è¿‡å» 20 åˆ†é’Ÿçš„ç´¯è®¡å›æŠ¥ï¼Œå¼€å§‹äº¤æ˜“ç­–ç•¥çš„å·¥ä½œã€‚

**ç´¯è®¡å›æŠ¥å…¬å¼**:(1+1 åˆ†é’Ÿå›æŠ¥)*(1+æœ€åä¸€åˆ†é’Ÿç´¯è®¡å›æŠ¥)-1

**pct_change()** :è®¡ç®—æœ€è¿‘ä¸€æ®µæ—¶é—´çš„ä»·æ ¼å˜åŒ–ã€‚

**cumprod()** :è®¡ç®—å…¬å¼çš„ååŠéƒ¨åˆ†ã€‚

```
test **=** dataorg('BTCUSDT')
ret **=** (test**.**Open**.**pct_change() **+** 1)**.**cumprod() **-**1
retTime
2022-02-11 16:52:00         NaN
2022-02-11 16:53:00    0.000279
2022-02-11 16:54:00    0.000974
2022-02-11 16:55:00    0.001551
2022-02-11 16:56:00    0.001645
2022-02-11 16:57:00    0.002303
2022-02-11 16:58:00    0.002782
2022-02-11 16:59:00    0.002060
2022-02-11 17:00:00    0.001818
2022-02-11 17:01:00    0.000858
2022-02-11 17:02:00    0.001216
2022-02-11 17:03:00    0.002534
2022-02-11 17:04:00    0.002666
2022-02-11 17:05:00    0.003242
2022-02-11 17:06:00    0.002548
2022-02-11 17:07:00    0.001416
2022-02-11 17:08:00    0.002460
2022-02-11 17:09:00    0.002109
2022-02-11 17:10:00    0.002550
2022-02-11 17:11:00    0.003376
Name: Open, dtype: float64
```

# æˆ˜ç•¥å®æ–½

æˆ‘ä»¬å°†åˆ¶å®šä¸€ä¸ªç®€å•çš„è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥:

**å¦‚æœ**æ¯”ç‰¹å¸ä»·æ ¼ä¸Šæ¶¨è¶…è¿‡ä¸€å®šæ¯”ä¾‹(0.2%) **åˆ™ä¹°å…¥**è®¢å•ï¼Œä¹°å…¥å**å¦‚æœ**ä»·æ ¼ä¸Šæ¶¨æˆ–ä¸‹è·Œä¸€å®šæ¯”ä¾‹(0.2%ï¼Œ-0.2%) **åˆ™å–å‡ºã€‚**

![](img/42e37f07e115c6dae41a73c37125285c.png)

```
 **def** strategy(symbol,qty,inPosition**=False**): **while** **True**: df **=** dataorg(symbol)
        cumret **=** (df**.**Open**.**pct_change()**+**1)**.**cumprod()**-**1 **if** **not** inPosition: **if** cumret[**-**1] **>** 0.002:
                    ordertime **=** df**.**index[**-**1]
                    order **=** client**.**create_order(symbol**=**symbol,  
                    side**=**'BUY',type**=**'MARKET', quantity**=**qty)

                    print(order)
                    inPosition**=True**
                    **break**
                **else**:
                    print('No trade excuted')
     **if** inPosition:
        **while** **True**:
            df**=**dataorg(symbol)
            afterbuy **=** df**.**loc[df**.**index **>** pd**.**to_datetime(
            order['transactTime'],
            unit**=**'ms')]

            **if** len(afterbuy) **>** 0: afterbuyret **=**  (df**.**Open**.**pct_change()**+**1)**.**cumprod()**-**1                    
                print(afterbuyret) **if** afterbuyret[**-**1]**>**0.002 **or** afterbuyret[**-**1]**< -0.002:** 
                    sellorder **=** client**.**create_order(symbol**=**symbol,
                                        side**=**'SELL',type**=**'MARKET',
                                                 quantity**=**qty)
                    print(sellorder)
                    **break**
```

## æ˜¯æ—¶å€™çœ‹çœ‹æœ€è¿‘ 20 åˆ†é’Ÿçš„ä»·æ ¼äº†ã€‚

```
test**.**Open**.**plot()
```

![](img/5053d3bf7268d19bfd2581636d8fdc8c.png)

## çœ‹èµ·æ¥æˆ‘ä»¬æœ‰ä¸Šå‡è¶‹åŠ¿ã€‚

# äº¤æ˜“æ‰§è¡Œ

æˆ‘ä»¬çš„æœ€åä¸€æ­¥æ˜¯è°ƒç”¨ **strategy()** å‡½æ•°ï¼Œç­‰å¾…äº¤æ˜“è¢«æ‰§è¡Œï¼Œ

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¹°å…¥è®¢å•ï¼Œç„¶åæ˜¯ä¸€ä¸ªäº¤æ˜“åçš„**ç´¯ç§¯å›æŠ¥**åˆ—è¡¨ï¼Œå½“å›æŠ¥è¶…è¿‡æˆ‘ä»¬çš„é˜ˆå€¼( **+0.2%æˆ–-0.2%** )æ—¶ï¼Œç„¶åæ˜¯ä¸€ä¸ªå–å‡ºäº¤æ˜“

è¿™æ˜¯ä¸€é¡¹æœ‰åˆ©å¯å›¾çš„äº¤æ˜“ğŸ˜€

```
strategy('BTCUSDT', 0.001){'symbol': 'BTCUSDT', 'orderId': 4982968, 'orderListId': -1, 'clientOrderId': 'oappYtNU1466jYiXCV3URd', 'transactTime': 1644599469117, 'price': '0.00000000', 'origQty': '0.00100000', 'executedQty': '0.00100000', 'cummulativeQuoteQty': '43.65218000', 'status': 'FILLED', 'timeInForce': 'GTC', 'type': 'MARKET', 'side': 'BUY', 'fills': [{'price': '43652.18000000', 'qty': '0.00100000', 'commission': '0.00000000', 'commissionAsset': 'BTC', 'tradeId': 1240296}]}Time
2022-02-11 16:52:00         NaN
2022-02-11 16:53:00    0.000279
2022-02-11 16:54:00    0.000974
2022-02-11 16:55:00    0.001551
2022-02-11 16:56:00    0.001645
2022-02-11 16:57:00    0.002303
2022-02-11 16:58:00    0.002782
2022-02-11 16:59:00    0.002060
2022-02-11 17:00:00    0.001818
2022-02-11 17:01:00    0.000858
2022-02-11 17:02:00    0.001216
2022-02-11 17:03:00    0.002534
2022-02-11 17:04:00    0.002666
2022-02-11 17:05:00    0.003242
2022-02-11 17:06:00    0.002548
2022-02-11 17:07:00    0.001416
2022-02-11 17:08:00    0.002460
2022-02-11 17:09:00    0.002109
2022-02-11 17:10:00    0.002550
2022-02-11 17:11:00    0.003376
2022-02-11 17:12:00    0.003520
Name: Open, dtype: float64{'symbol': 'BTCUSDT', 'orderId': 4983220, 'orderListId': -1, 'clientOrderId': 'OWLlWGmI044UlKEFaURffy', 'transactTime': 1644599521374, 'price': '0.00000000', 'origQty': '0.00100000', 'executedQty': '0.00100000', 'cummulativeQuoteQty': '43.65542000', 'status': 'FILLED', 'timeInForce': 'GTC', 'type': 'MARKET', 'side': 'SELL', 'fills': [{'price': '43655.42000000', 'qty': '0.00100000', 'commission': '0.00000000', 'commissionAsset': 'USDT', 'tradeId': 1240505}]}
```

# ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ

å¥½äº†ï¼Œä¼™è®¡ä»¬ï¼Œè¿™å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å†…å®¹ã€‚å½“ç„¶ï¼Œè¿™ä¸æ˜¯æœ€å¥½çš„èµšé’±çš„äº¤æ˜“æœºå™¨äººï¼Œè€Œä¸”å®ƒç¼ºå°‘å¾ˆå¤šä¸œè¥¿ï¼Œ

ç‰¹åˆ«æ˜¯æ•°æ®åˆ†æå’Œ[å›æµ‹](/coinmonks/how-to-backtest-a-trading-bot-with-backtrader-b5486277c7dc)ï¼Œ

æˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æä¾›æ›´å¤šè§è§£ï¼Œ

æˆ‘å¸Œæœ›ä½ å–œæ¬¢ã€‚