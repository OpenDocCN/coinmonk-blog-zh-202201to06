<html>
<head>
<title>NFT Staking Smart contract with Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NFT以稳健赢得精明合约</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/nft-staking-swith-solidity-d99f3281c5a8?source=collection_archive---------0-----------------------#2022-04-05">https://medium.com/coinmonks/nft-staking-swith-solidity-d99f3281c5a8?source=collection_archive---------0-----------------------#2022-04-05</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="e196" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">作为一名smart contract和dapp开发人员，我在Fiverr的工作中收到的最多的任务之一就是nft staking。我很难找到例子，所以我决定为可能正在努力实现这一点的开发人员创建这个指南。</p><p id="04e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你想和我合作，这里有我的链接，比如contra或Fiverr，还有Github repo:</p><div class="jo jp fm fo jq jr"><a href="https://linktr.ee/drakenwolf" rel="noopener  ugc nofollow" target="_blank"><div class="js ab ej"><div class="jt ab ju cl cj jv"><h2 class="bd hu fv z el jw eo ep jx er et hs dt translated">@drakenwolf | Linktree</h2><div class="jy l"><h3 class="bd b fv z el jw eo ep jx er et ek translated">链接树。让你的链接做得更多。</h3></div><div class="jz l"><p class="bd b gc z el jw eo ep jx er et ek translated">linktr.ee</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf kg jr"/></div></div></a></div><div class="jo jp fm fo jq jr"><a href="https://github.com/Drakenwolf/Nft_Staking_System" rel="noopener  ugc nofollow" target="_blank"><div class="js ab ej"><div class="jt ab ju cl cj jv"><h2 class="bd hu fv z el jw eo ep jx er et hs dt translated">GitHub-Drakenwolf/Nft _ Staking _ System:一个开源的、Nft的Staking系统。</h2><div class="jy l"><h3 class="bd b fv z el jw eo ep jx er et ek translated">这个项目演示了一个基本的安全帽用例。它附有一份合同样本，一份合同测试，一份样本…</h3></div><div class="jz l"><p class="bd b gc z el jw eo ep jx er et ek translated">github.com</p></div></div><div class="ka l"><div class="kh l kc kd ke ka kf kg jr"/></div></div></a></div><p id="3169" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是什么是非功能性测试系统呢？</p><p id="43aa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该系统将由3份合同组成:</p><ol class=""><li id="7b06" class="ki kj ht is b it iu ix iy jb kk jf kl jj km jn kn ko kp kq dt translated">一个Erc20代币将作为奖励代币。</li><li id="c9ea" class="ki kj ht is b it kr ix ks jb kt jf ku jj kv jn kn ko kp kq dt translated">Erc721将是nft令牌。</li><li id="9faa" class="ki kj ht is b it kr ix ks jb kt jf ku jj kv jn kn ko kp kq dt translated">赌注合同将持有赌注nft，并允许要求奖励。</li></ol><p id="0f59" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这不会是一个自动系统，智能合同需要有人调用该功能并签署交易，这可以由用户通过UI或后端的oracle触发。</p><p id="b155" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们需要使用开放的zeppelin契约创建erc20令牌。</p><p id="36d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于这个staking系统，我决定使用erc20的mint函数直接为用户铸造令牌。这就是为什么我使用open zeppelin的AccessControl，这样我们就可以为staking契约分配一个铸造角色。</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff kw"><img src="../Images/90d46c511db80c077ed1c7575286f09c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cJ8HEFe5k2W0hgJSgM8H5w.png"/></div></div></figure><p id="c38d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后我们需要签订nft合同:</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lh"><img src="../Images/dc36678c7bcf91409269ffac2f2a904b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SIkKPXNN1CynUGRw7KQx4w.png"/></div></div></figure><p id="adf3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在在Stake系统上，我决定使用接口来调用token和nft的函数。我从open zeppelin导入了IERCO、IER721接口(记住，经过验证的代码总是更好)。</p><p id="fb64" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我还为我们的奖励令牌添加了一个mint函数，因为这个函数不在界面上。</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div class="fe ff li"><img src="../Images/deeca432d34727b304205aa026cebfad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*VUa20AmdNsMsDaoak3n7BQ.png"/></div></figure><p id="5ef6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一些实用程序变量:</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/eeaf2fe0b06eb34879cd214c4e61162e.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*dzwiSWA7scVAQv66zrvyFA.png"/></div></figure><p id="b87c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于我正在进行一些手动测试，所以我将stakingTime设置为180秒，但是为了降低时间戳风险，最好使用更长的时间，比如几天。此外，您可以使用chainlink oracle进行更可靠的时间管理。</p><p id="4c39" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，我们有一个结构来保存所有的Staker实体的信息，如果您的业务逻辑需要，您可以添加其他字段或修改这些字段。</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lk"><img src="../Images/fd06ca0be1939f8c6aee5f7f1bedff49.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*uWz4AS-jmuYuhYMrYlTYag.png"/></div></div></figure><ol class=""><li id="b5ca" class="ki kj ht is b it iu ix iy jb kk jf kl jj km jn kn ko kp kq dt translated"><strong class="is hu"> TokenIds </strong>:是用户用于锁定的id的数组</li><li id="dd43" class="ki kj ht is b it kr ix ks jb kt jf ku jj kv jn kn ko kp kq dt translated"><strong class="is hu">tokenstakingcludd:</strong>是一个可以跟踪令牌索引的映射</li><li id="46ca" class="ki kj ht is b it kr ix ks jb kt jf ku jj kv jn kn ko kp kq dt translated"><strong class="is hu">余额:</strong>奖励令牌用户当前的余额。</li><li id="11f1" class="ki kj ht is b it kr ix ks jb kt jf ku jj kv jn kn ko kp kq dt translated"><strong class="is hu">rewards release:</strong>用户认领的奖励。</li></ol><p id="dcfc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">其他一些var:</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/730375b2ee51528625ec7bb72857090c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*NjyXZy8A-uQLEbUwEX6upw.png"/></div></figure><p id="0336" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">事件:</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div class="fe ff lm"><img src="../Images/623811bc5758428047272a46b60a316a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*G1ITryb_jRUHEueVsYTJ-Q.png"/></div></figure><p id="5418" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这些功能将成为合同控制的一部分，因为我们需要确保在启动系统之前一切准备就绪:</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div class="fe ff ln"><img src="../Images/114ba8f3aeeb00a7ba4d02c028beb5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*QiBfxsQ5tInjfXemC6VpDA.png"/></div></figure><p id="0cde" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一个get函数:</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div class="fe ff lo"><img src="../Images/b9ed55019d715bc9d0d6ac415cf28160.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*LDnBM8N5HO-BWHOmZwqtAw.png"/></div></figure><p id="fa2a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们制作_stake函数和一个单个和多个stake函数:</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lp"><img src="../Images/924f8ee891f97a7f945a223e44f26835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OtzZUi-Olzuxo2XHp0-x4w.png"/></div></div></figure><p id="b838" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果被调用方实际上是nft的所有者，我们需要仔细检查系统的状态。然后，我们保存用户的所有信息，并将nft转移到必须拥有权限的合同中，我们可以使用web3来实现这一点，让用户批准允许合同中的nft，或者在nft的合同中，或者在此合同中从nft合同中调用approve函数。我决定使用最后一种方法来避免前端依赖，在部署合同时，将这种方法添加到nft合同中可能会很棘手。</p><p id="7fc2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们创建_ustake函数。Github资源库中提供了该软件的个人版、多版本和紧急版本。</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lq"><img src="../Images/feaa08ea2d27788451f3030b3ef02abe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SDZB_XThn1WApxaILPxIqQ.png"/></div></div></figure><p id="009c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后一部分将使索赔和更新和奖励功能。</p><p id="9d96" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">更新的奖励必须由用户或外部服务器调用，因为智能合约本身无法做到这一点。如果您选择使用chainlink，您将需要修改更新功能。如果你想让我用oracle创建一个合同，请在评论中告诉我。</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lr"><img src="../Images/f6ca610c28679e95986a22186ddfcb55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZLNiaYsS19mP_61T7TVcVQ.png"/></div></div></figure><p id="d297" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">更新功能的逻辑是检查令牌是否被标桩(如果没有，冷却时间将为0)，您可以添加一个事件来指出这一点或一个要求，然后如果令牌被标桩，您需要检查完成了多少个标桩周期并保存部分时间，否则合同将不会在下一次调用此功能时反映实际的标桩时间。</p><p id="3a8c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">索赔奖励将为用户铸造代币，如果您有受控/有限的供应，您可以使用转移或使用奖励池合同代替。</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/b7536dc535844e1f3ff31589d5c13adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*aYuQK6wRbsdTfLUXzOha3w.png"/></div></figure><p id="35c4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我希望这能对你有用，留下一个赞，订阅更多区块链内容，随时问我。</p><p id="720a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">谢谢！</p><blockquote class="lt"><p id="1ebe" class="lu lv ht bd lw lx ly lz ma mb mc jn ek translated">交易新手？试试<a class="ae md" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae md" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>