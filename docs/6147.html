<html>
<head>
<title>How to Protect your Smart Contracts Against Re-entrancy Hack!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何保护你的智能合同免受黑客入侵！</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-protect-your-smart-contracts-against-re-entrancy-hack-e60ea719dbdf?source=collection_archive---------26-----------------------#2022-05-04">https://medium.com/coinmonks/how-to-protect-your-smart-contracts-against-re-entrancy-hack-e60ea719dbdf?source=collection_archive---------26-----------------------#2022-05-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/a79d0666212a03e14cd7d3c0683933ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QmDEdFbsM13mSc0TShH3ag@2x.jpeg"/></div></div></figure><p id="9890" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">内容</p><ul class=""><li id="0d8c" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">什么是再入攻击？</li><li id="b651" class="jz ka ht jd b je kq ji kr jm ks jq kt ju ku jy ke kf kg kh dt translated"><span class="l ki kj kk bm kl km kn ko kp di">黑客如何能够执行再入攻击？</span></li><li id="38c5" class="jz ka ht jd b je kq ji kr jm ks jq kt ju ku jy ke kf kg kh dt translated"><span class="l ki kj kk bm kl km kn ko kp di">他们为什么能做到这一点？</span></li><li id="17c3" class="jz ka ht jd b je kq ji kr jm ks jq kt ju ku jy ke kf kg kh dt translated">如何防止重入攻击？</li></ul><p id="5be4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">什么是再入攻击？</strong></p><p id="d5bd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">重入，顾名思义，意味着重复地重新进入或重新调用函数，在Defi的情况下，我们可以说重入攻击重复地调用智能契约中的函数，以耗尽目标契约或钱包中的资金。</p><p id="abed" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">假设情景</strong></p><p id="95e7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">想象一下，一名黑客假扮成银行客户，将资金存入银行的流动性池——无意中存入了自己的账户。这位黑客随后继续提取他的存款，但让我们盲目地假设银行的后端代码有一个错误，无法在提取时更新客户的帐户。也就是说，在执行转移函数之前，他们不能更新他们的余额。银行方面的这一错误将允许我们假设的黑客返回并一次又一次地调用函数“取款”，直到他们处于耗尽银行流动性池的边缘。</p><p id="266b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请注意，这是假设，可能永远不会发生在现实世界中，但我非常希望你抓住重入攻击是如何工作的。</p><p id="4800" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一次又一次地返回调用该函数“撤回”的过程就是这种攻击得名“重入”的原因。</p><p id="3880" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">同样的逻辑也适用于智能契约中的可重入攻击。攻击者契约基本上是重复调用目标契约的一个函数，目的是耗尽资金。</p><p id="1772" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">黑客是如何做到这一点的？</strong></p><p id="5c30" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">攻击者编写一个契约，通过首先伪装成用户或存款人来与目标契约进行交互，这意味着他们的契约将具有调用另一个契约中的“撤回”的函数、一个回退函数以及一个可以命名为“排出”、“攻击”等的函数，而另一个函数所做的正是它所命名的。它不断地从目标账户中提取资金。</p><p id="efa7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">他们为什么能够做到这一点？</strong></p><p id="b1d3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">有效的问题。攻击者之所以能够做到这一点，可能是由于目标契约方面的两个原因或错误。首先，目标契约有一个修改器，在转移资金到野外之前更新你的契约状态。简单地说，在释放资金之前，首先更新你的余额。我不知道你是否注意到了这一点，但传统银行往往会在交易成功之前就快速借记你的账户，如果交易失败，他们会将你的钱退回。借方提醒是他们先主动更新他们的余额，然后你才能决定重新进入取款功能。</p><p id="9d44" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这也是你应该对你的智能合同做的，总是在执行前首先更新余额。</p><figure class="kv kw kx ky fq iu"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="2063" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">上述函数直到执行结束时才更新余额。这使得合同容易受到重入攻击。</p><p id="86a1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">在上面的代码中如何防止重入</strong></p><figure class="kv kw kx ky fq iu"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="795e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个函数在执行结束前更新契约的状态，这是防止重入攻击的简单方法。</p><p id="a861" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">你的智能合约可能受到损害的另一个原因是，当你使用像<strong class="jd hu">调用这样的低级方法时。值</strong>。如果你熟悉在智能合约中发送以太网，你会知道有三种发送以太网的方式；通过使用‘呼。“值”、“传输”和“发送”。最好和最安全的方法是使用“转移”。这是因为transfer和sends方法不同于call。“value”使用标准的gas级别— 2300，并在交易失败时抛出异常，但<strong class="jd hu"> call.value </strong>允许无限量的gas，这就是为什么接收器可以不断操纵和触发其回退功能来接收以太网。</p><figure class="kv kw kx ky fq iu"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="0d44" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">注意，这三个函数被标记为sendEther。这仅仅是假设。还要注意，三个函数中的函数体是不同的。第一种使用<strong class="jd hu">发送</strong>的方法，第二种使用<strong class="jd hu">调用。值</strong>，而第三个发送器函数使用<strong class="jd hu">传输</strong>。作为防止重入攻击的最佳实践，请始终使用transfer方法。</p><p id="cf4a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">总之，为了防止智能契约中的重入，我们强调了两个简单的方法，一个是在执行之前总是更新契约的状态，另一个是避免使用call之类的低级调用。价值。</p><blockquote class="lb"><p id="3f10" class="lc ld ht bd le lf lg lh li lj lk jy ek translated"><em class="ll">加入Coinmonks </em> <a class="ae lm" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> <em class="ll">电报频道</em> </a> <em class="ll">和</em> <a class="ae lm" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> <em class="ll"> Youtube频道</em> </a> <em class="ll">了解加密交易和投资</em></p></blockquote><h1 id="baf2" class="ln lo ht bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk dt translated">另外，阅读</h1><ul class=""><li id="fb6f" class="jz ka ht jd b je ml ji mm jm mn jq mo ju mp jy ke kf kg kh dt translated"><a class="ae lm" href="https://coincodecap.com/trading-signal" rel="noopener ugc nofollow" target="_blank">有哪些交易信号？</a> | <a class="ae lm" href="https://coincodecap.com/bitstamp-coinbase" rel="noopener ugc nofollow" target="_blank"> Bitstamp vs比特币基地</a> | <a class="ae lm" href="https://coincodecap.com/buy-solana" rel="noopener ugc nofollow" target="_blank">买索拉纳</a></li><li id="c810" class="jz ka ht jd b je kq ji kr jm ks jq kt ju ku jy ke kf kg kh dt translated"><a class="ae lm" href="https://coincodecap.com/profitfarmers-review" rel="noopener ugc nofollow" target="_blank"> ProfitFarmers回顾</a> | <a class="ae lm" href="https://coincodecap.com/cornix-trading-bot" rel="noopener ugc nofollow" target="_blank">如何使用Cornix Trading Bot </a></li><li id="1d8c" class="jz ka ht jd b je kq ji kr jm ks jq kt ju ku jy ke kf kg kh dt translated"><a class="ae lm" href="https://coincodecap.com/best-cryptocurrency-blogs" rel="noopener ugc nofollow" target="_blank">十大最佳加密货币博客</a> | <a class="ae lm" href="https://coincodecap.com/youhodler-review" rel="noopener ugc nofollow" target="_blank"> YouHodler评论</a></li><li id="3b72" class="jz ka ht jd b je kq ji kr jm ks jq kt ju ku jy ke kf kg kh dt translated"><a class="ae lm" href="https://coincodecap.com/myconstant-review" rel="noopener ugc nofollow" target="_blank"> MyConstant点评</a> | <a class="ae lm" href="https://coincodecap.com/best-swing-trading-bots" rel="noopener ugc nofollow" target="_blank"> 8款最佳摇摆交易机器人</a></li><li id="690c" class="jz ka ht jd b je kq ji kr jm ks jq kt ju ku jy ke kf kg kh dt translated"><a class="ae lm" rel="noopener" href="/coinmonks/mxc-exchange-review-3af0ec1cba8c"> MXC交易所评论</a> | <a class="ae lm" href="https://coincodecap.com/pionex-vs-binance" rel="noopener ugc nofollow" target="_blank"> Pionex vs币安</a> | <a class="ae lm" href="https://coincodecap.com/pionex-arbitrage-bot" rel="noopener ugc nofollow" target="_blank"> Pionex套利机器人</a></li></ul></div></div>    
</body>
</html>