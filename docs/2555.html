<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/coinmonks/detailed-explanation-of-ethereum-smart-contract-vulnerabilities-on-chain-vulnerability-d98f9da33058?source=collection_archive---------31-----------------------#2022-03-15">https://medium.com/coinmonks/detailed-explanation-of-ethereum-smart-contract-vulnerabilities-on-chain-vulnerability-d98f9da33058?source=collection_archive---------31-----------------------#2022-03-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><h2 id="2ebf" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">以太坊智能合约漏洞详解——链上漏洞重现:绕过合约大小检查</h2><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff iq"><img src="../Images/cbe8aa4dc65d6037f50e28c0fddd3068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RdH5JulOA32zACTJj4Yhvg.png"/></div></div></figure><blockquote class="jc jd je"><p id="fcbe" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">以太坊智能合约漏洞详解—链上漏洞重现—绕过合约大小检查</p><p id="cbdd" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">欢迎关注并与我们讨论</p><p id="3724" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">作者:<a class="ae ke" href="mailto:support@lunaray.co" rel="noopener ugc nofollow" target="_blank">support@lunaray.co</a></p></blockquote><h2 id="80b8" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x01漏洞</h2><p id="6ecc" class="pw-post-body-paragraph jf jg ht ji b jj kf jl jm jn kg jp jq id kh jt ju ih ki jx jy il kj kb kc kd hm dt translated">如果地址是合同，那么存储在该地址的代码的大小将大于0，对吗？让我们看看如何创建一个返回代码大小等于0的extcodesize的契约。</p><h2 id="29b6" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x02易受攻击的协定</h2><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kk"><img src="../Images/1ca0d4bf43d2149edf5436f8a724d4d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Olt7VDr4DvcBlh0VVf1Y6w.png"/></div></div></figure><p id="39eb" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">易受攻击的代码通过extcodesize &gt; 0来确定调用方是否为协定。</p><h2 id="7760" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x03验证</h2><p id="788c" class="pw-post-body-paragraph jf jg ht ji b jj kf jl jm jn kg jp jq id kh jt ju ih ki jx jy il kj kb kc kd hm dt translated">让我们写一个常见的契约来验证效果:</p><figure class="ir is it iu fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/686f5c97baec14ebbb299793c2b92b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*Qwg7qBEr9UBhRq38Y5AArQ.png"/></div></figure><p id="f89c" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">通过契约的pwn函数调用受保护的函数会失败。上链结果如图所示:</p><p id="7718" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated"><a class="ae ke" href="https://kovan.etherscan.io/tx/0x15b63899038362e4e80df8395d88dcd7205ebdc18c2acd1fd77cdaf06cb4c2d1" rel="noopener ugc nofollow" target="_blank">https://kovan . ethers can . io/tx/0x15b 63899038362 E4 e 80 df 8395d 88 DCD 7205 ebdc 18 C2 ACD 1 FD 77 cdaf 06 CB 4c 2d 1</a></p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff km"><img src="../Images/8149d95aac71319278d0b9353db23d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JP8xaZ2LHyuLH2Q4vjB6Kg.png"/></div></div></figure><h2 id="7a5d" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x04攻击思想</h2><p id="ce9e" class="pw-post-body-paragraph jf jg ht ji b jj kf jl jm jn kg jp jq id kh jt ju ih ki jx jy il kj kb kc kd hm dt translated">在契约初始化之前，调用受保护的函数(即:在构造函数中调用这个函数)</p><h2 id="a7dc" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x05攻击契约</h2><p id="f348" class="pw-post-body-paragraph jf jg ht ji b jj kf jl jm jn kg jp jq id kh jt ju ih ki jx jy il kj kb kc kd hm dt translated">接下来我们写攻击契约:</p><figure class="ir is it iu fq iv fe ff paragraph-image"><div class="fe ff kn"><img src="../Images/d4e5f34c8bd5a512c42d0726030e5988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*TN__9XfVhOWaQGLoN1TD5A.png"/></div></figure><p id="8151" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">部署契约，可以看到isContract变量的值为fasle，易受攻击的契约的pwned值为true。</p><h2 id="30d0" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x06链上循环</h2><p id="d13f" class="pw-post-body-paragraph jf jg ht ji b jj kf jl jm jn kg jp jq id kh jt ju ih ki jx jy il kj kb kc kd hm dt translated">让我们再次检查链条上的信息:</p><p id="44ab" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">ttps://kovan . ethers can . io/tx/0x f 759 e 56 F2 ba 4c 42 DC 64213186 D1 c 20 F4 a 5152 ce 0 bb 382 a 994 cbdc 25596 C5 c14f</p><p id="a9c9" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">您可以看到合同已成功部署。</p><h2 id="1e5f" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x07安全建议</h2><ol class=""><li id="6dc1" class="ko kp ht ji b jj kf jn kg id kq ih kr il ks kd kt ku kv kw dt translated">目前，链上智能契约中契约的大小是通过程序集中的extcodesize获取的。</li><li id="ec34" class="ko kp ht ji b jj kx jn ky id kz ih la il lb kd kt ku kv kw dt translated">对于上面提到的契约大小检查，黑客可以通过执行构造函数中的代码来绕过，需要开发者和安全审计人员特别注意。</li></ol><blockquote class="lc"><p id="5dad" class="ld le ht bd lf lg lh li lj lk ll kd ek translated">加入Coinmonks <a class="ae ke" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ke" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="667c" class="lm hs ht bd hu ln lo lp hy lq lr ls ic lt lu lv ig lw lx ly ik lz ma mb io mc dt translated">另外，阅读</h1><ul class=""><li id="4ad5" class="ko kp ht ji b jj kf jn kg id kq ih kr il ks kd md ku kv kw dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>|<a class="ae ke" rel="noopener" href="/coinmonks/hodlnaut-review-best-way-to-hodl-is-to-earn-interest-on-your-bitcoin-6658a8c19edf">Hodlnaut审核</a> | <a class="ae ke" href="https://coincodecap.com/kucoin-review" rel="noopener ugc nofollow" target="_blank"> KuCoin审核</a></li><li id="9c39" class="ko kp ht ji b jj kx jn ky id kz ih la il lb kd md ku kv kw dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/bitsgap-review-a-crypto-trading-bot-that-makes-easy-money-a5d88a336df2"> Bitsgap评审</a> | <a class="ae ke" rel="noopener" href="/coinmonks/quadency-review-a-crypto-trading-automation-platform-3068eaa374e1"> Quadency评审</a> | <a class="ae ke" rel="noopener" href="/coinmonks/bitbns-review-38256a07e161"> Bitbns评审</a></li><li id="d906" class="ko kp ht ji b jj kx jn ky id kz ih la il lb kd md ku kv kw dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">加密复制交易平台</a> | <a class="ae ke" rel="noopener" href="/coinmonks/coinmama-review-ace5641bde6e"> Coinmama审核</a></li><li id="3889" class="ko kp ht ji b jj kx jn ky id kz ih la il lb kd md ku kv kw dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度的加密交易所</a> | <a class="ae ke" rel="noopener" href="/coinmonks/bitcoin-savings-account-e65b13f92451">比特币储蓄账户</a></li><li id="477e" class="ko kp ht ji b jj kx jn ky id kz ih la il lb kd md ku kv kw dt translated"><a class="ae ke" href="https://coincodecap.com/okex-kucoin" rel="noopener ugc nofollow" target="_blank"> OKEx vs KuCoin </a> | <a class="ae ke" href="https://coincodecap.com/celsius-alternatives" rel="noopener ugc nofollow" target="_blank">摄氏替代品</a> | <a class="ae ke" href="https://coincodecap.com/buy-vechain" rel="noopener ugc nofollow" target="_blank">如何购买VeChain </a></li><li id="a669" class="ko kp ht ji b jj kx jn ky id kz ih la il lb kd md ku kv kw dt translated"><a class="ae ke" href="https://coincodecap.com/binance-futures-trading" rel="noopener ugc nofollow" target="_blank">币安期货交易</a>|<a class="ae ke" href="https://coincodecap.com/mudrex-3commas-etoro" rel="noopener ugc nofollow" target="_blank">3 comas vs Mudrex vs eToro</a></li></ul></div></div>    
</body>
</html>