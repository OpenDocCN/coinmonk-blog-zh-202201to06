<html>
<head>
<title>Certification Rotation/Renewal in Hyperledger Fabric: Recover Expired certificate Fabric Network</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hyperledger结构中的证书轮换/续订:恢复过期的证书结构网络</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/certification-rotation-in-hyperledger-fabric-c9eb5fc68dec?source=collection_archive---------4-----------------------#2022-02-20">https://medium.com/coinmonks/certification-rotation-in-hyperledger-fabric-c9eb5fc68dec?source=collection_archive---------4-----------------------#2022-02-20</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="e5ff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">证书轮换是Hyperledger结构中最重要和最关键的部分之一。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/b4e90b5a3a15810d3a76cc2f7166a70e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMESCA4mvKJKD_s22PAlLg.jpeg"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek"><a class="ae ke" href="https://unsplash.com/photos/_rZnChsIFuQ" rel="noopener ugc nofollow" target="_blank"><strong class="bd kf">Photo by Shubham Dhage on Unsplash</strong></a></figcaption></figure><p id="562a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">签名下有三个部分1) CA <br/> 2)注册<br/> 3) TLS</p><p id="255c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请检查任何fabric-ca-server-config.yaml中的签名部分</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="3486" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">签名部分:</strong> <br/>“默认”部分用于注册证书的签名；默认到期(“到期”字段)为“8760h”，即1年(小时)。</p><p id="6fc4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">Profile:ca</strong><br/>“CA”Profile子部分用于签署中间CA证书；默认到期(“到期”字段)是“<strong class="is hu"> 43800h </strong>”，即5年(小时)。请注意，“isca”是真的，这意味着它颁发ca证书。maxpathlen为0意味着中间CA不能颁发其他中间CA证书，尽管它仍然可以颁发终端实体证书。</p><p id="aa6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">Profile:tls</strong><br/>“TLS”Profile子部分用于签署TLS证书请求；默认到期(“到期”字段)为“<strong class="is hu"> 8760h </strong>”，即以小时为单位的<strong class="is hu"> 1 </strong>年。</p><p id="a780" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">tls和注册证书的默认有效期为1年(<strong class="is hu"> 8760h </strong>)。如果您的网络建成1年，您可能会面临认证过期的问题，事实上，您将无法与网络互动，实际上您的网络将关闭。</p><p id="b3e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">解决方案:<br/> 1)到期前轮换证书。(我们应该遵循这个)<br/> 2)到期后轮换证书。(如果您忘记了续订证书，不推荐使用这种方法，您可以使用这种方法来恢复证书)</p></div><div class="ab cl ki kj hb kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hm hn ho hp hq"><p id="6baf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们把这篇文章分成两部分</p><ol class=""><li id="8548" class="kp kq ht is b it iu ix iy jb kr jf ks jj kt jn ku kv kw kx dt translated">使用过期的证书创建网络</li><li id="98fc" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">恢复过期证书的网络(您可以将此活动视为证书轮换)</li></ol></div><div class="ab cl ki kj hb kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hm hn ho hp hq"><p id="b7a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我建议浏览我的youtube视频，里面有所有的信息。在这篇文章中，我只是提到了步骤，而不是所有的编码部分。我用自己的回购创造了一个网络。在我以前的视频有关于如何从头开始创建一个网络的所有信息。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ld kh l"/></div></figure><h2 id="b6a9" class="le lf ht bd lg lh li lj lk ll lm ln lo jb lp lq lr jf ls lt lu jj lv lw lx ly dt translated"><strong class="ak">第一部分</strong></h2><p id="0b63" class="pw-post-body-paragraph iq ir ht is b it lz iv iw ix ma iz ja jb mb jd je jf mc jh ji jj md jl jm jn hm dt translated">注意:<strong class="is hu">如果您已经使用过期的证书联网，您可以从第2部分开始。</strong></p><ol class=""><li id="bd02" class="kp kq ht is b it iu ix iy jb kr jf ks jj kt jn ku kv kw kx dt translated">将您的机器时间设置为过去的日期(32天前)</li><li id="46e6" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">为所有组织创建CA服务</li><li id="5654" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">更改fabric-ca-server-config.yaml文件，如下所示</li></ol><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="1c2b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4.重新启动CA服务。<br/> 5。创建所有参与者证书。6。创建通道工件<br/> 7。运行所有其他服务(Peer、order、CouchDB) <br/> 8。部署链码。<br/> 9。在API中创建一个连接配置文件。<br/> 10。调用一些事务并验证是否一切正常。</p><p id="b9da" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意:在这个阶段，我们有一个工作网络。注册和TLS的默认证书过期时间都是720小时(30天)。</p></div><div class="ab cl ki kj hb kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hm hn ho hp hq"><h2 id="ed78" class="le lf ht bd lg lh li lj lk ll lm ln lo jb lp lq lr jf ls lt lu jj lv lw lx ly dt translated"><strong class="ak">第二部分</strong></h2><ol class=""><li id="2e2d" class="kp kq ht is b it lz ix ma jb me jf mf jj mg jn ku kv kw kx dt translated">将日期更改为当前。现在，我们有一个在32天之前创建的网络，默认到期时间是30天(720小时)。在这个阶段，我们有一个证书过期的网络。为了验证，您可以检查任何服务的日志(peer，orderer)，可能会有错误。</li><li id="1cfe" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">我们必须为网络中的所有参与者创建新的证书(注册、TLS)。在repo中有一个renew-cert.sh脚本可用，只需运行它，它将创建新的证书。</li><li id="d2ab" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">现在，我们需要在所有订购者服务中使用env变量。添加这些变量并重新启动订购程序。</li></ol><pre class="jp jq jr js fq mh mi mj mk aw ml dt"><span id="140f" class="le lf ht mi b fv mm mn l mo mp">- ORDERER_GENERAL_TLS_TLSHANDSHAKETIMESHIFT=200h</span><span id="b4cb" class="le lf ht mi b fv mq mn l mo mp">- ORDERER_GENERAL_CLUSTER_TLSHANDSHAKETIMESHIFT=200h</span><span id="834d" class="le lf ht mi b fv mq mn l mo mp">- ORDERER_GENERAL_AUTHENTICATION_NOEXPIRATIONCHECKS=true</span></pre><p id="fe7e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4.用新创建的MSP文件夹更改所有订购者、所有对等者的所有MSP文件夹，并重新启动服务。</p><p id="4949" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5.我们必须进行配置更新，以更改订购者tls证书。在当前网络中，我们有一个应用程序通道，一个系统通道。</p><p id="d425" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">6.我们可以一次更新一个订购者的配置。我们有两个通道，这意味着我们必须进行3x2=6，6配置更新。</p><p id="3227" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">7.在上述视频中，我已经涵盖了所有步骤，请通过它，并在回购所有可用的代码</p><p id="7586" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">8.首先对系统通道和应用程序通道进行配置更新。成功完成后，替换新创建的tls证书并重新启动订购者。</p><p id="be6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">9.对所有订购者执行相同的上述程序。</p><p id="cf60" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">10.用新创建的tls文件夹替换所有对等方的tls文件夹，并重新启动所有对等方</p><p id="2100" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">11.在API中重新创建连接配置文件并重启服务器。</p><p id="112e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">12.从钱包中删除过期的管理员身份，注册新用户，尝试调用新交易。验证它是否成功执行。</p><p id="83ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">13.一件重要的事情是，当在API注册一个新用户时，我们必须存储从CA返回的秘密(在注册中)，否则我们将无法重新注册同一个用户。</p><p id="1d61" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">14.您可以对证书轮换或续订使用相同的脚本。这里我们在过期的网络上做一些活动。您可以在证书到期前续订证书，这样我们的网络就可以正常运行，不会因为证书到期而停机。</p><p id="fcd0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">15.下面提到的配置更新脚本示例。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="a161" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">本文到此为止，我知道它非常简短，但在视频中，我已经涵盖了轮换/续订证书所需的大部分内容。</p><p id="7196" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你面临任何问题，请让我知道，我很乐意帮助你。你可以通过linked in或Instagram与我联系。<br/><a class="ae ke" href="https://www.instagram.com/pavanadhavofficial/" rel="noopener ugc nofollow" target="_blank"><strong class="is hu"/></a><strong class="is hu"><br/></strong><a class="ae ke" href="https://www.linkedin.com/in/pavan-adhav/" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">https://www.linkedin.com/in/pavan-adhav/</strong></a><strong class="is hu"><br/>邮箱:adhavpavan@gmail.com</strong></p><h1 id="5205" class="mr lf ht bd lg ms mt mu lk mv mw mx lo my mz na lr nb nc nd lu ne nf ng lx nh dt translated">参考</h1><ul class=""><li id="346b" class="kp kq ht is b it lz ix ma jb me jf mf jj mg jn ni kv kw kx dt translated"><a class="ae ke" href="https://github.com/adhavpavan/FabricNetwork-2.x.git" rel="noopener ugc nofollow" target="_blank">https://github.com/adhavpavan/FabricNetwork-2.x.git</a></li></ul><blockquote class="nj"><p id="3cde" class="nk nl ht bd nm nn no np nq nr ns jn ek translated">加入Coinmonks <a class="ae ke" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ke" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="4196" class="mr lf ht bd lg ms mt mu lk mv mw mx lo my nt na lr nb nu nd lu ne nv ng lx nh dt translated">另外，阅读</h1><ul class=""><li id="5d22" class="kp kq ht is b it lz ix ma jb me jf mf jj mg jn ni kv kw kx dt translated"><a class="ae ke" href="https://coincodecap.com/smithbot-review" rel="noopener ugc nofollow" target="_blank"> SmithBot评论</a> | <a class="ae ke" href="https://coincodecap.com/free-open-source-trading-bots" rel="noopener ugc nofollow" target="_blank"> 4款最佳免费开源交易机器人</a></li><li id="a198" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ni kv kw kx dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/coinbase-bots-ac6359e897f3">比特币基地僵尸工具</a> | <a class="ae ke" rel="noopener" href="/coinmonks/ascendex-review-53e829cf75fa"> AscendEX审查</a> | <a class="ae ke" rel="noopener" href="/coinmonks/okex-trading-bots-234920f61e60"> OKEx交易僵尸工具</a></li><li id="1be4" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ni kv kw kx dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94">如何在印度购买比特币？</a> | <a class="ae ke" rel="noopener" href="/coinmonks/wazirx-review-5c811b074f5b">瓦济克斯审查</a></li><li id="b5c7" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ni kv kw kx dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/cryptohopper-alternatives-d67287b16d27">隐翅虫替代品</a> | <a class="ae ke" rel="noopener" href="/coinmonks/hitbtc-review-c5143c5d53c2"> HitBTC审查</a></li><li id="a9c3" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ni kv kw kx dt translated"><a class="ae ke" href="https://coincodecap.com/cbet-casino-review" rel="noopener ugc nofollow" target="_blank"> CBET评论</a> | <a class="ae ke" href="https://coincodecap.com/kucoin-vs-coinbase" rel="noopener ugc nofollow" target="_blank">库科恩vs比特币基地</a></li><li id="6a9a" class="kp kq ht is b it ky ix kz jb la jf lb jj lc jn ni kv kw kx dt translated"><a class="ae ke" href="https://coincodecap.com/fold-app-review" rel="noopener ugc nofollow" target="_blank">折叠App审核</a> | <a class="ae ke" rel="noopener" href="/coinmonks/kucoin-trading-bot-automate-your-trades-8cf0ca2138e0"> Kucoin交易机器人</a> | <a class="ae ke" href="https://coincodecap.com/probit-review" rel="noopener ugc nofollow" target="_blank"> Probit审核</a></li></ul></div></div>    
</body>
</html>