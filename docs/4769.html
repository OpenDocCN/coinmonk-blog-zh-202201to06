<html>
<head>
<title>Emulate Any SIGHASH Flag Without a Fork</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟任何不带分叉的SIGHASH标志</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/emulate-any-sighash-flag-without-a-fork-568fa624039f?source=collection_archive---------5-----------------------#2022-04-13">https://medium.com/coinmonks/emulate-any-sighash-flag-without-a-fork-568fa624039f?source=collection_archive---------5-----------------------#2022-04-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="42a4" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">通过在智能合同中对其进行编程</h2></div><p id="26d9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们开发了一种新的方法来模拟任何SIGHASH标志，只需在智能契约中简单地编码逻辑。它不需要更改协议，因此比每次构思新的用例时通过fork添加硬编码标志更加实用和灵活。</p><h1 id="fc80" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">SIGHASH标志</h1><p id="0008" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">一个<a class="ae lb" href="https://wiki.bitcoinsv.io/index.php/SIGHASH_flags" rel="noopener ugc nofollow" target="_blank"> SIGHASH </a>标志决定签名对事务的哪一部分进行签名。具体来说，它控制签名涵盖以下10项中的哪一项。</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff lc"><img src="../Images/76f27ad74c61ee5b89cb5d8c38d2afc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jjm5Ee1EmmwZsL0R"/></div></div><figcaption class="lo lp fg fe ff lq lr bd b be z ek"><a class="ae lb" href="https://github.com/bitcoin-sv/bitcoin-sv/blob/master/doc/abc/replay-protected-sighash.md#digest-algorithm" rel="noopener ugc nofollow" target="_blank">SigHash Preimage Format</a></figcaption></figure><p id="abd3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">有三个基本标志:<em class="ls"> SIGHASH_ALL、SIGHASH_NONE和SIGHASH_SINGLE </em>。还有一个修改器标志<em class="ls"> SIGHASH_ANYONECANPAY </em>，产生六种组合。</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff lt"><img src="../Images/16d6984278d807a55a8492fbffd12671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mW1spkpvZdutu-W_.png"/></div></div><figcaption class="lo lp fg fe ff lq lr bd b be z ek"><a class="ae lb" href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch06.asciidoc#signature-hash-types-sighash" rel="noopener ugc nofollow" target="_blank">Summary of different sighash combinations</a></figcaption></figure><p id="ab25" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">有人提议添加更多的标志，以定制在现有标志下不可能签署的交易的各个部分。下面列出了一个例子:</p><figure class="ld le lf lg fq lh"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="lo lp fg fe ff lq lr bd b be z ek"><a class="ae lb" href="https://github.com/scmorse/bitcoin-misc/blob/master/sighash_proposal.md" rel="noopener ugc nofollow" target="_blank">Proposed Flags</a></figcaption></figure><p id="fcb4" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然而，它们中的每一个都必须在节点软件中硬编码，因此需要一个潜在的有争议的分支。</p><h1 id="194b" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">模拟任何SIGHASH标志</h1><p id="f406" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">我们提供了一个框架来模拟任意的SIGHASH标志。新的SIGHASH标志可以简单地以智能合约的形式添加，因此根本不需要升级比特币。总的来说，它分三步工作:</p><ol class=""><li id="a70e" class="lw lx ht jk b jl jm jo jp jr ly jv lz jz ma kd mb mc md me dt translated">使用<a class="ae lb" href="http://OP_PUSH_TX" rel="noopener ugc nofollow" target="_blank"> OP_PUSH_TX </a>获取当前sighash</li><li id="376f" class="lw lx ht jk b jl mf jo mg jr mh jv mi jz mj kd mb mc md me dt translated">根据新的标志语义修改/屏蔽sighash</li><li id="96c4" class="lw lx ht jk b jl mf jo mg jr mh jv mi jz mj kd mb mc md me dt translated">使用ECDSA签名算法，对照新的sighash检查签名。</li></ol><p id="e06b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">作为一个例子，我们实现了<em class="ls"> SIGHASH_ANYPREVOUT </em>。</p><h2 id="0517" class="mk kf ht bd kg ml mm mn kk mo mp mq ko jr mr ms kq jv mt mu ks jz mv mw ku mx dt translated">SIGHASH _ ANYPREVOUT</h2><p id="5c3e" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">在<a class="ae lb" href="https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki" rel="noopener ugc nofollow" target="_blank"> BIP-118 </a>中的<em class="ls"> SIGHASH_ANYPREVOUT </em>(之前命名为<em class="ls"> SIGHASH_NOINPUT </em>)从签名中排除了正在使用的UTXO的标识符。与之签署的交易不链接到特定的UTXO，并且可以花费来自具有<strong class="jk hu"> </strong>相同公钥(或花费条件)的地址的任何UTXO。</p><p id="a074" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">例如，当用户想要授权第三方应用程序使用她的硬币时，可以使用这种方法。她可以使用<em class="ls"> SIGHASH_ANYPREVOUT </em>进行预签名，当她不在时，应用程序可以重复使用该签名。</p><p id="022b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">下面的契约检查输入签名(即<em class="ls"> Sig sig </em>)没有覆盖正在花费的UTXO，相当于使用<em class="ls"> SIGHASH_ANYPREVOUT </em>进行签名。</p><figure class="ld le lf lg fq lh"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="lo lp fg fe ff lq lr bd b be z ek">UniversalSighash Contract</figcaption></figure><p id="8cdc" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">第1步:第10行确保<em class="ls"> sighash </em>用于使用OP_PUSH_TX的当前事务。</p><p id="935f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">第2步:第13–17行将<em class="ls"> sighash </em>的第2、3和4项设置为全0，即消除输入UTXO。</p><p id="b71c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">步骤3:第20行使用<a class="ae lb" href="https://xiaohuiliu.medium.com/elliptic-curve-arithmetic-in-script-cb0ab37e4f63" rel="noopener">椭圆曲线库</a>确保签名完全覆盖新的sighash。相当于BTC上的<a class="ae lb" href="https://diyhpl.us/wiki/transcripts/bitcoin-core-dev-tech/2019-06-06-noinput-etc/" rel="noopener ugc nofollow" target="_blank"> OP_CHECKSIGFROMSTACK </a>或者BCH上的<a class="ae lb" href="https://github.com/bitcoincashorg/bitcoincash.org/blob/master/spec/op_checkdatasig.md" rel="noopener ugc nofollow" target="_blank">OP _ DATASIGVERIFY</a>/<a class="ae lb" rel="noopener" href="/@Mengerian/the-story-of-op-checkdatasig-c2b1b38e801a">OP _ CHECKDATASIG</a>。</p><h2 id="9a8d" class="mk kf ht bd kg ml mm mn kk mo mp mq ko jr mr ms kq jv mt mu ks jz mv mw ku mx dt translated">展开性</h2><p id="37ab" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">同样的方法可以扩展到模拟任何标志。比如消隐项2和3等于<em class="ls"> SIGHASH_ANYONECANPAY </em>，消隐项6本质上是SIGHASH_WITHOUT_PREV_VALUE。比特币智能合约的表现力启用任意标志。</p><blockquote class="my"><p id="69e7" class="mz na ht bd nb nc nd ne nf ng nh kd ek translated">加入Coinmonks <a class="ae lb" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lb" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="bcb8" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz ni ja kq jc nj jd ks jf nk jg ku kv dt translated">另外，阅读</h1><ul class=""><li id="8dc9" class="lw lx ht jk b jl kw jo kx jr nl jv nm jz nn kd no mc md me dt translated"><a class="ae lb" href="https://coincodecap.com/crypto-affiliate-programs" rel="noopener ugc nofollow" target="_blank">8大加密附属计划</a> | <a class="ae lb" href="https://coincodecap.com/etoro-vs-coinbase" rel="noopener ugc nofollow" target="_blank"> eToro vs比特币基地</a></li><li id="9397" class="lw lx ht jk b jl mf jo mg jr mh jv mi jz mj kd no mc md me dt translated"><a class="ae lb" href="https://coincodecap.com/best-ethereum-wallets" rel="noopener ugc nofollow" target="_blank">最佳以太坊钱包</a> | <a class="ae lb" href="https://coincodecap.com/telegram-crypto-bots" rel="noopener ugc nofollow" target="_blank">电报上的加密货币机器人</a></li><li id="aa90" class="lw lx ht jk b jl mf jo mg jr mh jv mi jz mj kd no mc md me dt translated"><a class="ae lb" href="https://coincodecap.com/leveraged-token-exchanges" rel="noopener ugc nofollow" target="_blank">交易杠杆代币的最佳交易所</a> | <a class="ae lb" href="https://coincodecap.com/buy-floki-inu-token" rel="noopener ugc nofollow" target="_blank">购买Floki </a></li><li id="9239" class="lw lx ht jk b jl mf jo mg jr mh jv mi jz mj kd no mc md me dt translated"><a class="ae lb" href="https://coincodecap.com/3commas-vs-pionex-vs-cryptohopper" rel="noopener ugc nofollow" target="_blank"> 3Commas对Pionex对Cryptohopper </a> | <a class="ae lb" href="https://coincodecap.com/bingbon-review" rel="noopener ugc nofollow" target="_blank"> Bingbon评论</a></li><li id="3aef" class="lw lx ht jk b jl mf jo mg jr mh jv mi jz mj kd no mc md me dt translated"><a class="ae lb" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">加密复制交易平台</a> | <a class="ae lb" rel="noopener" href="/coinmonks/buy-bitcoin-on-wazirx-2d12b7989af1">如何在WazirX上购买比特币</a></li></ul></div></div>    
</body>
</html>