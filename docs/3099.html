<html>
<head>
<title>BTC and Funding Rates Analysis (1/3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BTC和融资利率分析(1/3)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/btc-and-funding-rates-analysis-c03c06e061e5?source=collection_archive---------10-----------------------#2022-03-22">https://medium.com/coinmonks/btc-and-funding-rates-analysis-c03c06e061e5?source=collection_archive---------10-----------------------#2022-03-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="afe8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">问题</strong></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/5cb9a50870dfce6e3a3fbc7485a66484.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*McBzWgDDFVDU6I1XspYXtg.jpeg"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">I would like to avoid feeling like this</figcaption></figure><p id="099d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了赚钱，每个人，不管是不是crypto，都希望能够预测股票、商品、住宅、crypto或任何其他实体的价格。如果有人能够有效地做到这一点，他们很可能就不会在中等到0的粉丝上写博客了(<em class="ke">咳咳</em>)。</p><p id="be3e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我已经在加密货币领域工作了2年多，和许多人一样，我很快就投入了进去。从“什么是区块链”到了“我如何让种植隐形玉米获得最大收益”。也像大多数人一样，我进入了杠杆交易，有一天早上醒来发现我的账户被清算了，心想“这不能再糟了”，YOLO死了，情况变得更糟了。这让我踏上了能够预测或预见加密货币资产价格变化的旅程，希望不会亏钱，但最终会赚钱。</p><p id="e420" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当我和<em class="ke">@ moneywithcarter</em>(crypto Twitter)一起做一个项目时，我开始研究不同交易所的资金利率如何预测、影响或不预测比特币的价格。对于那些不熟悉术语<em class="ke">融资利率</em>的人来说，它基本上是使用期货/杠杆合约时交易者之间的支付。当资金利率为&gt; 0时，多头交易者多于空头，&lt; 0则相反。因此，我试图解决的问题是:<em class="ke">BTC的融资利率和价格之间的相关性是什么，无论是现在、过去还是未来</em>。</p><p id="9990" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">整个项目都是用Python完成的，包有:</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="44a0" class="kk kl ht kg b fv km kn l ko kp">import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>from datetime import datetime, date<br/>import Historic_Crypto<br/>from selenium import webdriver<br/>from webdriver_manager.chrome import chromeDriverManager<br/>import re</span></pre><p id="6a08" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">数据</strong></p><p id="72cf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">任何问题的第一步都是找到数据并给它一个好的外观。</p><p id="88ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">价格数据</strong></p><p id="1511" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">幸运的是，我能够找到一个名为<em class="ke"> Historic_Crypto </em>的Python包，它非常容易使用并获得比特币的历史价格。我创建了下面的函数来获取数据，并使它看起来像我想要的那样:</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="84fd" class="kk kl ht kg b fv km kn l ko kp">def Price_data():<br/>    BTC_pricedata = Historic_Crypto.HistoricalData('BTC-USD', 86400, '2016-05-14-00-00').retrieve_data()<br/>    BTC_pricedata.index.name = 'Date'<br/>    BTC_pricedata.reset_index(inplace=True)<br/>    BTC_pricedata['Date'] = pd.to_datetime(BTC_pricedata['Date']).dt.date<br/>    BTC_pricedata = BTC_pricedata[['Date', 'low', 'high', 'open', 'close', 'volume']]<br/>    return BTC_pricedata</span></pre><p id="2083" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ke">历史_加密。HistoricalData </em>接收报价器(<em class="ke">BTC-美元</em>)、以秒为单位的时间范围(86400秒=每天)和开始日期(选择这个日期是因为这是资金利率回溯的时间)。这个功能给了我回到2016年5月14日的比特币价格数据。</p><p id="9060" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">融资利率</strong></p><p id="4001" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在是有趣的事情。我想获得两个交易所的所有融资利率，<em class="ke">币安</em>和<em class="ke"> Bitmex </em>(出于任何原因，我没有公开选择这两个交易所)。我从Bitmex开始，注意到他们有一个API(<a class="ae kq" href="https://www.bitmex.com/app/fundingHistory?start=" rel="noopener ugc nofollow" target="_blank"><em class="ke">https://www.bitmex.com/app/fundingHistory?start=</em></a>)。<em class="ke">牛逼。</em></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff kr"><img src="../Images/83a310b46132bcfff190ffb9e89f1fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZuC_vHV2JXCrH4hRKgxPuA.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Bitmex website</figcaption></figure><p id="b135" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">任何做网络搜集的人都知道API节省了大量的时间和精力。然而，当尝试使用API时，它不允许我获得我想要的那么多数据。我想要所有的数据，而他们不想让我拥有所有的数据。这不能怪他们。我现在的选择是:1。使用API，获取尽可能多的数据，使用不同的IP地址(从VPN或从不同的计算机)并获取其余的数据，或者2。自己刮(可能有其他选择，但如果有，我显然不知道他们)。</p><p id="f914" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">作为一个花了一些时间浏览网站的人，我决定“嘿，这会很有趣”却发现不会。我试着使用我喜欢的<em class="ke"> BeautifulSoup </em>包，但是在尝试使用它时，它找不到正确的HTML标签，所以我决定使用<em class="ke"> Selenium。</em>我发现当网站具有良好的HTML标签功能时,<em class="ke"> BeautifulSoup </em>更容易使用，但当HTML标签不直观时就不容易使用了。</p><p id="a73f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在检查网页时，我决定使用XPath标签，因为HTML标签不起作用。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff ks"><img src="../Images/8bb1ab604e101ec8d7a8b5fac2b35fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9AsT36_0WMGrE3EEkzwtQ.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Inspecting the table I want</figcaption></figure><p id="8790" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我知道我只想得到BTC的数据，在<em class="ke"> BitMex </em>上是‘xbt USD’。在浏览网站时，我还意识到我需要循环浏览页面以获取所有数据。为此，我在网站上找到了搜索栏，考察了搜索栏，复制了<em class="ke"> full XPath </em>，我上路了。在我的代码中，我需要找到搜索栏，输入'<em class="ke"> XBTUSD </em>'，然后单击<em class="ke">搜索</em>按钮进行导航。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="da2e" class="kk kl ht kg b fv km kn l ko kp">driver = webdriver.Chrome(executable_path=ChromeDriverManager().install())<br/>driver.get(url)<br/>text_area = driver.find_element_by_xpath('//*[@id="filter"]')<br/>text_area.send_keys('{"symbol":"XBTUSD"}')<br/>button = driver.find_element_by_xpath('/html/body/div[2]/div/span/div[2]/div/div/section/div/div/div/form/fieldset/div/div/div[2]/button[2]')<br/>button.click()</span></pre><p id="2745" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下一步是获取表的完整XPath，这样我就可以提取每个页面的内容。我检查了表，复制了完整的XPath，并继续前进。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="4ad9" class="kk kl ht kg b fv km kn l ko kp">jb = driver.find_element_by_xpath("/html/body/div[2]/div/span/div[2]/div/div/section/div/div/div/div[2]/div[2]/div[2]/table/tbody")</span></pre><p id="a9bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"><em class="ke"/></strong></p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="a23c" class="kk kl ht kg b fv km kn l ko kp">def bitmex_data(): #wanted to try and get the data w/o using APIs<br/>    url_base = 'https://www.bitmex.com/app/fundingHistory?start='<br/>    # the number changes by 100 for each page<br/>    page = 0<br/>    total_data = []<br/>    while True:<br/>        url = url_base + str(page)<br/>        driver = webdriver.Chrome(executable_path=ChromeDriverManager().install())<br/>        driver.get(url)<br/>        text_area = driver.find_element_by_xpath('//*[@id="filter"]')<br/>        text_area.send_keys('{"symbol":"XBTUSD"}')<br/>        button = driver.find_element_by_xpath('/html/body/div[2]/div/span/div[2]/div/div/section/div/div/div/form/fieldset/div/div/div[2]/button[2]')<br/>        button.click()<br/>        time.sleep(5)<br/>        jb = driver.find_element_by_xpath("/html/body/div[2]/div/span/div[2]/div/div/section/div/div/div/div[2]/div[2]/div[2]/table/tbody")<br/>        time.sleep(3)<br/>        a = jb.text<br/>        if a == 'No data.':<br/>            break<br/>        list = a.splitlines()<br/>        array = []<br/>        for i in list:<br/>            newlist = re.split(' AM | PM | every 8 hours |\%', i)[0:4]<br/>            array.append(newlist)<br/>        page += 100<br/>        total_data.extend(array)<br/>        driver.close()</span></pre><p id="2945" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我创建的函数以URL为基础，运行while循环，不断改变分页，并获取表结果。如果我所做的跳转令人困惑，我认为最好从查看<em class="ke"> find_element_by_xpath </em>的结果开始，看看如何从那里得到有意义的数据集(对不起，这篇文章已经很长了)。</p><p id="e7e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="ke">币安资助率</em> </strong></p><p id="f264" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">既然我花了很多时间为Bitmex构建一个webscraper，我最不想做的事情就是以某种复杂的方式从币安获取数据。够直观了，我只是做了不可想象的事情(铁杆数据科学家捂眼睛)。我<em class="ke">将表格</em>复制粘贴到<em class="ke"> Excel中。</em>抱歉。如果你不读书了，我能理解，但是当你可以复制别人的房子时，为什么要盖房子呢？之后，我用这个函数来清理它:</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="b298" class="kk kl ht kg b fv km kn l ko kp">def binance_data():<br/>    BTCdata = pd.read_csv('path.../data/Funding Rate History_BTCUSDT Perpetual_2022-02-11.csv')<br/>    BTCdata['Date'] = pd.to_datetime(BTCdata['Time']).dt.date<br/>    BTCdata['Time'] = pd.to_datetime(BTCdata['Time']).dt.time<br/>    BTCdata['Funding Rate'] = (BTCdata['Funding Rate'].str.rstrip('%').astype('float') / 100.0)<br/>    #BTCdata['Funding Rate'] = float(BTCdata['Funding Rate'].apply(lambda x: '%.8f' % x))<br/>    BTCdata = BTCdata[['Date', 'Time', 'Funding Interval', 'Funding Rate']]<br/>    return BTCdata</span></pre><p id="5973" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">(您需要输入自己的路径。不想给你看我的用户名是DJ好好先生)。</p><p id="5a52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">让它看起来很漂亮</strong></p><p id="03f8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们已经有了<em class="ke">融资利率</em>数据和<em class="ke">价格</em>数据，我想对其进行一点清理，使其更易于使用。我决定将<em class="ke"> Pandas </em>包用于用户友好的数据框。由于数据的极端性，我认为最好将<em class="ke">价格</em>和<em class="ke">融资利率</em>数据放入存储箱。宁滨数据允许您大幅减少变量的大小，同时仍然试图描述变量。我不认为看BTC 54900美元和55000美元的价格有什么重要。我决定将价格<em class="ke">和融资利率</em>的数据放入5个箱中。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="0bd7" class="kk kl ht kg b fv km kn l ko kp">def merge_rates_price(BTCpricedata, BTCdata):<br/>    data_join = BTCpricedata.merge(BTCdata, how='left', on='Date')<br/>    data_join = data_join[['Date', 'low', 'high', 'open', 'close', 'volume', 'Funding Rate']]<br/>    data_join['Funding Rate'] = data_join['Funding Rate'].astype(float)<br/>    data_join['FRbin'] = pd.qcut(data_join['Funding Rate'], 5, precision=5, duplicates='drop', labels=False)<br/>    data_join['Pricebin'] = pd.qcut(data_join['high'], 5, precision=5, duplicates='drop', labels=False)<br/>    data_join['FRbin'].value_counts()<br/>    return data_join</span></pre><p id="1081" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该函数产生数据集:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff kt"><img src="../Images/381c6471ceb08a898cf3e2e2b28cb818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-FZaTKBAAWW0z602TpuNqA.png"/></div></div></figure><p id="9b6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们有了数据，我们可以继续有趣的事情了。这在<a class="ae kq" rel="noopener" href="/@jakelindell/btc-and-funding-rates-analysis-2-x-ca8fa28c1801">下一篇</a>里。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff ku"><img src="../Images/7c6c4cd8f08bfec497121e0a3286c159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VzmxJpLJCUJbr1Y-XZobGw.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Shows the relationship between Funding Rate and Bitcoin price</figcaption></figure><p id="6356" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你在任何时候想要我的代码，它有点混乱，但可以在https://github.com/jrlindell/CryptoFundingRates找到</p><blockquote class="kv"><p id="a629" class="kw kx ht bd ky kz la lb lc ld le jn ek translated"><em class="lf">加入Coinmonks </em> <a class="ae kq" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> <em class="lf">电报频道</em> </a> <em class="lf">和</em> <a class="ae kq" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> Youtube频道</em> </a> <em class="lf">了解加密交易和投资</em></p></blockquote><h1 id="46cb" class="lg kl ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">另外，阅读</h1><ul class=""><li id="7ad7" class="md me ht is b it mf ix mg jb mh jf mi jj mj jn mk ml mm mn dt translated"><a class="ae kq" href="https://coincodecap.com/trading-signal" rel="noopener ugc nofollow" target="_blank">有哪些交易信号？</a> | <a class="ae kq" href="https://coincodecap.com/bitstamp-coinbase" rel="noopener ugc nofollow" target="_blank"> Bitstamp vs比特币基地</a> | <a class="ae kq" href="https://coincodecap.com/buy-solana" rel="noopener ugc nofollow" target="_blank">买索拉纳</a></li><li id="09a8" class="md me ht is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn dt translated"><a class="ae kq" href="https://coincodecap.com/profitfarmers-review" rel="noopener ugc nofollow" target="_blank"> ProfitFarmers点评</a> | <a class="ae kq" href="https://coincodecap.com/cornix-trading-bot" rel="noopener ugc nofollow" target="_blank">如何使用Cornix交易机器人</a></li><li id="100e" class="md me ht is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn dt translated"><a class="ae kq" href="https://coincodecap.com/best-cryptocurrency-blogs" rel="noopener ugc nofollow" target="_blank">十大最佳加密货币博客</a> | <a class="ae kq" href="https://coincodecap.com/youhodler-review" rel="noopener ugc nofollow" target="_blank"> YouHodler评论</a></li><li id="25d7" class="md me ht is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn dt translated"><a class="ae kq" href="https://coincodecap.com/myconstant-review" rel="noopener ugc nofollow" target="_blank"> MyConstant Review </a> | <a class="ae kq" href="https://coincodecap.com/best-swing-trading-bots" rel="noopener ugc nofollow" target="_blank"> 8款最佳摇摆交易机器人</a></li><li id="1099" class="md me ht is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn dt translated"><a class="ae kq" rel="noopener" href="/coinmonks/mxc-exchange-review-3af0ec1cba8c"> MXC交易所评论</a> | <a class="ae kq" href="https://coincodecap.com/pionex-vs-binance" rel="noopener ugc nofollow" target="_blank"> Pionex vs币安</a> | <a class="ae kq" href="https://coincodecap.com/pionex-arbitrage-bot" rel="noopener ugc nofollow" target="_blank"> Pionex套利机器人</a></li></ul></div></div>    
</body>
</html>