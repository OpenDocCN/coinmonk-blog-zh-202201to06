<html>
<head>
<title>What is “stack too deep” in Solidity?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是坚实度上的“叠得太深”？</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/what-is-stack-too-deep-in-solidity-23d105064d42?source=collection_archive---------15-----------------------#2022-03-13">https://medium.com/coinmonks/what-is-stack-too-deep-in-solidity-23d105064d42?source=collection_archive---------15-----------------------#2022-03-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="5134" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用Solidity已经有一段时间了，你一定注意到了这个<strong class="is hu">编译错误</strong>，如下所示。</p><pre class="jo jp jq jr fq js jt ju jv aw jw dt"><span id="3c6f" class="jx jy ht jt b fv jz ka l kb kc">CompilerError: Stack too deep, try removing local variables.</span></pre><p id="8c51" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">那么，这是什么，为什么会发生？</p><p id="55de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我在这里与你分享一段代码，这样你就知道你可能会在哪里遇到这种类型的错误，以及我们正在做什么。这是你会得到这个错误的代码—</p><figure class="jo jp jq jr fq ke fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff kd"><img src="../Images/fd455e06dad3f180a497df78d67edac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h8fUbGuTA_Qo3KGcRL4uEQ.png"/></div></div></figure><p id="d5e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">没错。在第24行，在视图函数viewProduct中，你的编译器将抛出这个错误，即<strong class="is hu">栈太深</strong>。现在，我们不要把这个错误归咎于可靠性，即使有办法解决它，我们也要理解这一点。</p><p id="db47" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个错误是由<strong class="is hu">以太坊虚拟机(EVM)给出的。</strong></p><p id="50c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">EVM不是收银机，但它是一个堆栈机。这意味着所有的计算都发生在名为<strong class="is hu">栈</strong>的数据区(参见Solidity <a class="ae kl" href="https://docs.soliditylang.org/en/v0.8.12/introduction-to-smart-contracts.html?highlight=stack#storage-memory-and-the-stack" rel="noopener ugc nofollow" target="_blank"> docs </a>)。在EVM，您可以访问这个堆栈的方式是有限的。堆栈的最大大小为1024个元素。很有可能从堆栈中复制16个最顶层元素中的一个，并将其放在顶部。换句话说，你可以把栈顶的元素和它下面16个元素中的任何一个交换。我们还可以访问堆栈中第16个元素以外的更深层次的元素，但必须先移除顶部。</p><p id="f9eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以无论我们做什么，我们都有16个变量，包括函数参数和返回变量。给函数的每个输入参数取1个变量，每个返回值也取1个变量。除此之外，局部声明还会占用另一个变量空间，任何对存储的引用都会占用一些空间。所以你的16个限制在栈中访问，因为局部变量被存储在栈中被填满。</p><p id="7d0c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是EVM强加的，因为只能到达堆栈中的特定深度。</p><p id="d064" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">至于解决这个问题的方法，如果你愿意的话，有很多。你可以把你的函数分成几个部分，然后让它们调用其他函数，或者你可以完全返回这个结构，然后用JavaScript或者你正在使用的任何东西来处理它，把它呈现在你的网站上。像这样修改回报—</p><figure class="jo jp jq jr fq ke fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff km"><img src="../Images/994b54e6f07d745bba3b52fd93b73448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5l08C9-aHhYfPeXmmpG4xA.png"/></div></div></figure><p id="b81a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我希望你能理解这一点。懂了就简单了。</p><p id="8c9e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">谢谢你读到这里。✌</p><blockquote class="kn"><p id="d73a" class="ko kp ht bd kq kr ks kt ku kv kw jn ek translated">加入Coinmonks <a class="ae kl" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae kl" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae kl" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="jx jy ht bd kx ky kz la lb lc ld le lf jb lg lh li jf lj lk ll jj lm ln lo lp dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lq lr ht is b it ls ix lt jb lu jf lv jj lw jn lx ly lz ma dt translated"><a class="ae kl" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae kl" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lq lr ht is b it mb ix mc jb md jf me jj mf jn lx ly lz ma dt translated"><a class="ae kl" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae kl" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="lq lr ht is b it mb ix mc jb md jf me jj mf jn lx ly lz ma dt translated"><a class="ae kl" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae kl" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="lq lr ht is b it mb ix mc jb md jf me jj mf jn lx ly lz ma dt translated"><a class="ae kl" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae kl" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="lq lr ht is b it mb ix mc jb md jf me jj mf jn lx ly lz ma dt translated"><a class="ae kl" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">开发人员的最佳加密API</a></li><li id="b359" class="lq lr ht is b it mb ix mc jb md jf me jj mf jn lx ly lz ma dt translated">最佳<a class="ae kl" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="lq lr ht is b it mb ix mc jb md jf me jj mf jn lx ly lz ma dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>