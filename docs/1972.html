<html>
<head>
<title>Blockchain : Day 4 — Play with our smart contract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">区块链:第4天——玩转我们的智能合约</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/day-4-play-with-our-smart-contract-74f99d32f464?source=collection_archive---------24-----------------------#2022-03-08">https://medium.com/coinmonks/day-4-play-with-our-smart-contract-74f99d32f464?source=collection_archive---------24-----------------------#2022-03-08</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><h1 id="2e66" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">先决条件</h1><p id="f1fd" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">在进入这篇文章之前，请阅读我之前的关于使用EtherJS和VueJS来设置项目的文章。</p><div class="km kn fm fo ko kp"><a rel="noopener follow" target="_blank" href="/coinmonks/blockchain-day-2-etherjs-vuejs-4a2896a50ef2"><div class="kq ab ej"><div class="kr ab ks cl cj kt"><h2 class="bd hu fv z el ku eo ep kv er et hs dt translated">区块链:第二天— EtherJS + VueJS</h2><div class="kw l"><h3 class="bd b fv z el ku eo ep kv er et ek translated">#概述</h3></div><div class="kx l"><p class="bd b gc z el ku eo ep kv er et ek translated">medium.com</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld le kp"/></div></div></a></div><h1 id="a0b1" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">操场</h1><h2 id="ec82" class="lf ir ht bd is lg lh li iw lj lk ll ja jz lm ln je kd lo lp ji kh lq lr jm ls dt translated">部署您的合同</h2><p id="4e3e" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">是时候将您新创建的合同<code class="eh lt lu lv lw b">Library</code>部署到Ganache或Hardhat网络上了。</p><p id="bb52" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">如果hardhat网络作为本地以太坊测试网络:</p><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="a910" class="lf ir ht lw b fv mk ml l mm mn">// In one terminal<br/>npx hardhat node</span><span id="b945" class="lf ir ht lw b fv mo ml l mm mn">//on the other terminal<br/>npx hardhat run scripts/deploy.ts --network hardhat</span></pre><p id="4983" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">或者，如果您已经将Ganache定义为本地测试工作，那么这几乎是相同的</p><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="364f" class="lf ir ht lw b fv mk ml l mm mn">npx hardhat run scripts/deploy.ts --network ganache</span></pre><p id="0db9" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">记得启动ganache，并在您的<code class="eh lt lu lv lw b">hardhat.config.ts</code>中定义ganache网络</p><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="ed5a" class="lf ir ht lw b fv mk ml l mm mn">networks: {     <br/>    ganache: { <br/>        url: "http://127.0.0.1:7545", <br/>        accounts: process.env.GANACHE_PRIVATE_KEY !== undefined ?                 <br/>          [process.env.GANACHE_PRIVATE_KEY] : [], <br/>    }, <br/>},</span></pre><p id="a939" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">如果合同部署成功，由于<code class="eh lt lu lv lw b">deploy.ts</code>中的以下代码，合同的地址将在终端上打印出来</p><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="6410" class="lf ir ht lw b fv mk ml l mm mn">async function main() {</span><span id="fd3b" class="lf ir ht lw b fv mo ml l mm mn">   const Library = await ethers.getContractFactory("Library");</span><span id="00eb" class="lf ir ht lw b fv mo ml l mm mn">   const library = await Library.deploy("Miichisoft Library");</span><span id="2a4a" class="lf ir ht lw b fv mo ml l mm mn">   await library.deployed();</span><span id="cb55" class="lf ir ht lw b fv mo ml l mm mn">   console.log("Library deployed to:", library.address);</span><span id="e3a2" class="lf ir ht lw b fv mo ml l mm mn">}</span></pre><h2 id="ed92" class="lf ir ht bd is lg lh li iw lj lk ll ja jz lm ln je kd lo lp ji kh lq lr jm ls dt translated">玩弄你的契约</h2><p id="9d4b" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">由于我们已经在<a class="ae mp" rel="noopener" href="/coinmonks/blockchain-day-2-etherjs-vuejs-4a2896a50ef2">的前一篇文章</a>中实现了EtherJS插件，现在我们可以很容易地与我们部署的契约进行交互。比方说，如果我们想给图书馆增加一本新书。</p><p id="6e3c" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">UI准备会有人这样想:</p><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="bb73" class="lf ir ht lw b fv mk ml l mm mn">&lt;div&gt;</span><span id="9e2d" class="lf ir ht lw b fv mo ml l mm mn">   &lt;label for="isbn"&gt;ISBN:&lt;/label&gt;</span><span id="79d4" class="lf ir ht lw b fv mo ml l mm mn">   &lt;input id='isbn' type="text" v-model="new_book.isbn"&gt;</span><span id="e943" class="lf ir ht lw b fv mo ml l mm mn">   &lt;label for="author" &gt;Author:&lt;/label&gt;</span><span id="b47e" class="lf ir ht lw b fv mo ml l mm mn">   &lt;input id='author' type="text" v-model="new_book.author"&gt;</span><span id="cead" class="lf ir ht lw b fv mo ml l mm mn">   &lt;label for="title"&gt;Title:&lt;/label&gt;</span><span id="d084" class="lf ir ht lw b fv mo ml l mm mn">   &lt;input id='title' type="text" v-model="new_book.title"&gt;</span><span id="20b7" class="lf ir ht lw b fv mo ml l mm mn">   &lt;button class="primaryButton" @click="addBook()"&gt;Add&lt;/button&gt;</span><span id="c3bf" class="lf ir ht lw b fv mo ml l mm mn">&lt;/div&gt;</span></pre><p id="6020" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">我们的Vue数据模型:</p><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="6fbb" class="lf ir ht lw b fv mk ml l mm mn">data() {</span><span id="ca63" class="lf ir ht lw b fv mo ml l mm mn">   return {</span><span id="47e7" class="lf ir ht lw b fv mo ml l mm mn">      currentAccount: null,</span><span id="2296" class="lf ir ht lw b fv mo ml l mm mn">      currentContract : null,</span><span id="e463" class="lf ir ht lw b fv mo ml l mm mn">      contractAddress: "&lt;deployed_address",</span><span id="9914" class="lf ir ht lw b fv mo ml l mm mn">      new_book: {</span><span id="bb04" class="lf ir ht lw b fv mo ml l mm mn">         isbn:'',</span><span id="ae89" class="lf ir ht lw b fv mo ml l mm mn">         title:'',</span><span id="d573" class="lf ir ht lw b fv mo ml l mm mn">         author:''</span><span id="4d02" class="lf ir ht lw b fv mo ml l mm mn">   }</span><span id="3f52" class="lf ir ht lw b fv mo ml l mm mn">  };</span><span id="5bb2" class="lf ir ht lw b fv mo ml l mm mn">},</span></pre><p id="bc62" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">每当我们点击<code class="eh lt lu lv lw b">Add</code>按钮时，我们从输入中获取所有信息，组成一个图书结构并调用智能合同功能</p><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="3ad0" class="lf ir ht lw b fv mk ml l mm mn">methods:{<br/>    addBook: async function(){</span><span id="d388" class="lf ir ht lw b fv mo ml l mm mn">    await this.currentContract.addBook(this.new_book.isbn,</span><span id="671c" class="lf ir ht lw b fv mo ml l mm mn">    this.new_book.title,</span><span id="e4ea" class="lf ir ht lw b fv mo ml l mm mn">    this.new_book.author);</span><span id="f1b4" class="lf ir ht lw b fv mo ml l mm mn">},</span><span id="2513" class="lf ir ht lw b fv mo ml l mm mn">}</span></pre><p id="185b" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">现在，您可以输入图书的isbn、书名和作者，然后单击add按钮，MetaMask会询问您是否允许触发新事务来添加新书。在您的批准下，将创建一个新的交易，签名并通过网络发送，以向我们的书店添加一本新书。</p><p id="db46" class="pw-post-body-paragraph jo jp ht jq b jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh mb kj kk kl hm dt translated">练习:当我们添加完一本新书时，通过使用EtherJS与您的网络进行交互，实现您自己的逻辑来显示书店中的所有书籍将是一个很好的练习。</p><h1 id="f312" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">最后的</h1><p id="dcfa" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们完成了前端，展示了使用我们的EtherJS插件与区块链交互的能力。在下一篇文章中，我们将看到如何从我们的智能契约中发出一个事件，以及如何捕捉发出的事件并在VueJS前端使用它们。</p></div></div>    
</body>
</html>