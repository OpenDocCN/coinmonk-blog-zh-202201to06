<html>
<head>
<title>DeFi on Bitcoin Part 1: Fungible Tokens and Token Swap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">比特币定义第一部分:可替代代币和代币互换</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/defi-on-bitcoin-part-1-fungible-tokens-and-token-swap-f1e86683ee3b?source=collection_archive---------5-----------------------#2022-01-13">https://medium.com/coinmonks/defi-on-bitcoin-part-1-fungible-tokens-and-token-swap-f1e86683ee3b?source=collection_archive---------5-----------------------#2022-01-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="31f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">分散金融(DeFi)最近经历了快速增长，因为它声称可以解决遗留金融系统中固有的问题。</p><p id="cc2a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">DeFi没有与比特币联系在一起，因为传统观点认为比特币无法支持它。</p><p id="4c1f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这个系列中，我们将证明DeFi不仅在比特币上是可行的，而且从成本、安全性、可组合性和可伸缩性方面来看，在比特币上运行DeFi实际上比在其他区块链上更有优势。我们将涵盖DeFi基础设施和原语，它们可以组合成乐高积木来构建各种DeFi应用程序，如交易所、借贷平台和NFT市场。</p><p id="7915" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本系列的第一部分中，我们展示了如何实现可替换令牌以及如何原子地交换它们。</p><h1 id="abe6" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">可替代代币</h1><p id="aecf" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">本质上，可替换的令牌合同是一个表/分类帐。每个条目包含一个用户(此处标识为比特币公钥)和她拥有的令牌数量。可选地，发行者可以铸造新代币。下面这个契约实现了这样一个基本令牌，类似于以太坊里的<a class="ae kr" href="https://ethereum.org/en/developers/docs/standards/tokens/erc-20/" rel="noopener ugc nofollow" target="_blank"> ERC20 </a>令牌标准。</p><figure class="ks kt ku kv fq kw"><div class="bz el l di"><div class="kx ky l"/></div><figcaption class="kz la fg fe ff lb lc bd b be z ek"><a class="ae kr" href="https://github.com/sCrypt-Inc/boilerplate/blob/master/contracts/erc20.scrypt" rel="noopener ugc nofollow" target="_blank">ERC20 Contract</a></figcaption></figure><p id="84d1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它是<a class="ae kr" rel="noopener" href="/coinmonks/introducing-stateful-properties-f0f6bce45a06">一个有状态契约</a>(第5行)，包含一个将每个用户映射到其令牌余额的表(第6行)。</p><ul class=""><li id="56b3" class="ld le ht is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll dt translated"><strong class="is hu">铸造</strong>:铸造新代币并分配给接收者。只有发行者(第3行的<em class="lm">铸币者</em>)可以铸造新代币，在第11行检查。第13行检查接收者的旧余额，第14行增加它。第16行使用OP_PUSH_TX作为<a class="ae kr" rel="noopener" href="/coinmonks/introducing-stateful-properties-f0f6bce45a06">保持状态，我们总是这样做</a>。</li><li id="9aa1" class="ld le ht is b it ln ix lo jb lp jf lq jj lr jn li lj lk ll dt translated"><strong class="is hu"> transferFrom </strong>:将令牌从发送方转移到接收方。第22行验证发送者。第24行检查其余额，第23行确保她有足够的代币，之后她的余额被扣除，接收者的余额增加相同的数量。第30行像以前一样保持状态。</li></ul><p id="f86e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意<a class="ae kr" href="https://github.com/bitcoinbook/bitcoinbook/blob/a3229bbbc0c929dc53ec11365051a6782695cb52/ch06.asciidoc#signature-hash-types-sighash" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> <em class="lm"> SigHash。第35行使用了单个</em> </strong> </a>，以确保契约总是在与其被调用的输入相同的索引输出中。</p><h1 id="aafa" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">代币交换</h1><p id="7794" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">既然我们有代币，让我们交换它们。</p><p id="b154" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在典型的代币交换中，爱丽丝用鲍勃的<strong class="is hu"> y </strong>数量的<strong class="is hu"> B </strong>代币交换<strong class="is hu"> x </strong>数量的<strong class="is hu"> A </strong>代币。在下面的例子中，<strong class="is hu"> x </strong>是10，<strong class="is hu"> y </strong>是20，这意味着每个<strong class="is hu"> A </strong>代币值2个<strong class="is hu"> B </strong>代币。</p><figure class="ks kt ku kv fq kw fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ls"><img src="../Images/00ee021df01b2b68a5347d855f1c516a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*69A4bdzWA5MQejSFBeIEeQ.png"/></div></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">Alice swaps 10 <strong class="bd lz">A</strong> Tokens for 20 <strong class="bd lz">B</strong> Tokens from Bob: before/after on the left/right</figcaption></figure><p id="eb8c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们想以原子方式交换它们:要么爱丽丝收到20个<strong class="is hu"> B </strong>代币，鲍勃收到10个<strong class="is hu"> A </strong>代币，要么两者都没有收到任何代币。为了实现这一点，我们利用比特币的UTXO模型:每笔交易可以有多个输入和输出。爱丽丝或鲍勃(或类似交易所的第三方)创建交易<strong class="is hu"> <em class="lm"> tx2 </em> </strong>。它的第一个和第二个输入花费来自<strong class="is hu"> <em class="lm"> tx0 </em> </strong>和<strong class="is hu"> <em class="lm"> tx1 </em> </strong>，其中一个输出分别包含最新的<strong class="is hu"> A </strong>和<strong class="is hu"> B </strong>令牌契约。它的第一个和第二个输出分别包含更新的<strong class="is hu"> A </strong>和<strong class="is hu"> B </strong>令牌契约。</p><p id="41ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Alice可以在签名之前验证一切(例如，汇率和金额)是否正确。鲍勃也可以。值得注意的是，一方签字后(爱丽丝或鲍勃都可以先签字)，另一方在不使现有签名失效的情况下，不能单方面涂改<strong class="is hu"> <em class="lm"> tx2 </em> </strong>。由于一个交易只能被矿工作为一个整体接受或拒绝，交换是原子性的。</p><figure class="ks kt ku kv fq kw fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ma"><img src="../Images/e9e44d7364d3b47106ab4dea6cfc9c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c4FUO2MSLlxAs9Uv8ptsTg.png"/></div></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">Token Swap Transactions</figcaption></figure><h2 id="a796" class="mb jp ht bd jq mc md me ju mf mg mh jy jb mi mj kc jf mk ml kg jj mm mn kk mo dt translated">与以太坊相比</h2><p id="5c7e" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">以太坊中的代币交换通常分两步进行:</p><ol class=""><li id="12d8" class="ld le ht is b it iu ix iy jb lf jf lg jj lh jn mp lj lk ll dt translated">Alice和Bob批准了一份互换合同，以消费一定数量的代币，这称为批准ERC20中的津贴。</li><li id="557c" class="ld le ht is b it ln ix lo jb lp jf lq jj lr jn mp lj lk ll dt translated">互换合约执行实际的交换。</li></ol><p id="1d43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">互换合约本质上充当了一个可信的第三方。在步骤1之后，欺诈合同可以任意转移令牌并窃取它们。或者互换合约有bug导致批准的代币被烧或被盗。在我们的代币交换中，用户在任何时候都可以完全控制汇率和金额，而不必信任第三方。因此，它是非托管的，更安全。</p><blockquote class="mq"><p id="b139" class="mr ms ht bd mt mu mv mw mx my mz jn ek translated">加入Coinmonks <a class="ae kr" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae kr" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h2 id="bd97" class="mb jp ht bd jq mc na me ju mf nb mh jy jb nc mj kc jf nd ml kg jj ne mn kk mo dt translated">另外，阅读</h2><ul class=""><li id="3621" class="ld le ht is b it km ix kn jb nf jf ng jj nh jn li lj lk ll dt translated"><a class="ae kr" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae kr" href="https://blog.coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a> | <a class="ae kr" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="4023" class="ld le ht is b it ln ix lo jb lp jf lq jj lr jn li lj lk ll dt translated"><a class="ae kr" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">莱杰vs n rave</a>|<a class="ae kr" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">莱杰nano s vs x </a> | <a class="ae kr" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="a108" class="ld le ht is b it ln ix lo jb lp jf lq jj lr jn li lj lk ll dt translated"><a class="ae kr" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit Exchange审查</a> | <a class="ae kr" href="https://blog.coincodecap.com/bityard-reivew" rel="noopener ugc nofollow" target="_blank"> Bityard审查</a> | <a class="ae kr" href="https://blog.coincodecap.com/jet-bot-review" rel="noopener ugc nofollow" target="_blank"> Jet-Bot审查</a></li><li id="aa0d" class="ld le ht is b it ln ix lo jb lp jf lq jj lr jn li lj lk ll dt translated"><a class="ae kr" href="https://blog.coincodecap.com/buy-crypto-with-credit-card" rel="noopener ugc nofollow" target="_blank">用信用卡购买密码的10个最佳地点</a></li></ul></div></div>    
</body>
</html>