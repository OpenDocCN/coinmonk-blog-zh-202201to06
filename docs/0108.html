<html>
<head>
<title>How to get historical crypto prices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何获得历史加密价格</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-get-historical-crypto-prices-46b8ff133efd?source=collection_archive---------1-----------------------#2022-01-09">https://medium.com/coinmonks/how-to-get-historical-crypto-prices-46b8ff133efd?source=collection_archive---------1-----------------------#2022-01-09</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="f5fa" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">制作您自己的烛台图表，并获得数据，以找到您最喜爱的密码价格模式！</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/29901e02e6dff5c1b1067dfca418c32b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1O0Ja2lzAdRP_jvIkMihhA.png"/></div></div></figure><p id="2ef4" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我的一个朋友最近问我如何找到加密货币对的历史开盘价、最高价、最低价和收盘价(OHLC)数据。我知道如何在CoinGecko上查询价格，但我实际上不知道如何收集历史数据。对于希望对加密货币价格进行一些算法分析的人，或者甚至只是维护excel电子表格以帮助他们跟踪其表现的人来说，这是有用的信息。</p><p id="8983" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">当然，这些数据必须随时可用！</p><blockquote class="kr ks kt"><p id="d646" class="ju jv ku jw b jx jy iu jz ka kb ix kc kv ke kf kg kw ki kj kk kx km kn ko kp hm dt translated">如果你不能自由、轻松地获得像价格历史这样简单的东西，那么去中心化、公开化的区块链会有什么样的前景呢？</p></blockquote><p id="d24f" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">通过一点研究，我能够解决这个问题，现在我也将向您展示如何做到这一点。</p><h1 id="5c7c" class="ky kz ht bd la lb lc ld le lf lg lh li iz lj ja lk jc ll jd lm jf ln jg lo lp dt translated">寻找API提供者</h1><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff lq"><img src="../Images/c6e882eddb7be8c97b567a6cd9e3b911.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FJo6zSHOVxiB3xTQ"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Photo by <a class="ae kq" href="https://unsplash.com/@comparefibre?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Compare Fibre</a> on <a class="ae kq" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="62a3" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">一个厨师创造了新鲜，微妙的主菜知道，这一切都取决于挑选高品质的原料。同样，这项工作依赖于找到一个完美的API来提供我们需要的信息，这样我们就可以拼凑一个脚本来处理它。</p><h2 id="1670" class="lv kz ht bd la lw lx ly le lz ma mb li kd mc md lk kh me mf lm kl mg mh lo mi dt translated">让我们试试硬币壁虎</h2><p id="41ca" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">我做的第一件事是检查CoinGecko。他们的网站是我用来跟踪我的加密投资组合的价格表现的主要来源，我知道他们有一个API。也许，他们有办法获得高/低/开盘价/收盘价信息。</p><p id="ce72" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">您可以在这里找到Coingecko API文档。他们给自己贴上了“最全面的加密货币API”的标签，他们有一个免费的计划让我玩，所以我对这个领先感到兴奋！</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mo"><img src="../Images/4a54bfb8909606bd6aa0347a66ba1d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3ooqX_c9zDTzOuJhaW0eg.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek"><a class="ae kq" href="https://www.coingecko.com/en/api" rel="noopener ugc nofollow" target="_blank">https://www.coingecko.com/en/api</a></figcaption></figure><p id="a75f" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我迫不及待地点击“浏览文档”，寻找我需要的数据。</p><p id="3fa5" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">事实上，他们有各种有趣的数据，我鼓励你看看他们有什么可用的。也许你会为其他有趣的项目或分析收集一些想法，例如使用趋势数据来跳跃动量交易或根据类别数据寻找新的硬币来探索！</p><p id="42bc" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">然而，在查看价格数据时，我只看到了当前价格数据，以及可以从特定日期提取的历史价格数据。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mp"><img src="../Images/d033358b82badbd0e02d8bed83317973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U1U-hqDdv0p5FF7u0U-cbQ.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">request param only allows a specific date</figcaption></figure><p id="6a30" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">Coingecko可能有历史价格数据，但是只有一个日期字段。获取一系列历史价格数据会非常低效和繁琐。</p><blockquote class="mq"><p id="9aad" class="mr ms ht bd mt mu mv mw mx my mz kp ek translated">我需要为历史开盘、盘高、盘低、收盘(OHLC)价格数据找到一个更好的选择。</p></blockquote><h2 id="fcc0" class="lv kz ht bd la lw na ly le lz nb mb li kd nc md lk kh nd mf lm kl ne mh lo mi dt translated">[关于加密货币的OHLC的旁白]</h2><p id="ddb4" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">如果你仔细想想，开盘价、最高价、最低价和收盘价是一个有点奇怪的概念。对于常规的股票市场来说，它们很有意义，因为股票市场局限于一个地点，而且它们有交易开始和结束的市场时间。</p><blockquote class="mq"><p id="3a32" class="mr ms ht bd mt mu mv mw mx my mz kp ek translated">加密货币市场没有地点，也没有交易时间。</p></blockquote><p id="1ece" class="pw-post-body-paragraph ju jv ht jw b jx nf iu jz ka ng ix kc kd nh kf kg kh ni kj kk kl nj kn ko kp hm dt translated">加密的术语不像股票市场那样清晰:</p><ul class=""><li id="460b" class="nk nl ht jw b jx jy ka kb kd nm kh nn kl no kp np nq nr ns dt translated">当一个市场总是开放时,“开放”或“关闭”意味着什么？</li><li id="3269" class="nk nl ht jw b jx nt ka nu kd nv kh nw kl nx kp np nq nr ns dt translated">当价格信息是一个连续不间断的流时，什么是'高'和'低'价格？</li></ul><p id="f8bf" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">为了继续，我们必须根据我们的需求做出假设。在我的例子中，我并不太关心<em class="ku">确切的开始和结束时间是什么时候，但是我希望看到大致每天一段时间的数据，并查看OHLC在许多天内的性能。</em></p><p id="6fa2" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">因此，打开和关闭的时间并不重要，只要它们与下一次打开和关闭相隔大约24小时。反过来，可以在这24小时左右的时间内收集高点和低点。</p><h2 id="6041" class="lv kz ht bd la lw lx ly le lz ma mb li kd mc md lk kh me mf lm kl mg mh lo mi dt translated">找到更好的来源</h2><p id="38d1" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">我用谷歌搜索了一下数据来源，找到了<a class="ae kq" href="https://blog.rmotr.com/top-5-free-apis-to-access-historical-cryptocurrencies-data-2438adc8b62" rel="noopener ugc nofollow" target="_blank">的这篇文章</a>，它帮我找到了一些好的线索。该网站给出了一些很好的评论，请随意尝试不同的评论。不过出于我的目的，我选择了第一个选项:<a class="ae kq" href="https://docs.cryptowat.ch/rest-api/" rel="noopener ugc nofollow" target="_blank"> Cryptowatch </a>。</p><p id="a530" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我选择Cryptowatch是因为它提供了以下功能:</p><ul class=""><li id="c028" class="nk nl ht jw b jx jy ka kb kd nm kh nn kl no kp np nq nr ns dt translated">它有一个免费层，非常慷慨的每日限额来满足我的需求</li><li id="2896" class="nk nl ht jw b jx nt ka nu kd nv kh nw kl nx kp np nq nr ns dt translated">它拥有来自各种交易所和交易对的信息</li><li id="291b" class="nk nl ht jw b jx nt ka nu kd nv kh nw kl nx kp np nq nr ns dt translated">它有一个“/ohlc”API端点，为我完成了所有的聚合工作</li></ul><p id="14d8" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们最感兴趣的端点如下:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ny"><img src="../Images/670fbb7beac3d9c377b3059852b0ed1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R2917tZGG359pDD9mnYbPA.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek"><a class="ae kq" href="https://docs.cryptowat.ch/rest-api/markets/ohlc" rel="noopener ugc nofollow" target="_blank">https://docs.cryptowat.ch/rest-api/markets/ohlc</a></figcaption></figure><p id="3b82" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">请注意端点如何具有参数来选择对、日期范围，甚至周期的大小。</p><blockquote class="mq"><p id="1ab0" class="mr ms ht bd mt mu mv mw mx my mz kp ek translated">这正是我们要找的！</p></blockquote><h1 id="88a4" class="ky kz ht bd la lb lc ld le lf lg lh li iz nz ja lk jc oa jd lm jf ob jg lo lp dt translated">是时候把手弄脏了！</h1><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff oc"><img src="../Images/8a87fa6601f86e79b5eb045e06bcb5d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R_qSZ_N5YsYl0k4w"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Photo by <a class="ae kq" href="https://unsplash.com/@max_duz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Max Duzij</a> on <a class="ae kq" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="142a" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我们有了一个好的数据源，我们需要创建一个脚本来获取数据。</p><p id="9b3e" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">Python有一些方便的工具可以清晰而轻松地做到这一点。Jupyter笔记本特别允许你以“试错”的方式来做这件事，并且非常适合处理数据。(这也是python和Jupyter笔记本成为数据科学家最喜欢的工具的一个原因！)</p><h2 id="5216" class="lv kz ht bd la lw lx ly le lz ma mb li kd mc md lk kh me mf lm kl mg mh lo mi dt translated">设置</h2><p id="b9d4" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">设置您的环境超出了本文的范围，但是您可以在这里找到资源:</p><ul class=""><li id="4511" class="nk nl ht jw b jx jy ka kb kd nm kh nn kl no kp np nq nr ns dt translated">Anaconda安装:Anaconda python发行版可能是安装python和jupyter笔记本最简单的方法，尤其是如果你有一台PC的话。请参考他们的安装文档进行设置</li><li id="b3f0" class="nk nl ht jw b jx nt ka nu kd nv kh nw kl nx kp np nq nr ns dt translated"><a class="ae kq" href="https://docs.python-requests.org/en/latest/user/install/#install" rel="noopener ugc nofollow" target="_blank">请求</a>:这是一个用于获取REST API请求的基本库。通常在你的环境设置好之后，你只需要输入<code class="eh od oe of og b">pip install requests</code>。该链接有安装和使用的官方文档。</li></ul><p id="5839" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">一旦您的环境设置好了，就创建一个jupyter笔记本，并通过导入请求来启动您的脚本。</p><p id="175b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><code class="eh od oe of og b">import requests</code></p><h2 id="7cbe" class="lv kz ht bd la lw lx ly le lz ma mb li kd mc md lk kh me mf lm kl mg mh lo mi dt translated">选择贸易对</h2><p id="2a78" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">为了获得我们需要的数据，我们需要选择一个交易所和我们希望在该交易所交易的交易对。api有各种各样的交换可供选择。要查看列表，您可以按以下方式查询:</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="fb68" class="lv kz ht og b fv ol om l on oo"># Fetch list of exchanges<br/>resp = requests.get('https://api.cryptowat.ch/exchanges')</span></pre><p id="6cf7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">创建一个单独的jupyter单元格，使用resp对象来查找您想要的交换名称。例如，</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="c61e" class="lv kz ht og b fv ol om l on oo"># Get list of exchange values you can use<br/>exchange_names = [e['symbol'] for e in resp.json()['result'] \<br/>    if e['active']]<br/>exchange_names</span><span id="cc2f" class="lv kz ht og b fv op om l on oo">### You should see a response similar to the following:<br/>['coinone',<br/> 'uniswap-v2',<br/> 'ftx',<br/> 'coinbase-pro',<br/> 'gemini',<br/> 'binance',<br/>  ...<br/>]</span></pre><p id="3b65" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">理论上你可以从这个列表中选择任何东西，但是我们将在我们的脚本中选择'<strong class="jw hu">双子座</strong>'。</p><p id="adbd" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">选择交易所后，我们可以看到交易对列表:</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="884a" class="lv kz ht og b fv ol om l on oo"># Select Gemini<br/>EXCHANGE = 'gemini'</span><span id="8831" class="lv kz ht og b fv op om l on oo"># Fetch markets on the exchange<br/>exchange_resp = requests.get(f'https://api.cryptowat.ch/markets/{EXCHANGE}')</span></pre><p id="339b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在单独的单元格中，处理响应</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="d81a" class="lv kz ht og b fv ol om l on oo"># See all the pairs in the market</span><span id="4cdf" class="lv kz ht og b fv op om l on oo">pairs = [i['pair'] for i in exchange_resp.json()['result'] \<br/>    if i['active']]<br/>pairs</span><span id="2f23" class="lv kz ht og b fv op om l on oo">### You should see a response similar to this<br/>['btcusd',<br/> 'ethbtc',<br/> 'ethusd',<br/> 'zecusd',<br/> 'zecbtc',<br/> 'zeceth',<br/> 'ltcusd',<br/> ...<br/>]</span></pre><p id="f9cd" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们继续我们的脚本，选择'<strong class="jw hu"> ethusd </strong>'对(又名以太坊vs美元)。我们将通过在新单元格中添加行<code class="eh od oe of og b">PAIR = 'ethusd'</code>来设置参数。</p><p id="d5bf" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">注意:</strong>提前想好你想要的那双通常更容易。例如，如果我知道以太坊是ETH，美元是(USD ),那么我可以假设ETHUSD是配对</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="77e5" class="lv kz ht og b fv ol om l on oo"># you an verify that it is the correct pairing by checking here<br/>PAIR = ‘ethusd’</span><span id="e7d0" class="lv kz ht og b fv op om l on oo"># Verify Pair exists<br/>pair_resp = requests.get(f’https://api.cryptowat.ch/pairs/{PAIR}')</span><span id="0df7" class="lv kz ht og b fv op om l on oo">pair_resp.json()</span><span id="d183" class="lv kz ht og b fv op om l on oo">### You should see a response similar to this<br/>{'result': {'id': 125,<br/>  'symbol': 'ethusd',<br/>  'base': {'id': 77,<br/>   'symbol': 'eth',<br/>   'name': 'Ethereum',<br/>   'fiat': False,<br/>   'route': 'https://api.cryptowat.ch/assets/eth'},<br/>  'quote': {'id': 98,<br/>   'symbol': 'usd',<br/>   'name': 'United States Dollar',<br/>   'fiat': True,<br/>   'route': 'https://api.cryptowat.ch/assets/usd'},<br/>  'route': 'https://api.cryptowat.ch/pairs/ethusd',<br/>  'markets': [{'id': 672,<br/>    'exchange': 'zonda',<br/>    'pair': 'ethusd',<br/>    'active': True,<br/>    'route': 'https://api.cryptowat.ch/markets/zonda/ethusd'},<br/>    ...<br/>  ],<br/>  ...<br/>}</span></pre><h2 id="3753" class="lv kz ht bd la lw lx ly le lz ma mb li kd mc md lk kh me mf lm kl mg mh lo mi dt translated">选择日期范围</h2><p id="2c12" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">除了交易对，我们还必须选择我们的日期范围。我们还想将周期设置为每天。下面我设定了一个月的范围和每天的时间段。</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="57f4" class="lv kz ht og b fv ol om l on oo"># Date Parameters<br/>START_DATE = '12/8/2021'<br/>END_DATE = '1/8/2022'<br/>PERIOD = 86400  # Time period in seconds (e.g., 1 day = 86400)</span></pre><p id="ef4b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">如果您密切关注API，您会注意到您实际上需要使用时间戳(即，从UTC 1970年1月1日开始的秒数)来代替日期字符串。幸运的是，我们可以使用内置的<code class="eh od oe of og b">datetime</code>库很容易地在python中转换它。在您的脚本中包含以下内容以进行转换</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="e009" class="lv kz ht og b fv ol om l on oo"># Convert the dates to timestamps<br/>from datetime import datetime</span><span id="429c" class="lv kz ht og b fv op om l on oo">def to_timestamp(dateString):<br/>    element = datetime.strptime(dateString, '%m/%d/%Y')<br/>    return int(datetime.timestamp(element))</span><span id="9267" class="lv kz ht og b fv op om l on oo"># Will be used later to convert back<br/>def to_date(timestamp):<br/>    dt = datetime.fromtimestamp(timestamp)<br/>    return dt.strftime('%m/%d/%Y')</span><span id="4c8c" class="lv kz ht og b fv op om l on oo">start_ts = to_timestamp(START_DATE)<br/>end_ts = to_timestamp(END_DATE)</span></pre><h2 id="d91e" class="lv kz ht bd la lw lx ly le lz ma mb li kd mc md lk kh me mf lm kl mg mh lo mi dt translated">调用API</h2><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff oq"><img src="../Images/18fe3f08cb394fbd7c1e134ba1f0ddec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*eWDe9ax7muIURH-ww_7M1A.jpeg"/></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Created on memegenerator.net</figcaption></figure><p id="a352" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我们已经有了所有需要的参数，是时候调用Cryptowatch API端点了。</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="d549" class="lv kz ht og b fv ol om l on oo"># Fetch the data<br/>params = {<br/>  'after': start_ts,<br/>  'before': end_ts,<br/>  'periods': PERIOD,<br/>}</span><span id="dbef" class="lv kz ht og b fv op om l on oo">ohlc_resp = requests.get(<br/>    f'https://api.cryptowat.ch/markets/{EXCHANGE}/{PAIR}/ohlc',<br/>    params=params)<br/>ohlc_resp.json()['result'][f'{PERIOD}']</span></pre><p id="31d9" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这个调用应该在一个元组列表中给我们一堆结果，其中包含我们正在寻找的数据。</p><h1 id="3590" class="ky kz ht bd la lb lc ld le lf lg lh li iz lj ja lk jc ll jd lm jf ln jg lo lp dt translated">操纵数据</h1><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff or"><img src="../Images/1d6f7e68ec3900e4454b50d9e920aedf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FME60esySRZJ5qbV"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Photo by <a class="ae kq" href="https://unsplash.com/@earl_plannerzone?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Earl Wilcox</a> on <a class="ae kq" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="96ba" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我们有了数据，我们可以用它来操纵、分析和呈现数据。此时，您真的可以对数据做任何您想做的事情。为了演示这一点，我们将执行以下操作:</p><ul class=""><li id="6705" class="nk nl ht jw b jx jy ka kb kd nm kh nn kl no kp np nq nr ns dt translated">将数据放入结构化的python对象中，并获得用户友好的打印输出</li><li id="dd33" class="nk nl ht jw b jx nt ka nu kd nv kh nw kl nx kp np nq nr ns dt translated">创建蜡烛图</li></ul><h2 id="044b" class="lv kz ht bd la lw lx ly le lz ma mb li kd mc md lk kh me mf lm kl mg mh lo mi dt translated">打印易读的对象</h2><p id="169b" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">下面的代码定义了一个类对象，以及它将如何输出。</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="1678" class="lv kz ht og b fv ol om l on oo">import json<br/>import pprint as pp</span><span id="1c31" class="lv kz ht og b fv op om l on oo">class Ohlc():<br/>    def __init__(self, tuple):<br/>        (self.close_ts,<br/>         self.open,<br/>         self.high,<br/>         self.low,<br/>         self.close,<br/>         self.volume,<br/>         self.quote_volume) = tuple<br/>        self.close_dt = to_date(self.close_ts)</span><span id="18f1" class="lv kz ht og b fv op om l on oo">    def __repr__(self):<br/>        return pp.pformat({<br/>            'close_dt': self.close_ts,<br/>            'price': {<br/>              'open': self.open,<br/>              'high': self.high,<br/>              'low': self.low,<br/>              'close': self.close,<br/>            },<br/>        })</span></pre><p id="9792" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">` __init__ '函数将获取从API调用返回的元组对象，并将它们放入类中。` __repr__ '函数确定对象的字符串表示形式，并允许我们以我们想要的方式打印响应。</p><p id="1412" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我们所要做的就是通过类输入数据并打印结果。我们可以用一个简单的列表理解表达式很容易地做到这一点</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="e325" class="lv kz ht og b fv ol om l on oo">ohlcs = [Ohlc(i) for i in ohlc_resp.json()['result'][f'{PERIOD}']]<br/>ohlcs</span><span id="4a11" class="lv kz ht og b fv op om l on oo">### You should see a response similar to this<br/>[{'close_dt': 1639008000,<br/>  'price': {'close': 4440.15, 'high': 4456.05, 'low': 4229.99, 'open': 4310.34}},<br/> {'close_dt': 1639094400,<br/>  'price': {'close': 4106.69, 'high': 4490.84, 'low': 4077.15, 'open': 4441.35}},<br/> {'close_dt': 1639180800,<br/>  'price': {'close': 3900.4, 'high': 4200, 'low': 3888.88, 'open': 4113.06}},<br/> ...<br/>]</span></pre><h2 id="f3da" class="lv kz ht bd la lw lx ly le lz ma mb li kd mc md lk kh me mf lm kl mg mh lo mi dt translated">创建蜡烛图</h2><p id="cc84" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">蜡烛图通常用于分析股票的价格表现。它们是一种简洁的方式，通过粗棒线代表开盘价/收盘价范围，用线代表高低点范围，用粗棒线代表开盘价、收盘价、最高价和最低价。</p><p id="4a81" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">您可以搜索python绘图库来帮助您将这些数据转换成蜡烛图。下面我们将使用一个名为<code class="eh od oe of og b">pandas</code>的库将数据收集到数据帧中。然后，我们将使用数据框和名为<code class="eh od oe of og b">cufflinks</code>的python库进行绘图。</p><p id="df59" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">首先，我们需要安装先决条件:</p><p id="c1f9" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在命令控制台中，您应该能够安装它，如下所示:</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="726e" class="lv kz ht og b fv ol om l on oo">python -m pip install --upgrade pip<!-- --> <br/>pip install pandas<br/>pip install plotly</span></pre><p id="c213" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">[参见:<a class="ae kq" href="https://plotly.com/python/getting-started/" rel="noopener ugc nofollow" target="_blank"> Plotly - Getting started </a>获取故障排除信息]</p><p id="8406" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="ku">注意:如果你使用的是vscode，你可能需要下面的代码来显示图形</em></p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="d5d6" class="lv kz ht og b fv ol om l on oo">import plotly.io as pio<br/>pio.renderers.default = "vscode"</span></pre><p id="229a" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">接下来，我们将使用以下代码创建数据框:</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="9c1b" class="lv kz ht og b fv ol om l on oo"># Convert timestamp to date object in each row<br/>data = [tuple([datetime.fromtimestamp(i[0])] + i[1:]) \<br/>    for i in ohlc_resp.json()['result'][f'{PERIOD}']]</span><span id="10ef" class="lv kz ht og b fv op om l on oo"># Create dataframe<br/>columns = ['date', 'open', 'high', 'low','close',\<br/>    'volume', 'qt_volume']<br/>df = pandas.DataFrame.from_records(data, columns=columns)</span><span id="211c" class="lv kz ht og b fv op om l on oo">df.tail()</span></pre><p id="15dd" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">您应该会看到类似如下的结果:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff os"><img src="../Images/6076fd35d5cfcf863a24421fac6b3fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIdh0BRCFwexCovDsl8_gA.png"/></div></div></figure><p id="0857" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我们用plotly把这个数据框变成一个蜡烛图</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="a469" class="lv kz ht og b fv ol om l on oo">qf = cufflinks.QuantFig(<br/>    df, title="", name='ETHUSD')</span><span id="dc00" class="lv kz ht og b fv op om l on oo">qf.iplot()</span></pre><p id="b469" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这几行可能需要一点时间，但它们会产生如下精彩情节:</p><pre class="jj jk jl jm fq oh og oi oj aw ok dt"><span id="7c7d" class="lv kz ht og b fv ol om l on oo">import plotly.graph_objects as go</span><span id="0fce" class="lv kz ht og b fv op om l on oo">fig = go.Figure(data=[<br/>    go.Candlestick(x=df['date'],<br/>        open=df["open"],<br/>        high=df["high"],<br/>        low=df["low"],<br/>        close=df["close"])<br/>])</span><span id="0808" class="lv kz ht og b fv op om l on oo">fig.update_layout(<br/>    title=f"ETH/USD Candlesticks",<br/>    yaxis_title="ETH Price (USD)"<br/>)</span></pre><p id="8417" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">然后，瞧！你现在有一个烛台阴谋。我有没有提到它也是交互式的！</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ot"><img src="../Images/b0cc495fe1589c41a41729d3dcc2fa60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JGkH9nlImY5T79WWQXqlCg.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">You can zoom in and out with the nav on the bottom of the plot</figcaption></figure><h1 id="70ae" class="ky kz ht bd la lb lc ld le lf lg lh li iz lj ja lk jc ll jd lm jf ln jg lo lp dt translated">出去探索吧！</h1><p id="ae12" class="pw-post-body-paragraph ju jv ht jw b jx mj iu jz ka mk ix kc kd ml kf kg kh mm kj kk kl mn kn ko kp hm dt translated">在上面，您学习了如何执行以下操作:</p><ul class=""><li id="9e94" class="nk nl ht jw b jx jy ka kb kd nm kh nn kl no kp np nq nr ns dt translated">找到合适的API</li><li id="6ae0" class="nk nl ht jw b jx nt ka nu kd nv kh nw kl nx kp np nq nr ns dt translated">使用python获取历史价格数据</li><li id="5472" class="nk nl ht jw b jx nt ka nu kd nv kh nw kl nx kp np nq nr ns dt translated">将数据分为对象和数据框</li><li id="f62b" class="nk nl ht jw b jx nt ka nu kd nv kh nw kl nx kp np nq nr ns dt translated">将数据绘制成蜡烛图</li></ul><p id="d344" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这个过程可以用任何API重复，你可以用任何你想要的方式操作数据。</p><p id="851b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在剩下的就是出去尝试一些事情！祝你好运！</p><blockquote class="kr ks kt"><p id="5296" class="ju jv ku jw b jx jy iu jz ka kb ix kc kv ke kf kg kw ki kj kk kx km kn ko kp hm dt translated">免责声明:</p><p id="1f79" class="ju jv ku jw b jx jy iu jz ka kb ix kc kv ke kf kg kw ki kj kk kx km kn ko kp hm dt translated">我不是财务顾问，本文中表达的观点不是财务建议。加密货币和智能合约是复杂的工具，具有很高的亏损风险。你应该仔细考虑你是否了解这些工具是如何工作的，你是否能够承担失去你的钱的高风险。我鼓励你在做出任何投资决定之前进行自己的研究，避免投资任何你不完全了解其运作方式和所涉及风险的金融工具。</p></blockquote><blockquote class="mq"><p id="ed14" class="mr ms ht bd mt mu ou ov ow ox oy kp ek translated">加入Coinmonks <a class="ae kq" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae kq" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h2 id="6048" class="lv kz ht bd la lw na ly le lz nb mb li kd nc md lk kh nd mf lm kl ne mh lo mi dt translated">也阅读</h2><div class="oz pa fm fo pb pc"><a href="https://blog.coincodecap.com/bitsgap-review" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">获取信号、交易机器人和套利</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">在本文中，我们将讨论bits gap——一个满足您所有交易需求的一站式加密交易平台…</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">blog.coincodecap.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq js pc"/></div></div></a></div><div class="oz pa fm fo pb pc"><a href="https://blog.coincodecap.com/blockfi-review" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">BlockFi评论2021:利弊和利率| CoinCodeCap</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">今天，我们提出了一个全面的BlockFi评论，这是一个成立于2017年的加密贷款平台，拥有其…</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">blog.coincodecap.com</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq js pc"/></div></div></a></div><div class="oz pa fm fo pb pc"><a rel="noopener follow" target="_blank" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">如何在印度购买比特币？2021年购买比特币的7款最佳应用[手机版]</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">如何使用移动应用程序购买比特币印度</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">medium.com</p></div></div><div class="pl l"><div class="ps l pn po pp pl pq js pc"/></div></div></a></div><div class="oz pa fm fo pb pc"><a rel="noopener follow" target="_blank" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">加密税务软件——五大最佳比特币税务计算器[2021]</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">不管你是刚接触加密还是已经在这个领域呆了一段时间，你都需要交税。</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">medium.com</p></div></div><div class="pl l"><div class="pt l pn po pp pl pq js pc"/></div></div></a></div><div class="oz pa fm fo pb pc"><a href="https://blog.coincodecap.com/crypto-to-buy-in-2022" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">9个2022年最值得购买的密码| CoinCodeCap</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">2021年对于加密货币、比特币、NFT或不可替代代币、元宇宙等等来说是很棒的一年。这一年…</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">blog.coincodecap.com</p></div></div><div class="pl l"><div class="pu l pn po pp pl pq js pc"/></div></div></a></div><div class="oz pa fm fo pb pc"><a href="https://blog.coincodecap.com/best-hardware-wallet-bitcoin" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">存储比特币的最佳加密硬件钱包[2021] | CoinCodeCap</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">保管您的数字资产很容易，但找到正确的存储方式却是一项繁琐的任务。在线钱包有一个风险…</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">blog.coincodecap.com</p></div></div><div class="pl l"><div class="pv l pn po pp pl pq js pc"/></div></div></a></div><div class="oz pa fm fo pb pc"><a rel="noopener follow" target="_blank" href="/coinmonks/pionex-review-exchange-with-crypto-trading-bot-1e459d0191ea"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">Pionex评论2021 |免费加密交易机器人和交换</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">Pionex是为交易自动化提供工具的后起之秀。Pionex上提供了9个加密交易机器人…</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">medium.com</p></div></div><div class="pl l"><div class="pw l pn po pp pl pq js pc"/></div></div></a></div><div class="oz pa fm fo pb pc"><a rel="noopener follow" target="_blank" href="/coinmonks/top-3-telegram-channels-for-crypto-traders-in-2021-8385f4411ff4"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">2022年密码交易员的三大电报渠道</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">加密信号是来自专业交易者的交易想法，以特定的价格或价格买卖特定的加密货币</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">medium.com</p></div></div><div class="pl l"><div class="px l pn po pp pl pq js pc"/></div></div></a></div><div class="oz pa fm fo pb pc"><a href="https://blog.coincodecap.com/free-crypto-portfolio-trackers" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab ej"><div class="pe ab pf cl cj pg"><h2 class="bd hu fv z el ph eo ep pi er et hs dt translated">2022年5个最佳免费加密投资组合追踪器</h2><div class="pj l"><h3 class="bd b fv z el ph eo ep pi er et ek translated">加密投资组合追踪器是作为一个解决方案创建的，既费时又令人困惑的家务提供一个…</h3></div><div class="pk l"><p class="bd b gc z el ph eo ep pi er et ek translated">blog.coincodecap.com</p></div></div><div class="pl l"><div class="py l pn po pp pl pq js pc"/></div></div></a></div></div></div>    
</body>
</html>