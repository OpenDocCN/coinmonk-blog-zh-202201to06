<html>
<head>
<title>Bored Ape Yacht Club: Mechanics + Solidity Smart Contract Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无聊猿游艇俱乐部:力学+坚实智能合同分析</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/bored-ape-yacht-club-mechanics-smart-contract-breakdown-6345bffd75ec?source=collection_archive---------4-----------------------#2022-06-03">https://medium.com/coinmonks/bored-ape-yacht-club-mechanics-smart-contract-breakdown-6345bffd75ec?source=collection_archive---------4-----------------------#2022-06-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/22e233259b8fdff480fc6e1c3f420b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oG8OpE23QMmGQ-iZ1goVbg.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae jf" href="https://unsplash.com/s/photos/bored-ape?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2fd0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我知道这个已经完成了——特别是对无聊猿游艇俱乐部智能合同的逐行分析。</p><p id="57fc" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然而，读了一些帖子后，我仍然对其中的机制感到困惑——比如说我想做一个BAYC风格的NFT项目。一旦我有了智能合同，我实际上会做什么？涉及的操作顺序是什么——什么时候创建我的JSON元数据，什么时候部署我的合同？我应该先调用哪个函数？我如何进行预售？</p><p id="3505" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我觉得有很多关于<em class="ke">每行代码做什么</em>的解释，但是关于<em class="ke">如何做</em>的解释不够。所以我想以稍微不同的方式来处理这篇文章，通过回顾一下<em class="ke">如何使用</em>智能合同来实际执行NFT项目的机制。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="81f1" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">介绍</h1><p id="a428" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">BAYC是10，000个无聊的猿NFT的集合，<a class="ae jf" href="https://boredapeyachtclub.com/#/home" rel="noopener ugc nofollow" target="_blank">自称</a>为“生活在以太坊区块链上的独特数字收藏品”，其中每一个都是“独特的，通过编程从超过170个可能的特征中生成，包括表情、头饰、衣服等等……有些比其他的更罕见。”</p><p id="6fe1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">支撑这个大获成功的NFT项目的<a class="ae jf" href="https://etherscan.io/address/0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d#code" rel="noopener ugc nofollow" target="_blank"> BAYC智能合同</a>，是<a class="ae jf" href="https://eips.ethereum.org/EIPS/eip-721" rel="noopener ugc nofollow" target="_blank"> ERC-721不可替代令牌标准</a>的实现。</p><p id="6bf0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">ERC-721标准听起来很奇特，因为它是一个带有数字代码的首字母缩写词，而我们在心理上将它与复杂性联系在一起。然而，其核心仅仅是一组标准的事件、功能和合同细节，需要实现它们才能将智能合同归类为符合ERC-721标准。仅此而已。</p><p id="fcd4" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">谢天谢地，OpenZeppelin已经创建了<a class="ae jf" href="https://docs.openzeppelin.com/contracts/4.x/erc721" rel="noopener ugc nofollow" target="_blank">模板</a>来帮助你做到这一点。您可以轻松地扩展这些现成的合同来实现您自己的NFT项目(这正是BAYC所做的)。</p><p id="d083" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">也有很多优秀的NFT教程。</p><h1 id="967c" class="km kn ht bd ko kp lp kr ks kt lq kv kw kx lr kz la lb ls ld le lf lt lh li lj dt translated">力学</h1><p id="52b6" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">所以，很快——你走上了经典的加密路线，获得了BAYC的合同，部署了一个你自己的模仿NFT的项目。从哪里开始？</p><h2 id="25da" class="lu kn ht bd ko lv lw lx ks ly lz ma kw jr mb mc la jv md me le jz mf mg li mh dt translated">1a。艺术</h2><p id="67d6" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">这<em class="ke">应该是</em>的第一步——首先，你要推销的艺术和概念应该在实现之前；关于车和马的一些事情。第二——为了恰当地实施“随机化”的售前流程，防止对系列中特定作品的窃取，比如BAYC，需要一个初始序列。</p><p id="1cab" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">每只猿都有不同的可能特征——例如，<a class="ae jf" href="https://ipfs.io/ipfs/QmQsxRXfVxxC5k9Uo8U51QcBtiA6TNmHAenbPMar7vFZrt" rel="noopener ugc nofollow" target="_blank">猿#1152 </a>，在公海上看到的<a class="ae jf" href="https://opensea.io/assets/0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d/1152" rel="noopener ugc nofollow" target="_blank"/>，有5个特征——“皮毛”(“深棕色”)，“背景”(“紫色”)，“嘴”(“无聊的胡子拉碴”)，“衣服”(“服务”)，“眼睛”(“僵尸”)。其他类人猿也可能有不同数量的特征。</p><p id="5006" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">“程序生成”简单地说就是，在离线状态下，创造者为每只猿生成不同数量的特征和相应的特征值的随机组合。每个性状值的稀有程度不同，这意味着它们在集合中出现的概率不同。</p><p id="6349" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这在实践中如何运作？</p><p id="08dc" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">他们提出了一系列不同的可能特征(“皮毛”、“眼睛”、“帽子”等)，并为每个特征列出了一系列可能的值(“皮毛”颜色、“眼睛”类型等)，并为每个值分配了不同的出现概率(即1%的猿类有“服务”服装，如1152号猿)。</p><p id="2197" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然后，他们将这些特征值中的每一个绘制成图像层，并通过编程运行一个循环到10，000。在循环的每一次迭代中，他们都会生成一个随机的属性和值组合，将图像层组合在一起以创建每个独特的Ape。这是您开始时的顺序(稍后会以随机方式重新排序)。</p><p id="0240" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><a class="ae jf" href="https://github.com/rounakbanik/generative-art-nft" rel="noopener ugc nofollow" target="_blank">这里有一个很棒的github repo </a>演示了用Python写的另一个NFT项目(Scrappy松鼠——嘿，我不评价艺术)的生成过程。然而，他们对元数据采取了稍微不同的路线，将元数据保存为一个大的CSV文件(而不是每个NFT一个JSON元数据文件；因此，它更类似于<a class="ae jf" href="https://ipfs.io/ipfs/Qme57kZ2VuVzcj5sC3tVHFgyyEgBTmAnyTK45YVNxKf6hi" rel="noopener ugc nofollow" target="_blank"> BAYC最终证明散列</a>，尽管没有出处散列字段)。</p><p id="521d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">每个Ape还需要一个与之相关联的JSON元数据文件，说明它的属性。以下是Ape #1152的JSON元数据:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/8a6cf1d0a0258fa266b53b1eecaea780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*8VYD72aaWtBOVkvuIOxBuQ.png"/></div></figure><h2 id="28b0" class="lu kn ht bd ko lv lw lx ks ly lz ma kw jr mb mc la jv md me le jz mf mg li mh dt translated">1b。IPFS</h2><p id="9f0d" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">你还需要上传数据到<a class="ae jf" href="https://ipfs.io/" rel="noopener ugc nofollow" target="_blank">IPFS</a>——图像数据，以及JSON元数据。IPFS只是帮助你为你的数据生成分散的URL端点(<code class="eh mn mo mp mq b">ipfs://…</code>)，这是一个比使用典型的URL端点(<code class="eh mn mo mp mq b">https://…</code>)更合理的<a class="ae jf" href="https://docs.pinata.cloud/nfts#why-dont-we-use-a-normal-url-for-the-image-property" rel="noopener ugc nofollow" target="_blank"/>。然而，如果所有者选择删除，IPFS链接仍然会受到链接腐烂的影响。</p><p id="49be" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">你可以使用Pinata云服务来帮助你上传或“锁定”你所有的数据到IPFS。这一步实际上可以(也应该)与步骤1a一起完成，即在编程循环中创建图像和元数据时将其固定。在此之后，对于每个Ape，您应该有两个IPFS链接——一个图像URI及其关联的元数据URI，其中还包含对IPFS图像链接的引用(对于Ape #1152，这里的<a class="ae jf" href="https://ipfs.io/ipfs/QmQsxRXfVxxC5k9Uo8U51QcBtiA6TNmHAenbPMar7vFZrt" rel="noopener ugc nofollow" target="_blank">和这里的</a>和<a class="ae jf" href="https://bafybeihpjhkeuiq3k6nqa3fkgeigeri7iebtrsuyuey5y6vy36n345xmbi.ipfs.dweb.link/1152" rel="noopener ugc nofollow" target="_blank"/>)。</p><h2 id="61f1" class="lu kn ht bd ko lv lw lx ks ly lz ma kw jr mb mc la jv md me le jz mf mg li mh dt translated">2.合同部署和初始参数</h2><p id="587f" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">下一步实际上是将智能合约部署到以太坊区块链上。这可以通过多种方式实现——从<a class="ae jf" href="https://trufflesuite.com/" rel="noopener ugc nofollow" target="_blank"> Truffle </a>或<a class="ae jf" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank"> Hardhat </a>部署脚本，或者简单地从<a class="ae jf" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"> Remix </a>部署脚本。BAYC合同在这里是<a class="ae jf" href="https://etherscan.io/address/0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D#code" rel="noopener ugc nofollow" target="_blank">T21。</a></p><p id="e2b0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在部署期间，构造函数需要几个参数:NFT的名称(" BoredApeYachtClub ")、符号(" BAYC ")、maxNftSupply(一个int-10000)和saleStart(一个unix时间戳int-1619060439，对应于2021年4月21日3:00:39 AM GMT)。从该数据中，ape的最大数量被设置(到10k)，并且显示时间戳被计算为所提供的销售开始时间之后的第9天:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mr"><img src="../Images/e9c2f6b11457f9789b92371d963da0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrNnV3YZy-T-gO2FxLy0Tw.png"/></div></div></figure><p id="8a95" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然后(在BAYC的情况下),合同<code class="eh mn mo mp mq b">owner</code>通过<code class="eh mn mo mp mq b">reserveApes</code>函数为自己保留了一些ape，他们可以无限次数地这样做，每批30个，除了汽油费什么都不花(注意，其他ape由普通公众铸造的底价是0.08 Eth)。这当然是可选的。</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/eb89eeac4275e5d24486d2ee16b66d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*KPXxXXjUqCeEG7qPIakjdA.png"/></div></figure><p id="0a24" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然后，设置基本URI——这是一个ERC721必填字段，链接到每个Ape的元数据。这是存储元数据的IPFS文件夹，按顺序排列。</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mt"><img src="../Images/70d3869b1374dd4bf39ca28b57ae13b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e0O3AcOhizq_BchroT8HXA.png"/></div></div></figure><h2 id="0eee" class="lu kn ht bd ko lv lw lx ks ly lz ma kw jr mb mc la jv md me le jz mf mg li mh dt translated">3.预售铸造期</h2><p id="2c32" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">一旦设置了这些初始参数，必须设置<code class="eh mn mo mp mq b">saleIsActive</code>字段<code class="eh mn mo mp mq b">true </code>，以便打开铸造周期。这是通过<code class="eh mn mo mp mq b">flipSaleState</code>功能实现的:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/9864c2c7df75349ce832f1192ed226d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*38pYT7woLHBMiRGpeJzTAg.png"/></div></figure><p id="0d2a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">现在任何人都可以开始铸造猿类(通过<code class="eh mn mo mp mq b">mintApes</code>功能)，最大数量为10，000。当已经铸造了10，000个Ape，或者在到达显示时间戳之后铸造了第一个Ape时(以先发生者为准)，在契约中自动设置<code class="eh mn mo mp mq b">startingIndexBlock</code>变量，由<code class="eh mn mo mp mq b">mintApes</code>函数中的逻辑控制:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mv"><img src="../Images/f9ca3b00771b6dd23a646ecde70f19a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_Fqz5_fVpoC6vQSDp-NnQ.png"/></div></div></figure><p id="22e4" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><code class="eh mn mo mp mq b">startingIndexBlock</code>实质上是初始预售期结束后的第一个Eth区块。</p><p id="0096" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">该变量非常重要，因为必须对其进行设置，以使随机化过程(即设置<code class="eh mn mo mp mq b">startingIndex</code>变量)发生。所以还内置了应急功能，让车主手动设置。但是，如果随机化尚未发生，他们只能<em class="ke">手动设置:</em></p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/770f8285d37b200cd12c5c8cbbd26370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*-r9ijZ9jvCLgyCahQjZFew.png"/></div></figure><h2 id="c2dc" class="lu kn ht bd ko lv lw lx ks ly lz ma kw jr mb mc la jv md me le jz mf mg li mh dt translated">4.序列随机化</h2><p id="9ddc" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">预售期结束后(设置<code class="eh mn mo mp mq b">startingIndexBlock</code>后)，可通过<code class="eh mn mo mp mq b">setStartingIndex</code>功能触发随机化过程。</p><p id="2ebb" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">随机化仅仅是将初始NFT序列移动一定的量，这样，虽然序列的<em class="ke">连续</em>顺序保持不变，但是起点和终点不同。</p><p id="d77f" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">移位量由<code class="eh mn mo mp mq b">startingIndex</code>的计算值直接给出，该值是在1和9999之间产生的随机数(如果<code class="eh mn mo mp mq b">startingIndex</code>恰好是0，则将其设置为1，以便保证序列移位至少1个索引，并且防止默认序列)，通过块号的blockhash使用简单随机性:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mx"><img src="../Images/d89b7f95b2f53ec839519d3a15c11b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R6jmsjsPNx_eHXxki01v5Q.png"/></div></div></figure><p id="0427" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在很大程度上，这种随机化方法是<a class="ae jf" href="https://docs.soliditylang.org/en/v0.8.14/units-and-global-variables.html#block-and-transaction-properties" rel="noopener ugc nofollow" target="_blank">糟糕的实践</a>，并且通常不可取，因为时间戳和块散列在某种程度上都可能受到挖掘者的影响。一个更好的解决方案是使用<a class="ae jf" href="https://docs.chain.link/docs/chainlink-vrf/" rel="noopener ugc nofollow" target="_blank">链节VRF(可验证随机函数)</a>，它提供加密安全的随机数。</p><p id="2a61" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">BAYC的<a class="ae jf" href="https://etherscan.io/address/0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D#readContract" rel="noopener ugc nofollow" target="_blank">最终起始指数</a>计算为8853:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div class="fe ff my"><img src="../Images/b63f1e8ae276addd621b0a6ab3d47b46.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*EaOyPDvNcarx9s36c8-b-w.png"/></div></figure><p id="62f5" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这意味着，从步骤1中创建的NFT序列，顺序被移动了8853，并且它的(易混淆的名称)“初始序列索引”是根据<a class="ae jf" href="https://boredapeyachtclub.com/#/provenance" rel="noopener ugc nofollow" target="_blank">公式</a>计算的:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/b23dddcefe7b566d9c4e76a53c884845.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*RrdOmD0VcETbwP3m03Gu9Q.png"/></div></figure><p id="8743" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">对于Ape #1152，这变成:(1152 + 8853) % 10000 = 5。因此，Ape #1152的初始序列索引为5:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff na"><img src="../Images/556d5c1ec51f48e2b2a61203d14cc27e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XFqNwEgCbAyM3igGziW71A.png"/></div></div></figure><h2 id="c132" class="lu kn ht bd ko lv lw lx ks ly lz ma kw jr mb mc la jv md me le jz mf mg li mh dt translated">5.创建出处散列</h2><p id="6213" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">既然已经设置了最终的序列，就可以<a class="ae jf" href="https://boredapeyachtclub.com/#/provenance" rel="noopener ugc nofollow" target="_blank">计算</a>最终的证明散列:</p><blockquote class="nb nc nd"><p id="84b3" class="jg jh ke ji b jj jk jl jm jn jo jp jq ne js jt ju nf jw jx jy ng ka kb kc kd hm dt translated">每个无聊的猿图像首先使用SHA-256算法散列。通过以如下所列的特定顺序连接每个钻孔Ape图像的SHA-256来获得组合串。最后的证明是通过SHA-256散列这个组合字符串获得的。这是存储在智能合约上的最终出处记录。</p></blockquote><p id="454d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这个<a class="ae jf" href="https://ipfs.io/ipfs/Qme57kZ2VuVzcj5sC3tVHFgyyEgBTmAnyTK45YVNxKf6hi" rel="noopener ugc nofollow" target="_blank">最终证明散列</a>也被固定到IPFS，作为包含出处散列(“cc 354 B3 FCA ce 8844 DCC 9861004 da 081 f 71 df 9567775 B3 F3 a 43412752752 c0bf”)以及NFT元数据的最终序列的JSON文件。</p><h2 id="8cdc" class="lu kn ht bd ko lv lw lx ks ly lz ma kw jr mb mc la jv md me le jz mf mg li mh dt translated">6.更新剩余数据</h2><p id="a748" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">最后一步是使用最终确定的序列更新剩余的数据。对于BAYC，这包括用最终的排序信息创建<a class="ae jf" href="https://www.arweave.org/" rel="noopener ugc nofollow" target="_blank"> Arweave </a> permaweb URIs，以及<a class="ae jf" href="https://ipfs.io/ipfs/QmUE2HrYFxMbrwrQeiXj7B8C7voUN9zE8C7yAkYD2Sw7eQ" rel="noopener ugc nofollow" target="_blank">将该元数据固定到IPFS </a>上，然后通过<code class="eh mn mo mp mq b">setProvenanceHash</code>函数用来自步骤5的出处散列更新合同:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div class="fe ff nh"><img src="../Images/96cb6134890515bb2409929db2c701df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*p0_nmpQuwqxX71pKp72odQ.png"/></div></figure></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><p id="fcd5" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">就是这样！一步一步的指南复制大获成功的BAYC项目，建立自己的NFT收藏。感谢阅读。</p><h2 id="c3f3" class="lu kn ht bd ko lv lw lx ks ly lz ma kw jr mb mc la jv md me le jz mf mg li mh dt translated">注意</h2><p id="d4a1" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">最后一点——我已经看到其他文章<a class="ae jf" rel="noopener" href="/better-programming/bored-ape-yacht-club-smart-contract-breakdown-6c254c774394">这里</a>和<a class="ae jf" rel="noopener" href="/northwest-nfts/bored-ape-yacht-club-contract-review-80dce503308e">这里</a>鹦鹉学舌关于<code class="eh mn mo mp mq b">startingIndex</code>变量及其作为猿类序列随机化手段的功能的相同错误:</p><blockquote class="nb nc nd"><p id="01aa" class="jg jh ke ji b jj jk jl jm jn jo jp jq ne js jt ju nf jw jx jy ng ka kb kc kd hm dt translated">但是……这个随机偏移量实际上并没有被用到任何地方！代码没用！尽管BAYC的<a class="ae jf" href="https://boredapeyachtclub.com/#/provenance" rel="noopener ugc nofollow" target="_blank">声称</a>猿的顺序是随机的，但实际上不是！而<code class="eh mn mo mp mq b"><em class="ht">startingIndex</em></code>只是浪费汽油！</p></blockquote><p id="8acd" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt">…</p><blockquote class="nb nc nd"><p id="0f2e" class="jg jh ke ji b jj jk jl jm jn jo jp jq ne js jt ju nf jw jx jy ng ka kb kc kd hm dt translated">这些功能都是辅助性的，没有实际影响！<em class="ht"> startingIndex </em>值在契约中不会被重用，因此它对任何事情都没有影响。</p></blockquote><p id="60df" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">他们错了。虽然BAYC随机数生成并不完美，但是<code class="eh mn mo mp mq b">startingIndex</code>“对任何事情都没有影响”显然是错误的。它并不直接用于智能合约本身，而是离线使用，最终证明散列通过<code class="eh mn mo mp mq b">startingIndex</code>计算，然后在合约中设置。</p><p id="caa2" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">自己检查一下— <a class="ae jf" href="https://ipfs.io/ipfs/Qme57kZ2VuVzcj5sC3tVHFgyyEgBTmAnyTK45YVNxKf6hi" rel="noopener ugc nofollow" target="_blank">最终证明哈希</a>显示了令牌Id为5的Ape #1152，它是使用8853的<code class="eh mn mo mp mq b">startingIndex</code>计算的:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ni"><img src="../Images/cd36587b5f03d8a85613461a24fa46d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vvOsSb9jKTRvrD7DLrF4ww.png"/></div></div></figure><p id="8b8e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">并且<a class="ae jf" href="https://ipfs.io/ipfs/QmUE2HrYFxMbrwrQeiXj7B8C7voUN9zE8C7yAkYD2Sw7eQ" rel="noopener ugc nofollow" target="_blank"> Arweave permaweb URIs </a>也示出了与Ape #1152的分配令牌ID 1152相关联的初始序列索引5:</p><figure class="mj mk ml mm fq iu fe ff paragraph-image"><div class="fe ff nj"><img src="../Images/5d3af76dfe4a85448f9dde94ae0bc9b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*x0qOZiFR20S6wXqecrO0YQ.png"/></div></figure><p id="40d9" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">通过在事务搜索中使用arweaveId，您还可以在这里看到Arweave事务<a class="ae jf" href="https://viewblock.io/arweave/tx/4CBzpnMCUJKCw5aaH2GbLb4XLleK70-pRj868NTM8P0" rel="noopener ugc nofollow" target="_blank">。此事务包含Ape #1152的IPFS映像链接的散列数据(qmqsxrxfvxxc 5 K9 uo 8 u 51 qcbtia 6 tnmhaenbpmar 7 VF zrt)。</a></p><blockquote class="nk"><p id="e55f" class="nl nm ht bd nn no np nq nr ns nt kd ek translated">加入Coinmonks <a class="ae jf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jf" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="9ca9" class="km kn ht bd ko kp lp kr ks kt lq kv kw kx nu kz la lb nv ld le lf nw lh li lj dt translated">另外，阅读</h1><ul class=""><li id="7592" class="nx ny ht ji b jj lk jn ll jr nz jv oa jz ob kd oc od oe of dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/coindcx-review-8444db3621a2"> CoinDCX评论</a> | <a class="ae jf" href="https://coincodecap.com/crypto-margin-trading-exchanges" rel="noopener ugc nofollow" target="_blank">加密保证金交易交易所</a></li><li id="dbf0" class="nx ny ht ji b jj og jn oh jr oi jv oj jz ok kd oc od oe of dt translated"><a class="ae jf" href="https://coincodecap.com/red-dog-casino-review" rel="noopener ugc nofollow" target="_blank">红狗赌场评论</a> | <a class="ae jf" href="https://coincodecap.com/swyftx-review" rel="noopener ugc nofollow" target="_blank"> Swyftx评论</a> | <a class="ae jf" href="https://coincodecap.com/coingate-review" rel="noopener ugc nofollow" target="_blank">造币厂评论</a></li><li id="4a9d" class="nx ny ht ji b jj og jn oh jr oi jv oj jz ok kd oc od oe of dt translated"><a class="ae jf" href="https://coincodecap.com/bookmap-review-2021-best-trading-software" rel="noopener ugc nofollow" target="_blank"> Bookmap评论</a> | <a class="ae jf" href="https://coincodecap.com/crypto-exchange-usa" rel="noopener ugc nofollow" target="_blank">美国5大最佳加密交易所</a></li><li id="fd1b" class="nx ny ht ji b jj og jn oh jr oi jv oj jz ok kd oc od oe of dt translated"><a class="ae jf" href="https://coincodecap.com/ftx-futures-trading" rel="noopener ugc nofollow" target="_blank">如何在FTX交易所交易期货</a> | <a class="ae jf" href="https://coincodecap.com/okex-vs-binance" rel="noopener ugc nofollow" target="_blank"> OKEx vs币安</a></li><li id="d623" class="nx ny ht ji b jj og jn oh jr oi jv oj jz ok kd oc od oe of dt translated"><a class="ae jf" href="https://coincodecap.com/coinloan-review" rel="noopener ugc nofollow" target="_blank"> CoinLoan审查</a> | <a class="ae jf" rel="noopener" href="/coinmonks/youhodler-4-easy-ways-to-make-money-98969b9689f2"> YouHodler审查</a> | <a class="ae jf" href="https://coincodecap.com/blockfi-review" rel="noopener ugc nofollow" target="_blank"> BlockFi审查</a></li><li id="85da" class="nx ny ht ji b jj og jn oh jr oi jv oj jz ok kd oc od oe of dt translated"><a class="ae jf" href="https://coincodecap.com/profittradingapp-for-binance" rel="noopener ugc nofollow" target="_blank">XT.COM评论</a>币安评论 | <a class="ae jf" href="https://coincodecap.com/xt-com-review" rel="noopener ugc nofollow" target="_blank"/></li><li id="cb36" class="nx ny ht ji b jj og jn oh jr oi jv oj jz ok kd oc od oe of dt translated"><a class="ae jf" href="https://coincodecap.com/smithbot-review" rel="noopener ugc nofollow" target="_blank"> SmithBot评论</a> | <a class="ae jf" href="https://coincodecap.com/free-open-source-trading-bots" rel="noopener ugc nofollow" target="_blank"> 4款最佳免费开源交易机器人</a></li></ul></div></div>    
</body>
</html>