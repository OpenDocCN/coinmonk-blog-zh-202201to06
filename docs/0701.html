<html>
<head>
<title>On-chain NFTs, at what cost?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">链上NFTs，代价是什么？</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/on-chain-nfts-at-what-cost-6ea7970c8dac?source=collection_archive---------4-----------------------#2022-02-15">https://medium.com/coinmonks/on-chain-nfts-at-what-cost-6ea7970c8dac?source=collection_archive---------4-----------------------#2022-02-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="3ef0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">随着时间的推移，越来越多的Solidity开发人员开始接触ERC721和ERC1155标准，他们开始更加关注不变性和链上数据的重要性。</p><p id="b8a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然而，一个经常被忽视的错误是使用了用于其他协议交互和链上发现的数据结构。</p><p id="d271" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">智能合约在交易期间或转移时循环遍历for循环中的项目变得越来越常见。然而，可枚举数据结构是为了链上发现而不是前端消费。“EnumerableSet”等数据结构的用例源自它的实用性，当它被其他协议以“廉价”的方式在链上发现时。这意味着其他协议可以轻松、廉价地迭代一个帐户的NFTs。</p><p id="c0b2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然而，在铸造的时候，循环这些项目变得越来越昂贵。因此，可枚举数据结构的良好实践是只在链上用例中使用它们。</p><p id="3c65" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们考虑一个拥有几个NFT的帐户和一个涉及几个事务的迭代(还记得我们提到的‘for’循环迭代)，那么这个函数耗尽gas的机会将会增加，甚至对于一个链外读取也是如此。</p><p id="4e1b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们回到基础，即使一个函数被声明为“虚拟的”,它也只是一个“自由读取”的函数，只要没有项目被转移。如果一个用户有10个商品，那么检查id列表和检查每个id将变得非常昂贵，从而增加了协议契约的外部调用数量。</p><h2 id="d09b" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">如何解决这个问题</h2><ol class=""><li id="2592" class="kj kk ht is b it kl ix km jb kn jf ko jj kp jn kq kr ks kt dt translated">创建一个列出帐户令牌id的函数</li><li id="083c" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt dt translated">离线调用这个函数</li><li id="4e45" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt dt translated">将令牌id传递给需要它们的函数，并验证该函数的所有权</li></ol><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="9862" class="jo jp ht le b fv li lj l lk ll"><br/>function useTokenIds(<br/>   address registry, <br/>   uint256[] calldata tokenIds<br/>) external {<br/>   address sender = msg.sender;<br/>   uint256 tokenId;<br/>   for (uint256 i; i &lt; tokenIds.length; i++){<br/>     tokenId = tokenIds[i];<br/>     require(<br/>     IERC721(registry).ownerOf(tokenIds[i]) == sender,<br/>     “not owner of those tokenIds”<br/>     );<br/>     _doSomethingWithThisTokenId(registry, tokenId, sender)<br/> }<br/>}</span></pre><p id="534c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果前端需要id列表，我们可以实现一个getter函数来遍历所有令牌并返回我们感兴趣的令牌id。这样做，我们将避免使用像Enumerable这样的数据结构，因为我们不需要其他链上协议来了解它。</p><p id="8c3e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你也可以使用<a class="ae lm" href="https://thegraph.com/en/" rel="noopener ugc nofollow" target="_blank">图</a>来索引用户的所有项目，甚至是一些市场的API，比如<a class="ae lm" href="https://opensea.io/" rel="noopener ugc nofollow" target="_blank"> OpenSea </a>。</p><p id="16e3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">EIP721直截了当地告诉了EIP:</p><p id="f274" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">&gt;考虑的替代方案:如果需要for循环，则删除资产枚举函数，从枚举函数中返回一个实数组类型。</p><p id="613e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">【https://eips.ethereum.org/EIPS/eip-721 T4】</p><figure class="kz la lb lc fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff ln"><img src="../Images/8b30d7aa1220b0de24edad7b96554d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0VC9MExnbplUU1V7m2TfQ.png"/></div></div></figure><blockquote class="lv"><p id="0ee2" class="lw lx ht bd ly lz ma mb mc md me jn ek translated"><em class="mf">加入Coinmonks </em> <a class="ae lm" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> <em class="mf">电报频道</em> </a> <em class="mf">和</em> <a class="ae lm" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> <em class="mf"> Youtube频道</em> </a> <em class="mf">了解加密交易和投资</em></p></blockquote><h1 id="c377" class="mg jp ht bd jq mh mi mj ju mk ml mm jy mn mo mp kb mq mr ms ke mt mu mv kh mw dt translated">另外，阅读</h1><ul class=""><li id="7ab7" class="kj kk ht is b it kl ix km jb kn jf ko jj kp jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/p2p-crypto-exchanges-in-india" rel="noopener ugc nofollow" target="_blank">印度最佳P2P加密交易所</a> | <a class="ae lm" href="https://coincodecap.com/baby-shiba-inu-wallets" rel="noopener ugc nofollow" target="_blank">柴犬钱包</a></li><li id="9c3f" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/crypto-affiliate-programs" rel="noopener ugc nofollow" target="_blank">8大加密附属计划</a> | <a class="ae lm" href="https://coincodecap.com/etoro-vs-coinbase" rel="noopener ugc nofollow" target="_blank"> eToro vs比特币基地</a></li><li id="4b17" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/best-ethereum-wallets" rel="noopener ugc nofollow" target="_blank">最佳以太坊钱包</a> | <a class="ae lm" href="https://coincodecap.com/telegram-crypto-bots" rel="noopener ugc nofollow" target="_blank">电报上的加密货币机器人</a></li><li id="61f7" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/leveraged-token-exchanges" rel="noopener ugc nofollow" target="_blank">交易杠杆代币的最佳交易所</a></li><li id="d83c" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/blockchain-analytics" rel="noopener ugc nofollow" target="_blank">最佳加密分析或链上数据</a> | <a class="ae lm" href="https://coincodecap.com/bexplus-review" rel="noopener ugc nofollow" target="_blank"> Bexplus评论</a></li><li id="3862" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/nft-marketplaces" rel="noopener ugc nofollow" target="_blank">NFT十大市场造币集锦</a></li><li id="94f0" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/ascendex-staking" rel="noopener ugc nofollow" target="_blank">AscendEx Staking</a>|<a class="ae lm" href="https://coincodecap.com/bot-ocean-review" rel="noopener ugc nofollow" target="_blank">Bot Ocean Review</a>|<a class="ae lm" href="https://coincodecap.com/bitcoin-wallets-india" rel="noopener ugc nofollow" target="_blank">最佳比特币钱包</a></li><li id="74e1" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/bitget-review" rel="noopener ugc nofollow" target="_blank"> Bitget评论</a> | <a class="ae lm" href="https://coincodecap.com/gemini-vs-blockfi" rel="noopener ugc nofollow" target="_blank">双子星vs BlockFi </a> | <a class="ae lm" href="https://coincodecap.com/okex-futures-trading" rel="noopener ugc nofollow" target="_blank"> OKEx期货交易</a></li><li id="c421" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/crypto-trading-bots-in-the-us" rel="noopener ugc nofollow" target="_blank">美国最佳加密交易机器人</a> | <a class="ae lm" href="https://coincodecap.com/changelly-review" rel="noopener ugc nofollow" target="_blank">经常性评论</a></li><li id="e8bc" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/crypto-arbitrage-in-india" rel="noopener ugc nofollow" target="_blank">在印度利用加密套利赚取被动收入</a></li><li id="da87" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/huobi-review" rel="noopener ugc nofollow" target="_blank">霍比评论</a> | <a class="ae lm" href="https://coincodecap.com/okex-margin-trading" rel="noopener ugc nofollow" target="_blank"> OKEx保证金交易</a> | <a class="ae lm" href="https://coincodecap.com/futures-trading" rel="noopener ugc nofollow" target="_blank">期货交易</a></li><li id="ef88" class="kj kk ht is b it ku ix kv jb kw jf kx jj ky jn mx kr ks kt dt translated"><a class="ae lm" href="https://coincodecap.com/sparrow-exchange-review" rel="noopener ugc nofollow" target="_blank">麻雀交换评论</a> | <a class="ae lm" href="https://coincodecap.com/nash-exchange-review" rel="noopener ugc nofollow" target="_blank">纳什交换评论</a></li></ul></div></div>    
</body>
</html>