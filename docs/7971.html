<html>
<head>
<title>Web3 onboarding as a service: technical details</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Web3 onboarding as a service:技术细节</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/web3-onboarding-as-a-service-technical-details-f9f19b8daba5?source=collection_archive---------14-----------------------#2022-06-03">https://medium.com/coinmonks/web3-onboarding-as-a-service-technical-details-f9f19b8daba5?source=collection_archive---------14-----------------------#2022-06-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="4108" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<a class="ae jo" rel="noopener" href="/@szmizorsz/cfbb70fa9d54">的第一篇文章</a>中，我们详细介绍了应用背后的动机和用例。在本文中，我们将更深入地探讨技术。您可以通过检查代码来跟踪文章:查看<a class="ae jo" href="https://github.com/szmizorsz/w3oas" rel="noopener ugc nofollow" target="_blank">应用程序</a>和<a class="ae jo" href="https://github.com/szmizorsz/w3oas-contracts" rel="noopener ugc nofollow" target="_blank">合同</a>，并使用<a class="ae jo" href="https://w3oas.vercel.app/" rel="noopener ugc nofollow" target="_blank">应用程序</a>。</p><p id="381c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">说到技术，以下是基本的技术决策:</p><ul class=""><li id="59b7" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated"><a class="ae jo" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> Typescript </a>:相比javascript，我更喜欢Typescript，尤其是当它与一些类型和代码生成工具一起使用时，比如<a class="ae jo" href="https://www.graphql-code-generator.com/" rel="noopener ugc nofollow" target="_blank"> GraphQL代码生成器</a>。当应用程序变得更大时，打字真的很重要。例如:你必须进行实体级的重构，其结果会泄露到应用程序的许多部分。在这种情况下，类型安全可以提前捕捉许多错误，这只是一个例子。</li><li id="6245" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a> : Next.js是一个React框架，它为您提供了创建web应用程序的构建块。它为您提供了服务器端渲染、静态站点生成、搜索引擎优化等等…例如，它附带了一个后端，我们可以广泛地使用它来创建我们的自定义端点。</li><li id="e00e" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://next-auth.js.org/" rel="noopener ugc nofollow" target="_blank"> Next-auth </a>:是Next.js的认证框架，我们用来实现oauth discord认证流程，定制相对简单。</li><li id="c33a" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://hasura.io/" rel="noopener ugc nofollow" target="_blank"> Hasura graphql引擎</a>:在基于实体的类型是应用程序的本质的环境中，我更喜欢graphql查询而不是REST API调用。基于关系数据库的应用程序就是这种情况。</li><li id="0ff4" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> Postgres </a> : Hasura是和Postgres一起开箱的。</li><li id="5f2e" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">Polygon :由于Polygon是目前最流行的扩展解决方案，我们希望我们的onboarding服务又快又便宜，这是一个自然的选择。</li><li id="49bb" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://web3auth.io/" rel="noopener ugc nofollow" target="_blank"> Web3auth </a> : web3auth让用户的入职流程变得轻量级。他们不必为创建钱包、私钥管理和备份而烦恼。他们只需使用他们的社交网站登录，生成的钱包将存储在Torus网络的不同区块中。所有的块都只能由所有者访问，而不能由环面网络中的节点提供者访问，所以它被安全地存储。Web3auth是广泛采用web3的基础设施的重要组成部分。</li><li id="bf11" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank">安全帽</a>:这是EVM兼容智能合约最流行的开发环境。</li><li id="e4ee" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://www.openzeppelin.com/" rel="noopener ugc nofollow" target="_blank"> Openzeppelin </a>，ERC1155:实现标准的事实上的智能契约库。在我们的案例中，我们建立在erc1155标准之上。</li><li id="2c16" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">open zeppelin Defender Relay:Defender Relay服务允许您通过常规的HTTP API发送交易，并负责私钥安全存储、交易签名、随机数管理、汽油价格估计和重新提交。这是为用户创建元事务的完美解决方案，否则会很复杂。因此，他们不必为购买Matic和签署交易来申请他们的NFT而烦恼。这就是第一次web3体验变得像使用普通web2应用一样流畅的原因。</li></ul><p id="9692" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">让我们详细介绍一些用户流程</strong></p><p id="18e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1.认证流程</p><p id="d88f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">身份验证流程基于next-auth的JWT身份验证流程，具有以下定制:</p><ul class=""><li id="e39c" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">登录被委托给不一致oauth认证</li><li id="86f7" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">一旦用户登录，就会在w3oas DB中创建或更新一个用户记录，其中包含来自discord的用户数据:用户名、电子邮件、头像等</li><li id="82fe" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">next-auth提供的会话用以下信息扩展:<br/> -用户记录id <br/> -用户的不一致服务器:表示用户是特定服务器的所有者或成员<br/> - Hasura声明:相同的JWT令牌用于对Hasura的认证，但它需要一些特定的声明存在<br/> - JWT令牌:也用于对w3oas后端和Hasura的认证</li></ul><figure class="ke kf kg kh fq ki fe ff paragraph-image"><div class="fe ff kd"><img src="../Images/efb43f76429425de0297b7ce20aef2b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*iL1d5dxH8eWn53pUstbQcQ.png"/></div></figure><p id="abe7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如您所见，认证不涉及任何web3特定的部分。钱包连接是一个完全独立的流程。</p><p id="6921" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.社区创建流程</p><p id="44a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">社区创建非常简单:</p><ul class=""><li id="450d" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">用户的discord服务器已经在会话中可用</li><li id="2b5c" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">他可以选择自己拥有的、尚未注册为w3oas社区的社区</li><li id="a01f" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">指定社区的属性后，它被保存到w3oas数据库中</li><li id="2f07" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">所以w3oas社区记录是它们对应的discord服务器的一个稍微修改的版本。</li></ul><figure class="ke kf kg kh fq ki fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/c8576c2e01a2fcdd0e0e410a930adfb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*kAhIgPaazMiTaKpNAfm9Fg.png"/></div></figure><p id="eac4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3.钱包连接流程</p><p id="dcef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">钱包连接基于web3auth流，完全独立于认证流:</p><ul class=""><li id="b7df" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">一旦通过身份验证，用户可以随时连接或断开钱包</li><li id="c500" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">web3auth流中的Wallet连接取决于连接类型:</li><li id="65e2" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">如果用户已经有一个外部钱包，如metamask或wallet connect，他可以选择使用它</li><li id="a078" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">用户也可以选择使用基于他的社交登录或电子邮件登录的web3auth钱包创建:<br/> -一旦用户通过所选提供商的认证，在Torus网络上创建新的钱包<br/> -重新创建钱包的单独声明由Torus网络上的独立节点提供商持有，并且只有用户可以重新创建他的私钥。没有一个节点提供程序有足够的信息来重新创建密钥。</li><li id="48ba" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">连接或创建钱包后，钱包地址会保存在w3oas数据库的用户记录中，以备后用，例如NFT空投</li></ul><figure class="ke kf kg kh fq ki fe ff paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="fe ff km"><img src="../Images/07a662cd2a1508e83f4ae81cca87cc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tk1x-YMfFptYteBCKBJvxw.png"/></div></div></figure><p id="f498" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4.社区NFT合同部署</p><p id="43a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">社区NFT合同部署作为一项服务提供给社区所有者。因此，它是免费和无气的体验与以下流程:</p><ul class=""><li id="3af0" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">如果社区还没有NFT合同，则社区所有者启动部署</li><li id="fe7c" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">部署由w3oas后端的专用端点管理。</li><li id="5a54" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">它首先根据JWT对请求进行身份验证。</li><li id="f3f4" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">认证成功后，它连接到Openzeppelin Defender Relayer，后者持有将对部署事务进行签名的私钥</li><li id="f268" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">它通过向Polygon上的“社区NFT工厂”契约发送事务来启动部署。交易由Openzeppelin Defender Relayer中保存的地址签署。在相同的事务中，发生了以下事情:<br/> -部署了新的社区NFT契约，其是ERC1155契约<br/> -用tokenId = 1创建了成员资格NFT<br/>-发起事务的社区所有者通过向其地址发布tokenId = 1的数量= 1，自动获得其成员资格NFT</li><li id="8bfd" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">一旦创建了新的契约，地址就会保存到社区的w3oas DB中。</li><li id="1adb" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">整个流程成功后，用户会得到适当的反馈。</li></ul><figure class="ke kf kg kh fq ki fe ff paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="fe ff kr"><img src="../Images/84de0ce6f7b5d5d7f6397dad0aabaef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AyIgCNz7Ukzl_4z4uNSzsA.png"/></div></div></figure><p id="a14a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5.要求加入NFT</p><p id="5266" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">会员NFT索赔非常类似于社区NFT合同部署。它也是一种服务，免费和无汽油的体验，其流程如下:</p><ul class=""><li id="b5d8" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">如果会员附上了他的钱包，他可以发起索赔</li><li id="c269" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">该声明由w3oas后端的专用端点管理。</li><li id="404a" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">它首先根据JWT对请求进行身份验证。</li><li id="e80a" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">认证成功后，它连接到Openzeppelin Defender Relayer，后者持有将对部署事务进行签名的私钥</li><li id="b440" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">它通过向Polygon上的社区NFT合同发送一个事务来启动索赔。交易由Openzeppelin Defender Relayer中保存的地址签署。</li><li id="35c4" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">交易成功或失败后，用户会得到相应的反馈。</li></ul><figure class="ke kf kg kh fq ki fe ff paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="fe ff kr"><img src="../Images/2b8258759e7a9f3594749a533fb8b3c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2itD5hGDcF36MrThaHFhg.png"/></div></div></figure><p id="2dd5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">开发者体验</strong></p><p id="191d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在web2和web3这两个方面，花一些时间在开发者体验上是值得的。</p><p id="a8ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在web2开发者体验中，最大的附加值是Hasura和<a class="ae jo" href="https://www.graphql-code-generator.com/" rel="noopener ugc nofollow" target="_blank"> GraphQL代码生成器</a>。从模式和实体定义到前端的类型和使用查询挂钩，使用这些工具，整个过程变得非常流畅和快速。让我们来看看细节:<br/> 1。只需点击几下鼠标，就可以在Hasura控制台上定义实体和模式修改。<br/> 2。Hasura自动生成迁移和元数据更改文件，稍后可以应用这些文件来构建相同的模式。这是一个类似Liquidbase的数据库模式管理解决方案。<br/> 3。Hasura有一个内置的graphql编辑器，可以让我们编写graphql查询。<br/> 4。从schema和graphql查询中，在GrahpQL代码生成器的帮助下，我们可以生成类型、类型化的useQuery钩子，以及使在前端使用typescript和生成的钩子变得容易的一切:为查询、查询变量、查询结果等分离文档类型。如果我们注意graphql查询中的字段片段，那么我们可以很容易地将查询结果分成子部分，并将它们传递给不同的UI组件，因此访问嵌套类型不会变得很麻烦。我真的推荐使用这个工具，并深入了解如何以正确的方式使用它。<br/>使用这些工具，将一个特征从模型创建发布到用户界面的过程变得更加快速和流畅。</p><p id="bdf8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过Hardhat生成的输入，web3开发人员的体验也变得更加流畅。我真的推荐使用它，从测试和脚本中的类型安全智能契约交互，到类型安全配置。生成的类型在应用程序的其他层也变得有用，如后端和前端，它们可以以类型安全的方式与契约交互。</p><p id="842e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有一件事我没有花时间去解决并使我的web2和web3开发人员体验更好，那就是找到一种适当的方法来与w3oas应用程序共享从契约中生成的类型。合同与应用程序本身有不同的存储库，所以每当我更改合同并重新生成类型时，我必须手动将类型从一个repo复制到另一个repo。解决这个问题的一个方法是创建一个monorepository，其中契约和应用程序都有自己的包，应用程序可以将契约声明为依赖项。</p><p id="f500" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">某种技术深度</strong></p><p id="5c81" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我想花点时间讲讲我们刚开始学习web3时在教程中通常找不到的东西。我非常支持关注点分离和单一责任原则。因此，与任何其他逻辑一样，web3交互可以提取到它们自己的实用程序中。</p><ol class=""><li id="a73d" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ks jv jw jx dt translated">例如，获取一个web3提供者通常被嵌入到一个组件中。我认为最好创建一个单独的上下文，并将每一个与web3提供商相关的逻辑嵌入其中。在w3oas应用程序中，<a class="ae jo" href="https://github.com/szmizorsz/w3oas/blob/develop/src/components/Web3Provider.tsx" rel="noopener ugc nofollow" target="_blank"> web3provider context </a>具有以下接口:</li></ol><pre class="ke kf kg kh fq kt ku kv kw aw kx dt"><span id="a051" class="ky kz ht ku b fv la lb l lc ld">export interface IWeb3Context {<br/>  web3Provider: ethers.providers.Web3Provider | null<br/>  web3Loading: boolean<br/>  connectWallet: () =&gt; Promise&lt;string[] | undefined&gt;<br/>  disconnectWallet: () =&gt; Promise&lt;void&gt;<br/>  getUserInfo: () =&gt; Promise&lt;void&gt;<br/>  getAccounts: () =&gt; Promise&lt;string[] | undefined&gt;<br/>}</span></pre><p id="724c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">web3Provider是对区块链连接的通常(ethers.provider)抽象。</p><p id="f518" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这些函数管理连接。connectWallet函数包含web3auth连接部分:</p><pre class="ke kf kg kh fq kt ku kv kw aw kx dt"><span id="3784" class="ky kz ht ku b fv la lb l lc ld">const connectWallet = async () =&gt; {<br/>    if (!web3AuthInstance) {<br/>      console.log('web3auth not initialized yet')<br/>      return<br/>    }<br/>    const provider = await web3AuthInstance.connect()<br/>    if (!provider) {<br/>      console.log('web3provider not initialized')<br/>      return<br/>    }<br/>    const web3ProviderFromWeb3Auth = new ethers.providers.Web3Provider(provider)<br/>    const accounts = await web3ProviderFromWeb3Auth.listAccounts()<br/>    setWeb3Provider(web3ProviderFromWeb3Auth)<br/>    return accounts<br/>  }</span></pre><p id="eea2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">web3AuthInstance.connect()打开web3 auth对话框，并向用户演示钱包连接步骤。</p><p id="49e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，在我们的应用程序中，web3provider被用作任何其他提供者和上下文:</p><pre class="ke kf kg kh fq kt ku kv kw aw kx dt"><span id="3205" class="ky kz ht ku b fv la lb l lc ld">function MyApp({ Component, pageProps }: AppProps) {<br/>  return (<br/>    &lt;ChakraProvider&gt;<br/>      &lt;SessionProvider session={pageProps.session} refetchInterval={0}&gt;<br/>        &lt;Web3Provider&gt;<br/>          &lt;ApolloProviderWithAuth&gt;<br/>            &lt;Component {...pageProps} /&gt;<br/>          &lt;/ApolloProviderWithAuth&gt;<br/>        &lt;/Web3Provider&gt;<br/>      &lt;/SessionProvider&gt;<br/>    &lt;/ChakraProvider&gt;<br/>  )<br/>}</span></pre><p id="1365" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.web3连接按钮也配有自己的<a class="ae jo" href="https://github.com/szmizorsz/w3oas/blob/develop/src/components/web3Button.tsx" rel="noopener ugc nofollow" target="_blank">组件</a>。它封装了上面描述的钱包连接流。它建立在web3提供者上下文中的connectWallet和disconnectWallet函数的基础上，并管理DB中的钱包地址持久性。</p><p id="6615" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3.契约连接逻辑也应该有自己独立的钩子:</p><pre class="ke kf kg kh fq kt ku kv kw aw kx dt"><span id="84ec" class="ky kz ht ku b fv la lb l lc ld">export default function useCommunityNftContract(<br/>  address: string | null | undefined,<br/>  signer?: ethers.providers.JsonRpcSigner<br/>) {<br/>  const [communityNftcontract, setCommunityNftContract] =<br/>    useState&lt;CommunityNFT | null&gt;(null)</span><span id="1a40" class="ky kz ht ku b fv le lb l lc ld">useEffect(() =&gt; {<br/>    ;(async () =&gt; {<br/>      if (!process.env.NEXT_PUBLIC_RPC_TARGET || !address) {<br/>        return<br/>      }</span><span id="660d" class="ky kz ht ku b fv le lb l lc ld">const signerOrProvider =<br/>        signer ||<br/>        new ethers.providers.JsonRpcProvider(process.env.NEXT_PUBLIC_RPC_TARGET)</span><span id="2dba" class="ky kz ht ku b fv le lb l lc ld">const contract = CommunityNFT__factory.connect(address, signerOrProvider)</span><span id="79db" class="ky kz ht ku b fv le lb l lc ld">setCommunityNftContract(contract)<br/>    })()<br/>  }, [signer, address])</span><span id="ac6c" class="ky kz ht ku b fv le lb l lc ld">return communityNftcontract<br/>}</span></pre><p id="d435" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">从组件获取契约连接变得很容易理解:</p><pre class="ke kf kg kh fq kt ku kv kw aw kx dt"><span id="583d" class="ky kz ht ku b fv la lb l lc ld">const communityNftContract = useCommunityNftContract(<br/>    communityNftContractAddress<br/>  )</span></pre><p id="69ac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当你在一个专业的web3项目中时，这些事情可能是显而易见的，但是当你试图学习web3概念和实现模式时就不那么明显了。</p><p id="7d69" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有两个新的库可以取代这些自己的组件和挂钩:</p><ul class=""><li id="5655" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">wag mi:React钩子的集合，用于契约交互、钱包连接等。</li><li id="b735" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">RainbowKit :一个<a class="ae jo" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>库，可以很容易地将钱包连接添加到你的dapp。</li></ul><p id="8bc1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">托管环境</strong></p><p id="fa02" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">应用程序托管在以下基于分布式云服务的环境中:</p><ul class=""><li id="9cc4" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">哈苏拉云</li><li id="dd52" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">Heroku postgres数据库</li><li id="23de" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">Vercel for Next.js</li><li id="c0b2" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">Matic孟买测试网</li><li id="02c2" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">契约阅读RPC连接:炼金术</li><li id="c203" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">交易(合同撰写):Openzeppelin Defender Relayer项目</li><li id="bb77" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">Web3auth项目</li></ul><p id="e6df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您想在本地开发环境中运行它:</p><ul class=""><li id="2a01" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">Hasura + Postgres与<a class="ae jo" href="https://github.com/szmizorsz/w3oas/blob/develop/docker-compose.yml" rel="noopener ugc nofollow" target="_blank"> Docker构成</a></li><li id="c865" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">Next.js本地web服务器:npm运行开发</li><li id="beb4" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">安全帽局域网</li></ul><p id="d130" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">结论</strong></p><p id="bd0d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有时候不容易找到比教程级别更高级的技术模板。在github repos中搜索著名项目是可能的，但是它们可能太复杂了。我希望通过w3oas平台的这些低复杂度用例，我可以给你一些提示或者至少一些启发。</p><blockquote class="lf"><p id="3ee5" class="lg lh ht bd li lj lk ll lm ln lo jn ek translated">加入Coinmonks <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="06cb" class="lp kz ht bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml dt translated">另外，阅读</h1><ul class=""><li id="fc38" class="jp jq ht is b it mm ix mn jb mo jf mp jj mq jn ju jv jw jx dt translated"><a class="ae jo" href="https://coincodecap.com/what-are-decentralized-exchanges" rel="noopener ugc nofollow" target="_blank">分散交易所</a> | <a class="ae jo" href="https://coincodecap.com/bitbns-fip" rel="noopener ugc nofollow" target="_blank">比特FIP </a> | <a class="ae jo" href="https://coincodecap.com/bingbon-review" rel="noopener ugc nofollow" target="_blank">宾邦评论</a></li><li id="1f2d" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">用信用卡购买密码的10个最佳地点</li><li id="192b" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://coincodecap.com/5-best-crypto-trading-bots-in-canada" rel="noopener ugc nofollow" target="_blank">加拿大最佳加密交易机器人</a> | <a class="ae jo" href="https://coincodecap.com/bybit-binance-moonxbt" rel="noopener ugc nofollow" target="_blank"> Bybit vs币安</a></li><li id="c58a" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://coincodecap.com/best-crypto-exchanges-in-uae" rel="noopener ugc nofollow" target="_blank">阿联酋5大最佳加密交易所</a> | <a class="ae jo" href="https://coincodecap.com/simpleswap-review" rel="noopener ugc nofollow" target="_blank"> SimpleSwap评论</a></li><li id="e00f" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">购买Dogecoin的7种最佳方式 | <a class="ae jo" href="https://coincodecap.com/zebpay-review" rel="noopener ugc nofollow" target="_blank"> ZebPay评论</a></li><li id="0123" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://coincodecap.com/futures-trading-signals" rel="noopener ugc nofollow" target="_blank">最佳期货交易信号</a> | <a class="ae jo" href="https://coincodecap.com/liquid-exchange-review" rel="noopener ugc nofollow" target="_blank">流动性交易回顾</a></li><li id="d0a2" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">【Huobi的加密交易信号 | <a class="ae jo" rel="noopener" href="/coinmonks/swapzone-review-crypto-exchange-data-aggregator-e0ad78e55ed7"> Swapzone审查</a></li></ul></div></div>    
</body>
</html>