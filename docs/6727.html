<html>
<head>
<title>Fortress attack event analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">堡垒攻击事件分析</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/fortress-attack-event-analysis-bd30157e7dc9?source=collection_archive---------25-----------------------#2022-05-13">https://medium.com/coinmonks/fortress-attack-event-analysis-bd30157e7dc9?source=collection_archive---------25-----------------------#2022-05-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="8667" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">0x01事件背景</h2></div><p id="cc83" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">2022年5月9日堡垒贷款遇袭。Fortress是一个基于BSC的分散金融借贷和稳定协议。目前该项目已损失约1048.1 ETH，40万DAI(总价值约298万美元)。</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/8c833b2282b86b5808145cc83e1f0f40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*CHzspH62746BMnvhF9MDQQ.png"/></div></figure><h2 id="18fa" class="km kn ht bd ko kp kq kr ks kt ku kv kw jr kx ky kz jv la lb lc jz ld le lf lg dt translated">0x02攻击信息</h2><ul class=""><li id="3e6d" class="lh li ht jk b jl lj jo lk jr ll jv lm jz ln kd lo lp lq lr dt translated">攻击者的主要利用交易</li></ul><p id="30f3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">0x13d 19809 b 19 AC 512 da 6d 6d 110764 caee 75 e 2157 ea 62 CB 70937 c 8d 9471 afcb 061 BF</p><ul class=""><li id="9e9d" class="lh li ht jk b jl jm jo jp jr ls jv lt jz lu kd lo lp lq lr dt translated">攻击者的主要利用交易</li></ul><p id="2b61" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">0 xa 6 af 2872176320015 F8 DDB 2 ba 013 b 38 CB 35d 22 ad</p><ul class=""><li id="68dd" class="lh li ht jk b jl jm jo jp jr ls jv lt jz lu kd lo lp lq lr dt translated">攻击者创建的合同地址</li></ul><p id="7f82" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">0x CD 337 b 920678 cf 35143322 ab 31 ab 8977 c 3463 a 45(自毁)</p><p id="0f83" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">0x 0 db 3 b 68 c 482 b 04 c 49 CD 64728 ad 5d 6d 9 a 7 b 8 e 43 e 6((提案与表决工具合同)</p><p id="9abb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">0x 39 e 7 fc 9 f 6565 c 68104 b 01689 fcf 0487 afbf 06656(攻击者预先测试的工具契约)</p><ul class=""><li id="d81a" class="lh li ht jk b jl jm jo jp jr ls jv lt jz lu kd lo lp lq lr dt translated">Oracle相关合同地址</li></ul><p id="a604" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">0xc 11 b 687 CD 6061 a 6516 e 23769 e 4657 b 6 EFA 25d 78 e</p><ul class=""><li id="19d6" class="lh li ht jk b jl jm jo jp jr ls jv lt jz lu kd lo lp lq lr dt translated">与治理相关的合同地址</li></ul><p id="f7e6" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">0 xe 79 ecdb 7 fedd 413 e 697 f 083982 BAC 29 e 93d 86 B2 e</p><h2 id="0757" class="km kn ht bd ko kp kq kr ks kt ku kv kw jr kx ky kz jv la lb lc jz ld le lf lg dt translated">0x03攻击分析</h2><ol class=""><li id="2bb4" class="lh li ht jk b jl lj jo lk jr ll jv lm jz ln kd lv lp lq lr dt translated">攻击者通过PancakeSwap: Router v2用大约11.126个ETH交换了大约400413.3278个FTS令牌</li></ol><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lw"><img src="../Images/a081817a4e98e11f73109bb9e0de42c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXnAJaQRINvHpeVAHFWEjA.png"/></div></div></figure><p id="3d1d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">2.攻击者在正式攻击前进行了大量的测试，向要塞总督阿尔法发起了恶意提案№11(更改贷款合同中FTS令牌的抵押系数)，然后攻击者用兑换的FTS令牌对自己的提案投了赞成票。同时，将FTS代币存入借款合同作为抵押。</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mb"><img src="../Images/574ced14221acc28d8c8f658cea6c2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75aB95E66VmqTvE7MvGtlg.png"/></div></div></figure><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mc"><img src="../Images/ffd37bafb3483f7eb3d5ea81f19a247e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jgk4F4qGdqkPo603exKDJw.png"/></div></div></figure><p id="4ed0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">3.提案通过后，攻击者使用攻击契约执行提案，并使用oracle相关契约中的<strong class="jk hu"> submit() </strong>函数更新贷款契约使用的价格。通过更新抵押系数，攻击者的抵押品(FTS)的价值被改变。大幅增长；</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff md"><img src="../Images/09b3b61b17f888bfed13cd36fe681c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*8cu-LBIJU9RrbyWEk2x-YA.png"/></div></figure><p id="28ae" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">4.攻击者使用FTS令牌交换大量其他令牌，并最终将所有其他令牌转换为ETH和DAI令牌。</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff me"><img src="../Images/4a7e95c3a8986e10d43c2c4067e5d58e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVzFDQhnrKCuVSz4WmyDKw.png"/></div></div></figure><h2 id="564e" class="km kn ht bd ko kp kq kr ks kt ku kv kw jr kx ky kz jv la lb lc jz ld le lf lg dt translated">0x04漏洞详细信息</h2><p id="8514" class="pw-post-body-paragraph ji jj ht jk b jl lj iu jn jo lk ix jq jr mf jt ju jv mg jx jy jz mh kb kc kd hm dt translated">通过对攻击交易的分析可以看出，攻击者通过治理契约执行恶意提议，通过恶意提议篡改了堡垒贷款项目中价格甲骨文的相关参数，导致FTS币价格暴涨，最终获利；</p><p id="8974" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">恶意提案的成功执行是由于Fortress Loans使用的治理合同中存在设计缺陷；根据治理契约源代码中的相关配置(同意提案的最低票数)小于攻击者持有的数量，提案通过。</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff me"><img src="../Images/4a7e95c3a8986e10d43c2c4067e5d58e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVzFDQhnrKCuVSz4WmyDKw.png"/></div></div></figure><p id="72be" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">成功投票所需的最低FTS令牌为40万，但由于FTS令牌价格低廉，攻击者仅用约11 ETH换取了40多万FTS令牌。</p><p id="062e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">通过分析oracle contract的源代码，可以发现用于更新价格的<strong class="jk hu"> submit() </strong>函数可以被任何角色调用，如下所示:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mi"><img src="../Images/9e5ec1f89699c29462fcb477388fd673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJ2x33uP3UObRPuscvNVdw.png"/></div></div></figure><p id="b375" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">①仅验证签名的数量，但不判断在②获得的签名地址的有效性，从而可以使用任意数量的地址签名来绕过。③必要的验证语句被注释掉，所以不验证票数。这些问题共同导致了任何人都可以调用的提交函数。</p><h2 id="69db" class="km kn ht bd ko kp kq kr ks kt ku kv kw jr kx ky kz jv la lb lc jz ld le lf lg dt translated">0x05总结</h2><p id="bf56" class="pw-post-body-paragraph ji jj ht jk b jl lj iu jn jo lk ix jq jr mf jt ju jv mg jx jy jz mh kb kc kd hm dt translated">根据此次攻击事件，安全风险是链条上治理相关函数的设计缺陷，oracle契约中更新价格的函数可以任意调用。从攻击者的交易可以看出，攻击者蓄谋已久，一个月前甚至更早就开始测试项目。制造了一系列攻击契约或者攻击辅助契约，主攻击契约在完成攻击后自毁，攻击的利润也通过<strong class="jk hu"> cBridge </strong> ( <strong class="jk hu"> Celer </strong>网络)等跨链桥转移到以太坊。系列中的后续交易被发送到Tornado Cash mixer。</p><blockquote class="mj"><p id="039f" class="mk ml ht bd mm mn mo mp mq mr ms kd ek translated">加入Coinmonks <a class="ae mt" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae mt" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="c1ae" class="mu kn ht bd ko mv mw mx ks my mz na kw iz nb ja kz jc nc jd lc jf nd jg lf ne dt translated">另外，阅读</h1><ul class=""><li id="f88d" class="lh li ht jk b jl lj jo lk jr ll jv lm jz ln kd lo lp lq lr dt translated"><a class="ae mt" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae mt" href="https://coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a> | <a class="ae mt" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="7c44" class="lh li ht jk b jl nf jo ng jr nh jv ni jz nj kd lo lp lq lr dt translated"><a class="ae mt" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">莱杰vs Ngrave </a> | <a class="ae mt" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">莱杰nano s vs x </a> | <a class="ae mt" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="1619" class="lh li ht jk b jl nf jo ng jr nh jv ni jz nj kd lo lp lq lr dt translated"><a class="ae mt" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit Exchange审查</a> | <a class="ae mt" href="https://coincodecap.com/bityard-reivew" rel="noopener ugc nofollow" target="_blank"> Bityard审查</a> | <a class="ae mt" href="https://coincodecap.com/jet-bot-review" rel="noopener ugc nofollow" target="_blank"> Jet-Bot审查</a></li><li id="2ee1" class="lh li ht jk b jl nf jo ng jr nh jv ni jz nj kd lo lp lq lr dt translated"><a class="ae mt" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203">3 commas vs Cryptohopper</a>|<a class="ae mt" rel="noopener" href="/coinmonks/earn-crypto-interest-b10b810fdda3">赚取加密利息</a></li><li id="f781" class="lh li ht jk b jl nf jo ng jr nh jv ni jz nj kd lo lp lq lr dt translated">最好的比特币<a class="ae mt" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a> | <a class="ae mt" rel="noopener" href="/coinmonks/bitbox02-review-your-swiss-bitcoin-hardware-wallet-c36c88fff29"> BitBox02回顾</a></li></ul></div></div>    
</body>
</html>