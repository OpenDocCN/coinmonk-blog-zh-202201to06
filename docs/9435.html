<html>
<head>
<title>How to manage randomness on a Blockchain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何管理区块链上的随机性</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/batman-flips-a-coin-on-blockchain-9d1a818d094e?source=collection_archive---------16-----------------------#2022-06-27">https://medium.com/coinmonks/batman-flips-a-coin-on-blockchain-9d1a818d094e?source=collection_archive---------16-----------------------#2022-06-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/5a0a667ccba2f8a45bf0a7bc3c0c1185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3v6BuYYtBeejIkS6"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@obionyeador?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Obi - @pixel6propix</a> on <a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8806" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如果我在区块链上实现一个掷硬币游戏会怎么样？我需要的第一件事是确定掷硬币结果的随机性来源。</p><p id="047e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">问题来了，我们如履薄冰！</p><p id="d1a1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我可能会尝试使用智能合约中的函数来实现这一点，但这是不可能的，因为区块链上的事务需要内在的确定性。</p><p id="3b0c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">智能协定必须是确定性的，因为当给一个方法相同的输入时，网络上的每个节点必须能够产生相同的结果。如果不同节点的智能契约执行给出不同的输出，则永远无法达成共识。</p><p id="079c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">非决定论导致共识失败。</p><p id="f73e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">所以，随机性的来源必然来自链外。</p><p id="b42c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在这方面，可以采取一些办法。最著名的有:</p><ul class=""><li id="4531" class="ke kf ht ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">提交并揭示</li><li id="cb5a" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">可信的oracle</li><li id="012b" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">使用块哈希</li></ul><p id="18f7" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">哪种方式最有效取决于安全需求和环境。</p></div><div class="ab cl ks kt hb ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hm hn ho hp hq"><h1 id="a965" class="kz la ht bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">提交并揭示</h1><p id="1053" class="pw-post-body-paragraph jg jh ht ji b jj lx jl jm jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd hm dt translated">它是如何工作的？</p><p id="7a57" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">别担心，这不是另一个鲍勃和爱丽丝的故事，而是一个奇妙的蝙蝠侠和罗宾的故事。</p><p id="13fd" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在这个故事中，蝙蝠侠挑战罗宾猜硬币的结果。罗宾做了一个猜测，并把结果放进了保险箱。然后他把封闭的保险箱送给蝙蝠侠。现在，罗宾不能改变保险箱里的结果，因为保险箱在蝙蝠侠手里。蝙蝠侠不能打开保险箱看结果，他必须掷硬币。蝙蝠侠把掷硬币的结果告诉罗宾。罗宾现在把密码发给蝙蝠侠，让他打开保险箱，并验证猜测。</p><p id="8ce3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在这种情况下，罗宾是一个快乐的蝙蝠侠助手。</p><figure class="md me mf mg fq iu fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/0e8f78e7532bdf33884407a6f2468d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*1zPkHor--IAhyR_dtCcnQA.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Commit Reveal in Gotham</figcaption></figure><p id="9bae" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">从技术上来说，玩家必须提交他的选择，但不要透露出来，而是以一种事后可以验证的方式。<br/>玩家(Robin)用一个只有他自己知道的salt散列这个猜测，并将散列提交给一个智能合约。以这种方式，他提交了猜测而没有透露它。<br/>“房子”(蝙蝠侠)抛硬币，并将结果存储在智能合约存储器中。<br/>现在玩家要通过发布“头”和他用来智能契约的盐来透露他的猜测。<br/>契约可以计算散列，然后检查它是否与先前提交的散列匹配，因此它是有效的提交。如果猜对了，合同会把他的赢款发给玩家。</p><figure class="md me mf mg fq iu fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/6c3f7e56609c2aa6cca379fc23e4d4b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*isWoo1PLfHRehcyR8Rs5Rw.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Commit Reveal on a Blockchain</figcaption></figure><p id="5682" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是承诺方案的简化版本，因此我们不需要处理“最后的启示者问题”。然而，必须实施一种管理“惩罚”的方法。如果“房子”从来不透露抛硬币的结果怎么办？有一个时间间隔，在此之后，合同允许玩家无论如何提取奖金？</p><p id="a675" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这里的最后一点是，随机性是由房子赋予的，你必须相信它，否则它看起来就像一个“奇偶游戏”，而不仅仅是一个抛硬币游戏。</p></div><div class="ab cl ks kt hb ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hm hn ho hp hq"><h1 id="03a2" class="kz la ht bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">可信的Oracle</h1><p id="9a81" class="pw-post-body-paragraph jg jh ht ji b jj lx jl jm jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd hm dt translated">在这个故事中，我们有小丑在“房子”的角色，罗宾在玩家的角色，蝙蝠侠在神谕的角色。蝙蝠信号是代表区块链交易的一种方式。小丑向罗宾挑战掷硬币游戏，但罗宾不信任小丑打算掷的硬币，他只信任蝙蝠侠的硬币。所以他公开宣称自己的猜测，并用蝙蝠信号告诉蝙蝠侠抛硬币。蝙蝠侠抛硬币，用蝙蝠信号，每个人都可以看到，显示硬币投掷的结果。</p><p id="526e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">现在小丑必须付钱给快乐幸运的蝙蝠侠助手罗宾。</p><figure class="md me mf mg fq iu fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/ed33c315a0af8222de31c20f7116cf73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*6QcKrqDXoTRRUps4dAt0zA.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Trusted Oracle in Gotham</figcaption></figure><p id="8b41" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">现实世界中的事情是如何运作的？</p><p id="4d51" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">随机性的来源是一种链外服务(例如randomness)，而Oracle合同和Oracle链外基础设施(下图中的应用程序)填补了区块链世界和外部服务之间的差距。Oracle从链外来源检索数据，并在链上传输数据，将其放入智能契约存储中。</p><p id="1a53" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">更详细:<br/> 1)玩家将自己的猜测(人头)存储在一个游戏契约中，<br/> 2)然后，他用Oracle服务需要的所有信息调用Oracle契约，<br/> 3)玩家调用成功包含在block #36中作为Txn3，现在他要等待</p><p id="ad03" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一旦Txn3事务被验证，oracle请求就可以被视为Oracle契约发出的EVM事件或状态变化。</p><p id="9ed2" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一家受信任的公司部署了一个应用程序，该应用程序确切地知道要监控哪些事件和合同，并定期查询区块链。</p><p id="4be8" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">因此，在某个时刻:<br/> 4)找到Txn3，<br/>5)Oracle应用程序离线检索所需数据(在这种情况下，所需数据是随机的掷硬币结果)，<br/>6)Oracle应用程序调用游戏合约上的方法来存储掷硬币结果(真实性证明保证数据未被篡改)，<br/> 7)现在玩家可以检查并最终提取他的奖金。</p><figure class="md me mf mg fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mj"><img src="../Images/d7ca521476e1693f7891f943fa4dd437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HRMXORJlR8FScSSK8qxxQQ.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Trusted Oracle on a Blockchain</figcaption></figure><p id="fd12" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">使用这种方法，不仅要信任提供这种服务的Oracle公司，还要信任服务提供商(在这种情况下是random.org)。此外，Oracle服务不是免费的，此外，您必须为回调方法提供汽油费，并最终获得访问所请求数据的权限。</p><p id="53df" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">其他方案也是可能的；例如，外部应用程序可以直接请求和返回数据，从而无需Oracle智能合约。</p></div><div class="ab cl ks kt hb ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hm hn ho hp hq"><h1 id="1daa" class="kz la ht bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">使用块哈希</h1><p id="014d" class="pw-post-body-paragraph jg jh ht ji b jj lx jl jm jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd hm dt translated">蝙蝠侠再次向罗宾挑战掷硬币游戏。掷硬币的结果来自一个公共抽取，在那里许多人监督并验证其正确性。提取的结果是头。</p><p id="d693" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">罗宾是我见过的最幸运的助手。</p><figure class="md me mf mg fq iu fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/aa1c20d7dd05881762fb1a482ce30b7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*7HE1laPxJSSjPSOsIvhNpw.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Using block hash in Gotham</figcaption></figure><p id="1dcd" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是一个概念，但在区块链的环境中，这个概念如何转化呢？</p><p id="b003" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这里，随机性的来源是由未来的块哈希给出的，因为新块的哈希是不可预测的，并且每个人都可以验证哈希以及基于该哈希的计算的正确性。</p><p id="8d50" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">玩家将其猜测注册到智能合约中，并获得区块链开采的最后一个区块号。现在，他必须等待下一个区块被开采。一旦区块被开采，他可以通过调用智能合同来要求奖金。智能合约检索先前链接到玩家的块散列，计算出它只有两个可能的值(头或尾)，如果结果与猜测匹配，则合约将奖金发送给玩家。</p><p id="0ebf" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如果玩家输了，他总是可以检查没有欺骗，因为他能够检索他已经注册的块散列，并且他知道哪个是对该散列的计算，因为它在智能合约中是公开可用的。</p><figure class="md me mf mg fq iu fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/cabc3c8060fd11e93e53155260c18a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*ofcCTAmM5WDpVam3DKgthQ.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Using block hash on a blockchain</figcaption></figure><p id="75c1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这种方法的主要缺点是矿商可以选择是否发布区块。因此，矿工可以故意丢弃他们不喜欢的块，以这种方式影响块散列。</p><p id="69db" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">当游戏的奖励很小时，矿工没有动机在游戏中作弊，但是如果奖励的金额大于方块奖励，矿工可以考虑扔掉方块，希望找到另一个保证他获胜的人。</p><p id="99b5" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这里要研究的另一点是块散列的随机性。</p><p id="e5a9" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">感谢阅读，我希望你喜欢它！</p></div></div>    
</body>
</html>