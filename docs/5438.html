<html>
<head>
<title>Beanstalk Exploit — A Simplified Post-Mortem Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">豆茎漏洞——简化的事后分析</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/beanstalk-exploit-a-simplified-post-mortem-analysis-92e6cdb17ace?source=collection_archive---------4-----------------------#2022-04-23">https://medium.com/coinmonks/beanstalk-exploit-a-simplified-post-mortem-analysis-92e6cdb17ace?source=collection_archive---------4-----------------------#2022-04-23</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><h1 id="4993" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">前言</h1><p id="09ef" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">建立在以太坊基础上的Beanstalk是一个基于信用的算法stablecoin协议，旨在破坏DeFi和寻租抵押stablecoin市场，<strong class="jq hu">在2022年4月17日周日的一次闪电贷款攻击中损失了1 . 82亿美元</strong>。攻击者能够识别并利用治理设计中的缺陷。它使攻击者能够获得协议的控制权。攻击者耗尽了其资产的流动性池，并带走了7600万美元，BEAN从其1美元的挂钩价格下跌了约75%。如果您是该协议的新手，我强烈建议您在继续之前阅读一下<a class="ae km" rel="noopener" href="/@everythingblockchain/beanstalk-reaping-defi-bean-efits-463dc1e1f9d9">我的文章</a>，这篇文章详细介绍了Beanstalk及其治理机制。在本文中，我将介绍漏洞利用是如何准备的以及它是如何发生的，然后是Beanstalk的回应。所以事不宜迟，让我们深入细节。</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff kn"><img src="../Images/a3e4ac9de3df8e9b3be4165e0191359f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4TgPLWQNpjCYR10Evun_kg.png"/></div></div></figure><h1 id="70a9" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">豆茎漏洞</h1><p id="4e94" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">整个攻击基于一个漏洞，该漏洞使攻击者能够利用协议的多数表决治理系统。简单来说，任何拥有三分之二(绝对多数)选票的个人都可以在任何时候通过BIP。</p><p id="18ec" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated"><a class="ae km" href="https://www.coindesk.com/learn/2021/02/17/what-is-a-flash-loan/" rel="noopener ugc nofollow" target="_blank">快速贷款</a>在DeFi越来越受欢迎，因为它们为个人提供了从套利交易中获利的令人兴奋的机会。然而，DeFi是几个黑客和恶意演员的家，他们利用这些贷款窃取大量的密码。(<em class="le">快速贷款消除了对抵押品的需求，因为初始贷款必须在交易结束时偿还。如果借款人无法保证偿还，则交易失败，从而消除了贷款人的风险</em>。那么攻击者是如何成功的呢？我们将在下一节中讨论这一点。</p><p id="44d3" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">很多人提到这种行为不能被归类为黑客或盗窃，它只是治理设计中一个巨大缺陷的结果。但是，我想补充一点，这是以下几个因素的结合-</p><p id="74ae" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">1.flash Loan——对于攻击者获得Beanstalk的链上治理的多数控制权至关重要。<br/> 2。治理机制emergencyCommit()函数，它允许攻击者立即在链上执行提议。通常，执行一个BIP链至少需要7天时间，但是利用紧急提交功能帮助攻击者绕过了这个时间(执行时需要2/3的共享)</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff lf"><img src="../Images/31ae9052a9d386acd6e335ad9846b9d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kTUuQ4xY-B669p_D.png"/></div></div></figure><p id="1a3f" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">简而言之，攻击者利用快速贷款获得了足够的抵押品，成为了超级多数，通过了BIP，从豆茎农场诈骗了1 . 82亿美元。</p><h1 id="86b5" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">t-1 2022年4月16日</h1><p id="8cfe" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">第一步:<a class="ae km" href="https://etherscan.io/address/0x1c5dcdd006ea78a7e4783f9e6021c32935a10fb4" rel="noopener ugc nofollow" target="_blank">攻击者</a>从龙卷风现金中获得资金，并通过<a class="ae km" href="https://etherscan.io/tx/0x1fb73ec5ed8c25b9ca7c9c3c465ab4bbca8554927094f939d96600271475e101" rel="noopener ugc nofollow" target="_blank">突触桥</a>将其桥接。<br/>第二步:这个动作之后是一个<a class="ae km" href="https://etherscan.io/tx/0xf5a698984485d01e09744e8d7b8ca15cd29aa430a0137349c8c9e19e60c0bb9d" rel="noopener ugc nofollow" target="_blank">存放</a>212，858豆到豆茎仓的相同地址。<br/>步骤3:步骤2有助于生成足够的茎杆(<em class="le">这是产生收益的治理令牌)</em>和种子(<em class="le">既得茎杆</em>)，使攻击者能够创建Beanstalk改进建议(BIP18和BIP19)。</p><p id="b762" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">需要注意的几件事<br/> *BIP18最初是空白的(稍后将详细介绍)<br/> *BIP19被攻击者战略性地命名为InitBip18，其中包含一份经过验证的合同，向乌克兰捐赠25万美元，向提议者捐赠1万美元。</p><h1 id="d5de" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">2022年4月17日登陆日</h1><p id="aea9" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">闪贷对豆茎发起攻击</p><p id="6bda" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated"><a class="ae km" href="https://etherscan.io/tx/0xcd314668aaa9bbfebaf1a0bd2b6553d01dd58899c508d4729fa7311dc5d33ad7" rel="noopener ugc nofollow" target="_blank">闪贷</a>(约美元)用于从Aave获得3.5亿戴、5亿和1.5亿，从Uniswap v2获得3200万比恩，从SushiSwap获得1160万。这些令牌被用来增加曲线池中的流动性，BEAN用于治理投票。因此，攻击者首先使用戴、和生成BEAN3CRV-f来伪造3CRV。然后，在另一个合同中存入3200万美元BEAN和2500万美元来创建新的令牌BEAN3LUSD-f</p><p id="d955" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">接下来，攻击者将上述资产存放在豆秸筒仓中，并获得足够的豆秸和种子，以获得总发行量的70%(<em class="le">LP储户每存放一粒豆获得的种子是豆存款的两倍</em>)。该份额使攻击者能够获得2/3的绝对多数票，并执行emergencyCommit()函数。</p><p id="5870" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">现在，攻击者部署并投票支持了一个伪造的协议改进提案(BIP18)，该提案耗尽了池基金，并将令牌(BEAN/WETH-BEAN LP/BEAN 3 crv-f/BEANLUSD-f)转移给了攻击者。这使得攻击者能够偿还快速贷款，并通过硬币混合工具TornadoCash获得24，830 wet的利润(约7600万美元，剩余的1.06亿美元用于偿还AAVE的快速贷款)。</p><p id="b4d1" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">攻击者设法欺骗社区，让他们相信BIP18只是为了向乌克兰捐赠地址捐款。一旦攻击者通过flash loan获得了多数治理股权，emergencyCommit功能会帮助攻击者在投票后立即执行该提案，就这样Beanstalk损失了大约1 . 82亿美元。</p><p id="539f" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">损失的1.82亿美元的明细:</p><ul class=""><li id="9d6c" class="lg lh ht jq b jr kz jv la jz li kd lj kh lk kl ll lm ln lo dt translated">3600万豆(3600万美元)</li><li id="cb80" class="lg lh ht jq b jr lp jv lq jz lr kd ls kh lt kl ll lm ln lo dt translated">来自ETH-BEAN UNI v2 LP令牌的3300万美元ETH和3200万美元BEAN(6500万美元)</li><li id="9d1f" class="lg lh ht jq b jr lp jv lq jz lr kd ls kh lt kl ll lm ln lo dt translated">7920万BEAN3CRV-f曲线LP代币(7920万美元)</li><li id="e090" class="lg lh ht jq b jr lp jv lq jz lr kd ls kh lt kl ll lm ln lo dt translated">160万比恩-LUSD曲线LP代币(160万美元)</li></ul><p id="e9f8" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">一旦攻击者耗尽了Beanstalk的资金，BEAN的价格就从其与美元挂钩的价格暴跌了75%。</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff lu"><img src="../Images/2ab5c2282acf1e55773cc2fa3f7f0e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*huKdhnHkiYen0p6N.png"/></div></figure><p id="6dd9" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">当天晚些时候，Beanstalk在Twitter上证实了这一事件。“豆茎今天遭受了一次攻击”。</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff lv"><img src="../Images/ce1aa9ca4c87696960596acbec7efbc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-u_i0KeafnFFHwad.png"/></div></div></figure><p id="95f6" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">点击<a class="ae km" href="https://bean.money/blog/beanstalk-governance-exploit" rel="noopener ugc nofollow" target="_blank">此处</a>阅读豆茎官方声明。</p><p id="8f42" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">我想补充的是，不仅团队反应灵敏、平易近人，而且社区也比以往任何时候都更加强大。Beanstalk在2022年4月19日概述了继续雄心勃勃的旅程的前进道路。<strong class="jq hu">“这是对豆茎管理模式的攻击，而不是对其经济设计的攻击”。</strong>点击<a class="ae km" href="https://bean.money/blog/path-forward" rel="noopener ugc nofollow" target="_blank">此处</a>了解青苗计划如何前进。</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff lu"><img src="../Images/3235cdb0e7f8ffe453dc67e9def0e2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*J9BsvKpkFnBA2rJA.png"/></div></figure><h1 id="622a" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">结束语</h1><p id="9958" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">虽然闪贷黑客和智能合同漏洞在DeFi中并不新鲜，但这次不同于以往的任何利用。它揭示了治理和相关方面的问题，必须认真设计这些问题，以防止今后发生此类事件。</p><p id="2c86" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">限制治理提议的范围和使用链外解决方案可以减少这种情况。此外，必要时可以使用内置的timelock特性实现链上治理。</p><p id="72f8" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">投票和执行之间必须有足够的时间，以便用户可以仔细审查提案。黑客只用了13秒就清空了账户。</p><p id="d4c7" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">显然，不要投资超过你能承受的损失。</p></div><div class="ab cl lw lx hb ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hm hn ho hp hq"><p id="24e5" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">如果你觉得这很有帮助，请考虑通过小费、订阅和关注来支持。</p><p id="99ef" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated"><strong class="jq hu">一切区块链— </strong>追求简化元宇宙链的不同区块。</p><p id="17a7" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated"><strong class="jq hu">社交</strong></p><p id="428f" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated"><a class="ae km" href="https://everythingblockchain.substack.com/account?utm_source=menu-dropdown" rel="noopener ugc nofollow" target="_blank"> Substack </a>，<a class="ae km" href="https://twitter.com/EverythingB0x" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae km" href="https://www.youtube.com/channel/UCkcc6EceEAu1sMoi2dKczCQ" rel="noopener ugc nofollow" target="_blank"> Youtube </a>，<a class="ae km" rel="noopener" href="/@everythingblockchain"> Medium </a>，<a class="ae km" href="https://www.reddit.com/user/cyekmyster" rel="noopener ugc nofollow" target="_blank"> Reddit </a></p><p id="0027" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated"><strong class="jq hu">下线</strong></p><p id="bbff" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated"><a class="ae km" href="https://app.usebraintrust.com/r/everything1/" rel="noopener ugc nofollow" target="_blank">智囊团</a>，<a class="ae km" href="https://www.presearch.org/signup?rid=2491437" rel="noopener ugc nofollow" target="_blank">预研</a>，<a class="ae km" href="https://accounts.binance.com/en/register?ref=12626399" rel="noopener ugc nofollow" target="_blank">币安</a>，<a class="ae km" href="https://www.kucoin.com/ucenter/signup?rcode=rJCLFS2" rel="noopener ugc nofollow" target="_blank">库科恩</a></p><p id="04fe" class="pw-post-body-paragraph jo jp ht jq b jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl hm dt translated">本文提供的信息仅用于教育目的，不得视为投资建议。在正确呈现任何信息方面的任何失误都是我们的责任。我们否认与使用此内容相关的任何责任。</p></div></div>    
</body>
</html>