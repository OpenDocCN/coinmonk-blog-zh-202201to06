<html>
<head>
<title>Simple Crypto Payment System Using PHP and Coinex.net API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PHP和Coinex.net API的简单加密支付系统</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/simple-crypto-payment-system-using-php-and-coinex-net-api-45d38cf2131?source=collection_archive---------6-----------------------#2022-05-28">https://medium.com/coinmonks/simple-crypto-payment-system-using-php-and-coinex-net-api-45d38cf2131?source=collection_archive---------6-----------------------#2022-05-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="d3ba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">嘿嘿嘿！</p><p id="3e1f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0xlive在这里😃</p><p id="14a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本教程中，我们将使用php和coiex.net API开发一个简单的加密支付系统</p><p id="867e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> web3.js安装</strong></p><p id="79b4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要在终端类型中安装web3.js:</p><pre class="jo jp jq jr fq js jt ju jv aw jw dt"><span id="6bc4" class="jx jy ht jt b fv jz ka l kb kc">npm install web3</span></pre><p id="b815" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您也可以安装纱线:</p><pre class="jo jp jq jr fq js jt ju jv aw jw dt"><span id="b4ca" class="jx jy ht jt b fv jz ka l kb kc">yarn add web3</span></pre><p id="f8cd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您想在不安装任何东西的情况下使用web3.js，请将其导入浏览器:</p><pre class="jo jp jq jr fq js jt ju jv aw jw dt"><span id="c615" class="jx jy ht jt b fv jz ka l kb kc">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.3/web3.min.js" integrity="sha512-Ws+qbaGHSFw2Zc1e7XRpvW+kySrhmPLFYTyQ95mxAkss0sshj6ObdNP3HDWcwTs8zBJ60KpynKZywk0R8tG1GA==" crossorigin="anonymous" referrerpolicy="no-referrer"&gt;&lt;/script&gt;</span></pre><p id="3b6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">项目设置</strong></p><p id="5e18" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们创建一个名为payment.html的文件</p><pre class="jo jp jq jr fq js jt ju jv aw jw dt"><span id="8ddf" class="jx jy ht jt b fv jz ka l kb kc">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Payment Gateway&lt;/title&gt;<br/>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.3/web3.min.js" integrity="sha512-Ws+qbaGHSFw2Zc1e7XRpvW+kySrhmPLFYTyQ95mxAkss0sshj6ObdNP3HDWcwTs8zBJ60KpynKZywk0R8tG1GA==" crossorigin="anonymous" referrerpolicy="no-referrer"&gt;&lt;/script&gt;<br/>&lt;&lt;link rel="stylesheet" href="style.css"&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/><br/>     &lt;section id="payment" class="payment"&gt;<br/>&lt;form class="credit-card"&gt;<br/>  &lt;div class="form-header"&gt;<br/>    &lt;h4 class="title"&gt;Payment&lt;/h4&gt;<br/>  &lt;/div&gt;<br/>  &lt;div class="form-body"&gt;<br/>    &lt;input class="card-number" id="Amount" type="number" placeholder="Amount"&gt;<br/>    &lt;div class="date-field"&gt;<br/>      &lt;/div&gt;<br/>    &lt;button class="pay-button" type="submit"&gt; &lt;a href="#"&gt;Buy&lt;/a&gt;&lt;/button&gt;<br/>        &lt;div id="status"&gt;&lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/form&gt;<br/>&lt;/section&gt;<br/><br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="ea26" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们已经创建了一个付款形式的部分，现在我们想使用metamask + JS进行交易</p><pre class="jo jp jq jr fq js jt ju jv aw jw dt"><span id="9127" class="jx jy ht jt b fv jz ka l kb kc">window.addEventListener('load', async () =&gt; {<br/>      if (window.ethereum) {<br/>        window.web3 = new Web3(ethereum);<br/>        try {<br/>          await ethereum.eth_requestAccounts;<br/>          initPayButton()<br/>        } catch (err) {<br/>          $('#status').html('User denied account access', err)<br/>        }<br/>      } else if (window.web3) {<br/>        window.web3 = new Web3(web3.currentProvider)<br/>        initPayButton()<br/>      } else {<br/>        $('#status').html('No Metamask (or other Web3 Provider) installed')<br/>      }<br/>    })</span></pre><p id="b8c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们要求许可，如果用户接受，我们将进一步，如果没有状态标签将显示“<code class="eh kd ke kf jt b">No Metamask (or other Web3 Provider) installed".</code></p><p id="fb10" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">付款</strong></p><p id="a18f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们从输入中获取值，然后存储到支付地址。如果交易成功，它会将数据传递给pay.php，否则会显示错误消息。</p><pre class="jo jp jq jr fq js jt ju jv aw jw dt"><span id="28c2" class="jx jy ht jt b fv jz ka l kb kc">const initPayButton = () =&gt; {<br/>      $('.pay-button').click(() =&gt; {<br/>        const paymentAddress = 'YOUR ADDRESS'<br/>        const amountEth = document.getElementById("Amount").value;<br/><br/>        web3.eth.sendTransaction({<br/>          to: paymentAddress,<br/>          value: web3.toWei(amountEth, 'ether')<br/>        }, function(err, transactionHash) {<br/>    if (err) { <br/>        console.log('Payment failed', err)<br/>            $('#status').html('Payment failed')<br/>    } else {<br/><br/> document.getElementById("status").innerHTML = transactionHash;<br/>            $('#status').html('Payment successful')<br/> var httpc = new XMLHttpRequest(); <br/>    var url = "pay.php";<br/>    httpc.open("POST", url, true);<br/><br/>    httpc.onreadystatechange = function() {.<br/>        if(httpc.readyState == 4 &amp;&amp; httpc.status == 200) {<br/>            alert(httpc.responseText);<br/>        }<br/>    };<br/>    httpc.send(transactionHash);<br/>      }})</span></pre><p id="5877" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">Coinex.net API</strong></p><p id="4596" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要与coinex.net api服务交互，我们需要API密钥！</p><p id="abaf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">打开<a class="ae kg" href="https://testnet.coinex.net/register" rel="noopener ugc nofollow" target="_blank">https://testnet.coinex.net/register</a></p><figure class="jo jp jq jr fq ki fe ff paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="fe ff kh"><img src="../Images/cd328f820399d1661d66d9e343aa58fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qurRMV75jQTwYE7RrwrDnA.jpeg"/></div></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek">coinex.net</figcaption></figure><p id="23ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注册后，转到“api密钥”</p><p id="2ad0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意:不要和任何人分享你的api密匙！</p><p id="d581" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">Pay.php</strong></p><p id="d92b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们配置我们的脚本:</p><pre class="jo jp jq jr fq js jt ju jv aw jw dt"><span id="7562" class="jx jy ht jt b fv jz ka l kb kc">&lt;?php<br/><br/>$tx= $_POST['Amount'];<br/><br/>$curl = curl_init();<br/>curl_setopt_array($curl, [<br/>	CURLOPT_URL =&gt; "https://www.coinex.net/api/v1/transactions/".$tx,<br/>	CURLOPT_RETURNTRANSFER =&gt; true,<br/>	CURLOPT_FOLLOWLOCATION =&gt; true,<br/>	CURLOPT_ENCODING =&gt; "",<br/>	CURLOPT_MAXREDIRS =&gt; 10,<br/>	CURLOPT_TIMEOUT =&gt; 30,<br/>	CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,<br/>	CURLOPT_CUSTOMREQUEST =&gt; "GET",<br/>	CURLOPT_HTTPHEADER =&gt; [<br/>		"apikey: YOUR KEY",<br/>	],<br/>]);<br/><br/>$response = curl_exec($curl);<br/>$err = curl_error($curl);<br/>curl_close($curl);<br/>$data = json_decode($response, true);<br/><br/><br/>if ($err) {<br/>	echo "cURL Error #:" . $err;<br/>} else {<br/>	if  (strlen($data["data"]["error"]) == 0) {<br/>            echo "successful";<br/>    else{<br/>        echo"a mistake was made";<br/>}}}<br/>?&gt;</span></pre><p id="a2d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们首先从输入中获得数量。然后我们去请求api服务。</p><p id="52ed" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们从api获取数据并解码成json格式。</p><p id="3841" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果事务的错误部分有任何数据，则表示事务失败，如果没有任何数据，则表示事务成功！</p><p id="e196" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">祝贺🥳</p><p id="e7f9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们已经使用web3.js、metamask、coinex.net API服务和php为csc创建了一个简单的加密支付</p><blockquote class="kt"><p id="4850" class="ku kv ht bd kw kx ky kz la lb lc jn ek translated"><em class="ld">加入Coinmonks </em> <a class="ae kg" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> <em class="ld">电报频道</em> </a> <em class="ld">和</em> <a class="ae kg" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> <em class="ld"> Youtube频道</em> </a> <em class="ld">了解加密交易和投资</em></p></blockquote><h1 id="2dc0" class="le jy ht bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma dt translated">另外，阅读</h1><ul class=""><li id="023b" class="mb mc ht is b it md ix me jb mf jf mg jj mh jn mi mj mk ml dt translated"><a class="ae kg" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae kg" href="https://coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a> | <a class="ae kg" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="8ff7" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae kg" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">莱杰vs n rave</a>|<a class="ae kg" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">莱杰nano s vs x </a> | <a class="ae kg" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="af2e" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae kg" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit交易所评论</a> | <a class="ae kg" href="https://coincodecap.com/bityard-reivew" rel="noopener ugc nofollow" target="_blank"> Bityard评论</a> | <a class="ae kg" href="https://coincodecap.com/jet-bot-review" rel="noopener ugc nofollow" target="_blank"> Jet-Bot评论</a></li><li id="e8ba" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae kg" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203">3 commas vs crypto hopper</a>|<a class="ae kg" rel="noopener" href="/coinmonks/earn-crypto-interest-b10b810fdda3">赚取加密利息</a></li><li id="a4d0" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated">最好的比特币<a class="ae kg" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a> | <a class="ae kg" rel="noopener" href="/coinmonks/bitbox02-review-your-swiss-bitcoin-hardware-wallet-c36c88fff29"> BitBox02回顾</a></li><li id="42ab" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae kg" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>|<a class="ae kg" rel="noopener" href="/coinmonks/hodlnaut-review-best-way-to-hodl-is-to-earn-interest-on-your-bitcoin-6658a8c19edf">Hodlnaut审核</a> | <a class="ae kg" href="https://coincodecap.com/kucoin-review" rel="noopener ugc nofollow" target="_blank"> KuCoin审核</a></li></ul></div></div>    
</body>
</html>