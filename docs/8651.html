<html>
<head>
<title>Dark Side of CREATE2 opcode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CREATE2操作码的负面影响</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/dark-side-of-create2-opcode-6b6838a42d71?source=collection_archive---------2-----------------------#2022-06-14">https://medium.com/coinmonks/dark-side-of-create2-opcode-6b6838a42d71?source=collection_archive---------2-----------------------#2022-06-14</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><h1 id="1b21" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">创造2和自毁的结合是致命的，我们将在这篇文章中探讨这一点。</h1><p id="ef43" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">CREATE和CREATE2操作码的区别:</p><p id="6eab" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated"><strong class="jq hu">创建:</strong></p><ul class=""><li id="d7b6" class="kr ks ht jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz dt translated">散列创建它的帐户的地址。</li><li id="63cf" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">对“账户现时”进行哈希运算，相当于账户迄今完成的交易数量。</li></ul><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="0ba0" class="lo ir ht lk b fv lp lq l lr ls">new_address = <!-- -->keccak256<!-- -->(sender, nonce);</span></pre><p id="4ab6" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated"><strong class="jq hu">创建2 : </strong></p><ul class=""><li id="5d81" class="kr ks ht jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz dt translated">0xFF，一个常数。</li><li id="707d" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">部署者的地址，即发送CREATE2的智能合约地址。</li><li id="9afb" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">一种随机盐。</li><li id="ebef" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">将在该特定地址上部署的散列字节码。</li></ul><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="7362" class="lo ir ht lk b fv lp lq l lr ls">new_address = keccak256(0xFF, sender, salt, bytecode);</span></pre><p id="05ce" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">关于CREATE2和分步指南的更多内容，请点击这个<a class="ae lt" href="https://ethereum-blockchain-developer.com/110-upgrade-smart-contracts/12-metamorphosis-create2/" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="6bdc" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">让我们讨论一下CREATE2与自毁操作码配对时的黑暗面。</p><ol class=""><li id="efb7" class="kr ks ht jq b jr km jv kn jz kt kd ku kh kv kl lu kx ky kz dt translated"><strong class="jq hu">可以根据创建期间使用的操作码(即CREATE或CREATE2操作码)来区分合同吗？</strong></li></ol><ul class=""><li id="f015" class="kr ks ht jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz dt translated"><strong class="jq hu">是的，但是这被使用create2操作码欺骗了，这也使得create不安全。</strong></li><li id="f35c" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">示例:协定A使用CREATE2创建协定B，然后协定B使用标准的CREATE操作码创建协定C。然后，如果我们销毁契约B和C，我们可以使用与之前相同的地址再次创建契约B和C<strong class="jq hu"/>。</li><li id="9f96" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">换句话说，契约B可以用CREATE2重新创建，而契约C可以用相同的地址重新创建，因为相同的“帐户随机数”可以重复使用。</li></ul><p id="0be1" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated"><strong class="jq hu">代码</strong>？→我们开始吧！！！</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="3a3b" class="lo ir ht lk b fv lp lq l lr ls">// SPDX-License-Identifier: UNLICENSED</span><span id="3564" class="lo ir ht lk b fv lv lq l lr ls">pragma solidity ^0.8.12;</span><span id="771d" class="lo ir ht lk b fv lv lq l lr ls">contract Target {</span><span id="16b8" class="lo ir ht lk b fv lv lq l lr ls"> address public owner;</span><span id="64e7" class="lo ir ht lk b fv lv lq l lr ls">constructor() {<br/> owner = msg.sender;<br/> }</span><span id="dcd3" class="lo ir ht lk b fv lv lq l lr ls">function destroy() public {<br/> selfdestruct(payable(msg.sender));<br/> }<br/> <br/>}</span><span id="1245" class="lo ir ht lk b fv lv lq l lr ls">contract CreatorContract {</span><span id="9434" class="lo ir ht lk b fv lv lq l lr ls"> event CreatorDeploy (address addr);<br/> address public _targetaddr;</span><span id="ff37" class="lo ir ht lk b fv lv lq l lr ls"> function deployTarget() external {<br/> Target _contract = new Target();<br/> emit CreatorDeploy(address(_contract));<br/> _targetaddr = address (_contract);<br/> }</span><span id="b8b1" class="lo ir ht lk b fv lv lq l lr ls">function destroy() public {<br/> selfdestruct(payable(msg.sender));<br/> }</span><span id="d2d4" class="lo ir ht lk b fv lv lq l lr ls">}</span><span id="d4bd" class="lo ir ht lk b fv lv lq l lr ls">contract CreatorFactoryContract {</span><span id="ff17" class="lo ir ht lk b fv lv lq l lr ls"> event CreatorFactoryDeploy(address addrofc);<br/> address public _creatorContractaddr;</span><span id="c202" class="lo ir ht lk b fv lv lq l lr ls"> function deployCreator(uint _salt) external {<br/> CreatorContract _creatorcontract = new     CreatorContract{salt:bytes32(_salt)}();<br/> emit CreatorFactoryDeploy(address(_creatorcontract));<br/> _creatorContractaddr = address(_creatorcontract); <br/> }</span><span id="10cb" class="lo ir ht lk b fv lv lq l lr ls">}</span></pre><p id="73a1" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">将以下内容复制到remix，并遵循以下步骤:</p><ul class=""><li id="fa3c" class="kr ks ht jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz dt translated">部署CreatorFactoryContract并验证它</li><li id="c4c4" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">使用CreatorFactoryContract中的deployCreator函数部署CreatorContract，并保持一个常量salt比如1。</li><li id="d533" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">使用CreatorContract中的部署目标函数部署目标合同，并记下目标和CreatorContract的地址。</li><li id="469c" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">使用Destroy函数销毁目标合同，然后使用destroy函数销毁creator合同。</li><li id="5f14" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">使用步骤2和3重新部署两个合同。</li><li id="997b" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated">对两份合同的地址感到惊讶。</li></ul><p id="4cbb" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">测试网上的证据——我们开始吧</p><ul class=""><li id="1403" class="kr ks ht jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz dt translated">按照这些链接和图片进行链上分析</li><li id="e808" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><strong class="jq hu">CreatorFactoryContract address→</strong><a class="ae lt" href="https://mumbai.polygonscan.com/address/0x59b836ce6a1e08652a4ac0c5564f2cc313c44602#writeContract" rel="noopener ugc nofollow" target="_blank"><strong class="jq hu">https://Mumbai . polygonscan . com/address/0x 59 b 836 ce 6a 1e 08652 a4 ac0 c 5564 F2 cc 313 c 44602 # write contract</strong></a></li><li id="3b22" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><strong class="jq hu">creator contact address→</strong><a class="ae lt" href="https://mumbai.polygonscan.com/address/0x50eacbf80fc5d7be88e043c663578db4789f1370#code" rel="noopener ugc nofollow" target="_blank">T3】https://Mumbai . polygonscan . com/address/0x 50 ea CBF 80 fc 5d 7 be 88 e 043 c 663578 db 4789 f 1370 # codeT5】</a></li><li id="d8a0" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><strong class="jq hu">标的合同地址→</strong><a class="ae lt" href="https://mumbai.polygonscan.com/address/0xdC7cB816f8D7dD4e1CE40867c6bc65831CF6fF49#code" rel="noopener ugc nofollow" target="_blank"><strong class="jq hu">https://Mumbai . polygonscan . com/address/0x DC 7 CB 816 f8d 7 DD 4 E1 ce 40867 c6bc 65831 cf 6 ff 49 #代码</strong> </a></li><li id="9650" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><strong class="jq hu">部署者地址→0x 700 e 9 da 3270 aacb 3042 DC 25 da 677 ba 517 CCD C4 f 7</strong></li></ul><p id="32d9" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated"><strong class="jq hu">整个过程中合同状态的图像</strong></p><figure class="lf lg lh li fq lx fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff lw"><img src="../Images/1cfa98ff1ea3baaf6ad97f6f193f7082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ns3e5BwjwIluQ8LW-XIC2A.png"/></div></div></figure><figure class="lf lg lh li fq lx fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff lw"><img src="../Images/6167589074eccf6b98f92684001602ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xFyro9_e1AQktbNOlYJKnw.png"/></div></div></figure><figure class="lf lg lh li fq lx fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff lw"><img src="../Images/7cc349dfa94357ff0f1b1f47c9cb0d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BBdVOtMs0lga7_1LQ3qcMA.png"/></div></div></figure><figure class="lf lg lh li fq lx fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff lw"><img src="../Images/ae962c4ce4639f4dc5c461d3467819af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_aRK4G8WllFMD5MC42Elvg.png"/></div></div></figure><figure class="lf lg lh li fq lx fe ff paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="fe ff lw"><img src="../Images/b924a328974bde0e5056764255bd81c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OCToi0W9fTcO8S4Xcdkb4g.png"/></div></div></figure><p id="64d9" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">这只是create2操作码可能性的冰山一角。</p><p id="b9cd" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">我将在下一篇文章中进一步阐述这一点，因为这会变得很长。</p><p id="24ff" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated"><strong class="jq hu">下一主题:使用上述方法改变变量的值并触及变质作用。</strong></p><p id="2512" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">不能等到下一次吗？阅读此处了解更多关于下一主题的内容→ <a class="ae lt" href="https://ethereum-blockchain-developer.com/110-upgrade-smart-contracts/12-metamorphosis-create2/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hu">链接</strong> </a>。</p><p id="5a9a" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">创建者注释:这是我的第一篇文章，所以欢迎对文档格式和内容提出建议。请容忍我，直到我在这个平台上选择步伐。</p><p id="05c7" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">通过→ <a class="ae lt" href="http://jayakumargowtham2812@gmail.com" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hu">邮箱</strong> </a>联系我。→ <a class="ae lt" href="https://www.linkedin.com/in/jayakumar-sathayadhran-8b70a819b/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hu">领英</strong> </a>。</p><blockquote class="me"><p id="2773" class="mf mg ht bd mh mi mj mk ml mm mn kl ek translated">加入Coinmonks <a class="ae lt" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lt" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="773a" class="iq ir ht bd is it iu iv iw ix iy iz ja jb mo jd je jf mp jh ji jj mq jl jm jn dt translated">另外，阅读</h1><ul class=""><li id="6478" class="kr ks ht jq b jr js jv jw jz mr kd ms kh mt kl kw kx ky kz dt translated"><a class="ae lt" rel="noopener" href="/coinmonks/bigone-exchange-review-64705d85a1d4"> BigONE交易所评论</a> | <a class="ae lt" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">电网交易机器人</a></li><li id="dc87" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><a class="ae lt" href="https://coincodecap.com/anny-trade-review" rel="noopener ugc nofollow" target="_blank">氹欞侊贸易评论</a> | <a class="ae lt" href="https://coincodecap.com/coinspot-review" rel="noopener ugc nofollow" target="_blank"> CoinSpot评论</a></li><li id="3dde" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><a class="ae lt" href="https://coincodecap.com/crypto-exchange-in-singapore" rel="noopener ugc nofollow" target="_blank">新加坡十大最佳加密交易所</a> | <a class="ae lt" href="https://coincodecap.com/buy-axs-token" rel="noopener ugc nofollow" target="_blank">收购AXS </a></li><li id="832a" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><a class="ae lt" href="https://coincodecap.com/best-crypto-to-invest-in-india-in-2021" rel="noopener ugc nofollow" target="_blank">投资印度的最佳加密软件</a> | <a class="ae lt" href="https://coincodecap.com/wazirx-p2p" rel="noopener ugc nofollow" target="_blank"> WazirX P2P </a></li><li id="a5e9" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><a class="ae lt" href="https://coincodecap.com/copy-trading-spain" rel="noopener ugc nofollow" target="_blank">西班牙5大最佳文案交易平台</a></li><li id="6259" class="kr ks ht jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz dt translated"><a class="ae lt" href="https://coincodecap.com/pionex-dual-investment" rel="noopener ugc nofollow" target="_blank"> Pionex双重投资</a> | <a class="ae lt" href="https://coincodecap.com/advcash-review" rel="noopener ugc nofollow" target="_blank"> AdvCash审查</a> | <a class="ae lt" href="https://coincodecap.com/uphold-review" rel="noopener ugc nofollow" target="_blank">支持审查</a></li></ul></div></div>    
</body>
</html>