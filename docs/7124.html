<html>
<head>
<title>Feminist Metaverse attack analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">女权主义者元宇宙攻击分析</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/feminist-metaverse-attack-analysis-e97b20ddbea8?source=collection_archive---------12-----------------------#2022-05-20">https://medium.com/coinmonks/feminist-metaverse-attack-analysis-e97b20ddbea8?source=collection_archive---------12-----------------------#2022-05-20</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="7d69" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> 0x01事件背景</strong></p><p id="27e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5月18日，<strong class="is hu">币安</strong>链条上的女权主义者元宇宙智能合约遭到了<strong class="is hu">智能合约</strong>的攻击。损失了价值超过55万美元的资金。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff jo"><img src="../Images/7887a720ed0e31d7a79903a4743e5e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*53bIBISmteWkMXZS9n1A8Q.png"/></div></figure><p id="8789" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> 0x02攻击者信息</strong></p><p id="36b6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">攻击者钱包</strong>:0x AAA 1634d 669 DD 8 aa 275 bad 6 FD f19 c 7 E3 B2 f1 ef 50</p><p id="c218" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">攻击者契约</strong>:0x 0b 8d 752252694623766 DFB 161 e 1944 f 233 BC a10 f</p><p id="8b59" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">攻击者转移</strong>:0x ecde 3c 3742615852 Abd BD 6 EC 5d 75 AE 982 b5 c 29 f 810 e 140 e5cd 822667 d6f 7 b 848</p><p id="3f52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> FmToken合同</strong>:0x 843528746 f 073638 c9e 18253 ee 6078613 c0df 0 f 1</p><p id="9f8f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> 0x03攻击分析</strong></p><p id="6d1e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过分析攻击者在BNB链上的交易，攻击者的主要交易过程如下:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff jw"><img src="../Images/4eb31b17294b3095f13113116de32ecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A4WdmG2F0-cHbyeUfHiQxQ.png"/></div></div></figure><ol class=""><li id="6ddf" class="kb kc ht is b it iu ix iy jb kd jf ke jj kf jn kg kh ki kj dt translated">攻击者部署攻击契约；</li></ol><p id="dfc6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.攻击钱包向攻击契约发送10个FM，为后续调用做准备；</p><p id="5fe0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3.攻击者将他钱包中的最大FM资金授权给<strong class="is hu"> PancakeSwap。路由器v2 </strong>约定方便后续令牌交换；</p><p id="763f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4.攻击者正式开始调用攻击契约进行攻击。攻击契约调用Fmtoken.transfer将资金转入攻击者的钱包，然后从SakeSwapPair.skim中提取大量FM令牌；</p><p id="4a73" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5.将获得的FM令牌转换为美元和BNB。</p><p id="34ef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">攻击交易主要是第四步</strong></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff kk"><img src="../Images/b2e2a446c493d827cbefde077e149bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjCkWVYdHREjzCJs_EcyQQ.png"/></div></div></figure><p id="34ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上图为交易流程图，下图为交易明细。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff kl"><img src="../Images/db215f85cceee6412417de541f20f0f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZGaOS6DJABAKns5k9DVmg.png"/></div></div></figure><p id="6834" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上面的交易明细只有两个操作:<strong class="is hu">第一个</strong>是攻击者契约调用<strong class="is hu"> Fmtoken </strong>契约中的transfer方法将FM令牌转移到攻击者的钱包中，每次传输0.0000000000001FM，共500次转移；<strong class="is hu">第二个</strong>是攻击者的钱包地址调用<strong class="is hu"> SakeSwapPair </strong>契约中的<strong class="is hu">skim方法</strong>将7593万FM转给自己。</p><p id="2603" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过分析所有交易，攻击者共进行了16次成功的攻击交易，8000次调用Fmtoken契约中的转账方法进行资金转账，从<strong class="is hu"> skim方法</strong>转出超过11亿FM。</p><p id="27a3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> 0x04漏洞详情</strong></p><p id="8965" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过以上过程分析可以发现，攻击者成功获利的主要操作是攻击者契约调用Fmtoken契约中的转账方法将FM token转入攻击者的钱包，进而获得大量资金。</p><p id="3926" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了查看数据，关键数据将显示在这里</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff km"><img src="../Images/3efe2c9341f6a6164b925485b83016fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9KG7eJxY6VwTNZvKefSxtw.png"/></div></div></figure><p id="d38e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">从上图可以清楚地看到，攻击者最终通过<strong class="is hu"> _transfer </strong>方法转移资金。</p><p id="e90c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于<strong class="is hu">numTokensSellToAddToLiquidity</strong>和<strong class="is hu">swapandliquityenabled</strong>变量已经确定，在<strong class="is hu">的三个条件中，如果<strong class="is hu"> _transfer </strong>方法的条件</strong>、<strong class="is hu">swapandliquityenabled</strong>已经满足。既然攻击者调用了<strong class="is hu"> from！= uniswapV2Pair </strong>条件下，合同地址资金不小于<strong class="is hu">变量numTokensSellToAddToLiquidity</strong>的值。，可以满足条件，所以攻击者可以进行更新<strong class="is hu"> uniswapV2Pair </strong>地址余额和<strong class="is hu">地址(this) </strong>的操作。</p><p id="d50a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于这里的资金加入到<strong class="is hu"> uniswapV2Pair </strong>中，所以资金不是通过增加流动性进行转移，而是直接加入到<strong class="is hu"> uniswapV2Pair </strong>中。当攻击者进行多次转账时，即攻击者将契约的资金多次转账给<strong class="is hu"> uniswapV2Pair </strong>。</p><p id="980e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用<strong class="is hu"> skim方法</strong>，任何人都可以调用该方法来转移合同中的附加资产。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff kn"><img src="../Images/15294a0dba81d1e761ca2cf9a7ee30d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G9wjDWsuLrBwu8hNt9SG2g.png"/></div></div></figure><p id="d79b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">攻击者调用<strong class="is hu">SakeSwapPair contract</strong>t中的<strong class="is hu"> skim方法</strong>转移资金并获利。</p><p id="6d78" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> 0x05资金来源和去向</strong></p><p id="7a4a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">攻击者的资金来源全部来自<strong class="is hu">龙卷风。现金</strong>平台，金额为1 BNB。目前攻击者的利润已经全部兑换成1838.3 BNB，转移到<strong class="is hu">龙卷风。现金</strong>平台。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff ko"><img src="../Images/3040c1ecc04960ef7e77e0827f345d2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cUPN5MNdeCYWne7-tv9hiQ.png"/></div></div></figure><p id="96e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> 0x06汇总</strong></p><p id="ce65" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">根据这次攻击，<strong class="is hu"> Fmtoken。_transfer </strong>方法没有正确操作添加到<strong class="is hu"> SakeSwapPair </strong>合同中的资金，使得攻击者可以在一次交易中通过多次转账将合同中的原始资金转移到SakeSwapPair合同中。从而通过<strong class="is hu">撇帐方式</strong>提取资金。</p><p id="c5b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> 0x07安全建议</strong></p><ul class=""><li id="5311" class="kb kc ht is b it iu ix iy jb kd jf ke jj kf jn kp kh ki kj dt translated">应对合同资金转账逻辑进行严格检查；</li><li id="ae35" class="kb kc ht is b it kq ix kr jb ks jf kt jj ku jn kp kh ki kj dt translated">智能合约上线前，要进行完整详细的测试，确保合约逻辑正确。</li><li id="2766" class="kb kc ht is b it kq ix kr jb ks jf kt jj ku jn kp kh ki kj dt translated">智能合同生效前，应进行全面的安全审计</li></ul><blockquote class="kv"><p id="18c0" class="kw kx ht bd ky kz la lb lc ld le jn ek translated">加入Coinmonks <a class="ae lf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lf" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="d9d7" class="lg lh ht bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md dt translated">另外，阅读</h1><ul class=""><li id="030c" class="kb kc ht is b it me ix mf jb mg jf mh jj mi jn kp kh ki kj dt translated"><a class="ae lf" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae lf" href="https://coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a> | <a class="ae lf" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="8f95" class="kb kc ht is b it kq ix kr jb ks jf kt jj ku jn kp kh ki kj dt translated"><a class="ae lf" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">莱杰vs n rave</a>|<a class="ae lf" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">莱杰nano s vs x </a> | <a class="ae lf" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="34bd" class="kb kc ht is b it kq ix kr jb ks jf kt jj ku jn kp kh ki kj dt translated"><a class="ae lf" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit Exchange审查</a> | <a class="ae lf" href="https://coincodecap.com/bityard-reivew" rel="noopener ugc nofollow" target="_blank"> Bityard审查</a> | <a class="ae lf" href="https://coincodecap.com/jet-bot-review" rel="noopener ugc nofollow" target="_blank"> Jet-Bot审查</a></li><li id="a53f" class="kb kc ht is b it kq ix kr jb ks jf kt jj ku jn kp kh ki kj dt translated"><a class="ae lf" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203">3 commas vs crypto hopper</a>|<a class="ae lf" rel="noopener" href="/coinmonks/earn-crypto-interest-b10b810fdda3">赚取加密利息</a></li><li id="7590" class="kb kc ht is b it kq ix kr jb ks jf kt jj ku jn kp kh ki kj dt translated">最好的比特币<a class="ae lf" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a> | <a class="ae lf" rel="noopener" href="/coinmonks/bitbox02-review-your-swiss-bitcoin-hardware-wallet-c36c88fff29"> BitBox02回顾</a></li><li id="13d5" class="kb kc ht is b it kq ix kr jb ks jf kt jj ku jn kp kh ki kj dt translated"><a class="ae lf" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630"> BlockFi vs摄氏度</a> | <a class="ae lf" rel="noopener" href="/coinmonks/hodlnaut-review-best-way-to-hodl-is-to-earn-interest-on-your-bitcoin-6658a8c19edf"> Hodlnaut审核</a> | <a class="ae lf" href="https://coincodecap.com/kucoin-review" rel="noopener ugc nofollow" target="_blank"> KuCoin审核</a></li></ul></div></div>    
</body>
</html>