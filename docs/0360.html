<html>
<head>
<title>Deploy Subgraphs to Any EVM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将子图部署到任何EVM</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deploy-subgraphs-to-any-evm-aaaccc3559f?source=collection_archive---------0-----------------------#2022-01-29">https://medium.com/coinmonks/deploy-subgraphs-to-any-evm-aaaccc3559f?source=collection_archive---------0-----------------------#2022-01-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="57c6" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">使用Docker、图、图节点和OpenZepplin子图</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/615af28170183fdfb40b2be0916fadae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-Il23WRMUsXP7AfM5fldQ.png"/></div></div></figure><h1 id="49af" class="ju jv ht bd jw jx jy jz ka kb kc kd ke iz kf ja kg jc kh jd ki jf kj jg kk kl dt translated">介绍</h1><p id="39d6" class="pw-post-body-paragraph km kn ht ko b kp kq iu kr ks kt ix ku kv kw kx ky kz la lb lc ld le lf lg lh hm dt translated">该图支持以太坊、xDAI、BSC等多种网络。本文将解释如何用定制的网络RPC构建一个子图。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff li"><img src="../Images/b482177d1bbe82b2dfcbf704dbda7a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2gscw7j4LVITkL8W0rOJiA.png"/></div></div></figure><h1 id="a016" class="ju jv ht bd jw jx jy jz ka kb kc kd ke iz kf ja kg jc kh jd ki jf kj jg kk kl dt translated">设置本地节点</h1><p id="22ef" class="pw-post-body-paragraph km kn ht ko b kp kq iu kr ks kt ix ku kv kw kx ky kz la lb lc ld le lf lg lh hm dt translated">使用Docker运行本地图节点，并通过RPC将其连接到区块链。</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="bea0" class="lo jv ht lk b fv lp lq l lr ls">git clone <a class="ae lt" href="https://github.com/graphprotocol/graph-node/" rel="noopener ugc nofollow" target="_blank">https://github.com/graphprotocol/graph-node/</a></span></pre><p id="9111" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">打开<code class="eh lz ma mb lk b">docker-compose.yml</code>位于:</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="32ed" class="lo jv ht lk b fv lp lq l lr ls">graph-node/docker/docker-compose.yml</span></pre><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mc"><img src="../Images/adbaf615201cedaa189253ef6e059c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1VJsQ-5C7xJdJf9YVpsxkA.png"/></div></div></figure><p id="2400" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">用您的RPC url替换<code class="eh lz ma mb lk b">http://host.docker.internal:8545</code>。默认连接到本地以太坊节点。</p><p id="dfdf" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">注:保留<code class="eh lz ma mb lk b">mainnet:</code></p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mc"><img src="../Images/2e1795f76e936e1102f0cff1174332a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJVK-2AZF_BOQT9qUMTy7g.png"/></div></div></figure><p id="d75d" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">转到<code class="eh lz ma mb lk b">graph-node/docker</code>并运行</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="5db1" class="lo jv ht lk b fv lp lq l lr ls">./setup.sh</span></pre><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff md"><img src="../Images/1ac14c241f82bb71fcf01b9593916d8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYmD_eMQahSREGubRavoHQ.png"/></div></div></figure><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="ac30" class="lo jv ht lk b fv lp lq l lr ls">docker-compose up</span></pre><p id="9692" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">日志将显示当前块头。您可以将其与块管理器中的内容进行比较。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff me"><img src="../Images/5fd13fda58e5882a2e0c8db190208fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U-xLbP0ZjZdOYfoj8AWYow.png"/></div></div></figure><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mf"><img src="../Images/a484b97b9274224e760f041dc8f89d8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eA81t1xIn3wJxqjHjP5exg.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">close enough</figcaption></figure><p id="ac11" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">您的子图正在本地运行，并连接到正确的区块链。接下来，创建一个契约来索引。</p><h1 id="8106" class="ju jv ht bd jw jx jy jz ka kb kc kd ke iz kf ja kg jc kh jd ki jf kj jg kk kl dt translated">将合同部署到索引</h1><p id="7d8d" class="pw-post-body-paragraph km kn ht ko b kp kq iu kr ks kt ix ku kv kw kx ky kz la lb lc ld le lf lg lh hm dt translated">这个例子将使用OpenZepplin的ERC-1155合同。<code class="eh lz ma mb lk b">mint</code>有一个公共函数</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="3400" class="lo jv ht lk b fv lp lq l lr ls">// SPDX-License-Identifier: GPL-3.0 pragma solidity &gt;0.8.0;</span><span id="7fae" class="lo jv ht lk b fv mk lq l lr ls">import "<a class="ae lt" href="http://twitter.com/openzeppelin/contracts" rel="noopener ugc nofollow" target="_blank">@openzeppelin/contracts</a>/token/ERC1155/ERC1155.sol";</span><span id="476c" class="lo jv ht lk b fv mk lq l lr ls">contract My1155 is ERC1155 {</span><span id="507f" class="lo jv ht lk b fv mk lq l lr ls">  constructor() ERC1155("") {<br/>    _mint(msg.sender, 0, 1, ""); // mint 1 on deploy<br/>  }</span><span id="df16" class="lo jv ht lk b fv mk lq l lr ls">  function mint() public {<br/>      _mint(msg.sender, 0, 1, "");<br/>  }</span><span id="c4b1" class="lo jv ht lk b fv mk lq l lr ls">}</span></pre><p id="e4b0" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">部署并获取合同地址</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ml"><img src="../Images/c74dfd5c569b78d441641c54cd9a298e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ylg_MPU8jvs_vKLyGD7wVA.png"/></div></div></figure><p id="527c" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">查看合同地址和块的块浏览器。子图将从这个约定地址索引事件。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mm"><img src="../Images/520e93ea9fda219839a78458ace34029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybOm4d927glcyoMIjCuaHA.png"/></div></div></figure><h1 id="429a" class="ju jv ht bd jw jx jy jz ka kb kc kd ke iz kf ja kg jc kh jd ki jf kj jg kk kl dt translated">使用OpenZepplin设置子图</h1><p id="bfd0" class="pw-post-body-paragraph km kn ht ko b kp kq iu kr ks kt ix ku kv kw kx ky kz la lb lc ld le lf lg lh hm dt translated">这个例子将使用OpenZepplin的子图。这使得ERC-20、ERC-721和ERC-1155等合约的指数化变得容易。</p><p id="36c1" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated"><a class="ae lt" href="https://docs.openzeppelin.com/subgraphs/0.1.x/" rel="noopener ugc nofollow" target="_blank">https://docs.openzeppelin.com/subgraphs/0.1.x/</a></p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="6e24" class="lo jv ht lk b fv lp lq l lr ls">mkdir custom-subgraph<br/>cd custom-subgraph<br/>npm i @openzeppelin/subgraphs<br/>mkdir configs<br/>touch configs/config.json</span></pre><p id="3edb" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">在<code class="eh lz ma mb lk b">config.json</code>添加和更换</p><ul class=""><li id="6a18" class="mn mo ht ko b kp lu ks lv kv mp kz mq ld mr lh ms mt mu mv dt translated"><code class="eh lz ma mb lk b">address</code>:已部署的合同地址</li><li id="9e66" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><code class="eh lz ma mb lk b">startBlock</code>:已部署的合同区块</li></ul><p id="e988" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">注:保留<code class="eh lz ma mb lk b">mainnet</code></p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="dba4" class="lo jv ht lk b fv lp lq l lr ls">{<br/>  "output": "generated/sample.",<br/>  "chain": "mainnet",<br/>  "datasources": [{ "address": "0xf248a9c50d0db54ea53b6ce0ca0e8d5861b908ed", "startBlock": <a class="ae lt" href="https://stardust-explorer.metis.io/block/1218129" rel="noopener ugc nofollow" target="_blank">121812</a>8, "module": ["erc1155", "ownable", "accesscontrol"] }]<br/>}</span></pre><p id="8db8" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">编制</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="7cb2" class="lo jv ht lk b fv lp lq l lr ls">npx graph-compiler --config configs/config.json --include node_modules/@openzeppelin/subgraphs/src/datasources --export-schema --export-subgraph</span></pre><p id="4378" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">这应该会生成一个<code class="eh lz ma mb lk b">graphql</code>和<code class="eh lz ma mb lk b">yaml</code>文件。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nb"><img src="../Images/80f9f166ed2c2a8b9c28089875aa8b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S6JEpUwAv-rOFoH4BDlw4g.png"/></div></div></figure><p id="06d4" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">创建子图</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="9e1f" class="lo jv ht lk b fv lp lq l lr ls">graph create generated/sample --node <a class="ae lt" href="http://127.0.0.1:8020" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8020</a></span></pre><p id="9a7b" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">部署子图</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="0e33" class="lo jv ht lk b fv lp lq l lr ls">graph deploy --ipfs <a class="ae lt" href="http://localhost:5001" rel="noopener ugc nofollow" target="_blank">http://localhost:5001</a> --node <a class="ae lt" href="http://localhost:8020" rel="noopener ugc nofollow" target="_blank">http://localhost:8020</a> generated/sample ./generated/sample.subgraph.yaml</span></pre><p id="580e" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">一旦完成，请访问<a class="ae lt" href="http://localhost:8000/subgraphs/name/generated/sample" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/subgraphs/name/generated/sample</a></p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff me"><img src="../Images/7b3970d184d9bb2d5c0eac7711875fb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9fLHF7n7EhXWo2T_JIbAdg.png"/></div></div></figure><p id="4a8d" class="pw-post-body-paragraph km kn ht ko b kp lu iu kr ks lv ix ku kv lw kx ky kz lx lb lc ld ly lf lg lh hm dt translated">测试查询</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nc"><img src="../Images/d5fc9c3e369f3b520067d57274ab6783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUtk3BUyUK9MfA8cwZCKTA.png"/></div></div></figure><h1 id="e5d8" class="ju jv ht bd jw jx jy jz ka kb kc kd ke iz kf ja kg jc kh jd ki jf kj jg kk kl dt translated">庆祝🎉🎉🎉</h1><p id="e7f7" class="pw-post-body-paragraph km kn ht ko b kp kq iu kr ks kt ix ku kv kw kx ky kz la lb lc ld le lf lg lh hm dt translated">这种方法可以部署在任何专用服务器上。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nd"><img src="../Images/9456b07edbb61d2b96819bc706023bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2cHpl_wNjGmgJrRJ"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">Photo by <a class="ae lt" href="https://unsplash.com/@adam_whitlock?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Adam Whitlock</a> on <a class="ae lt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="ne"><p id="8700" class="nf ng ht bd nh ni nj nk nl nm nn lh ek translated">加入Coinmonks <a class="ae lt" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lt" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h2 id="87e7" class="lo jv ht bd jw no np nq ka nr ns nt ke kv nu nv kg kz nw nx ki ld ny nz kk oa dt translated">另外，阅读</h2><ul class=""><li id="5c1c" class="mn mo ht ko b kp kq ks kt kv ob kz oc ld od lh ms mt mu mv dt translated"><a class="ae lt" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae lt" href="https://coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a> | <a class="ae lt" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="5e23" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><a class="ae lt" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">莱杰vs Ngrave </a> | <a class="ae lt" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">莱杰nano s vs x </a> | <a class="ae lt" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="d367" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><a class="ae lt" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit Exchange评论</a> | <a class="ae lt" href="https://coincodecap.com/bityard-reivew" rel="noopener ugc nofollow" target="_blank"> Bityard评论</a> | <a class="ae lt" href="https://coincodecap.com/jet-bot-review" rel="noopener ugc nofollow" target="_blank"> Jet-Bot评论</a></li><li id="f819" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><a class="ae lt" href="https://coincodecap.com/ascendex-staking" rel="noopener ugc nofollow" target="_blank">AscendEx Staking</a>|<a class="ae lt" href="https://coincodecap.com/bot-ocean-review" rel="noopener ugc nofollow" target="_blank">Bot Ocean Review</a>|<a class="ae lt" href="https://coincodecap.com/bitcoin-wallets-india" rel="noopener ugc nofollow" target="_blank">最佳比特币钱包</a></li><li id="15e5" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><a class="ae lt" href="https://coincodecap.com/bitget-review" rel="noopener ugc nofollow" target="_blank"> Bitget回顾</a> | <a class="ae lt" href="https://coincodecap.com/gemini-vs-blockfi" rel="noopener ugc nofollow" target="_blank">双子星vs BlockFi </a> | <a class="ae lt" href="https://coincodecap.com/okex-futures-trading" rel="noopener ugc nofollow" target="_blank"> OKEx期货交易</a></li><li id="c009" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><a class="ae lt" href="https://coincodecap.com/crypto-trading-bots-in-the-us" rel="noopener ugc nofollow" target="_blank">美国最佳加密交易机器人</a> | <a class="ae lt" href="https://coincodecap.com/changelly-review" rel="noopener ugc nofollow" target="_blank">经常性回顾</a></li><li id="7716" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><a class="ae lt" href="https://coincodecap.com/crypto-arbitrage-in-india" rel="noopener ugc nofollow" target="_blank">在印度利用加密套利赚取被动收入</a></li><li id="92d8" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><a class="ae lt" href="https://coincodecap.com/huobi-review" rel="noopener ugc nofollow" target="_blank">霍比审核</a> | <a class="ae lt" href="https://coincodecap.com/okex-margin-trading" rel="noopener ugc nofollow" target="_blank"> OKEx保证金交易</a> | <a class="ae lt" href="https://coincodecap.com/futures-trading" rel="noopener ugc nofollow" target="_blank">期货交易</a></li><li id="d179" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated"><a class="ae lt" href="https://coincodecap.com/sparrow-exchange-review" rel="noopener ugc nofollow" target="_blank">麻雀交换评论</a> | <a class="ae lt" href="https://coincodecap.com/nash-exchange-review" rel="noopener ugc nofollow" target="_blank">纳什交换评论</a></li><li id="5a50" class="mn mo ht ko b kp mw ks mx kv my kz mz ld na lh ms mt mu mv dt translated">最好的<a class="ae lt" rel="noopener" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b">加密税务软件</a> | <a class="ae lt" rel="noopener" href="/coinmonks/cointracking-review-a-reliable-cryptocurrency-tax-software-5114e3eb5737">硬币追踪评论</a></li></ul></div></div>    
</body>
</html>