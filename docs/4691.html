<html>
<head>
<title>Linear Mean-Reverting Strategy | Cryptocurrency</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">线性均值回复策略|加密货币</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/linear-mean-reverting-strategy-cryptocurrency-55ec4a4f13ac?source=collection_archive---------8-----------------------#2022-04-12">https://medium.com/coinmonks/linear-mean-reverting-strategy-cryptocurrency-55ec4a4f13ac?source=collection_archive---------8-----------------------#2022-04-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="bfe7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在量化交易领域有两种主要的策略，即均值回归和动量交易。今天我们将介绍均值回复的一个简单的线性概念。</p></div><div class="ab cl jo jp hb jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hm hn ho hp hq"><div class="jv jw jx jy fq jz"><a rel="noopener follow" target="_blank" href="/@Dr.Bankruptcy/how-to-get-usdt-future-data-from-binance-python-api-13b20d937bdd"><div class="ka ab ej"><div class="kb ab kc cl cj kd"><h2 class="bd hu fv z el ke eo ep kf er et hs dt translated">如何从币安python API获取USDT未来数据</h2><div class="kg l"><h3 class="bd b fv z el ke eo ep kf er et ek translated">你需要数据来研究和测试交易策略。币安是一个很好的数据来源。在这里，我们将展示如何…</h3></div><div class="kh l"><p class="bd b gc z el ke eo ep kf er et ek translated">medium.com</p></div></div><div class="ki l"><div class="kj l kk kl km ki kn ko jz"/></div></div></a></div><p id="d8a3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以根据我的另一个故事来获得所需的数据。今天我们将学习ETH/BTC配对。</p><p id="839b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">大多数均值回复策略基于平稳性的思想。虽然你可以在维基百科上查看平稳过程的数学定义，但我想用图形来描述这个概念。</p><figure class="jv jw jx jy fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff kp"><img src="../Images/e2e8b16018c0f0ea01e27945ac51422d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9G7t212YsYTvM3Wrp0nZ7g.png"/></div></div></figure><p id="9804" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">左边的时间序列是平稳的。很明显，它在平均值附近振荡。在右侧，该系列是趋势性的，即存在非零漂移。</p><p id="518d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了测试平稳性，可以应用ADF (Augmented Dickey Fuller)测试。这个函数在许多统计库中被广泛定义，例如，在python:</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="71c4" class="lb lc ht kx b fv ld le l lf lg">from statsmodels.tsa.stattools import adfuller</span></pre><p id="e991" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">可以通过调用以下命令来检查p值:</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="ae56" class="lb lc ht kx b fv ld le l lf lg">pvalue = adfuller(X)[1]</span></pre><p id="4212" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果p值小于0.01或0.05，则检查平稳性。</p><p id="1c49" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们发现一个金融工具的价格，一对金融工具(如黄金-白银etc联邦储蓄银行等)的价差，甚至一个资产组合或资产之间的一些比率确实是平稳的，会怎么样呢？</p><figure class="jv jw jx jy fq kq fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/59519ef41319974bd652289232453f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*u8mcu5mBdICl0yE2s7o8LQ.png"/></div></figure><p id="e96c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于上面的综合价差，我们可以看到它在其平均值附近是稳定的。均值回归策略是，当你看到价值足够大于其均值时，你做空资产，因为你知道它最终会回到均值以获取利润(因此得名均值回归策略)，反之亦然，当价值远小于均值时。</p><p id="8015" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们检查一下BTC联邦理工学院的案例:</p><figure class="jv jw jx jy fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff li"><img src="../Images/5efc807463ee5a8a0c0b16f6ec4fe846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8VZONwTDWiuioSXv6J0IhQ.png"/></div></div></figure><p id="e547" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们将回顾期设置为240，即4小时，我们可以看到以下内容(显示前10天):</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="d8b2" class="lb lc ht kx b fv ld le l lf lg">lookback = 240<br/>price = df['Close'].iloc[:1440*10]<br/>mean = np.mean(price)</span><span id="c301" class="lb lc ht kx b fv lj le l lf lg">plt.figure(figsize=(12,6))<br/>price.plot()<br/>price.rolling(lookback).mean().plot()<br/>plt.xlabel('Time')<br/>plt.ylabel('Value')<br/>plt.legend(['ETH/BTC', 'Mean'])</span></pre><figure class="jv jw jx jy fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff lk"><img src="../Images/65de58d282967b641eb88b7d2e1a75bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2YK2ZhZCCf2t1B9ahMsmA.png"/></div></div></figure><p id="98b5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">实际上，平均值(橙色线)只是240-SMA(简单移动平均线)，通过均值回复，我们预计价格将围绕SMA线上下波动。然而，图表看起来并不稳定！如果我们检查它的p值:</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="c50d" class="lb lc ht kx b fv ld le l lf lg">from statsmodels.tsa.stattools import adfuller<br/>pvalue = adfuller(price)[1]<br/>print(pvalue)</span></pre><p id="4c26" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我在这里得到一个0.6668578022312203，表明这个数列是非平稳的。如果我们看它的z值:</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="6996" class="lb lc ht kx b fv ld le l lf lg">def zscore(series,lookback):<br/>    return (series - series.rolling(lookback).mean()) / series.rolling(lookback).std()</span><span id="dd3e" class="lb lc ht kx b fv lj le l lf lg">zscore(price,lookback).plot(figsize=(12,6))<br/>plt.axhline(zscore(price,lookback).mean(),color='green')<br/>plt.show()</span></pre><figure class="jv jw jx jy fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff ll"><img src="../Images/b71ef735e37efdc297be926da9f8d010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECxlmejlGbqLtw3IauM5gw.png"/></div></div></figure><p id="d25f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们可以看到该比率有时高达8个标准差！在经典的布林线策略中，人们会观察，比如说2个标准差，进行交易，即当价格超过平均值的2个标准差(布林线上轨)时，做空该工具，希望它会回到SMA。当价格低于2标准差(布林线下轨)时，做多。但在趋势市场中，价格可能远远高于2标准差，甚至3标准差，导致重大损失。</p><p id="1767" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">那么，我们能从一个具有均值回复策略的非平稳序列中获利来捕捉短期超卖/超买运动吗？</p><p id="e061" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将测试线性“放大”策略；当价格越来越超过z值时，我们逐渐增加我们的空头头寸，反之亦然。这里，我们将我们的位置设置为等于z得分的负值，因此这是一个线性均值回复策略。</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="1bd8" class="lb lc ht kx b fv ld le l lf lg">df['zscore'] = zscore(df['Close'],lookback)<br/>df['position'] = - df['zscore']</span></pre><p id="f579" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，我们通过将我们的头寸乘以价格变化，减去0.05%的交易费，计算我们投资组合的市场价值变化，从而计算我们的分钟PnL:</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="9b8a" class="lb lc ht kx b fv ld le l lf lg">df['pnl'] = df['position'].shift(1) * df['Close'].pct_change() - df['position'].diff().abs()*0.0003<br/>ret = df['pnl'].dropna()</span></pre><p id="bde8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后我们绘制权益曲线:</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="0951" class="lb lc ht kx b fv ld le l lf lg">(1+df['pnl']).cumprod().plot(figsize=(12,6))</span></pre><figure class="jv jw jx jy fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff lm"><img src="../Images/ed0c719e2a42a9a0b2b866e124db9803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HLJE3ug_0w7UFMOi9OOaeg.png"/></div></div></figure><p id="e4f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它不起作用可能是因为竞争——更多的人使用这种策略降低了它的盈利能力。事实上，如果不包括交易成本，该策略仍然非常有利可图。然而，更多的资本正在向同一方向流动，导致不利于该战略的价格变动。尽管如此，让我们看看一些性能指标，即夏普比率和最大下降</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="750f" class="lb lc ht kx b fv ld le l lf lg">N = 365 * 1440<br/>r = 0.2/365/1440</span><span id="fe0b" class="lb lc ht kx b fv lj le l lf lg">sharpe =(np.mean(ret)-r)/np.std(ret)*np.sqrt(N)<br/>print('Sharpe: ), sharpe)<br/>cum_ret = (ret+1).cumprod()<br/>peak = cum_ret.expanding(min_periods=1).max()<br/>dd = (cum_ret/peak)-1<br/>print('MDD: ' , dd.min())</span></pre><p id="3112" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们能修改策略使它再次盈利吗？你可以尝试改变回望周期或线性，降低交易成本，设置止盈或止损，应用像布林线等阈值。</p><p id="da0a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们只在6日至7日的区间交易，并将回望期增加到20天，以减少交易频率，会怎么样？</p><pre class="jv jw jx jy fq kw kx ky kz aw la dt"><span id="6862" class="lb lc ht kx b fv ld le l lf lg">lookback = 1440 * 20<br/>z1 = 6<br/>z2 = -1<br/>z3 = 7<br/>z4 = 1</span><span id="7f65" class="lb lc ht kx b fv lj le l lf lg">df['zscore'] = zscore(df['Close'],lookback)<br/>df['position'] = (df['zscore'].abs() &gt; z1) * z2 * df['zscore'] + (df['zscore'].abs() &gt; z3 ) * z4 * df['zscore']<br/>df['pnl'] = df['position'].shift(1) * df['Close'].pct_change() - df['position'].diff().abs() *0.0005<br/>ret = df['pnl'].dropna()<br/>N = 365 * 1440<br/>r = 0.08/365/1440<br/>sharpe =(np.mean(ret)-r)/np.std(ret)*np.sqrt(N)<br/>print('Sharpe:', sharpe)<br/>cum_ret = (ret+1).cumprod()<br/>peak = cum_ret.expanding(min_periods=1).max()<br/>dd = (cum_ret/peak)-1<br/>print('MDD: ' , dd.min())<br/>(1+df['pnl']).cumprod().plot(figsize=(12,6))</span><span id="c98d" class="lb lc ht kx b fv lj le l lf lg">#Sharpe: -0.9104931575786175<br/>#MDD:  -0.016416421941021553</span></pre><figure class="jv jw jx jy fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff ln"><img src="../Images/f0477662b3fa58d5051b7a9f6f30e878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYqDRzXBpchvjrqPp8verg.png"/></div></div></figure><p id="d990" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是我们只有少数交易在统计上是不可靠的，而且容易出现过度拟合的问题。当然，我们有一些假设和细节的遗漏，读者应该在实施之前仔细设计和测试他们的交易系统。</p><p id="2d22" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">再见。</p><blockquote class="lo"><p id="53cc" class="lp lq ht bd lr ls lt lu lv lw lx jn ek translated">加入Coinmonks <a class="ae ly" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ly" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="9936" class="lz lc ht bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv dt translated">另外，阅读</h1><ul class=""><li id="b7de" class="mw mx ht is b it my ix mz jb na jf nb jj nc jn nd ne nf ng dt translated"><a class="ae ly" href="https://coincodecap.com/crypto-trading-terminals" rel="noopener ugc nofollow" target="_blank"> 5款最佳加密交易终端</a> | <a class="ae ly" href="https://coincodecap.com/best-defi-apps" rel="noopener ugc nofollow" target="_blank">最佳DeFi应用</a></li><li id="805f" class="mw mx ht is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng dt translated"><a class="ae ly" href="https://coincodecap.com/coinbase-vs-wazirx" rel="noopener ugc nofollow" target="_blank">比特币基地vs瓦济克斯</a> | <a class="ae ly" href="https://coincodecap.com/bitrue-review" rel="noopener ugc nofollow" target="_blank">比特鲁点评</a> | <a class="ae ly" href="https://coincodecap.com/poloniex-vs-bittrex" rel="noopener ugc nofollow" target="_blank">波洛涅克斯vs比特鲁</a></li><li id="589d" class="mw mx ht is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng dt translated"><a class="ae ly" href="https://coincodecap.com/crypto-exchanges-in-germany" rel="noopener ugc nofollow" target="_blank">德国最佳加密交易所</a> | <a class="ae ly" href="https://coincodecap.com/arbitrum" rel="noopener ugc nofollow" target="_blank"> Arbitrum:第二层解决方案</a></li><li id="36cc" class="mw mx ht is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng dt translated"><a class="ae ly" rel="noopener" href="/coinmonks/binance-trading-bots-d0d57bb62c4c">币安交易机器人</a> | <a class="ae ly" rel="noopener" href="/coinmonks/okex-review-6b369304110f"> OKEx审查</a> | <a class="ae ly" href="https://coincodecap.com/atani-review" rel="noopener ugc nofollow" target="_blank">阿塔尼审查</a></li><li id="d70c" class="mw mx ht is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng dt translated"><a class="ae ly" rel="noopener" href="/coinmonks/best-crypto-signals-telegram-5785cdbc4b2b">最佳加密交易信号电报</a> | <a class="ae ly" rel="noopener" href="/coinmonks/moonxbt-review-6e4ab26d037"> MoonXBT评论</a></li></ul></div></div>    
</body>
</html>