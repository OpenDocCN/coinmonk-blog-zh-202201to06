<html>
<head>
<title>Detailed explanation of Ethereum
Yellow book (part 4) ——Transaction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊黄皮书详解(四)——交易</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/detailed-explanation-of-ethereum-yellow-book-part-4-transaction-481fb378ad2e?source=collection_archive---------34-----------------------#2022-03-16">https://medium.com/coinmonks/detailed-explanation-of-ethereum-yellow-book-part-4-transaction-481fb378ad2e?source=collection_archive---------34-----------------------#2022-03-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/2f484e3ebf20269c81b4e2c33b51fb3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7_P0vpkdv6qdidv5uoNzg.png"/></div></div></figure><blockquote class="jb jc jd"><p id="e05c" class="je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">以太坊如何进行交易？在本文中，我们将讨论事务验证规则，以及它们存在的原因；然后，我们将深入研究事务是如何执行的，以及节点在验证事务时采取的每一步。</p><p id="cbdd" class="je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">欢迎关注并与我们讨论</p><p id="ceb7" class="je jf jg jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">作者:<a class="ae kd" href="mailto:support@lunaray.co" rel="noopener ugc nofollow" target="_blank">support@lunaray.co</a></p></blockquote><h2 id="82e8" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">0x01简介</h2><p id="f7fd" class="pw-post-body-paragraph je jf ht jh b ji lc jk jl jm ld jo jp kp le js jt kt lf jw jx kx lg ka kb kc hm dt translated">简单地说，状态转换函数使用当前状态和事务作为输入来计算下一个状态。</p><figure class="li lj lk ll fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lh"><img src="../Images/5569e536f6887d5d8f167b3f4a6fe313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OXh9aeDmJMkb3BNqr9NMaQ.png"/></div></div></figure><h2 id="745d" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">0x02交易验证</h2><p id="ff54" class="pw-post-body-paragraph je jf ht jh b ji lc jk jl jm ld jo jp kp le js jt kt lf jw jx kx lg ka kb kc hm dt translated">在执行事务之前，节点验证事务是否满足一些基本规则。如果连这些基本规则都不通过，节点就不会执行事务。</p><ul class=""><li id="4328" class="lm ln ht jh b ji jj jm jn kp lo kt lp kx lq kc lr ls lt lu dt translated">符合RLP编码格式</li><li id="176b" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">有合法签名</li><li id="d07b" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">具有合法的nonce(与交易发送方的当前nonce值相同)</li><li id="41d4" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">执行交易的(内在成本)低于交易设置的gas限制的交易</li><li id="f681" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">发送者的账户余额大于或等于交易所需的预付款</li></ul><p id="b42e" class="pw-post-body-paragraph je jf ht jh b ji jj jk jl jm jn jo jp kp jr js jt kt jv jw jx kx jz ka kb kc hm dt translated">还有一个规则，不是事务固有的规则——如果一系列准备打包成一个块的事务，加上这个事务，会使所有事务的总gas限制超过该块的Gas限制，那么那个事务就不能和那些事务一起打包成一个块。</p><ul class=""><li id="fe7b" class="lm ln ht jh b ji jj jm jn kp lo kt lp kx lq kc lr ls lt lu dt translated"><strong class="jh hu">符合RLP编码格式</strong></li></ul><p id="f16a" class="pw-post-body-paragraph je jf ht jh b ji jj jk jl jm jn jo jp kp jr js jt kt jv jw jx kx jz ka kb kc hm dt translated">RLP(递归长度前缀)是以太坊中序列化对象的编码方式；与其他方法一样，如果不根据RLP对对象进行编码，就无法对对象进行解码，也无法通过数据编码信息获得原始对象。该规则的目的是确保以太坊客户端在收到交易后，能够成功解码并执行交易。</p><ul class=""><li id="1b95" class="lm ln ht jh b ji jj jm jn kp lo kt lp kx lq kc lr ls lt lu dt translated"><strong class="jh hu">交易必须有合法签名</strong></li></ul><p id="3f7a" class="pw-post-body-paragraph je jf ht jh b ji jj jk jl jm jn jo jp kp jr js jt kt jv jw jx kx jz ka kb kc hm dt translated">假设你的以太坊账户里有很多以太，现在有人试图发起交易把你账户里的钱转到他自己的账户里，你怎么看？你肯定不想看到有人冒充你，偷你的钱，这就是为什么我们需要交易签名。以太坊使用非对称加密，确保只有实际控制人才能从账户发起交易。在以太坊上，账户地址由个人的<strong class="jh hu">公钥</strong>生成。当发送交易时，<strong class="jh hu">私有密钥</strong>用于签署交易，然后所有<strong class="jh hu">节点</strong>可以确定交易是否实际上由相关账户的私有密钥的所有者签署。没有合法签名的交易没有执行的意义，所以必须有合法签名是交易的固有规则之一。</p><ul class=""><li id="fa9a" class="lm ln ht jh b ji jj jm jn kp lo kt lp kx lq kc lr ls lt lu dt translated"><strong class="jh hu">交易随机数和账户随机数必须匹配</strong></li></ul><p id="8a0e" class="pw-post-body-paragraph je jf ht jh b ji jj jk jl jm jn jo jp kp jr js jt kt jv jw jx kx jz ka kb kc hm dt translated">在以太坊中，账户nonce值代表账户发送的交易数量(在合约账户的情况下，nonce值是指账户创建的合约数量)。如果没有nonce，同一事务可能会被错误地执行多次(所谓的“重放攻击”)。以太坊强制交易随机数值与账户随机数值相匹配。这不仅可以防止重放攻击，还可以确保事务只执行和改变一次状态。</p><ul class=""><li id="2db7" class="lm ln ht jh b ji jj jm jn kp lo kt lp kx lq kc lr ls lt lu dt translated"><strong class="jh hu">交易的固有成本必须低于交易设定的气体上限</strong></li></ul><p id="ad2b" class="pw-post-body-paragraph je jf ht jh b ji jj jk jl jm jn jo jp kp jr js jt kt jv jw jx kx jz ka kb kc hm dt translated">每个事务都有与之相关的gas发送一个事务的成本由两部分组成:<strong class="jh hu">固有成本</strong>和<strong class="jh hu">执行成本</strong>。执行成本取决于事务需要运行多少<strong class="jh hu">以太坊虚拟机</strong> (EVM)资源，执行一个事务需要的操作越多，执行的成本就越高。固有成本由事务的<strong class="jh hu">有效负载</strong>决定，分为以下三个有效负载:</p><ul class=""><li id="e293" class="lm ln ht jh b ji jj jm jn kp lo kt lp kx lq kc lr ls lt lu dt translated">如果交易是为了创建智能合约，则有效负载是创建智能合约的EVM代码</li><li id="c0f3" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">如果事务要调用智能合约的函数，那么有效负载就是执行消息的输入数据</li><li id="4ea8" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">如果交易只是两个账户之间的转账，那么有效负载是空的</li><li id="d148" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">g交易= 21，000魏</li><li id="7a17" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">Gtxcreate = 32，000魏</li><li id="5850" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">Gtxdatazero = 4魏</li><li id="0682" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated">gtxdata非零= 68微</li></ul><h2 id="f00f" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">交易前</h2><p id="7287" class="pw-post-body-paragraph je jf ht jh b ji lc jk jl jm ld jo jp kp le js jt kt lf jw jx kx lg ka kb kc hm dt translated">交易前=气限*气价+价值(交易的气限)</p><h2 id="bb62" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">0x03执行事务</h2><p id="55da" class="pw-post-body-paragraph je jf ht jh b ji lc jk jl jm ld jo jp kp le js jt kt lf jw jx kx lg ka kb kc hm dt translated">验证完事务后，就该执行它了。在以太坊中，执行一个事务改变状态——几个事务打包成一个块，每个块相当于一个事务列表；当事务按顺序执行时，会输出一个新的合法状态。交易执行如下:</p><ol class=""><li id="4f1e" class="lm ln ht jh b ji jj jm jn kp lo kt lp kx lq kc ma ls lt lu dt translated">将发件人帐户随机数值增加1</li><li id="a7f1" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc ma ls lt lu dt translated">来自发送方账户的借记交易预付款(gasLimit * gasPrice)</li><li id="6d0a" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc ma ls lt lu dt translated">确定交易可用于执行的gas值(gasLimit内在成本)</li><li id="960f" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc ma ls lt lu dt translated">执行事务中包含的操作(转移、调用或创建智能合约)</li><li id="a2ba" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc ma ls lt lu dt translated">通过<strong class="jh hu">自毁</strong>和<strong class="jh hu">存储</strong>功能向发送方退款</li><li id="5bbb" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc ma ls lt lu dt translated">将任何未使用的<strong class="jh hu">气体</strong>退还给交易的发送者</li><li id="3f22" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc ma ls lt lu dt translated">将采矿收入转移至受益人账户(通常属于开采包含交易的区块的采矿者)</li></ol><p id="7629" class="pw-post-body-paragraph je jf ht jh b ji jj jk jl jm jn jo jp kp jr js jt kt jv jw jx kx jz ka kb kc hm dt translated">REF:https://ether eum . github . io/yellow paper/paper . pdf</p><blockquote class="mb"><p id="9308" class="mc md ht bd me mf mg mh mi mj mk kc ek translated">加入Coinmonks <a class="ae kd" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae kd" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="09e4" class="ml kf ht bd kg mm mn mo kk mp mq mr ko ms mt mu ks mv mw mx kw my mz na la nb dt translated">另外，阅读</h1><ul class=""><li id="e950" class="lm ln ht jh b ji lc jm ld kp nc kt nd kx ne kc lr ls lt lu dt translated"><a class="ae kd" rel="noopener" href="/coinmonks/godex-io-review-7366086519fb"> Godex.io审核</a> | <a class="ae kd" rel="noopener" href="/coinmonks/invity-review-70f3030c0502">邀请审核</a> | <a class="ae kd" href="https://coincodecap.com/bitforex-review" rel="noopener ugc nofollow" target="_blank"> BitForex审核</a></li><li id="3b67" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated"><a class="ae kd" rel="noopener" href="/coinmonks/bitcoin-margin-trading-exchange-bcbfcbf7b8e3">最佳比特币保证金交易</a> | <a class="ae kd" rel="noopener" href="/coinmonks/lolli-review-e6ddc7895ad8">萝莉点评</a> | <a class="ae kd" href="https://coincodecap.com/bityard-margin-trading" rel="noopener ugc nofollow" target="_blank">比特币保证金交易</a></li><li id="d102" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated"><a class="ae kd" href="https://coincodecap.com/create-nft" rel="noopener ugc nofollow" target="_blank">创造并出售你的第一个NFT </a> | <a class="ae kd" href="https://coincodecap.com/best-crypto-trading-bots" rel="noopener ugc nofollow" target="_blank">密码交易机器人</a></li><li id="7b03" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated"><a class="ae kd" href="https://coincodecap.com/buy-shiba-coindcx" rel="noopener ugc nofollow" target="_blank">如何在CoinDCX上购买柴犬(SHIB)币？</a></li><li id="c94f" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated"><a class="ae kd" href="https://coincodecap.com/cbet-casino-review" rel="noopener ugc nofollow" target="_blank"> CBET评论</a> | <a class="ae kd" href="https://coincodecap.com/kucoin-vs-coinbase" rel="noopener ugc nofollow" target="_blank">库科恩vs比特币基地</a> | <a class="ae kd" href="https://coincodecap.com/bybit-vs-coinbase" rel="noopener ugc nofollow" target="_blank">拜比特vs比特币基地</a></li><li id="b3f6" class="lm ln ht jh b ji lv jm lw kp lx kt ly kx lz kc lr ls lt lu dt translated"><a class="ae kd" href="https://coincodecap.com/fold-app-review" rel="noopener ugc nofollow" target="_blank">折叠App回顾</a> | <a class="ae kd" rel="noopener" href="/coinmonks/localbitcoins-review-6cc001c6ed56"> LocalBitcoins回顾</a> | <a class="ae kd" href="https://coincodecap.com/bybit-binance-moonxbt" rel="noopener ugc nofollow" target="_blank"> Bybit vs币安</a></li></ul></div></div>    
</body>
</html>