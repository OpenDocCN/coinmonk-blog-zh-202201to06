<html>
<head>
<title>The Risks of Storing Sensitive Data in Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在以太坊中存储敏感数据的风险</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/the-risks-of-storing-sensitive-data-in-ethereum-a39bb5fb444c?source=collection_archive---------5-----------------------#2022-05-25">https://medium.com/coinmonks/the-risks-of-storing-sensitive-data-in-ethereum-a39bb5fb444c?source=collection_archive---------5-----------------------#2022-05-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="8786" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">攻击者视角</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/f6d0961104b0b41179763eb4ed39c841.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xygtx7wZAmu0_Ses"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Photo by <a class="ae jy" href="https://unsplash.com/@dvlden?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nenad Novaković</a> on <a class="ae jy" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3f33" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">以太坊于2015年初首次推出，我们大多数人现在都知道它是一个公共的区块链网络，任何拥有网络访问权限的人都可以查看其他人进行的交易。出于同样的原因，在以太坊中存储敏感数据会带来很大的风险。但是，以太坊上的私人数据是如何公开的呢？攻击者如何从以太坊交易中获取信息？本博客的主要关注领域将是这些，并展示攻击者如何可能接近以太坊交易，以提取敏感数据。</p><p id="adc9" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">用一个示例场景来讨论概念总是更好。以下代码片段摘自<a class="ae jy" href="https://swcregistry.io/docs/SWC-136" rel="noopener ugc nofollow" target="_blank"> SWC注册中心的未加密私有数据链</a>。</p><pre class="jj jk jl jm fq kv kw kx ky aw kz dt"><span id="1ebb" class="la lb ht kw b fv lc ld l le lf">pragma solidity ^0.5.0; </span><span id="c15e" class="la lb ht kw b fv lg ld l le lf"><strong class="kw hu">contract</strong> <strong class="kw hu">OddEven</strong> { <br/><strong class="kw hu">struct</strong> Player { <br/><strong class="kw hu">address</strong> addr; <br/><strong class="kw hu">uint</strong> number; <br/>} </span><span id="2cc6" class="la lb ht kw b fv lg ld l le lf">Player[2] <strong class="kw hu">private</strong> players; <br/><strong class="kw hu">uint</strong> count = 0; </span><span id="8970" class="la lb ht kw b fv lg ld l le lf"><strong class="kw hu">function</strong> <strong class="kw hu">play</strong>(<strong class="kw hu">uint</strong> number) <strong class="kw hu">public</strong> <strong class="kw hu">payable</strong> { <br/><strong class="kw hu">require</strong>(msg.value == 1 ether, ‘msg.value must be 1 eth’); players[count] = Player(msg.sender, number); <br/>count++; <br/><strong class="kw hu">if</strong> (count == 2) selectWinner(); <br/>} </span><span id="32a6" class="la lb ht kw b fv lg ld l le lf"><strong class="kw hu">function</strong> <strong class="kw hu">selectWinner</strong>() <strong class="kw hu">private</strong> { <br/><strong class="kw hu">uint</strong> n = players[0].number + players[1].number;<br/>(<strong class="kw hu">bool</strong> success, ) = players[n%2].addr.call.value(<strong class="kw hu">address</strong>(this).balance)(“”); <strong class="kw hu">require</strong>(success, ‘transfer failed’); <br/><strong class="kw hu">delete</strong> players; count = 0; <br/>} <br/>}</span></pre><p id="ee84" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">以上是一个猜谜游戏的合同。两个用户可以每人猜一个数字，如果这些数字的总和是偶数，那么第一个玩家获胜，否则第二个玩家获胜。为了成为游戏的一部分并猜测号码，用户必须转移/下注1 ETH到合同，并且获胜的用户将获得该游戏的全部下注金额。</p><p id="5aaa" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">合同乍一看挺好的吧？函数<strong class="kb hu"> selectWinner() </strong>和<strong class="kb hu">玩家结构</strong>被声明为<strong class="kb hu">私有</strong>，用户只能调用play(unit)函数。以下是功能和状态变量上<strong class="kb hu">私有</strong>可见性级别的<a class="ae jy" href="https://docs.soliditylang.org/en/latest/contracts.html" rel="noopener ugc nofollow" target="_blank">正式定义。</a></p><blockquote class="lh li lj"><p id="a9f7" class="jz ka lk kb b kc kd iu ke kf kg ix kh ll kj kk kl lm kn ko kp ln kr ks kt ku hm dt translated">函数:私有函数类似于内部函数，但是它们在派生契约中是不可见的。</p><p id="dd47" class="jz ka lk kb b kc kd iu ke kf kg ix kh ll kj kk kl lm kn ko kp ln kr ks kt ku hm dt translated">状态变量:私有状态变量类似于内部变量，但它们在派生契约中不可见。</p></blockquote><p id="b946" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">现在我们已经讨论了契约逻辑，让我们继续讨论用户事务，我们可以利用<a class="ae jy" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"> Remix online IDE </a>。复制-粘贴上面的合同代码来重新混合和部署合同。假设用户1是普通用户，用户2是攻击者。攻击者会等待用户1先行动。在这种情况下，攻击者有什么优势？为了理解这一点，让我们假设用户1已经猜出了一个数字，并通过下面的交易将其与1 ETH一起输入到智能合同中。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff lo"><img src="../Images/f72f2d94a3d0e145a9aa5322b9eb29d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2puVYfgw9Zez4s3PqpsOgA.png"/></div></div></figure><h2 id="cdfb" class="la lb ht bd lp lq lr ls lt lu lv lw lx ki ly lz ma km mb mc md kq me mf mg mh dt translated">从用户事务中提取私有数据</h2><p id="8e80" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">让我们仔细看看上面user1的事务中的输入参数(事务数据),看看攻击者是如何理解它的。</p><pre class="jj jk jl jm fq kv kw kx ky aw kz dt"><span id="cd63" class="la lb ht kw b fv lc ld l le lf">0x6898f82b0000000000000000000000000000000000000000000000000000000000000066</span></pre><p id="9668" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">这个十六进制值由两部分组成。前四个字节<strong class="kb hu"> (6898f82b) </strong>指定调用哪个函数。它是使用函数名和参数的Keccak-256哈希生成的，也称为函数签名，即<strong class="kb hu"> play(uint256) </strong>。如果你有一个Keccak-256散列，有时可以使用<a class="ae jy" href="https://www.4byte.directory/signatures/" rel="noopener ugc nofollow" target="_blank">以太坊签名数据库</a>来识别函数签名。要确认6898f82b是Keccak-256 hash of play(uint256)，可以利用<a class="ae jy" href="https://emn178.github.io/online-tools/keccak_256.html" rel="noopener ugc nofollow" target="_blank"> Keccak-256 online hasher </a>。</p><p id="aeb6" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">从上述十六进制值的第五个字节开始，接下来是编码的参数。即用户作为参数传递给函数“play”的内容。每个参数由填充到32字节的输入的十六进制值表示。在我们的例子中，它是“0x 0000000000000000000000000000000000000000000000066”，因为它是对应于user1输入“102”的十六进制值。有关参数编码的更多信息，请参考<a class="ae jy" href="https://docs.soliditylang.org/en/latest/abi-spec.html#formal-specification-of-the-encoding" rel="noopener ugc nofollow" target="_blank">编码的可靠性正式规范</a>。</p><p id="d584" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">现在，作为攻击者的用户2知道用户1的输入是102。因此，为了赢得游戏，攻击者只需输入一个数字，该数字将使用户1输入和用户2输入的总和成为奇数。因此，用户2(攻击者)将赢得猜谜游戏并获得全部下注金额。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mn"><img src="../Images/722f5766420b170b029ec7528b41f933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Bq_kMPr98xhLVsk-"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Photo by <a class="ae jy" href="https://unsplash.com/@jefflssantos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jefferson Santos</a> on <a class="ae jy" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="0ec5" class="la lb ht bd lp lq lr ls lt lu lv lw lx ki ly lz ma km mb mc md kq me mf mg mh dt translated">如果是复函数签名会怎样？</h2><p id="be33" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">复杂函数签名可以由长度可变的输入字符串组成，该长度取决于所调用的特定函数和所需的参数等。没有问题，我们有合同的应用程序二进制接口(ABI)和Nodejs的救援。ABI是以太坊生态系统中与合同交互的标准接口，包括来自区块链之外的和合同之间的。ABI的可以在像<a class="ae jy" href="https://etherscan.io/" rel="noopener ugc nofollow" target="_blank"> EtherScan </a>这样的探索者上找到，或者可以在<a class="ae jy" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"> Remix online IDE </a>中编译后复制。下面是猜谜游戏合同的ABI。</p><pre class="jj jk jl jm fq kv kw kx ky aw kz dt"><span id="2bf3" class="la lb ht kw b fv lc ld l le lf">[<br/>  {<br/>    "constant": false,<br/>    "inputs": [<br/>      {<br/>        "name": "number",<br/>        "type": "uint256"<br/>      }<br/>    ],<br/>    "name": "play",<br/>    "outputs": [],<br/>    "payable": true,<br/>    "stateMutability": "payable",<br/>    "type": "function"<br/>  }<br/>]</span></pre><p id="acc2" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">将上述ABI保存在abi.json文件中。接下来，通过npm安装“<a class="ae jy" href="https://www.npmjs.com/package/ethereum-input-data-decoder" rel="noopener ugc nofollow" target="_blank">以太坊-输入-数据-解码器</a>”模块。</p><pre class="jj jk jl jm fq kv kw kx ky aw kz dt"><span id="99e8" class="la lb ht kw b fv lc ld l le lf">npm install ethereum-input-data-decoder</span></pre><p id="a248" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">将下面的代码保存在Nodejs文件中。确保将正确的<strong class="kb hu">文件路径</strong>提到abi.json文件，并在代码中插入正确的<strong class="kb hu">交易数据</strong>。</p><pre class="jj jk jl jm fq kv kw kx ky aw kz dt"><span id="7de5" class="la lb ht kw b fv lc ld l le lf">const InputDataDecoder = require('ethereum-input-data-decoder');<br/>const decoder = new InputDataDecoder(`${__dirname}/abi.json`);</span><span id="c099" class="la lb ht kw b fv lg ld l le lf">const data = `0x6898f82b0000000000000000000000000000000000000000000000000000000000000066`;</span><span id="3c3f" class="la lb ht kw b fv lg ld l le lf">const result = decoder.decodeData(data);<br/>console.log(result);</span></pre><p id="f3f7" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">运行上面的Nodejs脚本，观察解码的用户输入和用户调用的函数的详细信息，如下所示。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mo"><img src="../Images/a1723a392e2de140af7aceab871812ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VfP2M9EprroGqvIDNamXJQ.png"/></div></div></figure><h2 id="b341" class="la lb ht bd lp lq lr ls lt lu lv lw lx ki ly lz ma km mb mc md kq me mf mg mh dt translated">结论</h2><p id="fc0f" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">的确，使用EtherScan或Remix，任何人都可以从以太坊交易中提取人类可读格式的用户输入。然而，阅读这篇博客将帮助您理解事务数据(txdata)的复杂性，它将是以太坊中用于许多目的的众多自动化工具的主要输出之一。我希望这篇博客能揭示在以太网中保存敏感数据的风险，即使是在私有状态变量/函数中。任何私人数据要么离线存储，要么仔细加密。</p><blockquote class="mp"><p id="6773" class="mq mr ht bd ms mt mu mv mw mx my ku ek translated">加入Coinmonks <a class="ae jy" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jy" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="a3f2" class="mz lb ht bd lp na nb nc lt nd ne nf lx iz ng ja ma jc nh jd md jf ni jg mg nj dt translated">另外，阅读</h1><ul class=""><li id="39b9" class="nk nl ht kb b kc mi kf mj ki nm km nn kq no ku np nq nr ns dt translated"><a class="ae jy" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae jy" href="https://coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a> | <a class="ae jy" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="f356" class="nk nl ht kb b kc nt kf nu ki nv km nw kq nx ku np nq nr ns dt translated"><a class="ae jy" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">莱杰vs n rave</a>|<a class="ae jy" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">莱杰nano s vs x </a> | <a class="ae jy" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="49f2" class="nk nl ht kb b kc nt kf nu ki nv km nw kq nx ku np nq nr ns dt translated"><a class="ae jy" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit Exchange审查</a> | <a class="ae jy" href="https://coincodecap.com/bityard-reivew" rel="noopener ugc nofollow" target="_blank"> Bityard审查</a> | <a class="ae jy" href="https://coincodecap.com/jet-bot-review" rel="noopener ugc nofollow" target="_blank"> Jet-Bot审查</a></li><li id="ab9e" class="nk nl ht kb b kc nt kf nu ki nv km nw kq nx ku np nq nr ns dt translated"><a class="ae jy" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203">3 commas vs crypto hopper</a>|<a class="ae jy" rel="noopener" href="/coinmonks/earn-crypto-interest-b10b810fdda3">赚取加密利息</a></li><li id="1cf7" class="nk nl ht kb b kc nt kf nu ki nv km nw kq nx ku np nq nr ns dt translated">最好的比特币<a class="ae jy" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a> | <a class="ae jy" rel="noopener" href="/coinmonks/bitbox02-review-your-swiss-bitcoin-hardware-wallet-c36c88fff29"> BitBox02回顾</a></li><li id="036b" class="nk nl ht kb b kc nt kf nu ki nv km nw kq nx ku np nq nr ns dt translated"><a class="ae jy" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">BlockFi vs Celsius</a>|<a class="ae jy" rel="noopener" href="/coinmonks/hodlnaut-review-best-way-to-hodl-is-to-earn-interest-on-your-bitcoin-6658a8c19edf">Hodlnaut点评</a> | <a class="ae jy" href="https://coincodecap.com/kucoin-review" rel="noopener ugc nofollow" target="_blank"> KuCoin点评</a></li><li id="e457" class="nk nl ht kb b kc nt kf nu ki nv km nw kq nx ku np nq nr ns dt translated"><a class="ae jy" rel="noopener" href="/coinmonks/bitsgap-review-a-crypto-trading-bot-that-makes-easy-money-a5d88a336df2"> Bitsgap审查</a> | <a class="ae jy" rel="noopener" href="/coinmonks/quadency-review-a-crypto-trading-automation-platform-3068eaa374e1"> Quadency审查</a> | <a class="ae jy" rel="noopener" href="/coinmonks/bitbns-review-38256a07e161"> Bitbns审查</a></li></ul></div></div>    
</body>
</html>