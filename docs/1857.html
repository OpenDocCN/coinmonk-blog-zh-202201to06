<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/coinmonks/detailed-explanation-of-ethereum-yellow-paper-merkle-tree-and-ethereum-objects-d85edf5051b8?source=collection_archive---------7-----------------------#2022-03-07">https://medium.com/coinmonks/detailed-explanation-of-ethereum-yellow-paper-merkle-tree-and-ethereum-objects-d85edf5051b8?source=collection_archive---------7-----------------------#2022-03-07</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><h2 id="2b47" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">以太坊黄皮书<br/>详解— — Merkle树与以太坊对象</h2><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff iq"><img src="../Images/295ff549b5c4f406e2c2231549b66138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TaYFaay6DeS-QybPpDCmQ.png"/></div></div></figure><blockquote class="jc jd je"><p id="cf24" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在本帖中，我们将了解更多以太坊中的主要对象及其作用，我们还将简要讨论如何在以太坊中使用Merkle树。</p><p id="cbdd" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">欢迎关注并与我们讨论</p><p id="ceb7" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">作者:<a class="ae ke" href="mailto:support@lunaray.co" rel="noopener ugc nofollow" target="_blank">support@lunaray.co</a></p></blockquote><h2 id="4eac" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x01 Merkle树</h2><p id="855e" class="pw-post-body-paragraph jf jg ht ji b jj kf jl jm jn kg jp jq id kh jt ju ih ki jx jy il kj kb kc kd hm dt translated">在Merkle树中，叶节点包含数据块的散列，非叶节点包含其子节点的散列。</p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kk"><img src="../Images/b65d40fbe3d03b6230d9685c9ab114b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ttQbNNWpSELH2cK4p8sQ5Q.png"/></div></div></figure><p id="2e6d" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">在Merkle树中，对底层数据的任何更改都会导致引用该数据的节点的哈希发生变化。因为每个父节点散列依赖于其子节点的数据，所以对子节点数据的任何更改都会导致父节点散列发生变化。从每个父节点到根节点都会发生这种情况。因此，对叶节点上数据的任何更改都会导致根节点哈希发生变化。由此，我们可以获得两个重要的性质:</p><ul class=""><li id="c73b" class="kl km ht ji b jj jk jn jo id kn ih ko il kp kd kq kr ks kt dt translated">在判断两个Merkle树指向的数据是否完全相同时，我们不需要比较每个叶子节点，只需要比较根节点存储的hash即可。</li><li id="f707" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd kq kr ks kt dt translated">当确定树是否指向特定数据时，我们可以使用Merkel证明技术。</li></ul><p id="68fd" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">第一个属性很重要，因为它只能存储根节点的哈希来表示该时间点的数据。这意味着我们只需要在区块链上存储代表该块的树的根哈希(而不是在区块链中存储所有数据),并且仍然保持数据完整。</p><h2 id="4292" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x02世界状况</h2><ul class=""><li id="86bc" class="kl km ht ji b jj kf jn kg id kz ih la il lb kd kq kr ks kt dt translated">世界状态是地址(帐户)和帐户状态之间的映射。世界状态不存储在区块链上，但是黄皮书指出，实现应该将这些数据存储在一个树中(也称为状态数据库或状态树)。世界状态可以被视为通过事务执行的不断更新的全局状态。</li><li id="960d" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd kq kr ks kt dt translated">关于以太坊账户的所有信息都在世界状态中，并存储在世界状态树中。如果您想知道帐户的余额或智能合约的当前状态，您可以通过查询world state来检索该帐户的帐户状态。</li></ul><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lc"><img src="../Images/66a60c8f11925c5216f4460d4e9ad7ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJvTxPKw7NVJFkLJWrdOLA.png"/></div></div></figure><h2 id="cc5e" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x03帐户状态</h2><ul class=""><li id="bf26" class="kl km ht ji b jj kf jn kg id kz ih la il lb kd kq kr ks kt dt translated">在以太坊，有两种账户:外部账户(<strong class="ji ld"> EOAs </strong>)和<strong class="ji ld">合约账户</strong>。</li><li id="c874" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd kq kr ks kt dt translated"><strong class="ji ld"> EOA </strong>账户可以用它来互相发送以太网和部署智能合同</li><li id="2aca" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd kq kr ks kt dt translated">契约帐户是在部署智能契约时创建的帐户。</li><li id="0428" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd kq kr ks kt dt translated">每个智能合约都有自己的以太坊账户</li><li id="c87f" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd kq kr ks kt dt translated">帐户状态包含有关以太坊帐户的信息。例如，它存储一个帐户有多少余额以及该帐户发送的交易次数。每个帐户都有一个帐户状态。</li></ul><p id="c26b" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">以太坊帐户状态包含以下信息:</p><ol class=""><li id="ec82" class="kl km ht ji b jj jk jn jo id kn ih ko il kp kd le kr ks kt dt translated"><strong class="ji ld">现时值</strong></li></ol><p id="be30" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">从此地址发送的交易数量(如果它当前是EOA帐户)或由此帐户生成的合同创建操作</p><p id="c5bc" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated"><strong class="ji ld"> 2。余额</strong></p><p id="8beb" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">该帐户拥有的乙醚量(单位为魏)。</p><p id="5c0e" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated"><strong class="ji ld"> 3。存储根</strong></p><p id="f988" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">帐户存储树的根节点的哈希值</p><p id="129e" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated"><strong class="ji ld"> 4。代码哈希</strong></p><p id="4c37" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">对于合约账户，这是存储EVM代码散列的账户。对于EOA帐户，请留空。account state中一个不可忽视的细节是，包括上述的所有对象都是可变的(codeHash除外)。例如，当一个账户向其他账户发送以太网时，除了随机数增加之外，该账户的余额也相应地改变。如果部署了易受攻击的智能协定，codeHash的不变性使得无法修复和更新此协定。相应地，只能部署一个新的契约(易受攻击的版本将始终存在于区块链上)。这就是为什么有必要使用Truffle进行智能契约开发和部署，并在使用Solidity编程时遵循最佳实践。</p><p id="992f" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated"><strong class="ji ld">账户存储树是保存账户相关数据的结构:</strong>此项仅适用于合约账户，在EOA，storageRoot为空，codeHash为空字符串的哈希值。所有智能合约数据都以32字节映射的形式存储在帐户存储树中。如何维护账户状态树中的合同数据，此处不再赘述。</p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lf"><img src="../Images/acbd3a3441bd14accd84cf4a801b115f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwaRR5XTtZ1x5v74iMFc-g.png"/></div></div></figure><h2 id="8ddd" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x04交易</h2><p id="fc70" class="pw-post-body-paragraph jf jg ht ji b jj kf jl jm jn kg jp jq id kh jt ju ih ki jx jy il kj kb kc kd hm dt translated">事务驱动从当前状态到下一个状态的转换。以太坊有三种交易:</p><ol class=""><li id="e76e" class="kl km ht ji b jj jk jn jo id kn ih ko il kp kd le kr ks kt dt translated">在eoa(外部账户)之间转移价值的交易(例如，改变发送方和接收方的余额大小)。</li><li id="1507" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated">发送消息以调用协定的事务(例如，通过发送消息调用来触发setter方法以在协定中设置值)。</li><li id="b112" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated">用于部署合同(从而创建合同帐户)的交易。</li></ol><p id="146d" class="pw-post-body-paragraph jf jg ht ji b jj jk jl jm jn jo jp jq id js jt ju ih jw jx jy il ka kb kc kd hm dt translated">交易由以下部分组成:</p><ol class=""><li id="be62" class="kl km ht ji b jj jk jn jo id kn ih ko il kp kd le kr ks kt dt translated"><strong class="ji ld"> nonce </strong>:该账户发送的交易流水号的个数(大致可以理解为“这是该账户的第一笔交易”)。</li><li id="b209" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> gasPrice </strong>:为完成该交易和执行计算而支付的每单位天然气的费用(以魏计量)。</li><li id="11dc" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> gasLimit </strong>:执行该交易时可以使用的最大气体量。</li><li id="0a0a" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld">至</strong>:如果该交易用于发送以太，这里是接收以太的EOA地址；如果此事务用于向协定发送消息(例如，调用智能协定中的方法)，这里是协定的地址；如果该事务用于创建合同，则此处的值为空。</li><li id="15d8" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld">值</strong>:如果该交易用于收发以太，则此处为收款账户中以卫计量的代币金额；如果此事务用于向合约发送消息调用，则这里是支付给接收此消息的智能合约的Wei的金额；如果这个事务被用来创建一个合同，这里是在合同初始化时存储在帐户中的乙醚量。</li><li id="1839" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> v，r，s </strong>:交易的加密签名中使用的值，可以用来确定交易的发送方。</li><li id="5d20" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld">数据</strong>(仅用于值传递和向智能合约发送消息调用)输入伴随消息调用的数据(例如，如果您要在智能合约中执行setter方法，数据字段应包括setter方法的标识符和您要设置的参数值)。</li><li id="f35d" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> init </strong>(仅合同创建)用于初始化合同的EVM代码。<br/>块中的所有事务也存储在Merkle树中。并且这棵树的根节点哈希值是由块头保存的！</li></ol><h2 id="5677" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x05块</h2><ul class=""><li id="2baf" class="kl km ht ji b jj kf jn kg id kz ih la il lb kd kq kr ks kt dt translated">一个组块分为两部分，即<strong class="ji ld">组块头</strong>和<strong class="ji ld">组块体</strong>。</li><li id="da73" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd kq kr ks kt dt translated">块头是以太坊中区块链的一部分。它存储前一个块(也称为父块)的哈希值，并通过块头的连接形成密码背书链。</li><li id="54e0" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd kq kr ks kt dt translated">块主体包含该块中记录的一系列事务，以及一个ommer块标题列表。</li></ul><figure class="ir is it iu fq iv fe ff paragraph-image"><div class="fe ff lg"><img src="../Images/b060ff2bef7bcb5f1b7d958968930efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*Br0aKrLAt_oz0706M0x46w.png"/></div></figure><ol class=""><li id="62b2" class="kl km ht ji b jj jk jn jo id kn ih ko il kp kd le kr ks kt dt translated"><strong class="ji ld">括号:</strong>前一个块的块头哈希。每个块都包含前一个块的散列，一直追溯到链上的源块。这是保持数据不被篡改的结构设计(对前一个块的任何篡改都会影响所有后续块的哈希值)。</li><li id="8d0e" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> ommersHash: </strong>大叔块头和部分块体的哈希值。</li><li id="ed2a" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld">受益人:</strong>通过开采该区块获得报酬的以太坊账户。</li><li id="69b1" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> stateRoot: </strong>世界状态树的根节点的hash(所有事务执行完毕后)。</li><li id="b14b" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> transactionsRoot: </strong>事务树的根节点的哈希值。该树包含块主体中的所有事务。</li><li id="c822" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> receiptsRoot: </strong>每次执行交易时，以太坊都会生成与结果对应的交易回执。这是该交易收据树的根节点散列。</li><li id="893c" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> logsBloom: </strong>用于判断某个块的事务是否生成某个日志。这避免了将日志信息存储在块中(节省了大量空间)。</li><li id="6901" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld">难度:</strong>本块的难度值。这是对当前区块开采难度的衡量</li><li id="99ad" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld">数量:</strong>预订购区块总数。这表示区块链的高度(即区块链上有多少个区块)。起源块的编号是0。</li><li id="da48" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> gasLimit: </strong>每笔交易都需要加油。气体限制表示该块中记录的所有交易可使用的气体总量。这是一种限制块中事务数量的方法。</li><li id="9453" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> gasUsed: </strong>区块内每次交换实际消耗的气体总量。</li><li id="57f2" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld">时间戳:</strong>创建块时的Unix时间戳。</li><li id="db7a" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> extraData: </strong>可变长度的字节数组，可以输入任何内容。当矿工创建区块时，任何东西都可以添加到这个区域。</li><li id="8c7d" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> mixHash: </strong>用于验证一个块是否确实记录在链上的哈希值。</li><li id="0c1a" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated"><strong class="ji ld"> nonce: </strong>与<strong class="ji ld"> mixHash </strong>一样，该值用于验证该块是否实际记录在链上。</li></ol><h2 id="e701" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">0x06结束</h2><ol class=""><li id="d567" class="kl km ht ji b jj kf jn kg id kz ih la il lb kd le kr ks kt dt translated">世界状态树包括从地址到帐户状态的映射。世界状态树的根散列由块存储(在stateRoot字段中)，这指示了块创建时的当前状态。整个网络中只有一棵世界状态树。</li><li id="bd7c" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated">帐户存储树保存与智能合同相关的数据信息。帐户存储树的根哈希(在storageRoot字段中)由帐户状态存储。每个帐户都有一个帐户存储树。</li><li id="1d6d" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated">事务树包含块中的所有事务信息。事务树的根节点的哈希值由块头存储(在transactionsRoot区域中)。每个块都有一个事务树。</li><li id="884c" class="kl km ht ji b jj ku jn kv id kw ih kx il ky kd le kr ks kt dt translated">事务处理收据树包含块中所有事务处理的收据信息。交易收据树的根节点的哈希值也由块头存储(在receiptsRoot区域中)；每个块都有一个相应的交易收据树。</li></ol></div></div>    
</body>
</html>