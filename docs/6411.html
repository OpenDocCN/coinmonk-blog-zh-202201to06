<html>
<head>
<title>Hashed Timelock Contracts (HTLCs)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">散列时间锁合同(HTLCs)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hashed-timelock-contracts-htlcs-b3f0ba1eee02?source=collection_archive---------10-----------------------#2022-05-09">https://medium.com/coinmonks/hashed-timelock-contracts-htlcs-b3f0ba1eee02?source=collection_archive---------10-----------------------#2022-05-09</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="aba9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">概述</strong> <br/>比特币网络保留了交易的公共账本。由于块的大小限制，第1层区块链本身无法处理大量的事务。闪电网络通过使用“支付通道”解决了这个可扩展性问题。</p><p id="d6b6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在双方之间建立支付通道，使得他们可以在通道容量(用于资助通道的BTC的值)内进行多次支付，而不会在区块链上被记录。只有融资和结算交易需要在链上记录。</p><p id="f4a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因为支付通道在两方之间，所以对于一个用户来说，打开一个支付通道来与他们想要支付的每个不同的实体进行交易是不经济的。在这种情况下，我们可以利用这种能力，在lightning网络上沿着多个渠道可靠地路由支付，因为只需要找出一条连接节点(Lightning网络中的其他参与者)的路径，就可以将支付路由到您的目的地。这允许断开的节点互相支付。</p><p id="2212" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一个实际的例子是，爱丽丝想为她在埃里克店里买的比萨饼付款。Alice没有Eric的支付通道，但有Bob的支付通道。鲍勃又有一个与卡罗尔的频道，卡罗尔又有一个与戴安娜的频道，戴安娜又有一个与埃里克的频道。<br/>然后，Alice可以通过Bob、Carol和Diana将付款转给Eric。</p><p id="4b31" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了可靠地路由支付，闪电网络使用散列时间锁合同(HTLCs)</p></div><div class="ab cl jo jp hb jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hm hn ho hp hq"><p id="c88a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">什么是HTLCs？</strong></p><p id="3160" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">散列时间锁协定是一种既被散列锁定又被时间锁定的智能协定。hashlock限制锁定到hash的资金的花费，直到提供密码证明，而timelock限制资金的花费，直到将来的某个时间或块高度。</p><blockquote class="jv jw jx"><p id="3b13" class="iq ir jy is b it iu iv iw ix iy iz ja jz jc jd je ka jg jh ji kb jk jl jm jn hm dt translated"><strong class="is hu">“htlc有两个基本条款:用<em class="ht">哈希锁</em>保护的支付条款和用<em class="ht">时间锁</em>保护的退款条款。要打开散列锁并要求付款，接收者需要揭示契约中编码的散列摘要的原像。要打开时间锁并获得退款，消费者需要等到合同中规定的特定时间之后。”</strong></p><p id="ff74" class="iq ir jy is b it iu iv iw ix iy iz ja jz jc jd je ka jg jh ji kb jk jl jm jn hm dt translated">— <a class="ae kc" href="https://bitcoinops.org/en/topics/htlc/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">比特币Optech </strong> </a></p></blockquote><p id="91a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">HTLCs用于不同的支付实施中，如原子掉期——加密货币的跨链交易，以及零知识或有支付，允许通过比特币网络和闪电网络等公平交换出售的商品和支付。<br/>在这篇文章中，我将重点介绍它们在Lightning网络中的使用。</p><p id="f96a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">雷电网络中的htlc</strong></p><p id="c1bd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">HTLCs充当通过闪电网络进行支付的公平协议。在网络上进行支付的过程始于收款人生成发票并发送给汇款人。该发票包含相关信息，如支付散列、支付金额、路由提示等。<br/>支付散列‘h’本质上是一个在发送给发送者之前已经被散列的大随机数。当发送方从他们的一个渠道收到所请求金额的报价时，他们将提供原像作为回报(该原像散列到支付散列),这既允许支付结算，又作为接收方已收到资金的证明，因为他们是唯一知道原像的人。</p><p id="f159" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面是执行此操作的比特币脚本:</p><figure class="kd ke kf kg fq kh"><div class="bz el l di"><div class="ki kj l"/></div></figure><p id="7507" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该脚本有两种可能的支出路径。第一条路径是，如果Bob能够产生“r ”,则向Bob发送资金</p><pre class="kd ke kf kg fq kk kl km kn aw ko dt"><span id="2688" class="kp kq ht kl b fv kr ks l kt ku">OP IF<br/>    OP HASH160 &lt;Hash160 (R)&gt; OP EQUALVERIFY<br/></span></pre><p id="1827" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果该路径不满足，则第二路径在时间锁到期后向Alice赎回资金。</p><pre class="kd ke kf kg fq kk kl km kn aw ko dt"><span id="b10d" class="kp kq ht kl b fv kr ks l kt ku">OP ELSE<br/>    2 &lt;Alice1&gt; &lt;Bob1&gt; OP CHECKMULTISIG<br/>OP ENDIF 1&gt; &lt;Bob1&gt; OP CHECKMULTISIG<br/>OP ENDIF</span></pre><p id="ee23" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">正如前面模拟的那样，HTLCs可以帮助Alice向Eric支付1BTC购买比萨饼的费用，如下所示:</p><figure class="kd ke kf kg fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="fe ff kv"><img src="../Images/d941e4df61040d9be0cdbe05f5417358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4mcVYh_SpJ0Hv2ETzev3g.png"/></div></div><figcaption class="lc ld fg fe ff le lf bd b be z ek">Payment routing using HTLCS. Image source — <a class="ae kc" rel="noopener" href="/softblocks/lightning-network-in-depth-part-2-htlc-and-payment-routing-db46aea445a8">Magomed Aliev</a></figcaption></figure><ol class=""><li id="070a" class="lg lh ht is b it iu ix iy jb li jf lj jj lk jn ll lm ln lo dt translated">Eric生成一个秘密(` r `)，对该秘密进行哈希运算，然后将其发送给Alice。这个秘密只有埃里克知道。</li><li id="1705" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo dt translated">Alice的节点计算最短的路由路径，计算中间节点的费用(0.003BTC)以及Eric的付款(1BTC)，并创建一个HTLC，如果Bob能够在接下来的10个街区内提供秘密(也称为preimage)，则向Bob支付1.03BTC，否则，资金将退还给Alice。</li><li id="9f0e" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo dt translated">来自Alice的HTLC激励Bob创建一个HTLC来支付Carol，如果她能够在接下来的9个街区内提供秘密(` r `),则Carol具有1.02BTC的支付渠道，否则，资金将退还给他。</li><li id="c749" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo dt translated">Carol进而创建一个HTLC，如果Diana能在接下来的8个街区内提供秘密(` r ` ),则支付Diana 1.01BTC，否则，资金将退还给她。</li><li id="2063" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo dt translated">然后，Diana创建一个HTLC，如果她能在接下来的7个街区内提供秘密(` r `)，则支付给Eric 1BTC，否则，资金将退还给她(Diana)。</li><li id="b668" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo dt translated">在接收HTLC时，作为最终目的地和接收者的Eric提供他生成的秘密(` r `)并解锁HTLC以获得1BTC付款。</li></ol><p id="d108" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因为Diana现在有了秘密(` r `)，所以她将这个秘密提供给Carol来解锁她的HTLC并取回锁定的资金。这个秘密也通过鲍勃反向传播，然后传给爱丽丝。这在上图的步骤6–9中进行了说明。<br/>该路由路径中的所有节点都可以要求HTLCs中锁定的资金，并完成成功的支付路由。</p></div><div class="ab cl jo jp hb jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hm hn ho hp hq"><p id="7f9d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">局限性</strong></p><p id="8034" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于在整个支付路线中，所有HTLCs使用相同的支付散列，这在理论上可能会导致一些问题:</p><ol class=""><li id="1299" class="lg lh ht is b it iu ix iy jb li jf lj jj lk jn ll lm ln lo dt translated">发票重用将导致隐私泄露，并且使得先前使用该发票路由支付的节点能够更容易地花费该HTLC，因为他们已经具有预像/秘密。</li><li id="6a0b" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo dt translated">易受虫洞攻击:付款拦截和资金/费用索赔。</li></ol><blockquote class="jv jw jx"><p id="256f" class="iq ir jy is b it iu iv iw ix iy iz ja jz jc jd je ka jg jh ji kb jk jl jm jn hm dt translated">共享信息的两个节点(例如，因为它们属于同一个人)可以通过看到它们已经接收到具有相同散列的HTLCs来知道它们是否在一起的路由中。这不仅给了他们我们不希望他们访问的路由信息，而且还允许他们执行“虫洞攻击”,其中包括他们一起窃取他们之间所有中间跳的费用</p><p id="361a" class="iq ir jy is b it iu iv iw ix iy iz ja jz jc jd je ka jg jh ji kb jk jl jm jn hm dt translated">- <a class="ae kc" href="https://suredbits.com/payment-points-part-1/#references" rel="noopener ugc nofollow" target="_blank">确定位</a></p></blockquote></div><div class="ab cl jo jp hb jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hm hn ho hp hq"><p id="5a8e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">改进</strong></p><p id="7ed4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">时间锁定合同(PTLCs)是作为HTLCs的一种解决方案而提出的。<br/>PTLC是一种比特币交易，将比特币锁定在比特币椭圆曲线上的一个点(读作:非常大的数字)。它不同于HTLCs的主要锁定和解锁方法。<br/> PTLC点锁使用公钥(比特币椭圆曲线上的另一个<em class="jy">点</em>)锁定，并通过提供来自令人满意的<a class="ae kc" href="https://bitcoinops.org/en/topics/adaptor-signatures/" rel="noopener ugc nofollow" target="_blank">签名适配器</a>的相应签名来解锁。</p></div><div class="ab cl jo jp hb jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hm hn ho hp hq"><p id="c4d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">结论</strong>然而，在整个支付路由中使用相同的支付散列对HTLC作为公平协议的作用造成了一些威胁，因为知道该支付散列的节点可能能够在将前像反向传播到发送者以确认支付期间拦截并索取资金(并突然结束路由)。</p><blockquote class="lu"><p id="a898" class="lv lw ht bd lx ly lz ma mb mc md jn ek translated"><em class="me">加入Coinmonks </em> <a class="ae kc" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> <em class="me">电报频道</em> </a> <em class="me">和</em> <a class="ae kc" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> <em class="me"> Youtube频道</em> </a> <em class="me">了解加密交易和投资</em></p></blockquote><h1 id="dec6" class="mf kq ht bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb dt translated">另外，阅读</h1><ul class=""><li id="d442" class="lg lh ht is b it nc ix nd jb ne jf nf jj ng jn nh lm ln lo dt translated"><a class="ae kc" href="https://coincodecap.com/bookmap-review-2021-best-trading-software" rel="noopener ugc nofollow" target="_blank"> Bookmap评论</a> | <a class="ae kc" href="https://coincodecap.com/crypto-exchange-usa" rel="noopener ugc nofollow" target="_blank">美国5大最佳加密交易所</a></li><li id="748c" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn nh lm ln lo dt translated">最佳加密<a class="ae kc" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a> | <a class="ae kc" rel="noopener" href="/coinmonks/bitbns-review-38256a07e161"> Bitbns评论</a></li><li id="66f9" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn nh lm ln lo dt translated"><a class="ae kc" href="https://coincodecap.com/crypto-exchange-in-singapore" rel="noopener ugc nofollow" target="_blank">新加坡十大最佳加密交易所</a> | <a class="ae kc" href="https://coincodecap.com/buy-axs-token" rel="noopener ugc nofollow" target="_blank">收购AXS </a></li><li id="814e" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn nh lm ln lo dt translated"><a class="ae kc" href="https://coincodecap.com/red-dog-casino-review" rel="noopener ugc nofollow" target="_blank">红狗赌场评论</a> | <a class="ae kc" href="https://coincodecap.com/swyftx-review" rel="noopener ugc nofollow" target="_blank"> Swyftx评论</a> | <a class="ae kc" href="https://coincodecap.com/coingate-review" rel="noopener ugc nofollow" target="_blank"> CoinGate评论</a></li><li id="beb5" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn nh lm ln lo dt translated"><a class="ae kc" href="https://coincodecap.com/best-crypto-to-invest-in-india-in-2021" rel="noopener ugc nofollow" target="_blank">投资印度的最佳加密软件</a>|<a class="ae kc" href="https://coincodecap.com/wazirx-p2p" rel="noopener ugc nofollow" target="_blank">WazirX P2P</a>|<a class="ae kc" href="https://coincodecap.com/hi-dollar-review" rel="noopener ugc nofollow" target="_blank">Hi Dollar Review</a></li><li id="ac59" class="lg lh ht is b it lp ix lq jb lr jf ls jj lt jn nh lm ln lo dt translated"><a class="ae kc" href="https://coincodecap.com/5-best-crypto-trading-bots-in-canada" rel="noopener ugc nofollow" target="_blank">加拿大最佳加密交易机器人</a> | <a class="ae kc" href="https://coincodecap.com/kucoin-review" rel="noopener ugc nofollow" target="_blank">库币评论</a></li></ul></div></div>    
</body>
</html>