<html>
<head>
<title>Function State Mutability in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">固体中的函数状态可变性</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/function-state-mutability-in-solidity-acb850eedccc?source=collection_archive---------3-----------------------#2022-02-28">https://medium.com/coinmonks/function-state-mutability-in-solidity-acb850eedccc?source=collection_archive---------3-----------------------#2022-02-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/72cd41beb9275ffffc376fa52d7a0b14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mXetECAVqOV_dHzR"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@mcarsience_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Meagan Carsience</a> on <a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="24ba" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">状态可变性是可靠性中的一个概念，它定义了函数的行为以及它们如何与存储在区块链上的数据进行交互。在本文中，您将了解不同的状态可变性修饰符，以及如何在编写优化的智能契约时应用它们。</p><p id="e4a2" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">solidity中两个主要的状态可变性修改器是:</p><ul class=""><li id="8feb" class="ke kf ht ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">视角</li><li id="dc9d" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">纯的</li></ul><p id="6f7c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">查看功能</strong></p><p id="f4c0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">视图函数是只读函数，用关键字<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">view</em></strong></code>声明。它们不会改变区块链的状态。这意味着用<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">view</em></strong></code>关键字声明的函数不能包含可能修改状态变量或存储在区块链上的数据的代码。</p><p id="5b8e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">另外，<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">view</em></strong></code>函数不能接收或发送以太，只能调用其他<code class="eh ks kt ku kv b"><strong class="ji hu">view</strong></code>或<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">pure</em></strong></code>函数。有可能修改区块链状态的<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">view</em></strong></code>函数将抛出一个错误，并且无法编译。同样，当编译器检测到一个只读取而不写入区块链的函数时，它会建议您将该函数的状态可变性设置为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">view</em></strong></code>。</p><p id="d680" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">下面的<strong class="ji hu"> <em class="kw">合同A </em> </strong>中的例子演示了<strong class="ji hu"> <em class="kw">视图结果</em> </strong>函数如何从状态中读取数据(<strong class="ji hu"> <em class="kw"> num1 </em> </strong>和<strong class="ji hu"> <em class="kw"> num2 </em> </strong>)但不修改数据。</p><pre class="kx ky kz la fq lb kv lc ld aw le dt"><span id="bdaf" class="lf lg ht kv b fv lh li l lj lk">pragma solidity 0.8.10;</span><span id="d8eb" class="lf lg ht kv b fv ll li l lj lk">contract A {</span><span id="605f" class="lf lg ht kv b fv ll li l lj lk">  // Declaring state variables</span><span id="3888" class="lf lg ht kv b fv ll li l lj lk">  uint num1 = 5;</span><span id="5af9" class="lf lg ht kv b fv ll li l lj lk">  uint num2 = 10;</span><span id="df34" class="lf lg ht kv b fv ll li l lj lk"><br/>  // View function to calculate product of 2 numbers</span><span id="823a" class="lf lg ht kv b fv ll li l lj lk">  function viewResult() public view returns(uint product){</span><span id="c3fc" class="lf lg ht kv b fv ll li l lj lk">  // Expression that reads state</span><span id="0eac" class="lf lg ht kv b fv ll li l lj lk">     product = num1 * num2;<br/>  }</span><span id="6b99" class="lf lg ht kv b fv ll li l lj lk">}</span></pre><p id="701f" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">输出:</p><pre class="kx ky kz la fq lb kv lc ld aw le dt"><span id="2e02" class="lf lg ht kv b fv lh li l lj lk">product = 50</span></pre><p id="a734" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">纯函数？</strong></p><p id="22ac" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">将函数声明为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">pure</em></strong></code>会限制该函数改变存储在区块链上的数据或与之交互。标记为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">pure</em></strong></code>的函数既不读取也不写入区块链。它们不能接收或发送以太，不能使用<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">msg</em></strong></code>的成员或<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">block</em></strong></code>的成员，只能调用其他<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">pure</em></strong></code>函数。</p><p id="ad2e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如果您的契约包含不读取或修改状态的函数，编译器将发出警告，并建议您指定状态可变性。可以忽略此警告，代码仍然可以编译。但是，最好总是将其设置为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">pure</em></strong></code> <strong class="ji hu"> <em class="kw">。</em>T12】</strong></p><p id="fe16" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">下面的<strong class="ji hu"> <em class="kw">合同B </em> </strong>中的例子演示了<strong class="ji hu"> <em class="kw"> addNum </em> </strong>函数既不从状态读取数据也不向状态写入数据。</p><pre class="kx ky kz la fq lb kv lc ld aw le dt"><span id="2f73" class="lf lg ht kv b fv lh li l lj lk">pragma solidity 0.8.10;</span><span id="02b0" class="lf lg ht kv b fv ll li l lj lk">contract B {</span><span id="ccc1" class="lf lg ht kv b fv ll li l lj lk">  // Pure function that calculates sum of 2 numbers</span><span id="04b4" class="lf lg ht kv b fv ll li l lj lk">  function addNum(uint num1, uint num2) public pure<br/>  returns(uint sum){</span><span id="0027" class="lf lg ht kv b fv ll li l lj lk">  // Expression that computes data passed in as parameters<br/>  // and does not read or modify state</span><span id="0e6a" class="lf lg ht kv b fv ll li l lj lk">    sum = num1 + num2;</span><span id="f093" class="lf lg ht kv b fv ll li l lj lk">  }</span><span id="2d0b" class="lf lg ht kv b fv ll li l lj lk">}</span></pre><p id="16de" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">输出:</p><pre class="kx ky kz la fq lb kv lc ld aw le dt"><span id="d108" class="lf lg ht kv b fv lh li l lj lk">sum = 15</span></pre><p id="6b67" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">为什么要将函数标记为视图或纯函数？</strong></p><p id="04bd" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu"> <em class="kw"> Gas优化:</em> </strong> Gas consumption仅适用于触发交易时，以及修改状态时触发交易。标记为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">view</em></strong></code>或<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">pure</em></strong></code>的函数不修改状态，因此不消耗gas，除非从外部契约调用它们。</p><p id="3842" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">其他函数状态可变性修饰符</strong></p><p id="4059" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">除了<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">view</em></strong></code>和<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">pure</em></strong></code>，功能状态可变性还可以是<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">payable</em></strong></code>或<strong class="ji hu">T30】不可支付。 </strong></p><p id="c4e6" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">应付功能</strong></p><p id="76eb" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">用<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">payable</em></strong></code>关键字声明一个函数允许函数发送和接收以太。试图通过未标记为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">payable</em></strong></code>的函数发送或接收以太网将导致交易被拒绝。</p><p id="241d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">因此，如果您的智能合约需要通过某个函数发送或接收以太，则必须将该函数标记为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">payable</em></strong></code>。</p><p id="4027" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">下面的<strong class="ji hu"> <em class="kw">存款</em> </strong>功能允许其他合约向<strong class="ji hu"> <em class="kw">合约C </em> </strong>发送乙醚。</p><pre class="kx ky kz la fq lb kv lc ld aw le dt"><span id="c749" class="lf lg ht kv b fv lh li l lj lk">pragma solidity 0.8.10;</span><span id="6c48" class="lf lg ht kv b fv ll li l lj lk">contract C {<br/>  uint balance = 0;</span><span id="0ff6" class="lf lg ht kv b fv ll li l lj lk">// <em class="kw">Payable function that allows other contracts</em><br/>// <em class="kw">to send ether to this contract</em>.</span><span id="bc52" class="lf lg ht kv b fv ll li l lj lk">   function deposit () payable public{<br/>    balance += msg.value;<br/>  } </span><span id="d0b4" class="lf lg ht kv b fv ll li l lj lk">}</span></pre><p id="6154" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">非付费功能</strong></p><p id="fea5" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu"> <em class="kw">非应付</em> </strong> <em class="kw"> </em>在当前solidity版本中不是关键字，而是在函数没有被显式定义为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">payable</em></strong></code>时默认的状态可变性修饰符。<strong class="ji hu"> <em class="kw">不可支付</em> </strong>未明确定义为<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">view</em></strong></code>或<code class="eh ks kt ku kv b"><strong class="ji hu"><em class="kw">pure</em></strong></code>的函数最适合于可能读取和修改状态变量的函数。<strong class="ji hu"> <em class="kw">非付费</em> </strong>功能的主要限制是它们不能接收或发送以太网。</p><pre class="kx ky kz la fq lb kv lc ld aw le dt"><span id="8901" class="lf lg ht kv b fv lh li l lj lk">pragma solidity 0.8.10;</span><span id="af36" class="lf lg ht kv b fv ll li l lj lk">contract D {</span><span id="4a8d" class="lf lg ht kv b fv ll li l lj lk">  uint count = 0;</span><span id="8b63" class="lf lg ht kv b fv ll li l lj lk">// <em class="kw">non-payable function that reads and modifies state</em>.</span><span id="b4bb" class="lf lg ht kv b fv ll li l lj lk">function increment() public returns(uint){<br/>    count += 1;<br/>    return count;  <br/>}</span><span id="895b" class="lf lg ht kv b fv ll li l lj lk">}</span></pre><p id="8cd9" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">上面<strong class="ji hu"> <em class="kw">合同D </em> </strong>中的<strong class="ji hu"> <em class="kw">增量</em> </strong>函数演示了<strong class="ji hu"> <em class="kw">非应付</em> </strong>函数如何通过访问声明的<strong class="ji hu"> <em class="kw">计数</em> </strong>变量从state中读取数据。它还说明了该函数如何潜在地通过在每次调用函数<strong class="ji hu"><em class="kw"/></strong>增量时将<strong class="ji hu"> <em class="kw">计数</em> </strong>的值加1来修改状态。</p><p id="9baa" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu"> <em class="kw">如果你觉得这很有帮助，请关注、分享并展示一些❤️👏。</em>T44】</strong></p><blockquote class="lm"><p id="7c31" class="ln lo ht bd lp lq lr ls lt lu lv kd ek translated">加入Coinmonks <a class="ae jf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jf" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="e9fc" class="lw lg ht bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms dt translated">另外，阅读</h1><ul class=""><li id="90df" class="ke kf ht ji b jj mt jn mu jr mv jv mw jz mx kd kj kk kl km dt translated"><a class="ae jf" href="https://coincodecap.com/create-nft" rel="noopener ugc nofollow" target="_blank">创造并出售你的第一个NFT </a> | <a class="ae jf" href="https://coincodecap.com/best-crypto-trading-bots" rel="noopener ugc nofollow" target="_blank">密码交易机器人</a></li><li id="1f8e" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae jf" href="https://coincodecap.com/buy-shiba-coindcx" rel="noopener ugc nofollow" target="_blank">如何在CoinDCX上购买柴犬(SHIB)币？</a></li><li id="eee6" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae jf" href="https://coincodecap.com/cbet-casino-review" rel="noopener ugc nofollow" target="_blank"> CBET评论</a> | <a class="ae jf" href="https://coincodecap.com/kucoin-vs-coinbase" rel="noopener ugc nofollow" target="_blank">库科恩vs比特币基地</a> | <a class="ae jf" href="https://coincodecap.com/bybit-vs-coinbase" rel="noopener ugc nofollow" target="_blank">拜比特vs比特币基地</a></li><li id="69e6" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae jf" href="https://coincodecap.com/fold-app-review" rel="noopener ugc nofollow" target="_blank">折叠App回顾</a> | <a class="ae jf" rel="noopener" href="/coinmonks/localbitcoins-review-6cc001c6ed56">本地比特币回顾</a> | <a class="ae jf" href="https://coincodecap.com/bybit-binance-moonxbt" rel="noopener ugc nofollow" target="_blank"> Bybit vs币安</a></li><li id="8965" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/crypto-margin-trading-exchanges-428b1f7ad108">加密保证金交易交易所</a> | <a class="ae jf" rel="noopener" href="/coinmonks/earn-bitcoin-6e8bd3c592d9">赚取比特币</a> | <a class="ae jf" href="https://coincodecap.com/mudrex-invest-review-the-best-way-to-invest-in-crypto" rel="noopener ugc nofollow" target="_blank"> Mudrex投资</a></li><li id="e5d5" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/wazirx-vs-coindcx-vs-bitbns-149f4f19a2f1">WazirX vs CoinDCX vs bit bns</a>|<a class="ae jf" rel="noopener" href="/coinmonks/blockfi-vs-coinloan-vs-nexo-cb624635230d">block fi vs coin loan vs Nexo</a></li><li id="36bc" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae jf" href="https://coincodecap.com/bitsler-review" rel="noopener ugc nofollow" target="_blank">比斯勒评论</a>|<a class="ae jf" href="https://coincodecap.com/wazirx-vs-coinswitch-vs-coindcx" rel="noopener ugc nofollow" target="_blank">WazirX vs coin switch vs coin dcx</a></li><li id="c079" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae jf" href="https://coincodecap.com/copy-trading-platforms" rel="noopener ugc nofollow" target="_blank"> 7大副本交易平台</a> | <a class="ae jf" href="https://coincodecap.com/buycoins-review" rel="noopener ugc nofollow" target="_blank"> BuyCoins点评</a></li><li id="57c4" class="ke kf ht ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae jf" href="https://coincodecap.com/profittradingapp-for-binance" rel="noopener ugc nofollow" target="_blank">XT.COM评论</a>币安评论 | <a class="ae jf" href="https://coincodecap.com/xt-com-review" rel="noopener ugc nofollow" target="_blank"/></li></ul></div></div>    
</body>
</html>