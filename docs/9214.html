<html>
<head>
<title>Uniswap Introduction — 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Uniswap简介— 2</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/uniswap-introduction-2-c60e66530e68?source=collection_archive---------2-----------------------#2022-06-23">https://medium.com/coinmonks/uniswap-introduction-2-c60e66530e68?source=collection_archive---------2-----------------------#2022-06-23</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="bbc2" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">遍历所有代码</h2></div><p id="66af" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是分散交换介绍的第二部分。在之前的<a class="ae ke" rel="noopener" href="/@gregshen0925/decentralized-exchange-intro-3ab7c3937041">文章</a>中，我们介绍了Uniswap的基本概念，如DEX德克斯、AMM、常数乘积公式。</p><p id="cd71" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然而，这是一个高层次的介绍，我们仍然没有专业到告诉奶奶Uniswap到底是什么。引擎盖下有很多东西！幸运的是，我们正在浏览代码以完全理解它。</p><h1 id="a812" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">从Uniswap V2智能合同的体系结构开始…</h1><blockquote class="kx ky kz"><p id="4733" class="ji jj la jk b jl jm iu jn jo jp ix jq lb js jt ju lc jw jx jy ld ka kb kc kd hm dt translated">Uniswap有三个版本，但我刚刚走过V2，原因如下。<br/> 1。V1太简单了，不具备所有的现代特征。<br/> 2。V3比V2更高效，并且通过添加“tick”优化了资金利用。因此这要复杂得多</p><p id="0196" class="ji jj la jk b jl jm iu jn jo jp ix jq lb js jt ju lc jw jx jy ld ka kb kc kd hm dt translated"><em class="ht">因为我们正在介绍什么是AMM以及它是如何工作的。V2是徒步穿越的最佳选择。</em></p></blockquote><h1 id="5542" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">Uniswap V2智能合同的架构</h1><p id="e2e7" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hm dt translated">有两个存储库，它们都包含两个主要的智能合同。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff lj"><img src="../Images/90a658a7ce301f89943c23fa6e57e6da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nE43BiFtn96vp_Xa.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">Architecture of Uniswap Repository</figcaption></figure><h1 id="a17e" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">核心</h1><p id="1b10" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hm dt translated">核心是存储资金和管理资金。它包含两个智能合同，<strong class="jk hu">对</strong>和<strong class="jk hu">工厂</strong>。</p><ul class=""><li id="8433" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated"><strong class="jk hu"> Pair </strong> <br/>智能合约，具有交换、铸造和焚烧代币的功能。</li><li id="70ab" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated"><strong class="jk hu">工厂</strong> <br/>创建和跟踪配对</li></ul><h1 id="d078" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">边缘</h1><p id="2feb" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hm dt translated">很明显，外围设备包含智能契约来与核心进行交互。它还包含两个智能契约，<strong class="jk hu">路由器</strong>和<strong class="jk hu">库</strong></p><ul class=""><li id="c631" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated"><strong class="jk hu">路由器</strong>与核心<br/>交互。提供<code class="eh mn mo mp mq b">swapETHForExactTokens</code>、<code class="eh mn mo mp mq b">swapExactETHForToken</code>等功能。</li><li id="6882" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated"><strong class="jk hu">库</strong> <br/>有些功能像<code class="eh mn mo mp mq b">getReserves</code>、<code class="eh mn mo mp mq b">getAmountIn</code>、<code class="eh mn mo mp mq b">getAmountOut</code>等。</li></ul><h1 id="d3f4" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">从核心开始</h1><p id="7a6c" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hm dt translated">如前所述，core中有两个智能合约，<strong class="jk hu"> Pair </strong>和<strong class="jk hu"> Factory。在本文中，我将只讨论配对合同。这是最难的一个，可能需要一些时间来理解。</strong></p><h1 id="c515" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">1.一副</h1><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mr"><img src="../Images/e290b24278653301f0de37691f892bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PFVC7ihJ80Wsqvgl.png"/></div></div></figure><ul class=""><li id="5e2e" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">这个契约名为UniswapV2Pair。它固有IUniswapV2Pair接口和UniswapV2ERC20，并扩展了UniswapV2ERC20。请注意，当合同名称前面有“I”时，大多数情况下是接口。</li><li id="35a0" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">是一个安全数学的库:)它包含了一些安全数学的安全数学。</li><li id="5478" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated"><code class="eh mn mo mp mq b">UQ112x112</code>是一个支持浮点数的库，因为solidity默认不支持浮点数(浮点数大于整数，所以会花费更多的汽油费)。最后112位用于小数部分。</li></ul><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff ms"><img src="../Images/368d8758d986e1a03d6bd52f204605c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ue-lpUESbY_b6i4E.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">UQ112x112 library</figcaption></figure><p id="2b3a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">该库将Q112设置为2。有两个功能，<code class="eh mn mo mp mq b">encode</code>和<code class="eh mn mo mp mq b">uqdiv</code>(解码)。</p><p id="c297" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><code class="eh mn mo mp mq b">encode</code>获取参数y并用Q112乘以它，而<code class="eh mn mo mp mq b">uqdiv</code>将UQ112x112除以uint112并返回UQ112x112。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mt"><img src="../Images/5125e44a979a64e7a3c41648d9304a60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-34prxEo7R5_ACp7.png"/></div></div></figure><ul class=""><li id="d348" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated"><code class="eh mn mo mp mq b">MINIMUM_LIQUIDITY</code>是将流动性(rootK)保持在1000以上，以避免在流动性计算中被零除。这个我们以后再说。</li><li id="f7f1" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">选择器允许我们通过ABI来调用令牌。</li></ul><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mu"><img src="../Images/01c03338515126be3aaa79fac3278d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jt8oLhbB9Ot0EH2F.png"/></div></div></figure><ul class=""><li id="a4cd" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">第16行是为第45行设置选择器</li></ul><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mv"><img src="../Images/c54e6301c6f1e2c8786ec49ab58e5562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AjYGjiwO9AOhLe7s.png"/></div></div></figure><ul class=""><li id="9a86" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">声明了一个叫工厂的地址，我们以后再谈</li><li id="811a" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">令牌0和令牌1是成对的令牌</li><li id="504d" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">保留0和保留1是令牌0和令牌1的保留</li><li id="a646" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">blockTimestampLast将存储该对交互时的最后一个块时间戳</li><li id="b0a4" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">price0CumulativeLast和price1CumulativeLast是令牌0和令牌1的最后价格</li><li id="e20a" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">kLast = reserve0 x reserve1因为K= XY (Uniswap是一个恒定的产品做市商)</li></ul><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mw"><img src="../Images/9ca0123e0d8518a18ae2a80593522294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t3Eye3IT2Qw6Ms6D.png"/></div></div></figure><p id="67c2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这些事件将在函数被调用时发出</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mx"><img src="../Images/57cea74c2133481e2aba61ced3aa16b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iytuFtEiT3Nq6E4C.png"/></div></div></figure><ul class=""><li id="ca1c" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated"><code class="eh mn mo mp mq b">constructor</code>将仅被调用一次，用于在部署智能合约的同时进行设置。在这里，我们将factory设置为msg.sender，这意味着部署这个智能合约的地址。</li><li id="efef" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated"><code class="eh mn mo mp mq b">initialize</code>是将token0设置为_token0，将token1设置为_token1。该函数将由工厂在部署时调用一次。</li></ul><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff my"><img src="../Images/1403cf057f85b4b042e422c2e9756cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j6fjhw0rtyVQgO0-.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">createPair</figcaption></figure><p id="bf9d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是<strong class="jk hu">工厂</strong>的<code class="eh mn mo mp mq b">createPair</code>合同。</p><ul class=""><li id="2d26" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">第33行用两个参数token0和token1调用<code class="eh mn mo mp mq b">initialize</code>。</li></ul><p id="664a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">现在这一对已经创建好了。稍后在<strong class="jk hu"> Factory中我们会更深入的讨论这个功能。</strong></p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mz"><img src="../Images/610554df52b099573b33e6413ffc2a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ymf8hYAOEXeHCvW9.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">_update function</figcaption></figure><p id="53f9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们一步一步地了解这个函数。</p><ul class=""><li id="e5b1" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated"><code class="eh mn mo mp mq b">require</code>检查balance0和balance1是否都小于2 -1的<code class="eh mn mo mp mq b">uint112(-1)</code>。</li><li id="daae" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">将blockTimeStamp设为<code class="eh mn mo mp mq b">uint32(block.timestamp % 2**32)</code>。</li></ul><blockquote class="kx ky kz"><p id="4085" class="ji jj la jk b jl jm iu jn jo jp ix jq lb js jt ju lc jw jx jy ld ka kb kc kd hm dt translated">为什么是block.timestamp % 2？<br/>我们来看看第79行和第80行。因为我们跟踪的代码<code class="eh mn mo mp mq b">UQ112x112</code>变成了224位，但是solidity用256位打包每个事务。为了优化使用，他们决定也存储blockTimeStamp，它必须是32位(256–224)。这就是为什么我们有一个mod函数来获取blockTimeStamp的剩余部分。32位的blockTimeStamp将在2106/02/27溢出。所以现在不用担心了。</p></blockquote><ul class=""><li id="599c" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">第76行是告诉blockTimeStamp是否溢出(这将在2106/02/27发生)。</li><li id="5eec" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第77行到第81行是为价格oracle更新价格。</li><li id="06ac" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">将reserve0设置为balance0，将reserve1设置为balance1</li><li id="a974" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">将blockTimeStampLast设置为当前块时间戳</li><li id="3e06" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">发出同步事件</li></ul><p id="1121" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><code class="eh mn mo mp mq b">update</code>只是一个更新储量和价格的函数。因此，每当储量、价格发生变化时，就会调用它。如<code class="eh mn mo mp mq b">mint</code>、<code class="eh mn mo mp mq b">burn</code>、<code class="eh mn mo mp mq b">swap</code>、<code class="eh mn mo mp mq b">sync</code>。</p><p id="41b2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">接下来，我们前往<code class="eh mn mo mp mq b">mint</code>和<code class="eh mn mo mp mq b">burn</code>。</p><p id="a06b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> <em class="la">铸造</em> </strong>是指流动性提供者<strong class="jk hu">将资金</strong>添加到池中，从而铸造LP令牌。LP令牌用于记录流动性提供者拥有的池的百分比。</p><p id="e750" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> <em class="la">燃烧</em> </strong>发生在流动性提供者<strong class="jk hu">提取资金</strong>和累计费用(我们将在后面进行计算)时，他的池所有权令牌被燃烧。</p><blockquote class="kx ky kz"><p id="6442" class="ji jj la jk b jl jm iu jn jo jp ix jq lb js jt ju lc jw jx jy ld ka kb kc kd hm dt translated">请关注我的最新发布。</p><p id="36f8" class="ji jj la jk b jl jm iu jn jo jp ix jq lb js jt ju lc jw jx jy ld ka kb kc kd hm dt translated"><strong class="jk hu">随时联系。</strong></p><p id="6000" class="ji jj la jk b jl jm iu jn jo jp ix jq lb js jt ju lc jw jx jy ld ka kb kc kd hm dt translated"><strong class="jk hu">邮箱:gregshen0925@pm.me </strong></p><p id="e969" class="ji jj la jk b jl jm iu jn jo jp ix jq lb js jt ju lc jw jx jy ld ka kb kc kd hm dt translated">电报:@gregshen0925</p></blockquote><h1 id="b875" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">铸造</h1><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff my"><img src="../Images/fb6e5937fbc7683ab78e8cfce5ffeba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TJdYKjzZenRaX0z4.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">mint function</figcaption></figure><p id="ef00" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">当一个人提供流动性时，就会发生这种情况:</p><ul class=""><li id="6e5c" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">110线有一个<code class="eh mn mo mp mq b">lock</code>。</li></ul><p id="1103" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是一个修饰符，修饰符是当你要在许多函数中检查相同的东西，但你不想写同样的代码这么多次(部署契约时更昂贵)。你可以写一个修饰符并在不同的函数中使用它。</p><p id="21a7" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在这种情况下，lock所做的是检查<code class="eh mn mo mp mq b">unlocked</code>是否为1，否则恢复。如果<code class="eh mn mo mp mq b">unlocked</code>为1，将其设置为0。第34行意味着运行代码的剩余部分(第111行到第131行)。完成后，再次将<code class="eh mn mo mp mq b">unlocked</code>设置为1。</p><p id="ef08" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是为了确保不会有两个交易同时改变流动性池。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff na"><img src="../Images/5ee138c66ea86dadf56c3ba67aea017a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Br9JjMuLBBrDPmG3.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">modifier lock()</figcaption></figure><p id="13d4" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">回到<code class="eh mn mo mp mq b">mint</code>:</p><ul class=""><li id="d94d" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">第111行:获取token0和token1的<strong class="jk hu">前期储量</strong>。这意味着流动性池中有多少令牌0和令牌1。</li><li id="2360" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第112、113行:获得令牌0和令牌1的<strong class="jk hu">当前储备</strong>，因为流动性提供者刚刚提供了他的令牌。</li><li id="3171" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第114、115行:通过计算当前准备金减去先前准备金，得到流动性提供者提供的金额。</li></ul><h1 id="e07b" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">费恩和明特费</h1><p id="dfb6" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hm dt translated">如果fee打开，mint流动性相当于sqrt(k)增长的1/6，其中sqrt代表平方根。即1/6的费用归<strong class="jk hu">厂</strong>(下图90线)。<strong class="jk hu">工厂</strong>是创建此<strong class="jk hu">对</strong>契约的契约。随着时间的推移，流动性池越来越大。</p><p id="78b9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">请注意，流动性是平方根K，因为K =X * Y，但如果我们将流动性翻倍至2X和2Y，K就变成4XY。我们使用sqrt(K)进行计算，以确保获得正确的流动性。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff nb"><img src="../Images/07cf5ffb411747608e7750b8e39b7c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y6fj_AW8n6D2g1TP.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">_mintFee</figcaption></figure><p id="9d93" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">对于被这个函数搞糊涂的人。请检查下面的计算过程。我相信你会理解的。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff nc"><img src="../Images/6b4a04e3121149e05d894723d5297277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OvTUrbeWj2rCs3zFvEuzoQ.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">f for fee, k for constant, S for liquidity/supply</figcaption></figure><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff my"><img src="../Images/3d3e0ec4e644288ccdd5b413d9cdd029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nd4tk6TFNXdKy9HX.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">mint function</figcaption></figure><ul class=""><li id="238e" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">第118行:<code class="eh mn mo mp mq b">totalSupply</code>表示池所有权令牌的总供应量，并且是在<code class="eh mn mo mp mq b">UniswapV2ERC20</code>中存储的变量。结对契约一开始就扩展了<code class="eh mn mo mp mq b">UniswapV2ERC20</code>，这也是它能够使用<code class="eh mn mo mp mq b">totalSupply</code>的原因。</li></ul><p id="b892" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如果<code class="eh mn mo mp mq b">totalSupply</code>为0，这意味着这是一个新的池，我们需要锁定<code class="eh mn mo mp mq b">MINIMIUM_LIQUIDITY</code>数量(1000)的LP令牌，以避免在流动性计算中被零除。锁定的方法是通过将它发送到<strong class="jk hu">阻塞孔</strong>(地址零)而没有人知道地址零的私钥，令牌被永远锁定。</p><ul class=""><li id="c63e" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">第123行:<code class="eh mn mo mp mq b">liquidity</code>是需要向流动性提供者铸造的新池LP令牌的数量。流动性提供者根据其提供的新资金量获得一定比例的资金池所有权令牌。</li><li id="5a04" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第126行:在如此多的动作之后，代币最终被铸造并被转移到流动性提供者。</li><li id="7ce1" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第128行:记得更新余额和准备金。</li><li id="83c5" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第130行:发出<strong class="jk hu"> Mint </strong>事件。</li></ul><p id="1a3b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu">很多人可能会对添加的基金感到困惑。</strong></p><p id="0b5b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">它们只是通过为每个令牌调用<code class="eh mn mo mp mq b">transfer(from: liquidity provider’s address, to: Pair contract’s address, amount)</code>来存放到ERC20契约中。然后，配对合同将读取余额(第112和113行)，并将它们与最后已知的余额(第114和115行)进行比较。这就是配对合同如何可以减少存款的数额。</p><p id="c958" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">下一个要分解的功能是<code class="eh mn mo mp mq b">burn</code>，与<code class="eh mn mo mp mq b">mint</code>正好相反。你猜怎么着你自己看吧，我想看的时候再看！</p><h1 id="a1e2" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">烧伤</h1><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff nd"><img src="../Images/c8c3433f343be8d8db11869ad7b68749.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgY9Or9rod8tJbPJDPW_1w.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">burn function</figcaption></figure><h1 id="477c" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">互换</h1><p id="1e45" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hm dt translated">与其他函数不同，swap是通过用户的地址调用的。它是通过与流动性池相互作用，将一种代币转换为另一种代币。</p><blockquote class="kx ky kz"><p id="f17c" class="ji jj la jk b jl jm iu jn jo jp ix jq lb js jt ju lc jw jx jy ld ka kb kc kd hm dt translated">交易新手？尝试<a class="ae ke" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae ke" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><h1 id="d546" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw dt translated">交换费</h1><p id="04a5" class="pw-post-body-paragraph ji jj ht jk b jl le iu jn jo lf ix jq jr lg jt ju jv lh jx jy jz li kb kc kd hm dt translated">在交换期间，用户将支付0.3%的费用，这些费用留在池中，因此池越来越大。5/6的费用奖励给流动性提供者。他们有LP令牌，记录他们拥有的池的比例。由于资金池越来越大(因为里面剩下的费用)，他们在提取资金(烧LP令牌)的同时，可以获得更多的资金。那些开发商真是太聪明了！</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff my"><img src="../Images/9435e4c755fa81d6f6d42f72ac55a140.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*39XlxENvAV-FfHkM.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">swap function</figcaption></figure><ul class=""><li id="8943" class="lz ma ht jk b jl jm jo jp jr mb jv mc jz md kd me mf mg mh dt translated">第160~168行:检查是否满足要求，并分配一些变量。</li><li id="6618" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第170、171行:合约乐观地将代币转移给交易者(没有确保交易者已经将相同数量的代币转移到合约的余额中)。它可以乐观地将令牌转移出去，因为函数中稍后会有断言来检查是否收到了相应的令牌(外围协定应该在调用交换之前发送令牌)。</li><li id="39b8" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第172行:如果请求，通知接收者关于交换的信息。</li><li id="1c5b" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第176，177行:条件操作，检查收到的令牌契约的数量。</li><li id="44fa" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第178行:检查合同是否至少收到了一个令牌。</li><li id="d06c" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第180，181行:从余额中减去交易费(0.3%)</li><li id="d494" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第182行:检查交易后K是否下降。互换后流动性永远不会降低。</li><li id="d603" class="lz ma ht jk b jl mi jo mj jr mk jv ml jz mm kd me mf mg mh dt translated">第185、186行:更新余额和储备，然后发出<strong class="jk hu">交换</strong>事件。</li></ul><p id="cb17" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">现在我们已经从核心覆盖了<strong class="jk hu">对</strong>合同。还有三份合同。感谢您的宝贵时间！</p><p id="ffe3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu">请关注我的最新发布。</strong></p><p id="e1cb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu">随时联系</strong></p><p id="349e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu">电子邮件:gregshen0925@gmail.com</strong></p></div></div>    
</body>
</html>