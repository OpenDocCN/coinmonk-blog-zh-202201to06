<html>
<head>
<title>IPFS File Upload — using Moralis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">IPFS文件上传—使用Moralis</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ipfs-file-upload-using-moralis-a24a9dff4368?source=collection_archive---------5-----------------------#2022-05-04">https://medium.com/coinmonks/ipfs-file-upload-using-moralis-a24a9dff4368?source=collection_archive---------5-----------------------#2022-05-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><h2 id="fd80" class="hr hs ht bd b gc hu hv hw hx hy hz ek ia translated" aria-label="kicker paragraph">NFT系列</h2><div class=""/><div class=""><h2 id="4174" class="pw-subtitle-paragraph iz ic ht bd b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ek translated">使用Moralis服务器和云功能上传IPFS文件的指南</h2></div><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff jr"><img src="../Images/4b2d8c810e2f9a888cf13205633f25ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Duoc7zSnIlJFMrmZiYXhOA.png"/></div></div></figure><p id="9a26" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">如果您还没有Moralis的帐户，请通过以下方式获得一个免费帐户:</p><p id="825c" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated"><strong class="kf id">前往</strong> <a class="ae kz" href="https://admin.moralis.io/login" rel="noopener ugc nofollow" target="_blank"> <strong class="kf id">道德家登录</strong> </a></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff la"><img src="../Images/fc97d32e6083adae842555b4f8ee7fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*xVvFe_u7xlM061C2pmxX8A.png"/></div><figcaption class="lb lc fg fe ff ld le bd b be z ek">Moralis Sign Up or Sign In</figcaption></figure><p id="9c47" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated"><strong class="kf id">创建新的服务器</strong></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff la"><img src="../Images/7493419ba88644213baf4cb41303eccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*GJRgjunmDp14nXQrfQhD1w.png"/></div><figcaption class="lb lc fg fe ff ld le bd b be z ek">Moralis Server</figcaption></figure><p id="56fe" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated"><strong class="kf id">选择要使用的链条</strong></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff la"><img src="../Images/58837ccd146b386cf8700382a5fa8dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*aXHL6_doBAuc_G_gSKwDBQ.png"/></div><figcaption class="lb lc fg fe ff ld le bd b be z ek">Moralis Instance</figcaption></figure><p id="7fbc" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated"><strong class="kf id">复制服务器详细信息(服务器URL、应用程序ID和主密钥)</strong></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff la"><img src="../Images/de3a80a121b7e80b687e2366a54c7c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*tMJkf8EplvEpYgkXk9VtQA.png"/></div><figcaption class="lb lc fg fe ff ld le bd b be z ek">Moralis Server Details</figcaption></figure><p id="3a0e" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated"><strong class="kf id">启动Moralis服务器</strong></p><pre class="js jt ju jv fq lf lg lh li aw lj dt"><span id="867b" class="lk ll ht lg b fv lm ln l lo lp">require(“dotenv”).config();</span><span id="19d3" class="lk ll ht lg b fv lq ln l lo lp">const express = require(“express”);</span><span id="299e" class="lk ll ht lg b fv lq ln l lo lp">const Moralis = require(“moralis/node”);</span><span id="4e7d" class="lk ll ht lg b fv lq ln l lo lp">const app = express();</span><span id="04d5" class="lk ll ht lg b fv lq ln l lo lp">const {</span><span id="5155" class="lk ll ht lg b fv lq ln l lo lp">   PORT,</span><span id="f572" class="lk ll ht lg b fv lq ln l lo lp">   MORALIS_SERVER_URL,</span><span id="0add" class="lk ll ht lg b fv lq ln l lo lp">   MORALIS_APP_ID,</span><span id="eada" class="lk ll ht lg b fv lq ln l lo lp">   MORALIS_MASTER_KEY,</span><span id="a4ab" class="lk ll ht lg b fv lq ln l lo lp">} = process.env;</span><span id="0c38" class="lk ll ht lg b fv lq ln l lo lp">const port = PORT || 8000;</span><span id="0dd6" class="lk ll ht lg b fv lq ln l lo lp">const upload = multer({ dest: __dirname + “/public/uploads/” });</span><span id="77ad" class="lk ll ht lg b fv lq ln l lo lp">app.use(express.urlencoded({ extended: true }));</span><span id="4aa4" class="lk ll ht lg b fv lq ln l lo lp">app.use(express.static(“public”));<br/></span><span id="7a77" class="lk ll ht lg b fv lq ln l lo lp">app.listen(port, async () =&gt; {</span><span id="fafb" class="lk ll ht lg b fv lq ln l lo lp">   await Moralis.start({</span><span id="0e43" class="lk ll ht lg b fv lq ln l lo lp">      serverUrl: MORALIS_SERVER_URL,</span><span id="828b" class="lk ll ht lg b fv lq ln l lo lp">      appId: MORALIS_APP_ID,</span><span id="4784" class="lk ll ht lg b fv lq ln l lo lp">      masterKey: MORALIS_MASTER_KEY,</span><span id="12a3" class="lk ll ht lg b fv lq ln l lo lp">   });</span><span id="c8d2" class="lk ll ht lg b fv lq ln l lo lp">});</span></pre><p id="4cd1" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">。env文件应该如下所示:</p><pre class="js jt ju jv fq lf lg lh li aw lj dt"><span id="1892" class="lk ll ht lg b fv lm ln l lo lp">MORALIS_SERVER_URL = `moralis server url`<br/>MORALIS_APP_ID = `moralis application Id`<br/>MORALIS_MASTER_KEY = `moralis master key`</span></pre></div><div class="ab cl lr ls hb lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hm hn ho hp hq"><p id="d5ce" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">Moralis提供了两种将文件上传到IPFS的方法:</p><ol class=""><li id="00e7" class="ly lz ht kf b kg kh kj kk km ma kq mb ku mc ky md me mf mg dt translated">使用<strong class="kf id"> <em class="mh"> saveIPFS() </em> </strong>方法的Moralis服务器</li><li id="70e3" class="ly lz ht kf b kg mi kj mj km mk kq ml ku mm ky md me mf mg dt translated">使用<strong class="kf id">云功能</strong></li></ol><h2 id="622a" class="lk ll ht bd mn mo mp mq mr ms mt mu mv km mw mx my kq mz na nb ku nc nd ne hz dt translated">1.使用<strong class="ak"> <em class="nf"> saveIPFS() </em> </strong>方法的Moralis服务器</h2><h2 id="3d51" class="lk ll ht bd mn mo mp mq mr ms mt mu mv km mw mx my kq mz na nb ku nc nd ne hz dt translated"><strong class="ak">文件上传</strong></h2><pre class="js jt ju jv fq lf lg lh li aw lj dt"><span id="b9f1" class="lk ll ht lg b fv lm ln l lo lp">const uploadFile = async (req, res, next) =&gt; {<br/>    const { originalname: name, mimetype } = req.file;        <br/>    fs.readFile(req.file.path, async (err, buffer) =&gt; { <br/>       const data = Array.from(Buffer.from(buffer, “binary”));<br/>       const file = new Moralis.File(name, data, mimetype);<br/>       await file.saveIPFS({ useMasterKey: true });<br/>       return file.ipfs();<br/>    });<br/>}<br/>------------------------------------------</span><span id="b7ca" class="lk ll ht lg b fv lq ln l lo lp">You will get a response of ipfs url like below:</span><span id="0aad" class="lk ll ht lg b fv lq ln l lo lp"><a class="ae kz" href="https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv" rel="noopener ugc nofollow" target="_blank">https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv</a></span></pre><h2 id="49f7" class="lk ll ht bd mn mo mp mq mr ms mt mu mv km mw mx my kq mz na nb ku nc nd ne hz dt translated">Json上传</h2><pre class="js jt ju jv fq lf lg lh li aw lj dt"><span id="320d" class="lk ll ht lg b fv lm ln l lo lp">const uploadJson = async (req, res, next) =&gt; {<br/>    const jsonMetadata = {<br/>        name: "Female Bust",<br/>        description: "Female Bust 3D model",<br/>        image:  <br/>"<a class="ae kz" href="https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv" rel="noopener ugc nofollow" target="_blank">https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv</a>"</span><span id="a213" class="lk ll ht lg b fv lq ln l lo lp">}<br/>   const toBtoa =      <br/>       Buffer.from(JSON.stringify(jsonMetadata)).toString("base64"); <br/>   const file = new Moralis.File("FemaleBust.json", <br/>                { base64: toBtoa });<br/>   await file.saveIPFS({ useMasterKey: true });<br/>   return file.ipfs();<br/>}<br/>------------------------------------------</span><span id="c103" class="lk ll ht lg b fv lq ln l lo lp">You will get a response of ipfs url like below:</span><span id="d74d" class="lk ll ht lg b fv lq ln l lo lp"><a class="ae kz" href="https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv" rel="noopener ugc nofollow" target="_blank">https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv</a></span></pre><h2 id="0e01" class="lk ll ht bd mn mo mp mq mr ms mt mu mv km mw mx my kq mz na nb ku nc nd ne hz dt translated">2.使用云函数</h2><p id="d556" class="pw-post-body-paragraph kd ke ht kf b kg ng jd ki kj nh jg kl km ni ko kp kq nj ks kt ku nk kw kx ky hm dt translated">普通云函数的格式应该如下:</p><pre class="js jt ju jv fq lf lg lh li aw lj dt"><span id="3545" class="lk ll ht lg b fv lm ln l lo lp">Function Definition<br/>-----------------------------</span><span id="8fb1" class="lk ll ht lg b fv lq ln l lo lp">Moralis.Cloud.define(<em class="mh">function_name</em>, async (request) =&gt; {});</span><span id="ff57" class="lk ll ht lg b fv lq ln l lo lp">You can access the params like request.params.[key]</span><span id="16a4" class="lk ll ht lg b fv lq ln l lo lp"><br/>Function call<br/>------------------------------<br/>const params = {"key": "value"};</span><span id="61de" class="lk ll ht lg b fv lq ln l lo lp">await Moralis.Cloud.run(<em class="mh">function_name</em>, params);</span></pre><p id="f35b" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">创建一个文件夹<strong class="kf id"> <em class="mh"> /cloud </em> </strong>和一个文件<strong class="kf id"> <em class="mh"> cloud.js </em> </strong>在里面。</p><p id="febc" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">在那个文件上写你的云函数。</p><pre class="js jt ju jv fq lf lg lh li aw lj dt"><span id="183d" class="lk ll ht lg b fv lm ln l lo lp">Moralis.Cloud.define(“ipfsbinary”, async (request) =&gt; {</span><span id="861d" class="lk ll ht lg b fv lq ln l lo lp">    const result = await Moralis.Cloud.toIpfs({</span><span id="8c7b" class="lk ll ht lg b fv lq ln l lo lp">       sourceType: “base64Binary”,</span><span id="f290" class="lk ll ht lg b fv lq ln l lo lp">       source: request.params.image,</span><span id="8c02" class="lk ll ht lg b fv lq ln l lo lp">    });</span><span id="e7f3" class="lk ll ht lg b fv lq ln l lo lp">    return result;</span><span id="47a2" class="lk ll ht lg b fv lq ln l lo lp">});</span><span id="cd73" class="lk ll ht lg b fv lq ln l lo lp">Moralis.Cloud.define(“ipfsjson”, async (request) =&gt; {</span><span id="8768" class="lk ll ht lg b fv lq ln l lo lp">    const result = await Moralis.Cloud.toIpfs({</span><span id="5492" class="lk ll ht lg b fv lq ln l lo lp">       sourceType: “object”,</span><span id="f3e6" class="lk ll ht lg b fv lq ln l lo lp">       source: request.params.metadata,</span><span id="6ad8" class="lk ll ht lg b fv lq ln l lo lp">    });</span><span id="0c5b" class="lk ll ht lg b fv lq ln l lo lp">    return result;</span><span id="7015" class="lk ll ht lg b fv lq ln l lo lp">});</span></pre><p id="be85" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">现在我们可以从我们的文件中调用云函数了。</p><h2 id="4756" class="lk ll ht bd mn mo mp mq mr ms mt mu mv km mw mx my kq mz na nb ku nc nd ne hz dt translated">文件上传</h2><pre class="js jt ju jv fq lf lg lh li aw lj dt"><span id="017a" class="lk ll ht lg b fv lm ln l lo lp">const uploadFile = async (req, res, next) =&gt; {<br/>    fs.readFile(req.file.path, async (err, buffer) =&gt; {<br/>        const image = buffer.toString(“base64”);<br/>        const ipfsImagePath = await Moralis.Cloud.run(“ipfsbinary”,    <br/>                              { image });<br/>        return ipfsImagePath;<br/>    });<br/>}</span><span id="97a3" class="lk ll ht lg b fv lq ln l lo lp">------------------------------------------</span><span id="0258" class="lk ll ht lg b fv lq ln l lo lp">You will get a response like below:</span><span id="9dc7" class="lk ll ht lg b fv lq ln l lo lp">{<br/>   path: "<a class="ae kz" href="https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv" rel="noopener ugc nofollow" target="_blank">https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv</a>"</span><span id="3d27" class="lk ll ht lg b fv lq ln l lo lp">}</span></pre><h2 id="4847" class="lk ll ht bd mn mo mp mq mr ms mt mu mv km mw mx my kq mz na nb ku nc nd ne hz dt translated">Json上传</h2><pre class="js jt ju jv fq lf lg lh li aw lj dt"><span id="8360" class="lk ll ht lg b fv lm ln l lo lp">const uploadJson = async (req, res, next) =&gt; {<br/>      const metadata = {<br/>        name: "Female Bust",<br/>        description: "Female Bust 3D model",<br/>        image:  <br/>"<a class="ae kz" href="https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv" rel="noopener ugc nofollow" target="_blank">https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv</a>"<br/>      };<br/>      const ipfsJsonPath = await Moralis.Cloud.run(“ipfsjson”,  <br/>                           { metadata});<br/>      return ipfsJsonPath;<br/>}</span><span id="c843" class="lk ll ht lg b fv lq ln l lo lp">------------------------------------------</span><span id="9dff" class="lk ll ht lg b fv lq ln l lo lp">You will get a response like below:</span><span id="84ab" class="lk ll ht lg b fv lq ln l lo lp">{<br/>   path: "<a class="ae kz" href="https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv" rel="noopener ugc nofollow" target="_blank">https://ipfs.moralis.io:2053/ipfs/QmdPcF1r86v28PeJMxdxHbKQA17qBhW3W5s6DHGvxukdPv</a>"</span><span id="c9af" class="lk ll ht lg b fv lq ln l lo lp">}</span></pre></div><div class="ab cl lr ls hb lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hm hn ho hp hq"><p id="0de1" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated"><strong class="kf id">谢谢:)</strong></p><blockquote class="nl"><p id="113b" class="nm nn ht bd no np nq nr ns nt nu ky ek translated">加入Coinmonks <a class="ae kz" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae kz" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="15a2" class="nv ll ht bd mn nw nx ny mr nz oa ob mv ji oc jj my jl od jm nb jo oe jp ne of dt translated">另外，阅读</h1><ul class=""><li id="ef6b" class="ly lz ht kf b kg ng kj nh km og kq oh ku oi ky oj me mf mg dt translated"><a class="ae kz" href="https://coincodecap.com/smithbot-review" rel="noopener ugc nofollow" target="_blank"> SmithBot评论</a> | <a class="ae kz" href="https://coincodecap.com/free-open-source-trading-bots" rel="noopener ugc nofollow" target="_blank"> 4款最佳免费开源交易机器人</a></li><li id="0354" class="ly lz ht kf b kg mi kj mj km mk kq ml ku mm ky oj me mf mg dt translated"><a class="ae kz" rel="noopener" href="/coinmonks/coinbase-bots-ac6359e897f3">比特币基地僵尸程序</a> | <a class="ae kz" rel="noopener" href="/coinmonks/ascendex-review-53e829cf75fa"> AscendEX审查</a> | <a class="ae kz" rel="noopener" href="/coinmonks/okex-trading-bots-234920f61e60"> OKEx交易僵尸程序</a></li><li id="c225" class="ly lz ht kf b kg mi kj mj km mk kq ml ku mm ky oj me mf mg dt translated"><a class="ae kz" rel="noopener" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94">如何在印度购买比特币？</a> | <a class="ae kz" rel="noopener" href="/coinmonks/wazirx-review-5c811b074f5b"> WazirX评论</a></li><li id="75c7" class="ly lz ht kf b kg mi kj mj km mk kq ml ku mm ky oj me mf mg dt translated"><a class="ae kz" rel="noopener" href="/coinmonks/cryptohopper-alternatives-d67287b16d27">隐料斗替代品</a> | <a class="ae kz" rel="noopener" href="/coinmonks/hitbtc-review-c5143c5d53c2"> HitBTC审查</a></li><li id="1bc0" class="ly lz ht kf b kg mi kj mj km mk kq ml ku mm ky oj me mf mg dt translated"><a class="ae kz" href="https://coincodecap.com/cbet-casino-review" rel="noopener ugc nofollow" target="_blank"> CBET回顾</a> | <a class="ae kz" href="https://coincodecap.com/kucoin-vs-coinbase" rel="noopener ugc nofollow" target="_blank">库科恩vs比特币基地</a></li><li id="2546" class="ly lz ht kf b kg mi kj mj km mk kq ml ku mm ky oj me mf mg dt translated"><a class="ae kz" href="https://coincodecap.com/fold-app-review" rel="noopener ugc nofollow" target="_blank">折叠App审核</a> | <a class="ae kz" rel="noopener" href="/coinmonks/kucoin-trading-bot-automate-your-trades-8cf0ca2138e0"> Kucoin交易机器人</a> | <a class="ae kz" href="https://coincodecap.com/probit-review" rel="noopener ugc nofollow" target="_blank"> Probit审核</a></li></ul></div></div>    
</body>
</html>