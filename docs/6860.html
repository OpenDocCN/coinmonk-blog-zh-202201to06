<html>
<head>
<title>Beosin’s Detailed Analysis of FEGtoken Flashloan Attack: 3,280 $BNB and 144 $ETH Lost</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Beosin对FEGtoken Flashloan攻击的详细分析:BNB损失3280美元，ETH损失144美元</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/beosins-detailed-analysis-of-fegtoken-flashloan-attack-3-280-bnb-and-144-eth-lost-758d972ac65b?source=collection_archive---------8-----------------------#2022-05-16">https://medium.com/coinmonks/beosins-detailed-analysis-of-fegtoken-flashloan-attack-3-280-bnb-and-144-eth-lost-758d972ac65b?source=collection_archive---------8-----------------------#2022-05-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="4846" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2022年5月16日，Beosin EagleEye监测到，FEGtoken在以太坊和BNB链上的FEGexPRO合同被flashloan攻击利用了约3280 BNB和144 ETH。Beosin安全团队分析了该事件，结果如下所示。</p><p id="beef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">费托肯简介</strong></p><p id="73af" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">FEGtoken项目由以太坊和BNB链上的通货紧缩令牌FEG和FEGex多链分散交易所组成。官方网站:【https://fegtoken.com T2】</p><p id="af97" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">相关信息</strong></p><p id="eb6c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该攻击包含多个交易，其中一些如下所示。</p><p id="76b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">事务哈希:</p><p id="e791" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0x 77 cf 448 ce af8 f 66 e 06d 1537 ef 83218725670 d3a 509583 ea0d 161533 FDA 56 c 063(BNB连锁)</p><p id="3748" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0x1e 769 a 59 a 5 a 9 da bec 0 CB 7 f 21 a3 e 346 f 55 AE 1972 bb 18 AE 5 eeacdaa 0 BC 3424 Abd 2(以太坊)</p><p id="18bd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">黑客地址:</p><p id="c55a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0x73b 359 D5 da 488 e B2 e 97990619976 F2 f 004 e 9 ff 7c</p><p id="0bcb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">黑客合同:</p><p id="bac0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0x9a 843 bb 125 a3 c 03 f 496 CB 44653741 F2 cef 82 f 445</p><p id="670e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">受害者合同:</p><p id="0bbc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0x 818 e 2013 DD 7d 9 BF 4547 AAA BF 6b 617 c 1262578 BC 7(BNB链)</p><p id="4ed3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0 xf 2 BDA 964 EC 2d 2 fcb 1610 c 886 ed 4831 BF 58 f 64948(以太坊)</p><p id="6c7f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">开发流程</strong></p><p id="c89e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">以太坊和BNB链的开发流程是一样的，下面的分析是基于BNB链。</p><p id="cfa3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1.黑客调用攻击契约(0x9a84…. f445)到来自DVM合约(0xd534… .0dd7)的flashloan 915.84 WBNB，然后将116.81 WBNB转换成115.65 fWBNB，为后续的攻击做准备。</p><p id="a003" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.黑客利用攻击契约创建了10个契约。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/61fda0b7da8d6d5efe2a6e14275d8654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRIP0BwzYMbmbE6a6pho9A.png"/></div></div></figure><p id="10f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3.然后，黑客将赎回的fWBNB令牌与FEGexPRO合约(0x818e…8bc7)绑定。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/3a2a49c7c791a50732d1c4387fdb0d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PxJltG26qELh9oDujfHOqw.png"/></div></div></figure><p id="6ada" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4.然后黑客反复调用<em class="kb"> depositInternal </em>和<em class="kb"> swapToSwap </em>函数，让FEGexPRO契约批准fBNB给之前部署的其他契约。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kc"><img src="../Images/8a1402fec510e4a9d8bab90695fe0be9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rppa79tNI7MOOEV9hjbJOA.png"/></div></div></figure><p id="b19d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5.然后使用其他攻击契约调用<em class="kb"> transferFrom </em>函数，将FEGexPRO契约中的所有fBNBs转移到攻击契约(0x9a 84…f445)。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/1fd335e59f60832fec0a450ce7591132.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PPSXhDy9Mn1hiFYMtZvd4Q.png"/></div></div></figure><p id="cf5b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">6.接下来从LP交易对合约(0x2aa7)借入31，217，683，882，286.007211154 FEG代币和423 WBNB... 6c14)。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/251a0e7c96a41c032be1c257aa9c09a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXXRJCB6lHhX3MCPO9IgRA.png"/></div></div></figure><p id="5465" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">7.重复步骤3、4、5，从FEGexPRO契约中窃取大量FEG代币到攻击契约中。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kc"><img src="../Images/40ad344f89f260944e5e66c3ef1ebd6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5bks0f-vTdhc6I3InGkDw.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kc"><img src="../Images/c3e5a2997883cc3ddcd279cb76099ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*40cqSliFpujXlxf3s7fMrg.png"/></div></div></figure><p id="51f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">8.然后归还flashloan，将获得的WBNB转移到攻击契约中，完成这次攻击。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/6ed5000f447a679f787b83909672d813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Rkr1yPf0LBDG5Jmb4H8AQ.png"/></div></div></figure><p id="f068" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">9.使用相同的方法进行了50多次相同的攻击，总利润约为144 ETH和3280 BNB。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kc"><img src="../Images/ddff066bdd53f0ebfba066dd425cb54d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clS1OFSXl2lqGLrLxTPgDw.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kd"><img src="../Images/aa73f748eeeedaa85872a8d936e4394c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zC3ThmLFMO7ybsvqNPU7uA.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kd"><img src="../Images/3183faefc0da7fd1b335b39d7d173f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QSHLGYYQ5RBFvZMU_lG4AA.png"/></div></div></figure><p id="d5b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">漏洞分析</strong></p><p id="3944" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该攻击主要利用了FEGexPRO契约的<em class="kb">swaptosopp</em>函数中的路径地址可以被控制，并且契约中没有验证路径地址的有效性这一漏洞。由于在更新<em class="kb"> depositInternal </em>函数中的用户余额时，合同依赖于合同中的当前令牌余额，因此攻击者能够传入恶意路径地址，并且当调用<em class="kb">swaptosopp</em>函数时，合同中的令牌余额不会改变，从而允许攻击者重复重置FEGexPRO合同中攻击合同记录的令牌数量，从而允许FEGexPRO合同重复批准其令牌给攻击者控制的多个恶意合同。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kc"><img src="../Images/6317f141ac0049375ccb4662bbb012e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xKKkJVC9f0Rtoc5Cmda9iQ.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/2e3d7b6fbc1adab01d8c19a676ce1805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*homBbOuvpMg4FhcMmx8Ifw.png"/></div></div></figure><p id="30b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">资金追踪</strong></p><p id="c173" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">截至本文撰写之时，被盗资金仍在攻击者的地址(0x73b3…. ff7c)而不被转出。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kc"><img src="../Images/cc8c20a2bd59c4ab0104b6301037ab84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HbLVVJja_ojDAXnrzR2K5g.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/0c292a6ec3be2dbd78a80c654f183198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-Gfsmh9g-7XZaGqIameiw.png"/></div></div></figure><p id="b0dc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">总结</strong></p><p id="d305" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">针对这一事件，Beosin安全团队建议:</p><p id="c46f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1.在开发项目时，应注意与其他合同交互时可能存在的安全风险，尽量避免将关键参数设置为用户可控。如果业务需求是这样的，则需要严格判断用户输入的参数是否有风险。</p><p id="2bee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.项目上线前，强烈建议选择专业的安全审计公司进行全面的安全审计，规避安全风险。</p><h1 id="b6d8" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">更大的</h1><p id="a298" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/what-is-the-impact-on-web3-after-lunas-crash-and-defi-fled-b80334e00aba"> <strong class="is hu"> <em class="kb"> 1。LUNA崩溃和DeFi“出逃”后对Web3有什么影响？</em> </strong> </a></p><p id="fd80" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" rel="noopener" href="/@Beosin_com/how-to-ensure-the-security-of-nft-under-the-web-3-0-boom-beosin-vaas-has-provided-with-a-solution-50697ccd4f56"> <strong class="is hu"> <em class="kb"> 2。在Web 3.0热潮下，如何保证NFT的安全？</em> </strong> </a></p><p id="a6b4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" rel="noopener" href="/@Beosin_com/deus-finance-suffered-its-second-flashloan-attack-this-year-beosins-detailed-analysis-5032be0ec4f2"> <strong class="is hu"> <em class="kb"> 3。DEUS Finance遭遇今年第二次闪贷攻击:Beosin详细分析</em> </strong> </a></p><p id="3a5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" rel="noopener" href="/@Beosin_com/beosin-has-completed-security-audit-service-of-crypto-lego-alg-no-critical-high-or-medium-risk-b656849e9334"> <strong class="is hu"> <em class="kb"> 4。Beosin已完成加密乐高算法</em> </strong> </a>的安全审计服务</p><p id="0fea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/what-is-the-impact-on-web3-after-lunas-crash-and-defi-fled-b80334e00aba"> <strong class="is hu"> <em class="kb"> 5。LUNA崩溃和DeFi“出逃”后对Web3有什么影响？</em>T38</strong></a></p><p id="e277" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" rel="noopener" href="/@Beosin_com/recap-ama-about-how-to-keep-your-smart-contract-secure-during-development-with-beosin-vaas-f7ecd2dc27a"> <strong class="is hu"> <em class="kb"> 6。〖重述VaaS关于如何在使用Beosin VaaS </em> </strong> </a>进行开发的过程中保证智能合同的安全</p><h1 id="c86b" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">接触</h1><p id="813f" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">如果您需要任何区块链安全服务，请联系我们:</p><p id="439f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://beosin.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">网站</strong> </a> <strong class="is hu"> </strong> <a class="ae jo" href="http://contact@beosin.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">邮箱</strong> </a> <strong class="is hu"> </strong> <a class="ae jo" href="https://twitter.com/Beosin_com" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">官方推特</strong> </a> <strong class="is hu"> </strong> <a class="ae jo" href="https://twitter.com/BeosinAlert" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">预警</strong> </a> <strong class="is hu"> </strong> <a class="ae jo" href="https://t.me/beosin" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">电报</strong></a><strong class="is hu"/><a class="ae jo" href="https://www.linkedin.com/company/beosin" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">LinkedIn</strong></a></p></div></div>    
</body>
</html>