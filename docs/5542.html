<html>
<head>
<title>Build a Web 3 Application with Solidity, Hardhat, React, and Web3JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Solidity、Hardhat、React和Web3JS构建一个Web 3应用程序</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/build-a-web-3-application-with-solidity-hardhat-react-and-web3js-61b7ff137885?source=collection_archive---------5-----------------------#2022-04-25">https://medium.com/coinmonks/build-a-web-3-application-with-solidity-hardhat-react-and-web3js-61b7ff137885?source=collection_archive---------5-----------------------#2022-04-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/2e3bc7ee2db8538be133594cc67e0126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2GKUPRTpymEvCFve"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@eskaylim?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">eskay lim</a> on <a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fb9c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在本文中，您将学习如何使用<strong class="ji hu"> Solidity </strong>、<strong class="ji hu"> Hardhat </strong>、<strong class="ji hu"> React </strong>和<strong class="ji hu"> Web3.js </strong>库来设置Web3应用程序。尽管我们的应用程序看起来很简单，但它将提供很多价值。你将学习如何连接一个Web3应用程序的点。将来，您可以将它作为更复杂项目的起点。</p><p id="1570" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ke">注:如果你来这里只是为了代码，可以从我的GitHub </em>  <em class="ke">中抓取</em> <a class="ae jf" href="https://github.com/krisograbek/web3-playground/tree/main/update-greetings" rel="noopener ugc nofollow" target="_blank"> <em class="ke">。此外，您会发现文章中缺少的CSS文件。</em></a></p><p id="b15a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ke">注2:要跟随文章，JavaScript的基础知识应该足够了。此外，您的计算机上需要node.js和npm。否则，您将无法调用上述命令。</em></p><p id="7c75" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">测试Web 3应用程序最方便的方式是运行本地区块链。它比真正的网络更快，并提供可靠的堆栈跟踪和错误消息。要运行本地区块链，我们将使用Hardhat网络。</p><p id="7845" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们开始我们的项目吧！</p><h2 id="1c84" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated"><strong class="ak">准备智能合同。</strong></h2><p id="dcf4" class="pw-post-body-paragraph jg jh ht ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hm dt translated">我们将利用哈德哈特的合同样本。</p><p id="c8d1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">要在您的项目中使用hardhat，您必须使用<code class="eh lf lg lh li b">npm</code>安装它</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="76fe" class="kf kg ht li b fv lr ls l lt lu">$ npm install hardhat</span></pre><p id="1c93" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">之后，您将能够使用hardhat命令。安全帽开发者推荐在你的项目中使用<code class="eh lf lg lh li b">npx hardhat [options]</code>。但是，我们必须首先初始化一个项目。打开您的终端并键入:</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="0eed" class="kf kg ht li b fv lr ls l lt lu">$ npx hardhat</span></pre><p id="481e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">您应该会看到类似这样的内容:</p><figure class="lj lk ll lm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lv"><img src="../Images/46c2590ffd2386c19547ae999fa66275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3nsCD25fMQj-0gvrtj3jFA.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Initializing a new Hardhat project.</figcaption></figure><p id="7a37" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">为了简单起见，我们将使用一个基本的示例项目。选择此选项，然后按enter键。您需要选择更多选项:</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="232f" class="kf kg ht li b fv lr ls l lt lu">✔ What do you want to do? · Create a basic sample project<br/>✔ Hardhat project root: -  &lt;you can just press enter&gt;<br/>✔ Do you want to add a .gitignore? (Y/n)- &lt;I usually press ‘y’ because it’s going to my github&gt;<br/>✔ Do you want to install this sample project’s dependencies with npm (hardhat <a class="ae jf" href="http://twitter.com/nomiclabs/hardhat-waffle" rel="noopener ugc nofollow" target="_blank">@nomiclabs/hardhat-waffle</a> ethereum-waffle chai <a class="ae jf" href="http://twitter.com/nomiclabs/hardhat-ethers" rel="noopener ugc nofollow" target="_blank">@nomiclabs/hardhat-ethers</a> ethers)? (Y/n)-  &lt;press ‘y’ because we’ll need them&gt;</span></pre><p id="d52f" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">至此，我们已经有了一个基本的hardhat项目和一个示例Smart契约。检查出<code class="eh lf lg lh li b">contracts/Greeter.sol</code>找到它。在<code class="eh lf lg lh li b">scripts/sample-script.js,</code>中，有一个脚本来部署合同。我们需要以下步骤:</p><ul class=""><li id="f333" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mb mc md me dt translated">编写合同。为了从前端与我们的契约进行交互，我们需要两件事情:<strong class="ji hu">契约ABI </strong>和<strong class="ji hu">契约地址</strong>。我在<a class="ae jf" href="https://kris-ograbek.medium.com/freecodecamps-solidity-blockchain-smart-contracts-beginner-to-expert-course-summary-part-2-da6e642efdea" rel="noopener">这篇文章</a>里写了更多关于它的内容。要在终端中编译合同类型，请执行以下操作:</li></ul><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="48ae" class="kf kg ht li b fv lr ls l lt lu">$ npx hardhat compile</span></pre><p id="7051" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">它将在<code class="eh lf lg lh li b">artifacts/contracts/Greeter.sol/</code>文件夹中创建两个文件。合同ABI在<code class="eh lf lg lh li b">Greeter.sol</code>档。稍后，我们将在前端使用它。</p><ul class=""><li id="754f" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mb mc md me dt translated"><strong class="ji hu">运行一个安全帽节点</strong>。我已经解释过了，运营本地区块链是切实可行的。幸运的是，Hardhat允许我们通过一个简单的命令来实现这一点:</li></ul><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="8528" class="kf kg ht li b fv lr ls l lt lu">$ npx hardhat node</span></pre><p id="8549" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">您应该会看到类似这样的内容:</p><figure class="lj lk ll lm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mf"><img src="../Images/4e8321147ceaf8d9f1c8b96ebfd92098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0BHq7JRfFj-KkQoJISrr9g.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">A local Hardhat node.</figcaption></figure><p id="9dc3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">默认情况下，它会创建一个包含20个帐户的本地区块链。如果你读绿色的信息，你会找到位置。默认情况下，它位于端口8545上。让我们进入下一步。</p><ul class=""><li id="251f" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mb mc md me dt translated"><strong class="ji hu">部署合同</strong>。我们将使用前面提到的脚本来完成这项工作。</li></ul><p id="f2b3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ke">重要提示:请打开一个新的终端。保持上一步中的节点运行是很重要的。</em></p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="8ecf" class="kf kg ht li b fv lr ls l lt lu">$ npx hardhat run scripts/sample-script.js — network localhost</span></pre><p id="3c1f" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如果运行正常，您应该会在终端中看到以下消息:</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="c475" class="kf kg ht li b fv lr ls l lt lu">Greeter deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3</span></pre><p id="2173" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">请注意，合同地址可能不同。如果您让我们的本地hardhat节点保持运行，您应该会看到以下输出:</p><figure class="lj lk ll lm fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/daf4bc822955cac5ddc62e8d4edda479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mEvb9_pdKPLhvf_UHmIsIA.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Information about a newly deployed contract in our Hardhat node.</figcaption></figure><p id="937c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在第二行中，我们看到与之前相同的合同地址。我们有合同ABI和地址。因此，我们准备好去前端部分！</p><h2 id="28fe" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">构建前端。</h2><p id="b1f3" class="pw-post-body-paragraph jg jh ht ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hm dt translated"><strong class="ji hu">运行基本的React应用程序。</strong></p><p id="7b54" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一如既往，我们必须从安装开始。让我们创建一个React项目。</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="f82f" class="kf kg ht li b fv lr ls l lt lu">$ npx create-react-app my-project<br/>$ cd my-project</span></pre><p id="ea3c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是启动React项目的一种常见方式。它安装了许多必要的依赖项，并允许我们运行React脚本。此外，在<code class="eh lf lg lh li b">src/App.js</code>中，它是我们应用程序的起点。要运行该应用程序，请在终端中键入:</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="ce5b" class="kf kg ht li b fv lr ls l lt lu">$ npm start</span></pre><p id="40fe" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然后，在你的浏览器中打开<code class="eh lf lg lh li b">http://localhost:3000</code>，你就会看到。</p><figure class="lj lk ll lm fq iu fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/434f79c42f08abfa7564cbda85961c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*I8ey8w25uPJaj9WLy1OwiA.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Create React App template application.</figcaption></figure><p id="eade" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">向项目中添加Web3.js。</strong></p><p id="d43e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">为了添加Web 3部件，我们将安装<strong class="ji hu"> web3.js </strong>库。</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="5547" class="kf kg ht li b fv lr ls l lt lu">$ npm install web3</span></pre><p id="15a7" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然后，我们必须像这样把它进口到<code class="eh lf lg lh li b">App.js</code>。</p><figure class="lj lk ll lm fq iu"><div class="bz el l di"><div class="mi mj l"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Importing Web3 from web3.js.</figcaption></figure><p id="aa3e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">修复Web3导入。</strong></p><p id="6656" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">遗憾的是，截至2022年4月，此次导入失败。我在这个<a class="ae jf" href="https://stackoverflow.com/questions/70557596/couldnt-import-web3-library-in-react-application/70760506#70760506" rel="noopener ugc nofollow" target="_blank"> StackOverflow回答</a>中找到了两个变通办法。让我们使用第一个，它需要将react脚本降级到第四个版本。我们需要三个步骤:</p><ol class=""><li id="b3da" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mk mc md me dt translated">删除<code class="eh lf lg lh li b">node_modules</code>文件夹。</li><li id="48a3" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mk mc md me dt translated">在<code class="eh lf lg lh li b">package.json</code>中，用react-scripts将该行更新为<code class="eh lf lg lh li b">"react-scripts”: “4.0.3”</code></li><li id="8d36" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mk mc md me dt translated">通过在终端中键入<code class="eh lf lg lh li b">$ npm install</code>再次安装节点模块。</li></ol><p id="03a3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">添加合同ABI和地址。</strong></p><p id="da63" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">还记得我告诉过你我们需要合同ABI和地址来与之交互吗？是时候将它们添加到我们的项目中了。我最喜欢的做法是在<code class="eh lf lg lh li b">src</code>文件夹中创建<code class="eh lf lg lh li b">utils</code>。然后，我向其中添加以下文件:</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="d06f" class="kf kg ht li b fv lr ls l lt lu">-utils/<br/> |- constants.js<br/> |- Greeter.json</span></pre><p id="1c68" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><code class="eh lf lg lh li b">Greeter.json</code>是我们用Hardhat创建的文件。因此，从安全帽项目中，我们复制了<code class="eh lf lg lh li b">artifacts/contracts/Greeter.sol/Greeter.json</code>文件，并将其传递到<code class="eh lf lg lh li b">src/utils/</code>文件夹中。然后，在<code class="eh lf lg lh li b">constants.js</code>中，我们添加:</p><figure class="lj lk ll lm fq iu"><div class="bz el l di"><div class="mi mj l"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Contract ABI and address in constants.js</figcaption></figure><p id="3fe0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">酷，我们已经在React应用程序中联系了ABI和地址。我们需要他们从web3.js创建一个契约实例。同样，契约地址来自部署部分。</p><p id="dc1e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">创建web3合同。</strong></p><p id="e867" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">至此，我们已经具备了创建新合同的一切条件。让我们更新一下<code class="eh lf lg lh li b">App.js</code>文件的顶部。</p><figure class="lj lk ll lm fq iu"><div class="bz el l di"><div class="mi mj l"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Create a new web3js contract.</figcaption></figure><p id="12ee" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们将该过程分为以下步骤:</p><ul class=""><li id="19f9" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mb mc md me dt translated">创建web3实例。通过写<code class="eh lf lg lh li b">new Web("ws://localhost:8545")</code>，我们传递了提供者。在我们的例子中，它是我们之前启动的本地节点。我们希望通过WebSocket连接，这就是为什么我们键入<code class="eh lf lg lh li b">ws://…</code>而不是<code class="eh lf lg lh li b">http://...</code></li><li id="e1b5" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated">创建新的合同实例。这时候我们终于通过了ABI的合同和地址。</li></ul><p id="dcbb" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如果一切都是正确的，我们现在应该能够与我们用Hardhat部署的契约进行交互。</p><p id="2fed" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">重要提示:不要忘记在你的控制台中运行一个Hardhat节点。没有它，WebSocket将无法连接。</p><p id="48a5" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">调用公共视图函数。</strong></p><p id="2d96" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们看看迎宾员合同。</p><figure class="lj lk ll lm fq iu"><div class="bz el l di"><div class="mi mj l"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Default Greeter.sol file.</figcaption></figure><p id="a16a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">它有两个功能:</p><ul class=""><li id="df27" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mb mc md me dt translated"><code class="eh lf lg lh li b">function greet() public view … {}</code><strong class="ji hu">视图</strong>关键字至关重要。表示<code class="eh lf lg lh li b">greet()</code>是一个<strong class="ji hu">只读功能</strong>。这意味着我们不会改变区块链上的任何东西。</li><li id="bfd2" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated"><code class="eh lf lg lh li b">function setGreeting(string memory _greeting) public {}</code>与前面的例子相反，<code class="eh lf lg lh li b">setGreeting()</code>旨在改变区块链上的价值观。</li></ul><p id="9898" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们从第一个函数开始。我们准备一个按钮来调用我们的智能合约的<code class="eh lf lg lh li b">greet()</code>函数。为此，我们在JavaScript中创建了<code class="eh lf lg lh li b">greetMe()</code>函数。它从Solidity调用<code class="eh lf lg lh li b">greet()</code>函数并返回其值。基本示例如下所示:</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="6034" class="kf kg ht li b fv lr ls l lt lu">const greetMe = async () =&gt; {<br/>  const greetMsg = await greeterContract.methods.greet().call();<br/>  return greetMsg;<br/>}</span></pre><p id="095a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如您所见，我们使用了在上一步中创建的契约实例。在浏览器里看起来怎么样？</p><figure class="lj lk ll lm fq iu fe ff paragraph-image"><div class="fe ff mq"><img src="../Images/f30d0f3e15bcd3d8e86bacd5631e6c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*JYlCywtt7tyk-Fc0_2Cw0w.gif"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Calling the greet() function and displaying its result.</figcaption></figure><p id="10ac" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们的“问候我！”按钮调用JavaScript中的<code class="eh lf lg lh li b">greetMe()</code>函数。然后，我们显示返回值。虽然函数很短，但是有两个重要的事情要提一下:</p><ul class=""><li id="d113" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mb mc md me dt translated">它是异步的。注意<code class="eh lf lg lh li b">async</code>和<code class="eh lf lg lh li b">await</code>符号。在执行下一行代码之前，我们必须等待契约的响应，</li><li id="00d3" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated">为了调用合同函数，我们必须使用合同名称、<code class="eh lf lg lh li b">methods</code>关键字、函数名称和<code class="eh lf lg lh li b">call()</code>关键字。</li></ul><p id="1420" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">改变区块链上的价值观。</strong></p><p id="69e3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">你已经知道如何从区块链读取数据。但是，如果你想更新数据，即改变区块链的状态，该怎么办呢？我们<code class="eh lf lg lh li b">setGreeting()</code>在坚固中的功能使我们能够做到这一点。让我向您展示这个函数在JavaScript中是如何执行的。</p><pre class="lj lk ll lm fq ln li lo lp aw lq dt"><span id="dc48" class="kf kg ht li b fv lr ls l lt lu">await greeterContract.methods.setGreeting(newGreetings).send(<br/>{ from: ‘0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266’ })</span></pre><p id="2497" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们仔细看看:</p><ul class=""><li id="4f6e" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mb mc md me dt translated">我们需要<code class="eh lf lg lh li b">await</code>关键字，因为我们必须等待区块链的响应才能继续前进，</li><li id="6fec" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated">我们将<code class="eh lf lg lh li b">greetings</code>变量改为<code class="eh lf lg lh li b">newGreetings</code>值，</li><li id="acd2" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated">我们使用关键字<code class="eh lf lg lh li b">send()</code>代替前面例子中的<code class="eh lf lg lh li b">call()</code>，</li><li id="c55e" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated">我们在<code class="eh lf lg lh li b">from</code>键后传递呼叫者的地址。我从我们的Hardhat节点获取了第一个用户。</li></ul><p id="5156" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们每改变一个区块链的状态，就进行一次<strong class="ji hu">交易</strong>。我们必须通知其他<strong class="ji hu">区块链节点</strong>:“嘿，我(地址)正在试图改变这个值。希望你不要介意……”一个区块链上的每笔交易都要花一些<strong class="ji hu">油费</strong>。</p><p id="a0f1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">好的，让我们看看在我们的项目中更新区块链值是如何工作的。在对JavaScript部分进行必要的调整后，<code class="eh lf lg lh li b">App.js</code>文件看起来像这样。</p><figure class="lj lk ll lm fq iu"><div class="bz el l di"><div class="mi mj l"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">The Frontend part of our app.</figcaption></figure><p id="a8fa" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我来分解一下新的部分:</p><ul class=""><li id="535e" class="lw lx ht ji b jj jk jn jo jr ly jv lz jz ma kd mb mc md me dt translated">我们添加了<code class="eh lf lg lh li b">updateGreets()</code>函数来调用智能契约中的<code class="eh lf lg lh li b">setGreetings()</code>，</li><li id="9b59" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated">我们使用两个常见的React挂钩:<code class="eh lf lg lh li b">useState</code>和<code class="eh lf lg lh li b">useEffect.</code>后者在页面加载后设置初始问候。前者让我们更新React应用程序的状态。我鼓励你学习更多关于React钩子的知识。</li></ul><p id="8aeb" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">好了，我们完成了这个项目。在浏览器里看起来怎么样？</p><figure class="lj lk ll lm fq iu fe ff paragraph-image"><div class="fe ff mq"><img src="../Images/52e84c970e265a00df0805c121a9ff7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*pc4SHwJnStUP3rnQLTc6hA.gif"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Updating the Greetings on our local Blockchain.</figcaption></figure><h1 id="73ab" class="mr kg ht bd kh ms mt mu kl mv mw mx kp my mz na ks nb nc nd kv ne nf ng ky nh dt translated">最后的想法</h1><p id="bc13" class="pw-post-body-paragraph jg jh ht ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hm dt translated">厉害！如果你还在读书，你学到了很多！虽然我们的项目看起来并不壮观，但它教会了如何连接Web 3应用程序的点。</p><p id="e931" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">你有什么问题吗？把它们放到评论区。</p><h2 id="4c6d" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">参考</h2><p id="068a" class="pw-post-body-paragraph jg jh ht ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hm dt translated">[1] <a class="ae jf" href="https://hardhat.org/getting-started/" rel="noopener ugc nofollow" target="_blank">安全帽文档</a></p><p id="2992" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">[2] <a class="ae jf" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> React钩子文档</a></p><blockquote class="ni"><p id="5dcd" class="nj nk ht bd nl nm nn no np nq nr kd ek translated">加入Coinmonks <a class="ae jf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jf" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="5293" class="mr kg ht bd kh ms mt mu kl mv mw mx kp my ns na ks nb nt nd kv ne nu ng ky nh dt translated">另外，阅读</h1><ul class=""><li id="f09d" class="lw lx ht ji b jj la jn lb jr nv jv nw jz nx kd mb mc md me dt translated"><a class="ae jf" href="https://coincodecap.com/coinloan-review" rel="noopener ugc nofollow" target="_blank"> CoinLoan评论</a> | <a class="ae jf" rel="noopener" href="/coinmonks/youhodler-4-easy-ways-to-make-money-98969b9689f2"> YouHodler评论</a> | <a class="ae jf" href="https://coincodecap.com/blockfi-review" rel="noopener ugc nofollow" target="_blank"> BlockFi评论</a></li><li id="2d49" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated"><a class="ae jf" href="https://coincodecap.com/profittradingapp-for-binance" rel="noopener ugc nofollow" target="_blank">XT.COM评论</a>币安评论 | <a class="ae jf" href="https://coincodecap.com/xt-com-review" rel="noopener ugc nofollow" target="_blank"/></li><li id="e5e9" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated"><a class="ae jf" href="https://coincodecap.com/smithbot-review" rel="noopener ugc nofollow" target="_blank"> SmithBot评论</a> | <a class="ae jf" href="https://coincodecap.com/free-open-source-trading-bots" rel="noopener ugc nofollow" target="_blank"> 4款最佳免费开源交易机器人</a></li><li id="c18b" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/coinbase-bots-ac6359e897f3">比特币基地僵尸程序</a> | <a class="ae jf" rel="noopener" href="/coinmonks/ascendex-review-53e829cf75fa"> AscendEX审查</a> | <a class="ae jf" rel="noopener" href="/coinmonks/okex-trading-bots-234920f61e60"> OKEx交易僵尸程序</a></li><li id="bac3" class="lw lx ht ji b jj ml jn mm jr mn jv mo jz mp kd mb mc md me dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94">如何在印度购买比特币？</a> | <a class="ae jf" rel="noopener" href="/coinmonks/wazirx-review-5c811b074f5b">瓦济克斯审查</a></li></ul></div></div>    
</body>
</html>