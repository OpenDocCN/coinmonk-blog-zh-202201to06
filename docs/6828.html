<html>
<head>
<title>Hyperledger Fabric privacy illustration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hyperledger结构隐私插图</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hyperledger-fabric-privacy-illustration-1a275af403da?source=collection_archive---------16-----------------------#2022-05-15">https://medium.com/coinmonks/hyperledger-fabric-privacy-illustration-1a275af403da?source=collection_archive---------16-----------------------#2022-05-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="52a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我之前的<a class="ae jo" rel="noopener" href="/coinmonks/cordapp-example-to-illustrate-privacy-fbc51ce87f78">帖子</a>中，我用R3 Corda展示了隐私是如何在私有区块链中得到保护的。在这篇文章中，我想对另一个流行的私有区块链平台Hyperledger Fabric做同样的事情。</p><h1 id="8b4b" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">超级分类帐结构体系</h1><p id="0386" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">Hyperledger Fabric由订购服务组成，该服务提供关于区块链事务的一致服务，然后将事务块广播到每个成员的对等节点。每个成员都在成员资格服务提供程序中注册了自己的成员资格，X509证书将在该服务提供程序中授予。每个成员至少有一个对等节点，它保存分类帐的副本并执行名为chiancode的智能契约。</p><p id="ba95" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">总账只是一个简单的<key>数据库。chaincode调用只是调用<code class="eh ks kt ku kv b">GetState</code>和<code class="eh ks kt ku kv b">PutState</code>通过实体键字符串(state-id)读写数据库。通常，状态将被封送到json字符串中作为实体值存储。</key></p><h1 id="d1c4" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">Hyperledger结构中的隐私</h1><p id="7446" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">在Hyperledger Fabric网络中，数据受渠道范围的保护。每个频道都有自己的分类账。相互信任和沟通的多个成员将加入通道并共享分类帐数据的副本。分类帐数据操作的应用程序逻辑以名为chaincode的智能契约的形式实现。每个渠道成员的对等节点将执行链码来更新分类帐数据。每个分类账交易必须由所有渠道成员或渠道配置中预定义的成员子集进行验证和签名。</p><p id="69dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您希望将一些私有数据限制在每个成员本身，可以使用私有数据集合。每个成员都有一个隐式的默认私有数据集合(命名为“_implicit_org_ <mspid>”)，该集合仅限于成员自身，因此每个组织成员都可以存储一些仅由自己共享的私有数据。可以用不同的共享规则来定义额外的私有数据收集，这些规则允许数据被通道内的成员子集共享。</mspid></p><h1 id="516b" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">Croda和Hyperledger面料的区别</h1><p id="3c9b" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">Hyperledger Fabric和R3 Corda之间的一个关键区别是，Corda交易可以由不同方签署。比如交易001是甲乙双方签字，而交易002是甲乙丙双方签字，那么，甲方只能看到交易001，看不到交易002，而乙方可以同时看到交易001和交易002。在Hyperledger Farbic中，隐私在频道范围内受到保护。同一渠道的所有交易数据都存储在所有渠道成员的总账中。交易由所有渠道成员或渠道配置中预定义的成员子集进行验证和签名。</p><p id="ec5d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我的经验是R3 Corda更灵活，因为事务数据是在流执行运行时根据共享逻辑共享的。但是，在Hyperledger Frabic中，共享规则必须在创建渠道时使用交易背书政策或私人数据收集定义进行预设。</p><h1 id="7326" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">隐私插图</h1><p id="9db3" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">这里我用我之前的例子app(共享学校图书馆)来说明这一点。在这个例子中，每本书都有自己授权列表。只有授权列表中的当事人可以查看和借阅图书。</p><p id="a467" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在Corda中，图书创作由权利列表中的各方签署。由于不同的书籍可以有不同的权限列表，因此不同书籍的数据由不同的当事人子集存储，但不是所有当事人。</p><p id="0ed7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在Hyperledger Fabric中，所有帐簿数据都存储在所有渠道成员的分类帐中。尽管我们仍然为每本书定义了授权列表，但我们只能阻止不在授权列表中的成员查询书的详细信息和借书/还书。图书信息仍然存储在每个渠道成员的分类帐数据库中，即使该成员不能查询图书信息。下面是访问控制检查的代码。</p><pre class="kw kx ky kz fq la kv lb lc aw ld dt"><span id="4298" class="le jq ht kv b fv lf lg l lh li">for _, v := range book.EntitleList {<br/>           if v == caller {<br/>                books = append(books, &amp;book)<br/>                break;<br/>           }</span><span id="729b" class="le jq ht kv b fv lj lg l lh li">}</span></pre><p id="9352" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh ks kt ku kv b">caller</code>是成员节点用户运行的查询图书命令的通用名。Hyperledger Fabric提供了获取成员节点身份的API:<code class="eh ks kt ku kv b">ctx.GetStub().GetCreator()</code>，身份是一个X.509证书。为了便于阅读，我从证书中提取了CommonName。</p><pre class="kw kx ky kz fq la kv lb lc aw ld dt"><span id="1b77" class="le jq ht kv b fv lf lg l lh li">func (s *SmartContract) GetClientName(ctx contractapi.TransactionContextInterface) (string,error) {<br/>  caller,err := ctx.GetStub().GetCreator()<br/>  if err != nil {<br/>    return "",err<br/>  }<br/>  re := regexp.MustCompile("-----BEGIN CERTIFICATE-----[^ ]+-----END CERTIFICATE-----\n")<br/>  match := re.FindStringSubmatch(string(caller))<br/>  pemBlock, _ := pem.Decode([]byte(match[0]))<br/>  cert, err := x509.ParseCertificate(pemBlock.Bytes)<br/>  if err != nil {<br/>    return "",err<br/>  }<br/>  owner := cert.Subject.CommonName<br/>  return owner,nil<br/>}</span></pre><h1 id="5409" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">学生个人信息如何保护？</h1><p id="6272" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">图书信息通常可以在所有组织(学校)之间共享，但学生信息应该保存在每个组织(学校)内部，而不应该共享。这样的私有信息可以通过调用<code class="eh ks kt ku kv b">PutPrivateData</code>存储在隐式默认私有数据集合中。这是代码。</p><pre class="kw kx ky kz fq la kv lb lc aw ld dt"><span id="a1d1" class="le jq ht kv b fv lf lg l lh li">student := Student{<br/>    Org:            caller,<br/>    StudentID:      id,<br/>    Name:           studentInput.Name,<br/>    Phone:          studentInput.Phone,<br/>    Email:          studentInput.Email,<br/>  }<br/>  studentJSON, err := json.Marshal(student)<br/>  if err != nil {<br/>    return err<br/>  }</span><span id="55f4" class="le jq ht kv b fv lj lg l lh li">return ctx.GetStub().PutPrivateData(PrivateCollection,id, studentJSON)</span></pre><p id="2348" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">其他成员节点不能读取学生信息，但是它们可以通过从学生id获取数据散列来检查是否存在。</p><pre class="kw kx ky kz fq la kv lb lc aw ld dt"><span id="a384" class="le jq ht kv b fv lf lg l lh li">studentHash,err := ctx.GetStub().GetPrivateDataHash(PrivateCollection, student)<br/>  if err != nil {<br/>    return "",err<br/>  }<br/>  if studentHash == nil {<br/>    return "",fmt.Errorf("cannot find the student")<br/>  }</span></pre><p id="2621" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">理论上，如果用户提供私有信息，每个节点可以通过比较信息的SHA哈希来验证信息的正确性。</p><p id="5576" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">完整的代码可以在这里找到<a class="ae jo" href="https://github.com/iwasnothing/hlf_toy_app/blob/main/sharebook/sharebook.go" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="d5d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下一篇文章中，我会解释更多关于代码的内容。</p><blockquote class="lk"><p id="9776" class="ll lm ht bd ln lo lp lq lr ls lt jn ek translated">加入Coinmonks <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="fba5" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka lu kc kd ke lv kg kh ki lw kk kl km dt translated">另外，阅读</h1><ul class=""><li id="3d6d" class="lx ly ht is b it kn ix ko jb lz jf ma jj mb jn mc md me mf dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae jo" href="https://coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a> | <a class="ae jo" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="ea84" class="lx ly ht is b it mg ix mh jb mi jf mj jj mk jn mc md me mf dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">莱杰vs n rave</a>|<a class="ae jo" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">莱杰nano s vs x </a> | <a class="ae jo" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="dfca" class="lx ly ht is b it mg ix mh jb mi jf mj jj mk jn mc md me mf dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit Exchange审查</a> | <a class="ae jo" href="https://coincodecap.com/bityard-reivew" rel="noopener ugc nofollow" target="_blank"> Bityard审查</a> | <a class="ae jo" href="https://coincodecap.com/jet-bot-review" rel="noopener ugc nofollow" target="_blank"> Jet-Bot审查</a></li><li id="ee89" class="lx ly ht is b it mg ix mh jb mi jf mj jj mk jn mc md me mf dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203">3 commas vs crypto hopper</a>|<a class="ae jo" rel="noopener" href="/coinmonks/earn-crypto-interest-b10b810fdda3">赚取加密利息</a></li><li id="45ba" class="lx ly ht is b it mg ix mh jb mi jf mj jj mk jn mc md me mf dt translated">最好的比特币<a class="ae jo" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a> | <a class="ae jo" rel="noopener" href="/coinmonks/bitbox02-review-your-swiss-bitcoin-hardware-wallet-c36c88fff29"> BitBox02回顾</a></li><li id="ef0e" class="lx ly ht is b it mg ix mh jb mi jf mj jj mk jn mc md me mf dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630"> BlockFi vs摄氏度</a> | <a class="ae jo" rel="noopener" href="/coinmonks/hodlnaut-review-best-way-to-hodl-is-to-earn-interest-on-your-bitcoin-6658a8c19edf"> Hodlnaut审核</a> | <a class="ae jo" href="https://coincodecap.com/kucoin-review" rel="noopener ugc nofollow" target="_blank"> KuCoin审核</a></li></ul></div></div>    
</body>
</html>