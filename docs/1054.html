<html>
<head>
<title>The Partial Preimage Technique</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部分原像技术</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/the-partial-preimage-technique-b60498c47ba?source=collection_archive---------7-----------------------#2022-02-23">https://medium.com/coinmonks/the-partial-preimage-technique-b60498c47ba?source=collection_archive---------7-----------------------#2022-02-23</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="057e" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">如何善用长度扩展攻击</h2></div><p id="99a4" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一般来说，要计算输入的散列(称为原像)，需要它的整体。我们展示了一种新颖的技术，只使用部分原像来计算散列，适用于各种散列算法。</p><h1 id="d424" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">SHA256的工作原理</h1><p id="72c0" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">让我们以SHA256为例。在内部，它的工作方式如下:</p><ol class=""><li id="c9c5" class="lb lc ht jk b jl jm jo jp jr ld jv le jz lf kd lg lh li lj dt translated">原像被分成512位的块。必要时会添加填充。</li><li id="1145" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd lg lh li lj dt translated">每个块被迭代地馈入函数<strong class="jk hu"> g </strong>，连同内部状态(当前散列h0-h3)，其输出被用作下一次迭代的输入。</li><li id="7fe6" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd lg lh li lj dt translated">最后一个状态是最终的哈希。</li></ol><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff lp"><img src="../Images/d04eead2ddf7f1fccf9233df01219ab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxI3nvxVQHEQnrd6XwMKHQ.png"/></div></div><figcaption class="mb mc fg fe ff md me bd b be z ek"><a class="ae mf" href="https://en.wikipedia.org/wiki/Merkle%E2%80%93Damg%C3%A5rd_construction" rel="noopener ugc nofollow" target="_blank">Merkle–Damgård construction</a></figcaption></figure><p id="95a0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这个过程叫做<strong class="jk hu"/><a class="ae mf" href="https://en.wikipedia.org/wiki/Merkle%E2%80%93Damg%C3%A5rd_construction" rel="noopener ugc nofollow" target="_blank">Merkle–damg rd施工</a>。<strong class="jk hu"> g </strong>是一个压缩函数，接受两个固定长度的输入并产生一个固定长度的输出。</p><h1 id="5ef0" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">部分原像技术</h1><p id="2264" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">由于构造的迭代性质，如果我们从任何中间迭代开始，我们可以获得相同的散列，只要我们有当前的内部状态/散列和剩余的原像。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff mg"><img src="../Images/423a2a6a682f971a3238a1984a537137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BePrfgWD8YM85col--fkVQ.png"/></div></div><figcaption class="mb mc fg fe ff md me bd b be z ek">Compute Hash from Intermediate State</figcaption></figure><h2 id="9a39" class="mh kf ht bd kg mi mj mk kk ml mm mn ko jr mo mp kq jv mq mr ks jz ms mt ku mu dt translated">长度扩展攻击</h2><p id="4a89" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">SHA256的迭代和有状态特性使其容易受到所谓的<a class="ae mf" href="https://en.wikipedia.org/wiki/Length_extension_attack" rel="noopener ugc nofollow" target="_blank">长度扩展攻击</a>。攻击者可以使用<strong class="jk hu">sha 256</strong>(<em class="mv">message 1</em>)和<em class="mv"> message1 </em>的长度来计算被攻击者控制的<em class="mv"> message2 </em>的<strong class="jk hu">sha 256</strong>(<em class="mv">message 1</em>‖<em class="mv">message 2</em>)，而不需要知道<em class="mv"> message1 </em>的内容。</p><p id="fa0e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们将攻击面转向它的头部，并利用它来为我们服务。</p><h2 id="45e3" class="mh kf ht bd kg mi mj mk kk ml mm mn ko jr mo mp kq jv mq mr ks jz ms mt ku mu dt translated">示例用法:获取没有完整Tx的父Tx的nLocktime</h2><p id="a511" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">我们使用一个玩具示例来演示如何利用上述技术。契约要求解锁它的消费交易必须给<a class="ae mf" href="https://learnmeabitcoin.com/technical/locktime" rel="noopener ugc nofollow" target="_blank">锁定时间</a>增加一个指定的延迟。这通常需要注入完整的父事务并解析它以获得锁时间。多亏了这项技术，我们可以通过只包含最后一块来实现它。</p><figure class="lq lr ls lt fq lu"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="mb mc fg fe ff md me bd b be z ek"><a class="ae mf" href="https://github.com/sCrypt-Inc/boilerplate/blob/master/contracts/incrementLocktime.scrypt" rel="noopener ugc nofollow" target="_blank">Contract <em class="my">IncrementLocktime</em></a></figcaption></figure><p id="a29f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">函数<strong class="jk hu"><em class="mv">partialSha256()</em></strong>实现SHA256，并根据事务的尾部和所有前面部分的当前哈希计算事务的sha 256哈希(<em class="mv"> h0-h7 </em>)。第53–158行对应于将函数<strong class="jk hu"> g </strong>应用于一个块。</p><h2 id="6ee2" class="mh kf ht bd kg mi mj mk kk ml mm mn ko jr mo mp kq jv mq mr ks jz ms mt ku mu dt translated">讨论</h2><p id="27db" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">将部分前映像技术应用于上述契约可能没有意义，因为实现SHA256的开销超过了仅注入部分事务的节省。但是，当事务较大时，好处可能会超过开销，随着脚本和事务大小的不断增长，这种情况越来越常见。</p><p id="b850" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">除了SHA256之外，这种技术还适用于散列算法MD5、RIPEMD-160、SHA-1和其他也基于Merkle–damg rd结构的SHA-2。鉴于这些哈希算法在比特币中的流行，这种技术可以得到广泛应用。</p><h1 id="1e37" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">承认</h1><p id="9db6" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">这个想法源于史蒂夫·沙德斯。白皮书和部分原像的代码归Ying Chan所有，他以前在nChain工作，现在在Cambridge Cryptographic工作。</p></div><div class="ab cl mz na hb nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hm hn ho hp hq"><p id="a798" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">[1]是串联。</p><p id="ae4b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">[2]假设4字节nlocktime在最后一个块中，而不是跨最后两个块分割。</p><blockquote class="ng"><p id="6da2" class="nh ni ht bd nj nk nl nm nn no np kd ek translated">加入Coinmonks <a class="ae mf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae mf" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="6632" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz nq ja kq jc nr jd ks jf ns jg ku kv dt translated">另外，阅读</h1><ul class=""><li id="6609" class="lb lc ht jk b jl kw jo kx jr nt jv nu jz nv kd nw lh li lj dt translated"><a class="ae mf" href="https://coincodecap.com/best-online-casinos" rel="noopener ugc nofollow" target="_blank">最佳网上赌场</a> | <a class="ae mf" rel="noopener" href="/coinmonks/futures-trading-bots-5a282ccee3f5">期货交易机器人</a></li><li id="79f7" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated"><a class="ae mf" href="https://coincodecap.com/what-are-decentralized-exchanges" rel="noopener ugc nofollow" target="_blank">分散交易所</a> | <a class="ae mf" href="https://coincodecap.com/bitbns-fip" rel="noopener ugc nofollow" target="_blank">比特FIP </a> | <a class="ae mf" href="https://coincodecap.com/bingbon-review" rel="noopener ugc nofollow" target="_blank">宾邦评论</a></li><li id="2c5f" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated"><a class="ae mf" href="https://coincodecap.com/buy-crypto-with-credit-card" rel="noopener ugc nofollow" target="_blank">用信用卡购买密码的10个最佳地点</a></li><li id="0703" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated"><a class="ae mf" href="https://coincodecap.com/5-best-crypto-trading-bots-in-canada" rel="noopener ugc nofollow" target="_blank">加拿大最佳加密交易机器人</a> | <a class="ae mf" href="https://coincodecap.com/bybit-binance-moonxbt" rel="noopener ugc nofollow" target="_blank"> Bybit vs币安</a></li><li id="290c" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated"><a class="ae mf" href="https://coincodecap.com/best-crypto-exchanges-in-uae" rel="noopener ugc nofollow" target="_blank">阿联酋五大最佳加密交易所</a> | <a class="ae mf" href="https://coincodecap.com/simpleswap-review" rel="noopener ugc nofollow" target="_blank"> SimpleSwap评论</a></li><li id="cbd1" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated">购买Dogecoin的7种最佳方式</li><li id="a315" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated"><a class="ae mf" href="https://coincodecap.com/futures-trading-signals" rel="noopener ugc nofollow" target="_blank">最佳期货交易信号</a> | <a class="ae mf" href="https://coincodecap.com/liquid-exchange-review" rel="noopener ugc nofollow" target="_blank">期交所评论</a></li><li id="0fc6" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated"><a class="ae mf" href="https://coincodecap.com/huobi-crypto-trading-signals" rel="noopener ugc nofollow" target="_blank">用于Huobi的加密交易信号</a> | <a class="ae mf" rel="noopener" href="/coinmonks/swapzone-review-crypto-exchange-data-aggregator-e0ad78e55ed7"> Swapzone审查</a></li><li id="4853" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated">最佳<a class="ae mf" href="https://coincodecap.com/best-crypto-trading-bots" rel="noopener ugc nofollow" target="_blank">密码交易机器人</a> | <a class="ae mf" href="https://coincodecap.com/buy-solana" rel="noopener ugc nofollow" target="_blank">购买索拉纳</a> | <a class="ae mf" href="https://coincodecap.com/matrixport-review" rel="noopener ugc nofollow" target="_blank">矩阵导出评论</a></li><li id="73b1" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd nw lh li lj dt translated"><a class="ae mf" href="https://coincodecap.com/coldcard-review" rel="noopener ugc nofollow" target="_blank"> Coldcard评论</a> | <a class="ae mf" href="https://coincodecap.com/boxtradex-review" rel="noopener ugc nofollow" target="_blank"> BOXtradEX评论</a>|<a class="ae mf" href="https://coincodecap.com/uniswap" rel="noopener ugc nofollow" target="_blank">uni swap指南</a></li></ul></div></div>    
</body>
</html>