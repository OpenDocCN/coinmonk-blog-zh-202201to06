<html>
<head>
<title>Blockchain : Day 2 — EtherJS + VueJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">区块链:第二天— EtherJS + VueJS</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/blockchain-day-2-etherjs-vuejs-4a2896a50ef2?source=collection_archive---------2-----------------------#2022-01-07">https://medium.com/coinmonks/blockchain-day-2-etherjs-vuejs-4a2896a50ef2?source=collection_archive---------2-----------------------#2022-01-07</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/75ebef85e4984500b4185302f516f3e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*pcbpaCzJvgeobsFnWy6pqg.png"/></div></figure><h1 id="f6cd" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated">#概述</h1><p id="ffa7" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">在之前的帖子中，我们讨论了在Ganache上使用<a class="ae kt" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank"> Hardhat </a>创建和部署智能合约。我们还使用<code class="eh ku kv kw kx b">hardhat console</code>测试了简单智能契约的功能。控制台工具对于测试目的是好的，但是迟早我们需要建立真正的应用程序，它可以与我们创建的契约进行交互。有一些图书馆可以帮助我们完成这项任务，其中我找到了那两个著名的</p><ul class=""><li id="20b4" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated"><a class="ae kt" href="https://web3js.readthedocs.io/en/v1.5.2/" rel="noopener ugc nofollow" target="_blank"> Web3JS </a>:这是一个库的集合，允许你使用HTTP、IPC或WebSocket与本地或远程以太坊节点进行交互。</li><li id="d369" class="ky kz ht jx b jy lj kc lk kg ll kk lm ko ln ks lf lg lh li dt translated"><a class="ae kt" href="https://docs.ethers.io/v5/" rel="noopener ugc nofollow" target="_blank">Ether</a>s:ethers . js库旨在成为一个完整而紧凑的库，用于与以太坊区块链及其生态系统进行交互。</li></ul><p id="d2e5" class="pw-post-body-paragraph jv jw ht jx b jy la ka kb kc lb ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">根据描述，很难说哪一个更好，但是根据我的调查，ethers似乎有一些web3js没有的高级特性。</p><div class="lr ls fm fo lt lu"><a rel="noopener follow" target="_blank" href="/l4-media/announcing-ethers-js-a-web3-alternative-6f134fdd06f3"><div class="lv ab ej"><div class="lw ab lx cl cj ly"><h2 class="bd hu fv z el lz eo ep ma er et hs dt translated">宣布ethers . js—web 3的替代方案</h2><div class="mb l"><h3 class="bd b fv z el lz eo ep ma er et ek translated">L4 Ventures和毛利小五郎很自豪地宣布ethers.js的最新版本，这是一个功能完整的库…</h3></div><div class="mc l"><p class="bd b gc z el lz eo ep ma er et ek translated">medium.com</p></div></div></div></a></div><blockquote class="md me mf"><p id="671d" class="jv jw mg jx b jy la ka kb kc lb ke kf mh lo ki kj mi lp km kn mj lq kq kr ks hm dt translated">ethers.js和web3之间的一个主要区别是它们如何处理密钥管理和与以太坊区块链的交互。Web3假设有一个本地节点连接到应用程序。假设该节点存储密钥、签署交易、与以太坊区块链交互并读取以太坊。实际上，情况并不总是这样——大多数用户并不在本地运行geth。Metamask通过浏览器应用程序有效地模拟了那个环境，因此大多数web3应用程序需要Metamask来保存密钥、签署交易以及与以太坊主网交互。(<a class="ae kt" rel="noopener" href="/@l4v">引L4V </a>)</p></blockquote><p id="641e" class="pw-post-body-paragraph jv jw ht jx b jy la ka kb kc lb ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">所以我决定使用etherjs来构建我们的前端应用程序。我也决定选择<a class="ae kt" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx hu"> VueJS </strong> </a>作为前端框架。这并不是因为VueJS有一些支持etherjs的突出特性，而仅仅是因为我曾经在VueJS上工作过。</p><ul class=""><li id="196d" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">[化]醚</li><li id="fc1f" class="ky kz ht jx b jy lj kc lk kg ll kk lm ko ln ks lf lg lh li dt translated">VueJS</li></ul><h1 id="cf77" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated">#前端应用程序设置</h1><p id="3846" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">第一步是创建前端应用程序，我们已经在以前的职位。</p><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="153e" class="ms iy ht kx b fv mt mu l mv mw">$vue create hello-blockchain <br/>$cd hello-blockchain</span></pre><p id="82a1" class="pw-post-body-paragraph jv jw ht jx b jy la ka kb kc lb ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">然后我们需要安装乙醚:</p><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="be6e" class="ms iy ht kx b fv mt mu l mv mw">$npm install --save ethers</span></pre><p id="5d88" class="pw-post-body-paragraph jv jw ht jx b jy la ka kb kc lb ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">根据<a class="ae kt" href="https://docs.ethers.io/v5/getting-started/#installing" rel="noopener ugc nofollow" target="_blank">乙醚的手册</a>，导入乙醚并在我们的应用程序中使用非常简单:</p><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="28b6" class="ms iy ht kx b fv mt mu l mv mw">import { ethers } from "ethers";</span></pre><p id="9774" class="pw-post-body-paragraph jv jw ht jx b jy la ka kb kc lb ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">所以我试着在我的main.js中导入ethers，如下所示，但是没有成功。</p><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="bd91" class="ms iy ht kx b fv mt mu l mv mw">import Vue from 'vue'</span><span id="e685" class="ms iy ht kx b fv mx mu l mv mw">import router from './router'</span><span id="2840" class="ms iy ht kx b fv mx mu l mv mw"><strong class="kx hu">import { ethers } from "ethers";</strong></span><span id="0a5e" class="ms iy ht kx b fv mx mu l mv mw">import App from './App.vue'</span><span id="68b1" class="ms iy ht kx b fv mx mu l mv mw">Vue.config.productionTip = false</span><span id="565b" class="ms iy ht kx b fv mx mu l mv mw">Vue.use(<strong class="kx hu">ethers</strong>);</span><span id="9334" class="ms iy ht kx b fv mx mu l mv mw">new Vue({</span><span id="3d24" class="ms iy ht kx b fv mx mu l mv mw">   router,</span><span id="7a47" class="ms iy ht kx b fv mx mu l mv mw">   render: h =&gt; h(App),</span><span id="8a2c" class="ms iy ht kx b fv mx mu l mv mw">}).$mount('#app')</span></pre><p id="f9ff" class="pw-post-body-paragraph jv jw ht jx b jy la ka kb kc lb ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">我不能在我的Vue组件中使用醚，既不使用<code class="eh ku kv kw kx b">this.ethers</code>也不使用<code class="eh ku kv kw kx b">Vue.ethers</code>。我意识到问题可能不在于Vue插件的形状。所以我决定创建自己的ethers插件。</p><ul class=""><li id="1d13" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">创建插件文件夹</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="e5f9" class="ms iy ht kx b fv mt mu l mv mw">$mkdir plugins<br/>$cd plugins </span></pre><ul class=""><li id="8cb7" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">创建一个名为ethers.js的ethers插件</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="bb4f" class="ms iy ht kx b fv mt mu l mv mw">touch ethers.js </span></pre><ul class=""><li id="b4ca" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">我做了一个简单的技巧来包装ethers库并将其作为Vue插件安装:</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="2ffb" class="ms iy ht kx b fv mt mu l mv mw">"use strict";</span><span id="537c" class="ms iy ht kx b fv mx mu l mv mw">import { ethers } from 'ethers';</span><span id="c313" class="ms iy ht kx b fv mx mu l mv mw">Plugin.install = function(Vue) {</span><span id="7ba1" class="ms iy ht kx b fv mx mu l mv mw">   Vue.prototype.ethers = ethers;</span><span id="b526" class="ms iy ht kx b fv mx mu l mv mw">   Object.defineProperties(Vue.prototype, {</span><span id="a02e" class="ms iy ht kx b fv mx mu l mv mw">     $ethers: {</span><span id="883d" class="ms iy ht kx b fv mx mu l mv mw">        get() {</span><span id="8df0" class="ms iy ht kx b fv mx mu l mv mw">         return ethers;</span><span id="77b3" class="ms iy ht kx b fv mx mu l mv mw">        }</span><span id="afe5" class="ms iy ht kx b fv mx mu l mv mw">     },</span><span id="69aa" class="ms iy ht kx b fv mx mu l mv mw">  });</span><span id="c96d" class="ms iy ht kx b fv mx mu l mv mw">};</span><span id="8990" class="ms iy ht kx b fv mx mu l mv mw">export default Plugin;</span></pre><ul class=""><li id="3650" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">使用新创建的ethers插件，而不是在main.js中导入ethers库:</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="aec8" class="ms iy ht kx b fv mt mu l mv mw">import Vue from 'vue'</span><span id="8c22" class="ms iy ht kx b fv mx mu l mv mw">import router from './router'</span><span id="c4ea" class="ms iy ht kx b fv mx mu l mv mw"><strong class="kx hu">import ethers from "./plugins/ethers";</strong></span><span id="26c1" class="ms iy ht kx b fv mx mu l mv mw">import App from './App.vue'</span><span id="0779" class="ms iy ht kx b fv mx mu l mv mw">Vue.config.productionTip = false</span><span id="f016" class="ms iy ht kx b fv mx mu l mv mw">Vue.use(ethers);</span><span id="6876" class="ms iy ht kx b fv mx mu l mv mw">new Vue({</span><span id="d94c" class="ms iy ht kx b fv mx mu l mv mw">   router,</span><span id="548b" class="ms iy ht kx b fv mx mu l mv mw">   render: h =&gt; h(App),</span><span id="c0ab" class="ms iy ht kx b fv mx mu l mv mw">}).$mount('#app')</span></pre><p id="3053" class="pw-post-body-paragraph jv jw ht jx b jy la ka kb kc lb ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">从现在开始，我可以在我的组件中使用<code class="eh ku kv kw kx b">this.$ethers</code>。</p><h1 id="0617" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated"><strong class="ak"> #连接设置</strong></h1><p id="8465" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">现在是时候做一些基本的步骤，将我们的应用程序连接到ganache，并使用代码与我们的合同进行交互。现在让我们使用现有的组件HelloWorld.vue。</p><ul class=""><li id="20b2" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">定义组件数据结构:</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="14b8" class="ms iy ht kx b fv mt mu l mv mw">data() {</span><span id="e060" class="ms iy ht kx b fv mx mu l mv mw">   return {</span><span id="9364" class="ms iy ht kx b fv mx mu l mv mw">   currentAccount: null,</span><span id="59de" class="ms iy ht kx b fv mx mu l mv mw">   currentContract : null,</span><span id="34c8" class="ms iy ht kx b fv mx mu l mv mw">   contractAddress: "&lt;Your deployed contract Address&gt;"</span><span id="a92c" class="ms iy ht kx b fv mx mu l mv mw">   };</span><span id="4be1" class="ms iy ht kx b fv mx mu l mv mw">},</span></pre><ul class=""><li id="5fcd" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">我们希望在每次安装组件时检查我们的应用程序是否连接到元掩码，因此我们如下所示:</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="28fe" class="ms iy ht kx b fv mt mu l mv mw">mounted(){</span><span id="32c4" class="ms iy ht kx b fv mx mu l mv mw">    this.checkConnectedWalletExist();</span><span id="b31b" class="ms iy ht kx b fv mx mu l mv mw">},</span></pre><ul class=""><li id="9033" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated"><code class="eh ku kv kw kx b">checkConnectedWalletExists()</code>在组件的<code class="eh ku kv kw kx b">methods</code>部分定义。如果我们已经连接到元掩码，这个函数返回<code class="eh ku kv kw kx b">true</code>,如果没有，返回<code class="eh ku kv kw kx b">false</code>。</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="3abd" class="ms iy ht kx b fv mt mu l mv mw">methods:{</span><span id="d258" class="ms iy ht kx b fv mx mu l mv mw">   checkConnectedWalletExist: async function(){</span><span id="c0b3" class="ms iy ht kx b fv mx mu l mv mw">     try {</span><span id="7bc8" class="ms iy ht kx b fv mx mu l mv mw">      const { ethereum } = window;</span><span id="ed90" class="ms iy ht kx b fv mx mu l mv mw">      if (!ethereum) {</span><span id="861b" class="ms iy ht kx b fv mx mu l mv mw">        alert("Make sure you have metamask!");</span><span id="16b4" class="ms iy ht kx b fv mx mu l mv mw">        return false;</span><span id="39cd" class="ms iy ht kx b fv mx mu l mv mw">      } else {</span><span id="4123" class="ms iy ht kx b fv mx mu l mv mw">        console.log("We have the ethereum object", ethereum);</span><span id="eba3" class="ms iy ht kx b fv mx mu l mv mw">     }</span><span id="4cc4" class="ms iy ht kx b fv mx mu l mv mw">     const accounts = await ethereum.request({ method: "eth_accounts" });</span><span id="4e2c" class="ms iy ht kx b fv mx mu l mv mw">     if (accounts.length !== 0) {</span><span id="4d3e" class="ms iy ht kx b fv mx mu l mv mw">         const account = accounts[0];</span><span id="09ea" class="ms iy ht kx b fv mx mu l mv mw">         console.log("Found an authorized account:", account);</span><span id="8717" class="ms iy ht kx b fv mx mu l mv mw">         this.currentAccount = account;</span><span id="afcc" class="ms iy ht kx b fv mx mu l mv mw">         return true;</span><span id="ed50" class="ms iy ht kx b fv mx mu l mv mw">     } else {</span><span id="a035" class="ms iy ht kx b fv mx mu l mv mw">         console.log("No authorized account found");</span><span id="1986" class="ms iy ht kx b fv mx mu l mv mw">         return false;</span><span id="91e9" class="ms iy ht kx b fv mx mu l mv mw">      }</span><span id="f496" class="ms iy ht kx b fv mx mu l mv mw">   } catch (error) {</span><span id="7c35" class="ms iy ht kx b fv mx mu l mv mw">      console.log(error);</span><span id="de69" class="ms iy ht kx b fv mx mu l mv mw">      return false;</span><span id="4349" class="ms iy ht kx b fv mx mu l mv mw">   }</span><span id="6d95" class="ms iy ht kx b fv mx mu l mv mw">},</span></pre><ul class=""><li id="552a" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">如果我们没有连接到元掩码，我们要求用户通过单击连接钱包按钮来连接</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="4eae" class="ms iy ht kx b fv mt mu l mv mw">&lt;h3&gt;Connect Wallet&lt;/h3&gt;</span><span id="d59f" class="ms iy ht kx b fv mx mu l mv mw"><strong class="kx hu">&lt;div v-if="!currentAccount"&gt;</strong></span><span id="432e" class="ms iy ht kx b fv mx mu l mv mw">     &lt;button class="primaryButton" @click="<strong class="kx hu">connectWallet</strong>"&gt;Connect Wallet&lt;/button&gt;</span><span id="af13" class="ms iy ht kx b fv mx mu l mv mw">&lt;/div&gt;</span></pre><ul class=""><li id="a93f" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">点击连接钱包按钮将依次触发方法<code class="eh ku kv kw kx b">connectWallet()</code>，定义如下:</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="130b" class="ms iy ht kx b fv mt mu l mv mw">connectWallet: async function (){</span><span id="418c" class="ms iy ht kx b fv mx mu l mv mw"> try {</span><span id="6305" class="ms iy ht kx b fv mx mu l mv mw">   const { ethereum } = window;</span><span id="71a6" class="ms iy ht kx b fv mx mu l mv mw">   if (!ethereum) {</span><span id="671f" class="ms iy ht kx b fv mx mu l mv mw">       alert("Get MetaMask!");</span><span id="d344" class="ms iy ht kx b fv mx mu l mv mw">      return;</span><span id="a47e" class="ms iy ht kx b fv mx mu l mv mw">   }</span><span id="0f15" class="ms iy ht kx b fv mx mu l mv mw">   const accounts = await ethereum.request({</span><span id="687a" class="ms iy ht kx b fv mx mu l mv mw">        method: "eth_requestAccounts",</span><span id="3fbd" class="ms iy ht kx b fv mx mu l mv mw">   });</span><span id="e3c5" class="ms iy ht kx b fv mx mu l mv mw">   console.log("Connected", accounts[0]);</span><span id="8f24" class="ms iy ht kx b fv mx mu l mv mw">   this.currentAccount = accounts[0];</span><span id="dc8c" class="ms iy ht kx b fv mx mu l mv mw"> } catch (error) {</span><span id="d9ca" class="ms iy ht kx b fv mx mu l mv mw">   console.log(error);</span><span id="a5b4" class="ms iy ht kx b fv mx mu l mv mw"> }</span><span id="e989" class="ms iy ht kx b fv mx mu l mv mw">},</span></pre><ul class=""><li id="950b" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">现在我们已经连接到wallet，是时候参考我们部署的合同了:</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="778f" class="ms iy ht kx b fv mt mu l mv mw">&lt;div v-if="!currentContract"&gt;</span><span id="b7cb" class="ms iy ht kx b fv mx mu l mv mw">    &lt;button class="primaryButton" @click="attachContract"&gt;Attach Contract&lt;/button&gt;</span><span id="56c8" class="ms iy ht kx b fv mx mu l mv mw">&lt;/div&gt;</span></pre><ul class=""><li id="ead9" class="ky kz ht jx b jy la kc lb kg lc kk ld ko le ks lf lg lh li dt translated">合同参考:</li></ul><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="aafb" class="ms iy ht kx b fv mt mu l mv mw">attachContract: async function() {</span><span id="e149" class="ms iy ht kx b fv mx mu l mv mw">const provider = new this.$ethers.providers.JsonRpcProvider("http://127.0.0.1:7545");</span><span id="8947" class="ms iy ht kx b fv mx mu l mv mw">const signer = provider.getSigner()</span><span id="a46c" class="ms iy ht kx b fv mx mu l mv mw">//const network = await provider.getNetwork();</span><span id="020d" class="ms iy ht kx b fv mx mu l mv mw">//console.log(network);</span><span id="226e" class="ms iy ht kx b fv mx mu l mv mw">const abi = Greeter.abi;</span><span id="338f" class="ms iy ht kx b fv mx mu l mv mw">// The Contract object</span><span id="5982" class="ms iy ht kx b fv mx mu l mv mw">this.currentContract = new this.$ethers.Contract(this.contractAddress, abi, signer);</span><span id="4efe" class="ms iy ht kx b fv mx mu l mv mw">console.log(await this.currentContract.symbol());</span><span id="0be9" class="ms iy ht kx b fv mx mu l mv mw">}</span></pre><p id="f231" class="pw-post-body-paragraph jv jw ht jx b jy la ka kb kc lb ke kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">请注意<code class="eh ku kv kw kx b">http://127.0.0.1:7545</code>是Ganache的RCP地址。当然，在这里创建提供者是不方便的，我们稍后会把它放在商店里，但现在还可以。我把<code class="eh ku kv kw kx b">blockchain</code>文件夹放在Vue文件夹项目下的原因是为了方便参考组合ABI</p><pre class="mk ml mm mn fq mo kx mp mq aw mr dt"><span id="b6be" class="ms iy ht kx b fv mt mu l mv mw">import Greeter from '../../blockchain/artifacts/contracts/Greeter/Greeter.json'</span></pre><h1 id="34be" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated">#结束</h1><p id="c3d9" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">因此，我们完成了配置EtherJS以与我们的VueJS项目一起工作的第2步。第三天见。</p></div></div>    
</body>
</html>