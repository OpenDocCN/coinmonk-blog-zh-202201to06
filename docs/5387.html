<html>
<head>
<title>[Astar] Using Foundry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Astar]使用铸造</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/astar-using-foundry-74aac10bcd02?source=collection_archive---------9-----------------------#2022-04-22">https://medium.com/coinmonks/astar-using-foundry-74aac10bcd02?source=collection_archive---------9-----------------------#2022-04-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/7cd653a26beb9fa753ddbbcb8174c96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vwK_ni43I_uLtcxDp8ZtVQ.png"/></div></div></figure><h1 id="fc77" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">为什么要代工？</h1><p id="b42e" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">我最近听说solidity开发人员有比hardhat更好的工具。它的名字叫铸造厂。听说有以下几个特点。</p><ul class=""><li id="5634" class="kx ky ht kb b kc kz kg la kk lb ko lc ks ld kw le lf lg lh dt translated">测试代码可以在solidity中实现，不用换头。</li><li id="668c" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated">有一个强大的堆栈跟踪功能，所以你不必使用console.log，这是在hardhat环境中经常使用的。</li><li id="7565" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated">编译速度比hardhat快。等等。</li></ul><p id="af88" class="pw-post-body-paragraph jz ka ht kb b kc kz ke kf kg la ki kj kk ln km kn ko lo kq kr ks lp ku kv kw hm dt translated">我们试试用代工吧！</p><div class="lq lr fm fo ls lt"><a href="https://github.com/foundry-rs/foundry" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hu fv z el ly eo ep lz er et hs dt translated">foundry是一个非常快速、便携和模块化的以太坊工具包…</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">Foundry是一个用Rust编写的以太坊应用程序开发的非常快速、可移植和模块化的工具包。铸造厂…</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">github.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh iz lt"/></div></div></a></div><h1 id="8c11" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">安装</h1><ul class=""><li id="2c16" class="kx ky ht kb b kc kd kg kh kk mi ko mj ks mk kw le lf lg lh dt translated">首先，不装锈，就得装锈。查看<a class="ae ml" href="https://www.rust-lang.org/tools/install" rel="noopener ugc nofollow" target="_blank">官方网站</a>。</li><li id="757b" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated">网络安装代工。这是<a class="ae ml" href="https://github.com/foundry-rs/foundry" rel="noopener ugc nofollow" target="_blank"> github </a>。</li></ul><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="7728" class="mv jc ht mr b fv mw mx l my mz">curl -L https://foundry.paradigm.xyz | bash</span></pre><ul class=""><li id="d5fb" class="kx ky ht kb b kc kz kg la kk lb ko lc ks ld kw le lf lg lh dt translated">重启你的终端。</li></ul><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="765f" class="mv jc ht mr b fv mw mx l my mz">foundryup</span></pre><h1 id="200c" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">创建项目</h1><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="a43b" class="mv jc ht mr b fv mw mx l my mz">mkdir test_project<br/>cd test_project<br/>forge init</span></pre><ul class=""><li id="40a2" class="kx ky ht kb b kc kz kg la kk lb ko lc ks ld kw le lf lg lh dt translated">运行该命令应该会创建以下目录和文件。</li></ul><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="2098" class="mv jc ht mr b fv mw mx l my mz">% ls -la              <br/>total 24<br/>drwxr-xr-x  10 shin.takahashi  staff  320  4 22 20:26 .<br/>drwxr-xr-x   3 shin.takahashi  staff   96  4 22 20:26 ..<br/>drwxr-xr-x  13 shin.takahashi  staff  416  4 22 20:26 .git<br/>drwxr-xr-x   3 shin.takahashi  staff   96  4 22 20:26 .github<br/>-rw-r--r--   1 shin.takahashi  staff   12  4 22 20:26 .gitignore<br/>-rw-r--r--   1 shin.takahashi  staff   88  4 22 20:26 .gitmodules<br/>-rw-r--r--   1 shin.takahashi  staff  129  4 22 20:26 foundry.toml<br/>drwxr-xr-x   3 shin.takahashi  staff   96  4 22 20:26 lib<br/>drwxr-xr-x   3 shin.takahashi  staff   96  4 22 20:26 src<br/>drwxr-xr-x   3 shin.takahashi  staff   96  4 22 20:26 test</span></pre><h1 id="afd7" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">执行合同</h1><ul class=""><li id="5265" class="kx ky ht kb b kc kd kg kh kk mi ko mj ks mk kw le lf lg lh dt translated">由于“src/Contract.sol”是一个空文件，所以让我们实现一个测试契约。这一次，我将使用混音附带的storage.sol。</li></ul><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="f9c1" class="mv jc ht mr b fv mw mx l my mz">// SPDX-License-Identifier: UNLICENSED<br/>pragma solidity ^0.8.13;</span><span id="da58" class="mv jc ht mr b fv na mx l my mz">contract Contract {<br/>    uint256 number;</span><span id="f0f5" class="mv jc ht mr b fv na mx l my mz">     /**<br/>     * <a class="ae ml" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Store value in variable<br/>     * <a class="ae ml" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> num value to store<br/>     */<br/>    function store(uint256 num) public {<br/>        number = num;<br/>    }</span><span id="94bb" class="mv jc ht mr b fv na mx l my mz">     /**<br/>     * <a class="ae ml" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Return value <br/>     * <a class="ae ml" href="http://twitter.com/return" rel="noopener ugc nofollow" target="_blank">@return</a> value of 'number'<br/>     */<br/>    function retrieve() public view returns (uint256){<br/>        return number;<br/>    }</span><span id="84d1" class="mv jc ht mr b fv na mx l my mz">}</span></pre><h1 id="794d" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">编制</h1><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="f668" class="mv jc ht mr b fv mw mx l my mz">% forge build --contracts ./src/Contract.sol <br/>[⠊] Compiling...<br/>[⠊] installing solc version "0.8.13"<br/>[⠘] Successfully installed solc 0.8.13<br/>[⠢] Compiling 3 files with 0.8.13<br/>[⠆] Solc finished in 232.37ms<br/>Compiler run successful</span></pre><h1 id="d17d" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">试验</h1><ul class=""><li id="b246" class="kx ky ht kb b kc kd kg kh kk mi ko mj ks mk kw le lf lg lh dt translated">Foundry允许你在solidity中实现你的测试代码。</li><li id="bfe8" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated">继承并实现“DSTest ”,它是创建项目时生成的测试类。</li><li id="5cf9" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated"><strong class="kb hu">似乎它不被认为是测试函数，除非在测试函数的开头加上“test”。请注意，我在不知情的情况下在这里度过了时光。例如:“testXXXX”。</strong></li></ul><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="eff7" class="mv jc ht mr b fv mw mx l my mz">// SPDX-License-Identifier: UNLICENSED<br/>pragma solidity ^0.8.13;</span><span id="7d38" class="mv jc ht mr b fv na mx l my mz">import "../src/Contract.sol";<br/>import "../lib/ds-test/src/test.sol";</span><span id="ccc5" class="mv jc ht mr b fv na mx l my mz">contract ContractTest is DSTest {<br/>    <br/>    Contract test_contract;</span><span id="989b" class="mv jc ht mr b fv na mx l my mz">function setUp() public {<br/>        test_contract = new Contract();<br/>    }</span><span id="16b4" class="mv jc ht mr b fv na mx l my mz">function testStoreOK() public {<br/>        test_contract.store(1);<br/>        assertEq(test_contract.retrieve(),1);<br/>    }</span><span id="0eb3" class="mv jc ht mr b fv na mx l my mz">function testSotreNG() public {<br/>        test_contract.store(2);<br/>        assertTrue(test_contract.retrieve()!=3);<br/>    }</span><span id="06d0" class="mv jc ht mr b fv na mx l my mz">function testStoreFuzzing(uint256 x) public {<br/>        test_contract.store(x);<br/>        assertEq(test_contract.retrieve(), x);<br/>    }<br/>}</span></pre><ul class=""><li id="63d2" class="kx ky ht kb b kc kz kg la kk lb ko lc ks ld kw le lf lg lh dt translated">正常执行的测试如下。</li></ul><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="2d15" class="mv jc ht mr b fv mw mx l my mz">forge test --contracts ./test/Contract.t.sol       <br/>[⠢] Compiling...<br/>[⠒] Compiling 3 files with 0.8.13<br/>[⠑] Solc finished in 279.62ms<br/>Compiler run successful</span><span id="4c4b" class="mv jc ht mr b fv na mx l my mz">Running 3 tests for test/Contract.t.sol:ContractTest<br/>[PASS] testSotreNG() (gas: 28279)<br/>[PASS] testStoreFuzzing(uint256) (runs: 256, μ: 27984, ~: 28451)<br/>[PASS] testStoreOK() (gas: 28303)<br/>Test result: ok. 3 passed; 0 failed; finished in 48.35ms</span></pre><ul class=""><li id="0bcc" class="kx ky ht kb b kc kz kg la kk lb ko lc ks ld kw le lf lg lh dt translated">您可以输出堆栈跟踪。</li></ul><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="5518" class="mv jc ht mr b fv mw mx l my mz">forge test -vvvvv --contracts ./test/Contract.t.sol<br/>[⠆] Compiling...<br/>No files changed, compilation skipped</span><span id="6d13" class="mv jc ht mr b fv na mx l my mz">Running 3 tests for test/Contract.t.sol:ContractTest<br/>[PASS] testSotreNG() (gas: 28279)<br/>Traces:<br/>  [71895] ContractTest::setUp() <br/>    ├─ [34487] → new Contract@0xce71065d4017f316ec606fe4422e11eb2c47c246<br/>    │   └─ ← 172 bytes of code<br/>    └─ ← ()</span><span id="8e1a" class="mv jc ht mr b fv na mx l my mz">[28279] ContractTest::testSotreNG() <br/>    ├─ [22312] Contract::store(2) <br/>    │   └─ ← ()<br/>    ├─ [246] Contract::retrieve() [staticcall]<br/>    │   └─ ← 2<br/>    └─ ← ()</span><span id="94ef" class="mv jc ht mr b fv na mx l my mz">[PASS] testStoreFuzzing(uint256) (runs: 256, μ: 27595, ~: 28451)<br/>Traces:<br/>  [71895] ContractTest::setUp() <br/>    ├─ [34487] → new Contract@0xce71065d4017f316ec606fe4422e11eb2c47c246<br/>    │   └─ ← 172 bytes of code<br/>    └─ ← ()</span><span id="ef70" class="mv jc ht mr b fv na mx l my mz">[PASS] testStoreOK() (gas: 28303)<br/>Traces:<br/>  [71895] ContractTest::setUp() <br/>    ├─ [34487] → new Contract@0xce71065d4017f316ec606fe4422e11eb2c47c246<br/>    │   └─ ← 172 bytes of code<br/>    └─ ← ()</span><span id="51f2" class="mv jc ht mr b fv na mx l my mz">[28303] ContractTest::testStoreOK() <br/>    ├─ [22312] Contract::store(1) <br/>    │   └─ ← ()<br/>    ├─ [246] Contract::retrieve() [staticcall]<br/>    │   └─ ← 1<br/>    └─ ← ()</span><span id="e6d0" class="mv jc ht mr b fv na mx l my mz">Test result: ok. 3 passed; 0 failed; finished in 51.47ms</span></pre><h2 id="d779" class="mv jc ht bd jd nb nc nd jh ne nf ng jl kk nh ni jp ko nj nk jt ks nl nm jx nn dt translated">模糊测试</h2><ul class=""><li id="fb18" class="kx ky ht kb b kc kd kg kh kk mi ko mj ks mk kw le lf lg lh dt translated">请注意testStoreFuzzing函数。</li><li id="c837" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated">这个函数使用uint256中的x作为参数。</li><li id="3df0" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated">通过给参数一个随机值来运行测试是一个很好的特性。</li></ul><pre class="mm mn mo mp fq mq mr ms mt aw mu dt"><span id="c0fe" class="mv jc ht mr b fv mw mx l my mz">[PASS] testStoreFuzzing(uint256) (runs: 256, μ: 27595, ~: 28451)<br/>Traces:<br/>  [71895] ContractTest::setUp() <br/>    ├─ [34487] → new Contract@0xce71065d4017f316ec606fe4422e11eb2c47c246<br/>    │   └─ ← 172 bytes of code<br/>    └─ ← ()</span><span id="26b0" class="mv jc ht mr b fv na mx l my mz">[PASS] testStoreOK() (gas: 28303)</span></pre><h1 id="cd82" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">结论</h1><p id="4bb5" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">老实说，我发现很难使用安全帽，因为它太棒了，我已经太习惯了。但是，我认为测试代码可以可靠地实现的点和执行随机测试的点是非常奇妙的功能。它似乎没有像hardhat那样的节点。也许我就是找不到。<br/>非常期待未来的版本升级和功能增加。</p></div><div class="ab cl no np hb nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="hm hn ho hp hq"><h1 id="4ab3" class="jb jc ht bd jd je nv jg jh ji nw jk jl jm nx jo jp jq ny js jt ju nz jw jx jy dt translated">关于Astar</h1><p id="d606" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">Astar Network(以前称为Plasm)是Polkadot上的一个dApp hub，支持以太坊、WebAssembly和第2层解决方案，如ZK汇总。Astar的目标是成为一个多链智能合约平台，支持多种区块链和虚拟机。Polkadot中继链不支持智能合约。这就是为什么生态系统必须有一个副链，让所有想要在Polkadot生态系统中构建的开发者都能够做到这一点。Astar致力于为所有开发商提供最佳解决方案，支持EVM，打造一条EVM和WASM智能合同共存、互通的纽带。</p><h1 id="b498" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">跟着我们</h1><p id="ea06" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated"><a class="ae ml" href="https://astar.network/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hu">网站</strong> </a> <strong class="kb hu"> | </strong> <a class="ae ml" href="https://twitter.com/AstarNetwork" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hu">推特</strong> </a> <strong class="kb hu"> | </strong> <a class="ae ml" href="https://discord.gg/Z3nC9U4" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hu">不和</strong> </a> <strong class="kb hu"> | </strong> <a class="ae ml" href="https://t.me/PlasmOfficial" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hu">电报</strong></a><strong class="kb hu">|</strong><a class="ae ml" href="https://github.com/AstarNetwork" rel="noopener ugc nofollow" target="_blank"><strong class="kb hu">Github</strong></a></p><blockquote class="oa"><p id="d83e" class="ob oc ht bd od oe of og oh oi oj kw ek translated">加入Coinmonks <a class="ae ml" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ml" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="b52a" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm ok jo jp jq ol js jt ju om jw jx jy dt translated">另外，阅读</h1><ul class=""><li id="bf45" class="kx ky ht kb b kc kd kg kh kk mi ko mj ks mk kw le lf lg lh dt translated"><a class="ae ml" href="https://coincodecap.com/best-crypto-books" rel="noopener ugc nofollow" target="_blank"> 10本关于加密的最佳书籍</a> | <a class="ae ml" href="https://coincodecap.com/uk-trading-bots" rel="noopener ugc nofollow" target="_blank">英国5个最佳加密机器人</a></li><li id="cf18" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated"><a class="ae ml" href="https://coincodecap.com/koinly-review" rel="noopener ugc nofollow" target="_blank">ko only回顾</a> | <a class="ae ml" href="https://coincodecap.com/binaryx-review" rel="noopener ugc nofollow" target="_blank"> Binaryx回顾</a>|<a class="ae ml" href="https://coincodecap.com/hodlnaut-vs-cakedefi-vs-celsius" rel="noopener ugc nofollow" target="_blank">Hodlnaut vs CakeDefi</a></li><li id="8963" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated"><a class="ae ml" href="https://coincodecap.com/bybit-binance-moonxbt" rel="noopener ugc nofollow" target="_blank"> MoonXBT vs Bybit vs币安</a> | <a class="ae ml" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a></li><li id="1dd0" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated"><a class="ae ml" href="https://coincodecap.com/huobi-trading-bot" rel="noopener ugc nofollow" target="_blank">火币交易机器人</a> | <a class="ae ml" href="https://coincodecap.com/buy-ada-cardano" rel="noopener ugc nofollow" target="_blank">如何购买ADA </a> | <a class="ae ml" href="https://coincodecap.com/geco-one-review" rel="noopener ugc nofollow" target="_blank"> Geco？一次回顾</a></li><li id="29ab" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated"><a class="ae ml" href="https://coincodecap.com/binance-vs-bitstamp" rel="noopener ugc nofollow" target="_blank">币安vs比特邮票</a> | <a class="ae ml" href="https://coincodecap.com/bitpanda-coinbase-coinsbit" rel="noopener ugc nofollow" target="_blank">比特熊猫vs比特币基地vs Coinsbit </a></li><li id="1caf" class="kx ky ht kb b kc li kg lj kk lk ko ll ks lm kw le lf lg lh dt translated"><a class="ae ml" href="https://coincodecap.com/buy-ripple-india" rel="noopener ugc nofollow" target="_blank">如何购买Ripple (XRP) </a> | <a class="ae ml" href="https://coincodecap.com/crypto-exchange-africa" rel="noopener ugc nofollow" target="_blank">非洲最好的加密交易所</a></li></ul></div></div>    
</body>
</html>